<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="&amp;nbsp;http://www.html5rocks.com/en/tutorials/file/xhr2/&amp;nbsp;IntroductionOne of the unsung heros in the HTML5 universe is XMLHttpRequest.  Strictly speaking XHR2 isn’t HTML5. However, it’s part of th">
<meta property="og:type" content="article">
<meta property="og:title" content="New Tricks in XMLHttpRequest2">
<meta property="og:url" content="http://blog.pickbox.me/2011/06/11/New-Tricks-in-XMLHttpRequest2/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="&amp;nbsp;http://www.html5rocks.com/en/tutorials/file/xhr2/&amp;nbsp;IntroductionOne of the unsung heros in the HTML5 universe is XMLHttpRequest.  Strictly speaking XHR2 isn’t HTML5. However, it’s part of th">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="New Tricks in XMLHttpRequest2">
<meta name="twitter:description" content="&amp;nbsp;http://www.html5rocks.com/en/tutorials/file/xhr2/&amp;nbsp;IntroductionOne of the unsung heros in the HTML5 universe is XMLHttpRequest.  Strictly speaking XHR2 isn’t HTML5. However, it’s part of th">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2011/06/11/New-Tricks-in-XMLHttpRequest2/"/>


  <title> New Tricks in XMLHttpRequest2 | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                New Tricks in XMLHttpRequest2
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2011-06-11T12:01:00+08:00" content="2011-06-11">
              2011-06-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python-js-php-html-mysql-http/" itemprop="url" rel="index">
                    <span itemprop="name">python/js/php/html/mysql/http</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
         <p>&nbsp;</p><p><a target="_blank" href="http://www.html5rocks.com/en/tutorials/file/xhr2/">http://www.html5rocks.com/en/tutorials/file/xhr2/</a></p><p>&nbsp;</p><p>Introduction</p><p>One of the unsung heros in the HTML5 universe is XMLHttpRequest.  Strictly speaking XHR2 isn’t HTML5. However, it’s part of the incremental improvements  browser vendors are making to the core platform. I’m including XHR2 in our new bag of  goodies because it plays such an integral part in today’s complex web apps.</p><p>Turns out our old friend got a huge makeover but many folks  are unaware of its new features. <a href="http://dev.w3.org/2006/webapi/%20-2/" target="_blank" rel="external">XMLHttpRequest Level 2</a>  introduces a slew of new capabilities which put an end to crazy hacks in our web apps;  things like cross-origin requests, uploading progress events,  and support for uploading/downloading binary data. These allow AJAX  to work in concert with many of the bleeding edge HTML5 APIs such as <a href="http://www.html5rocks.com/tutorials/file/filesystem/" target="_blank" rel="external">File System API</a>,  <a href="http://chromium.googlecode.com/svn/trunk/samples/audio/specification/specification.html" target="_blank" rel="external">Web Audio API</a>,  and WebGL.</p><p>This tutorial highlights some of the new features in XMLHttpRequest,  especially those that can be used for <a href="http://www.html5rocks.com/tutorials/file/dndfiles/" target="_blank" rel="external">working with files</a>.</p>Fetching data<p>Fetching a file as a binary blob has been painful with XHR. Technically,  it wasn’t even possible. One trick that has been well documented involves  overriding the mime type with a user-defined charset as seen below.</p><p>The old way to fetch an image:</p>var xhr =newXMLHttpRequest();<br>xhr.open(‘GET’,’/path/to/image.png’,true);<br><br>// Hack to pass bytes through unprocessed.<br><b>xhr.overrideMimeType(‘text/plain; charset=x-user-defined’);</b><br><br>xhr.onreadystatechange =function(e){<br>&nbsp; if(this.readyState ==4&amp;&amp;this.status ==200){<br>&nbsp; &nbsp; var binStr =this.responseText;<br>&nbsp; &nbsp; for(var i =0, len = binStr.length; i &lt; len;++i){<br>&nbsp; &nbsp; &nbsp; <b>var c = binStr.charCodeAt(i);</b><br>&nbsp; &nbsp; &nbsp; <b>//String.fromCharCode(c &amp; 0xff);</b><br>&nbsp; &nbsp; &nbsp; <b>varbyte= c &amp;0xff; &nbsp;// byte at offset i</b><br>&nbsp; &nbsp; }<br>&nbsp; }<br>};<br><br>xhr.send();<p>While this works, what you actually get back in the responseText  is not a binary blob. It is a binary string representing the image file.  We’re tricking the server into passing the data back, unprocessed.  Even though this little gem works, I’m going to call it black magic and advise  against it. Anytime you resort to character code hacks and string manipulation  for coercing data into a desirable format, that’s a problem.</p>Specifying a response format<p>In the previous example, we downloaded the image as a binary &quot;file&quot;  by overriding the server’s mime type and processing the response text as a binary string.  Instead, let’s leverage XMLHttpRequest’s new  responseType and response properties to inform  the browser what format we want the data returned as.</p>xhr.<strong>responseType</strong><br>Before sending a request, set the xhr.responseType    to &quot;text&quot;, &quot;arraybuffer&quot;, &quot;blob&quot;, or &quot;document&quot;, depending on your data needs.    Note, setting xhr.responseType = ‘’ (or omitting) will default    the response to &quot;text&quot;.xhr.<strong>response</strong>After a successful request, the xhr’s response property will    contain the requested data as a DOMString, ArrayBuffer,    Blob, or Document (depending on what was set for    responseType.)<p>With this new awesomeness, we can rework the previous example, but this time,  fetch the image as an ArrayBuffer instead of a string. Handing the  buffer over to the BlobBuilder API creates a Blob:</p>BlobBuilder= window.MozBlobBuilder|| window.WebKitBlobBuilder|| window.BlobBuilder;<br><br>var xhr =newXMLHttpRequest();<br>xhr.open(‘GET’,’/path/to/image.png’,true);<br><b>xhr.responseType =’arraybuffer’;</b><br><br><b>xhr.onload</b>=function(e){<br>&nbsp; if(this.status ==200){<br>&nbsp; &nbsp; var bb =newBlobBuilder();<br>&nbsp; &nbsp; bb.append(<b>this.response</b>);// Note: not xhr.responseText<br><br>&nbsp; &nbsp; var blob = bb.getBlob(‘image/png’);<br>&nbsp; &nbsp; …<br>&nbsp; }<br>};<br><br>xhr.send();<p>Much nicer!</p>ArrayBuffer responses<p>An <a href="https://developer.mozilla.org/en/%20_typed_arrays/ArrayBuffer" target="_blank" rel="external">ArrayBuffer</a>    is a generic fixed-length container for binary data. They are super handy if you    need a generalized buffer of raw data, but the real power behind these guys is that    you can create &quot;views&quot; of the underlying data using <a href="https://developer.mozilla.org/en/%20_typed_arrays" target="_blank" rel="external">JavaScript typed arrays</a>.    In fact, multiple views can be created from a single ArrayBuffer source.    For example, you could create an 8-bit integer array that shares the same ArrayBuffer    as an existing 32-bit integer array from the same data. The underlying data    remains the same, we just create different representations of it.</p><p>As an example, the following fetches our same image as an ArrayBuffer,    but this time, creates an unsigned 8-bit integer array from that data buffer:</p>var xhr =newXMLHttpRequest();<br>xhr.open(‘GET’,’/path/to/image.png’,true);<br><b>xhr.responseType =’arraybuffer’;</b><br><br><b>xhr.onload</b>=function(e){<br>&nbsp; var uInt8Array =new<b>Uint8Array</b>(<b>this.response</b>);// this.response == uInt8Array.buffer<br>&nbsp; // var byte3 = uInt8Array[4]; // byte at offset 4<br>&nbsp; …<br>};<br><br>xhr.send();Blob responses<p>If you want to work directly with a <a href="https://developer.mozilla.org/en/DOM/Blob" target="_blank" rel="external">Blob</a> and/or  don’t need to manipulate any of the file’s bytes, use xhr.responseType=’blob’  (currently unimplemented in Chrome (<a href="http://crbug.com/52486" target="_blank" rel="external">crbug.com/52486</a>):</p>window.URL = window.URL || window.webkitURL; &nbsp;// Take care of vendor prefixes.<br><br>var xhr =newXMLHttpRequest();<br>xhr.open(‘GET’,’/path/to/image.png’,true);<br><b>xhr.responseType =’blob’;</b><br><br><b>xhr.onload</b>=function(e){<br>&nbsp; if(this.status ==200){<br>&nbsp; &nbsp; var blob =<b>this.response</b>;<br><br>&nbsp; &nbsp; var img = document.createElement(‘img’);<br>&nbsp; &nbsp; img.onload =function(e){<br>&nbsp; &nbsp; &nbsp; <b>window.URL.revokeObjectURL(img.src);</b>// Clean up after yourself.<br>&nbsp; &nbsp; };<br>&nbsp; &nbsp; img.src =<b>window.URL.createObjectURL(blob);</b><br>&nbsp; &nbsp; document.body.appendChild(img);<br>&nbsp; &nbsp; …<br>&nbsp; }<br>};<br><br>xhr.send();<p>A Blob can be used in a number of places, including savingit to <a href="http://www.html5rocks.com/tutorials/indexeddb/todo/" target="_blank" rel="external">indexedDB</a>, writing it to the HTML5 <a href="http://www.html5rocks.com/tutorials/file/filesystem/" target="_blank" rel="external">File System</a>,or <a href="http://www.html5rocks.com/tutorials/workers/basics/#toc-inlineworkers-bloburis" target="_blank" rel="external">creating an Blob URL</a>, as seenin this example.</p>Sending data<p>Being able to <a href="http://www.html5rocks.com/en/tutorials/file/xhr2/#toc-response" target="_blank" rel="external">download data in different formats</a> is great, but it doesn’t  get us anywhere if we can’t send these rich formats back to home base (the server).  XMLHttpRequest has limited us to sending DOMString  or Document (XML) data for some time. Not anymore. A revamped send()  method has been overridden to accept any of the following types:  DOMString, Document, FormData, Blob,  File, ArrayBuffer. The examples in the rest of this  section demonstrate sending data using each type.</p>Sending string data: xhr.send(DOMString)function sendText(txt){<br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; xhr.onload =function(e){<br>&nbsp; &nbsp; if(this.status ==200){<br>&nbsp; &nbsp; &nbsp; console.log(<b>this.responseText</b>);<br>&nbsp; &nbsp; }<br>&nbsp; };<br><br>&nbsp; xhr.send(txt);<br>}<br><br>sendText(<b>‘test string’</b>);function sendTextNew(txt){<br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; <b>xhr.responseType =’text’;</b><br>&nbsp; xhr.onload =function(e){<br>&nbsp; &nbsp; if(this.status ==200){<br>&nbsp; &nbsp; &nbsp; console.log(<b>this.response</b>);<br>&nbsp; &nbsp; }<br>&nbsp; };<br>&nbsp; xhr.send(txt);<br>}<br><br>sendText2(<b>‘test string’</b>);<p>There’s nothing new here, though the right snippet is slightly different.  It sets responseType=’text’ for comparison. Again, omitting that line  yields the same results.</p>Submitting forms: xhr.send(FormData)<p>Many people are probably accustomed to using <a href="http://jquery.malsup.com/form/" target="_blank" rel="external">jQuery plugins</a>  or other libraries to handle AJAX form submissions. Instead, we can use <a href="https://developer.mozilla.org/en/%20/FormData" target="_blank" rel="external">FormData</a>,  another new data type conceived for XHR2. FormData  is convenient for creating an HTML &lt;form&gt; on-the-fly, in JavaScript.  That form can then be submitted using AJAX:</p>function sendForm(){<br>&nbsp; var formData =new<b>FormData</b>();<br>&nbsp; <b>formData.append</b>(‘username’,’johndoe’);<br>&nbsp; <b>formData.append</b>(‘id’,123456);<br><br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; xhr.onload =function(e){…};<br><br>&nbsp; xhr.send(<b>formData</b>);<br>}<p>Essentially, we’re just dynamically creating a &lt;form&gt; and tacking on  &lt;input&gt; values to it by calling the append method.</p><p>Of course, you don’t need to create a &lt;form&gt; from scratch.  FormData objects can be initialized from and existing HTMLFormElement  on the page. For example:</p>&lt;formid=&quot;myform&quot;name=&quot;myform&quot;action=&quot;/server&quot;&gt;<br>&nbsp; &lt;inputtype=&quot;text&quot;name=&quot;username&quot;value=&quot;johndoe&quot;&gt;<br>&nbsp; &lt;inputtype=&quot;number&quot;name=&quot;id&quot;value=&quot;123456&quot;&gt;<br>&nbsp; &lt;inputtype=&quot;submit&quot;onclick=&quot;<b>return sendForm(this.form);</b>&quot;&gt;<br>&lt;/form&gt;function sendForm(form){<br>&nbsp; var formData =new<b>FormData</b>(form);<br><br>&nbsp; <b>formData.append</b>(‘secret_token’,’1234567890’);// Append extra data before send.<br><br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’, form.action,true);<br>&nbsp; xhr.onload =function(e){…};<br><br>&nbsp; xhr.send(<b>formData</b>);<br><br>&nbsp; returnfalse;// Prevent page from submitting.<br>}<p>An HTML form can include file uploads (e.g. &lt;input type=&quot;file&quot;&gt;)  and  FormData can handle that too. Simply append the file(s) and the browser will  construct a multipart/form-data request when send() is called:</p>function uploadFiles(url, files){<br>&nbsp; var formData =new<b>FormData</b>();<br><br>&nbsp; for(var i =0, file; file = files[i];++i){<br>&nbsp; &nbsp; <b>formData.append(file.name, file);</b><br>&nbsp; }<br><br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’, url,true);<br>&nbsp; xhr.onload =function(e){…};<br><br>&nbsp; xhr.send(<b>formData</b>); &nbsp;// multipart/form-data<br>}<br><br>document.querySelector(‘input[type=&quot;file&quot;]’).addEventListener(‘change’,function(e){<br>&nbsp; uploadFiles(‘/server’,this.files);<br>},false);Uploading a file or blob: xhr.send(Blob)<p>We can also send File or Blob data using XHR.  Keep in mind all Files are Blobs, so either works here.</p><p>This example creates a new text file from scratch using the BlobBuilder API  and uploads that Blob to the server. The code also sets up a handler  to inform the user of the upload’s progress:</p>&lt;progressmin=&quot;0&quot;max=&quot;100&quot;value=&quot;0&quot;&gt;0% complete&lt;/progress&gt;function upload(blobOrFile){<br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; xhr.onload =function(e){…};<br><br>&nbsp; // Listen to the upload progress.<br>&nbsp; var progressBar = document.querySelector(‘progress’);<br>&nbsp; <b>xhr.upload.onprogress</b>=function(e){<br>&nbsp; &nbsp; if(e.lengthComputable){<br>&nbsp; &nbsp; &nbsp; progressBar.value =(e.loaded / e.total)<em>100;<br>&nbsp; &nbsp; &nbsp; progressBar.textContent = progressBar.value;// Fallback for unsupported browsers.<br>&nbsp; &nbsp; }<br>&nbsp; };<br><br>&nbsp; xhr.send(<b>blobOrFile</b>);<br>}<br><br>// Take care of vendor prefixes.<br>BlobBuilder= window.MozBlobBuilder|| window.WebKitBlobBuilder|| window.BlobBuilder;<br><br>var bb =new<b>BlobBuilder</b>();<br><b>bb.append</b>(‘hello world’);<br><br>upload(<b>bb.getBlob(‘text/plain’)</b>);Uploading a chunk of bytes: xhr.send(ArrayBuffer)<p>Last but not least, we can send ArrayBuffers as the XHR’s payload.</p>function sendArrayBuffer(){<br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; xhr.onload =function(e){…};<br><br>&nbsp; <b>var uInt8Array =new</b><b>Uint8Array</b>([1,2,3]);<br><br>&nbsp; xhr.send(<b>uInt8Array.buffer</b>);<br><p>}</p><p></p><p>&nbsp;</p><p>&nbsp;</p><p>Practical examples</p><p><strong>Download + save files to the HTML5 file system</strong></p><p>Let’s say you have an image gallery and want to fetch a bunch  of images then save them locally using the <a href="http://www.html5rocks.com/tutorials/file/filesystem/" target="_blank" rel="external">HTML5 File System</a>.  One way to accomplish this would be to request images as ArrayBuffers,  build a Blob from the data, and write the blob using FileWriter:</p>window.requestFileSystem &nbsp;= window.requestFileSystem || window.webkiRequestFileSystem;<br><br>function onError(e){<br>&nbsp; console.log(‘Error’, e);<br>}<br><br>var xhr =newXMLHttpRequest();<br>xhr.open(‘GET’,’/path/to/image.png’,true);<br><b>xhr.responseType =’arraybuffer’;</b><br><br><b>xhr.onload</b>=function(e){<br><br>&nbsp; <b>window.requestFileSystem</b>(TEMPORARY,1024</em>1024,function(fs){<br>&nbsp; &nbsp; fs.root.getFile(‘image.png’,{create:true},function(fileEntry){<br>&nbsp; &nbsp; &nbsp; fileEntry.createWriter(function(writer){<br><br>&nbsp; &nbsp; &nbsp; &nbsp; writer.onwrite =function(e){…};<br>&nbsp; &nbsp; &nbsp; &nbsp; writer.onerror =function(e){…};<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <b>var bb =newBlobBuilder();</b><br>&nbsp; &nbsp; &nbsp; &nbsp; <b>bb.append</b>(<b>this.response</b>);<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <b>writer.write</b>(bb.getBlob(‘image/png’));<br><br>&nbsp; &nbsp; &nbsp; }, onError);<br>&nbsp; &nbsp; }, onError);<br>&nbsp; }, onError);<br>};<br><br>xhr.send();<p><strong>Note:</strong> to use this code, see <a href="http://www.html5rocks.com/tutorials/file/filesystem/#toc-support" target="_blank" rel="external">browser support &amp; storage limitations</a>  in the &quot;<a href="http://www.html5rocks.com/tutorials/file/filesystem/" target="_blank" rel="external">Exploring the FileSystem APIs</a>&quot; tutorial.</p><strong>Slicing a file and uploading each portion</strong><p>Using the <a href="http://www.html5rocks.com/tutorials/file/dndfiles/" target="_blank" rel="external">File APIs</a>, we can minimize  the work to upload a large file. The technique is to slice the upload into multiple chunks,  spawn an XHR for each portion, and put the file together on the server. This is  similar to how GMail uploads large attachments so quickly. Such a technique could also be  used to get around Google App Engine’s 32MB http request limit.</p>window.BlobBuilder= window.MozBlobBuilder|| window.WebKitBlobBuilder||<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;window.BlobBuilder;<br><br>function upload(blobOrFile){<br>&nbsp; var xhr =newXMLHttpRequest();<br>&nbsp; xhr.open(‘POST’,’/server’,true);<br>&nbsp; xhr.onload =function(e){…};<br>&nbsp; xhr.send(blobOrFile);<br>}<br><br>document.querySelector(‘input[type=&quot;file&quot;]’).addEventListener(‘change’,function(e){<br>&nbsp; var blob =this.files[0];<br><br>&nbsp; const BYTES_PER_CHUNK =1024*1024;// 1MB chunk sizes.<br>&nbsp; const SIZE = blob.size;<br><br>&nbsp; var start =0;<br>&nbsp; varend= BYTES_PER_CHUNK;<br><br>&nbsp; while(start &lt; SIZE){<br><br>&nbsp; &nbsp; // Note: blob.slice has changed semantics and been prefixed. See <a href="http://goo.gl/U9mE5" target="_blank" rel="external">http://goo.gl/U9mE5</a>.<br>&nbsp; &nbsp; if(‘mozSlice’in blob){<br>&nbsp; &nbsp; &nbsp; var chunk = blob.mozSlice(start,end);<br>&nbsp; &nbsp; }else{<br>&nbsp; &nbsp; &nbsp; var chunk = blob.webkitSlice(start,end);<br>&nbsp; &nbsp; }<br><br>&nbsp; &nbsp; upload(chunk);<br><br>&nbsp; &nbsp; start =end;<br>&nbsp; &nbsp; end= start + BYTES_PER_CHUNK;<br>&nbsp; }<br>},false);<br><br>})();<p>What is not shown here is the code to reconstruct the file on the server.</p><p><strong>Try it!</strong></p> 
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2011/06/11/JavaScript-Equality-and-Identity/" rel="next" title="JavaScript Equality (==) and Identity (===)">
                <i class="fa fa-chevron-left"></i> JavaScript Equality (==) and Identity (===)
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2011/06/13/HTML5-in-5-minutes/" rel="prev" title="HTML5 in 5 minutes">
                HTML5 in 5 minutes <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  
<script type="text/javascript">
function attach () {
    $('body').append('<img src="http://p.pickbox.me/pv">');
    $(document).unbind('scroll', attach);
}
$(document).bind('scroll', attach);
</script>



</body>
</html>
