<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="&amp;nbsp;
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/
&amp;nbsp;
Custom Account / Sync adapter: inability to">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Sync Provider">
<meta property="og:url" content="http://blog.pickbox.me/2011/08/01/Android-Sync-Provider/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="&amp;nbsp;
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/
&amp;nbsp;
Custom Account / Sync adapter: inability to">
<meta property="og:image" content="http://img.pickbox.me/wp-content/uploads/pic/b152d7628535e5dd1487069076c6a7efcf1b6263.jpg">
<meta property="og:image" content="http://img.pickbox.me/wp-content/uploads/pic/42aeb33533fa828bc168e2acfd1f4134960a5a42.jpg">
<meta property="og:image" content="http://img.pickbox.me/wp-content/uploads/pic/4fa531fa828ba61ec0a5b7604134970a314e5942.jpg">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Sync Provider">
<meta name="twitter:description" content="&amp;nbsp;
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/
http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/
&amp;nbsp;
Custom Account / Sync adapter: inability to">
<meta name="twitter:image" content="http://img.pickbox.me/wp-content/uploads/pic/b152d7628535e5dd1487069076c6a7efcf1b6263.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2011/08/01/Android-Sync-Provider/"/>


  <title> Android Sync Provider | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android Sync Provider
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2011-08-01T22:34:00+08:00" content="2011-08-01">
              2011-08-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>&nbsp;</p>
<p><a href="http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/" target="_blank">http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-1/</a></p>
<p><a href="http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/" target="_blank">http://www.c99.org/2010/01/23/writing-an-android-sync-provider-part-2/</a></p>
<p>&nbsp;</p>
<p>Custom Account / Sync adapter: inability to edit contacts?</p>
<p><a href="http://groups.google.com/group/android-developers/browse_thread/thread/c4003febfe3a5690" target="_blank" rel="external">http://groups.google.com/group/android-developers/browse_thread/thread/c4003febfe3a5690</a></p>
<p><a href="http://code.google.com/p/android/issues/detail?id=5988" target="_blank" rel="external">http://code.google.com/p/android/issues/detail?id=5988</a></p>
<p>&nbsp;</p>
<p>Writing an Android Sync Provider: Part 1January 23rd, 2010 <a title="Posts by Sam Steele" href="http://www.c99.org/author/admin/" rel="external" target="_blank">Sam Steele</a></p>
<p>One of the highlights of the Android 2.0 SDK is that you can write custom sync providers to integrate with the system contacts, calendars, etc. The only problem is that there’s very little documentation on how it all fits together. And worse, if you mess up in certain places, the Android system will crash and reboot! Always up for a challenge, I’ve navigated through the sparse documentation, vague mailing list posts, and the Android source code itself to build a sync provider for our Last.fm app. Want to know how to build your own? Read on!</p>
<p>Account Authenticators</p>
<p>The first piece of the puzzle is called an <a href="http://developer.android.com/reference/android/accounts/AbstractAccountAuthenticator.html" target="_blank" rel="external">Account Authenticator</a>, which defines how the user’s account will appear in the “Accounts &amp; Sync” settings. Implementing an Account Authenticator requires 3 pieces: a service that returns a subclass of AbstractAccountAuthenticator from the onBind method, an activity to prompt the user to enter their credentials, and an xml file describing how your account should look when displayed to the user. You’ll also need to add the <b>android.permission.AUTHENTICATE_ACCOUNTS</b> permission to your AndroidManifest.xml.</p>
<p>The Service</p>
<p>The authenticator service is expected to return a subclass of AbstractAccountAuthenticator from the onBind method — if you don’t, Android will crash and reboot when you try to add a new account to the system. The only method in AbstractAccountAuthenticator we really need to implement is addAccount, which returns an Intent that the system will use to display the login dialog to the user. The implementation below will launch our app’s main launcher activity with an action of “fm.last.android.sync.LOGIN” and an extra containing the AccountAuthenticatorResponse object we use to pass data back to the system after the user has logged in.</p>
<p>AccountAuthenticatorService.java</p>
<p><ol><br>    <li>import fm.last.android.LastFm;</li><br>    <li>import android.accounts.AbstractAccountAuthenticator;</li><br>    <li>import android.accounts.Account;</li><br>    <li>import android.accounts.AccountAuthenticatorResponse;</li><br>    <li>import android.accounts.AccountManager;</li><br>    <li>import android.accounts.NetworkErrorException;</li><br>    <li>import android.app.Service;</li><br>    <li>import android.content.Context;</li><br>    <li>import android.content.Intent;</li><br>    <li>import android.os.Bundle;</li><br>    <li>import android.os.IBinder;</li><br>    <li>import android.util.Log;</li><br>    <li></li><br>    <li>/<em>*</em></li><br>    <li>  Authenticator service that returns a subclass of AbstractAccountAuthenticator in onBind()</li><br>    <li> <em>/</em></li><br>    <li>public class AccountAuthenticatorService extends Service {</li><br>    <li> private static final String TAG = “AccountAuthenticatorService”;</li><br>    <li> private static AccountAuthenticatorImpl sAccountAuthenticator = null;</li><br>    <li></li><br>    <li> public AccountAuthenticatorService() {</li><br>    <li>  super();</li><br>    <li> }</li><br>    <li></li><br>    <li> public IBinder onBind(Intent intent) {</li><br>    <li>  IBinder ret = null;</li><br>    <li>  if (intent.getAction().equals(android.accounts.AccountManager.ACTION_AUTHENTICATOR_INTENT))</li><br>    <li>   ret = getAuthenticator().getIBinder();</li><br>    <li>  return ret;</li><br>    <li> }</li><br>    <li></li><br>    <li> private AccountAuthenticatorImpl getAuthenticator() {</li><br>    <li>  if (sAccountAuthenticator == null)</li><br>    <li>   sAccountAuthenticator = new AccountAuthenticatorImpl(this);</li><br>    <li>  return sAccountAuthenticator;</li><br>    <li> }</li><br>    <li></li><br>    <li> private static class AccountAuthenticatorImpl extends AbstractAccountAuthenticator {</li><br>    <li>  private Context mContext;</li><br>    <li></li><br>    <li>  public AccountAuthenticatorImpl(Context context) {</li><br>    <li>   super(context);</li><br>    <li>   mContext = context;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  /</li><br>    <li>   <em>  The user has requested to add a new account to the system.  We return an intent that will launch our login screen if the user has not logged in yet,</em></li><br>    <li>     otherwise our activity will just pass the user’s credentials on to the account manager.</li><br>    <li>   */</li><br>    <li>  @Override</li><br>    <li>  public Bundle addAccount(AccountAuthenticatorResponse response, String accountType, String authTokenType,String[] requiredFeatures, Bundle options)</li><br>    <li>    throws NetworkErrorException {</li><br>    <li>   Bundle reply = new Bundle();</li><br>    <li></li><br>    <li>   Intent i = new Intent(mContext, LastFm.class);</li><br>    <li>   i.setAction(“fm.last.android.sync.LOGIN”);</li><br>    <li>   i.putExtra(AccountManager.KEY_ACCOUNT_AUTHENTICATOR_RESPONSE, response);</li><br>    <li>   reply.putParcelable(AccountManager.KEY_INTENT, i);</li><br>    <li></li><br>    <li>   return reply;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public Bundle confirmCredentials(AccountAuthenticatorResponse response, Account account, Bundle options) {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public Bundle editProperties(AccountAuthenticatorResponse response, String accountType) {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public Bundle getAuthToken(AccountAuthenticatorResponse response, Account account, String authTokenType, Bundle options) throws NetworkErrorException {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public String getAuthTokenLabel(String authTokenType) {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public Bundle hasFeatures(AccountAuthenticatorResponse response, Account account, String[] features)throws NetworkErrorException {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li></li><br>    <li>  @Override</li><br>    <li>  public Bundle updateCredentials(AccountAuthenticatorResponse response, Account account, StringauthTokenType, Bundle options) {</li><br>    <li>   return null;</li><br>    <li>  }</li><br>    <li> }</li><br>    <li>}</li><br></ol><br>The account authenticator service should be defined in your AndroidManifest.xml, with a meta-data tag referencing an xml definition file, as follows:</p>
<p>Snippet from AndroidManifest.xml</p>
<p><ol><br>    <li>&lt;service android:name=”AccountAuthenticatorService”</li><br>    <li> android:exported=”true” android:process=”:auth”&gt;</li><br>    <li> &lt;intent-filter&gt;</li><br>    <li>  &lt;action android:name=”android.accounts.AccountAuthenticator” /&gt;</li><br>    <li> &lt;/intent-filter&gt;</li><br>    <li> &lt;meta-data android:name=”android.accounts.AccountAuthenticator”</li><br>    <li>  android:resource=”@xml/authenticator” /&gt;</li><br>    <li>&lt;/service&gt;</li><br></ol><br>The Activity</p>
<p>If you don’t already have a login screen, there’s a convenience class <a href="http://developer.android.com/reference/android/accounts/AccountAuthenticatorActivity.html" target="_blank" rel="external">AccountAuthenticatorActivity</a> you can subclass that will pass your response back to the authentication manager for you, however if you already have a login activity in place you may find it easier to just pass the data back yourself, as I have done here. When the user has successfully been authenticated, we create an Account object for the user’s credentials. An account has an account name, such as the username or email address, and an account type, which you will define in your xml file next. You may find it easier to store your account type in strings.xml and use getString() to fetch it, as it is used in multiple places.</p>
<p>Snippet from the Last.fm login activity</p>
<p><ol><br>    <li>Account account = new Account(username, getString(R.string.ACCOUNT_TYPE)));</li><br>    <li>AccountManager am = AccountManager.get(this);</li><br>    <li>boolean accountCreated = am.addAccountExplicitly(account, password, null);</li><br>    <li></li><br>    <li>Bundle extras = getIntent.getExtras();</li><br>    <li>if (extras != null) {</li><br>    <li> if (accountCreated) {  //Pass the new account back to the account manager</li><br>    <li>  AccountAuthenticatorResponse response = extras.getParcelable(AccountManager.KEY_ACCOUNT_AUTHENTICATOR_RESPONSE);</li><br>    <li>  Bundle result = new Bundle();</li><br>    <li>  result.putString(AccountManager.KEY_ACCOUNT_NAME, username);</li><br>    <li>  result.putString(AccountManager.KEY_ACCOUNT_TYPE, getString(R.string.ACCOUNT_TYPE));</li><br>    <li>  response.onResult(result);</li><br>    <li> }</li><br>    <li> finish();</li><br>    <li>}</li><br></ol><br>The XML definition file</p>
<p>The account xml file defines what the user will see when they’re interacting with your account. It contains a user-readable name, the system account type you’re defining, various icons, and a reference to an xml file containing PreferenceScreens the user will see when modifying your account.</p>
<p>authenticator.xml</p>
<p><ol><br>    <li>&lt;account-authenticator xmlns:android=”<a href="http://schemas.android.com/apk/res/android" target="_blank" rel="external">http://schemas.android.com/apk/res/android</a>“</li><br>    <li>    android:accountType=”fm.last.android.account”</li><br>    <li>    android:icon=”@drawable/icon”</li><br>    <li>    android:smallIcon=”@drawable/icon”</li><br>    <li>    android:label=”@string/app_name”</li><br>    <li>    android:accountPreferences=”@xml/account_preferences”/&gt;</li><br></ol><br>account_preferences.xml</p>
<p><ol><br>    <li>&lt;PreferenceScreen</li><br>    <li>  xmlns:android=”<a href="http://schemas.android.com/apk/res/android&quot;&amp;gt" target="_blank" rel="external">http://schemas.android.com/apk/res/android&quot;&amp;gt</a>;</li><br>    <li>    &lt;PreferenceCategory</li><br>    <li>            android:title=”General Settings” /&gt;</li><br>    <li></li><br>    <li>    &lt;PreferenceScreen</li><br>    <li>        android:key=”account_settings”</li><br>    <li>        android:title=”Account Settings”</li><br>    <li>        android:summary=”Sync frequency, notifications, etc.”&gt;</li><br>    <li>        &lt;intent</li><br>    <li>            android:action=”fm.last.android.activity.Preferences.ACCOUNT_SETUP”</li><br>    <li>            android:targetPackage=”fm.last.android”</li><br>    <li>            android:targetClass=”fm.last.android.activity.Preferences” /&gt;</li><br>    <li>    &lt;/PreferenceScreen&gt;</li><br>    <li>&lt;/PreferenceScreen&gt;</li><br></ol><br>Putting it all together</p>
<p>Now we’re ready for testing! The Android accounts setting screen doesn’t handle exceptions very well — if something goes wrong, your device will reboot! A better way to test is to launch the emulator, run the “Dev Tools” app, and pick “AccountsTester”.<br><a href="http://www.c99.org/wp-content/uploads/2010/01/accountstester1.png" rel="external" target="_blank"><img alt="" src="http://img.pickbox.me/wp-content/uploads/pic/b152d7628535e5dd1487069076c6a7efcf1b6263.jpg" width="211" height="300"></a><br>You should see your new account type in the list, along with the built-in “Corporate” account type. Go ahead and select your account type from the drop-down list, and then press the “Add” button, and you should be presented with your login activity. After authenticating, your account should appear in a list below the buttons. At this point, it should be safe to use the system “Accounts &amp; Sync” settings screen to remove or modify your account.<br><a href="http://www.c99.org/wp-content/uploads/2010/01/accountsandsync1.png" rel="external" target="_blank"><img alt="" src="http://img.pickbox.me/wp-content/uploads/pic/42aeb33533fa828bc168e2acfd1f4134960a5a42.jpg" width="210" height="300"></a> <a href="http://www.c99.org/wp-content/uploads/2010/01/accountsandsync2.png" rel="external" target="_blank"><img alt="" src="http://img.pickbox.me/wp-content/uploads/pic/4fa531fa828ba61ec0a5b7604134970a314e5942.jpg" width="210" height="300"></a></p>
<p>Ready to fill in that section below “Data &amp; synchronization”? Let’s move on to <a href="http://blog.pickbox.me/archives/500" target="_blank">part 2</a>!</p>
<p>The source code for the implementation referenced here is available in my <a href="http://github.com/c99koder/lastfm-android/" target="_blank" rel="external">Last.fm github project</a> under the terms of the GNU General Public License. A standalone sample project is also available <a href="http://github.com/c99koder/AndroidSyncProviderDemo" target="_blank" rel="external">here</a> under the terms of the Apache License 2.0. Google has also released their own sample sync provider on the <a href="http://developer.android.com/resources/samples/SampleSyncAdapter/index.html" target="_blank" rel="external">Android developer portal</a>that’s a bit more complete than mine.</p>
<p>Categories: <a title="View all posts in Android" href="http://www.c99.org/category/android/" rel="external" target="_blank">Android</a></p>
<p><a href="http://blog.pickbox.me/archives/500" target="_blank">Writing an Android Sync Provider: Part 2</a></p>
<p>&nbsp;</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2011/07/26/Property-Animation-in-Honeycomb/" rel="next" title="Property Animation in Honeycomb">
                <i class="fa fa-chevron-left"></i> Property Animation in Honeycomb
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2011/08/05/解析Unicode编码和Java-char/" rel="prev" title="解析Unicode编码和Java char">
                解析Unicode编码和Java char <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  
<script type="text/javascript" src="http://p.pickbox.me/js/pv.js"></script>



</body>
</html>
