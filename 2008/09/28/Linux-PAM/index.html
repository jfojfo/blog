<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="mypam_namespace.so模块应用，polyinstantiation（多实例化），提高安全性 通过配置pam，在用户登录时实际登录的是虚拟目录，类似chroot，用户的所有操作都限定在该虚拟目录中。修改/etc/security/namespace.conf，添加：$HOME&amp;nbsp;&amp;nbsp;&amp;nbsp;   $HOME/$USER.inst/inst-&amp;nbsp;&amp;nbsp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux-PAM">
<meta property="og:url" content="http://blog.pickbox.me/2008/09/28/Linux-PAM/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="mypam_namespace.so模块应用，polyinstantiation（多实例化），提高安全性 通过配置pam，在用户登录时实际登录的是虚拟目录，类似chroot，用户的所有操作都限定在该虚拟目录中。修改/etc/security/namespace.conf，添加：$HOME&amp;nbsp;&amp;nbsp;&amp;nbsp;   $HOME/$USER.inst/inst-&amp;nbsp;&amp;nbsp;">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux-PAM">
<meta name="twitter:description" content="mypam_namespace.so模块应用，polyinstantiation（多实例化），提高安全性 通过配置pam，在用户登录时实际登录的是虚拟目录，类似chroot，用户的所有操作都限定在该虚拟目录中。修改/etc/security/namespace.conf，添加：$HOME&amp;nbsp;&amp;nbsp;&amp;nbsp;   $HOME/$USER.inst/inst-&amp;nbsp;&amp;nbsp;">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2008/09/28/Linux-PAM/"/>


  <title> Linux-PAM | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule" rel="section">
            
            日程
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Linux-PAM
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2008-09-28T20:46:00+08:00" content="2008-09-28">
              2008-09-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux-App/" itemprop="url" rel="index">
                    <span itemprop="name">Linux App</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> <br><del>my</del><br><br>pam_namespace.so模块应用，polyinstantiation（多实例化），提高安全性<br> <br>通过配置pam，在用户登录时实际登录的是虚拟目录，类似chroot，用户的所有操作都限定在该虚拟目录中。<br><br>修改/etc/security/namespace.conf，添加：<br>$HOME&nbsp;&nbsp;&nbsp;   $HOME/$USER.inst/inst-&nbsp;&nbsp;&nbsp;   context<br># mkdir /home/test/test.inst<br># chown root:root /home/test/test.inst<br># chmod 000 /home/test/test.inst<br><br>在/etc/pam.d/login 和 /etc/pam.d/sshd 中添加：<br>session required pam_namespace.so<br><br>Ctrl+Alt+F1，以test用户登录<br>$ touch test_file<br>$ ls<br>test_file<br>$ pwd<br>/home/test<br><br>再以root用户来看：<br>root@jfo-laptop:/home/test# cd test.inst/inst-test/<br>root@jfo-laptop:/home/test/test.inst/inst-test# ls<br>test_file<br>root@jfo-laptop:/home/test/test.inst/inst-test# pwd<br>/home/test/test.inst/inst-test<br><br><br>for more info, refer:<br><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-polyinstantiation/index.html">使用多实例化提高安全性</a><br><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-polyinstantiation/index.html">http://www.ibm.com/developerworks/cn/linux/l-polyinstantiation/index.html</a><br><br><br><del>my</del><br><br><br>Linux的鉴别(Authentication)机制–PAM<br><a href="http://blog.csdn.net/absurd/archive/2007/04/23/1576621.aspx" target="_blank">http://blog.csdn.net/absurd/archive/2007/04/23/1576621.aspx</a><br><br>The Linux-PAM System Administrators’ Guide<br><a target="_blank" href="http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/Linux-PAM_SAG.html">http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/Linux-PAM_SAG.html</a><br></p><p><em>Linux-PAM</em> (Pluggable Authentication Modules for Linux) is a suite of shared libraries that enable the local system administrator to choose how applications authenticate users.</p><p>In other words, without (rewriting and) recompiling a PAM-aware application, it is possible to switch between the authentication mechanism(s) it uses. Indeed, one may entirely upgrade the local authentication system without touching the applications themselves.</p><p>Historically an application that has required a given user to be authenticated, has had to be compiled to use a specific authentication mechanism. For example, in the case of traditional UN*X systems, the identity of the user is verified by the user entering a correct password. This password, after being prefixed by a two character <code>salt&#39;&#39;, is encrypted (with crypt(3)). The user is then authenticated if this encrypted password is identical to the second field of the user&#39;s entry in the system password database (the &lt;code&gt;/etc/passwd&lt;/code&gt; file). On such systems, most if not all forms of privileges are granted based on this single authentication scheme. Privilege comes in the form of a personal user-identifier (UID) and membership of various groups. Services and applications are available based on the personal and group identity of the user. Traditionally, group membership has been assigned based on entries in the &lt;code&gt;/etc/group&lt;/code&gt; file.&lt;/p&gt;&lt;p&gt;It is the purpose of the &lt;em&gt;Linux-PAM&lt;/em&gt; project to separate the development of privilege granting software from the development of secure and appropriate authentication schemes. This is accomplished by providing a library of functions that an application may use to request that a user be authenticated. This PAM library is configured locally with a system file, &lt;code&gt;/etc/pam.conf&lt;/code&gt; (or a series of configuration       files located in &lt;code&gt;/etc/pam.d/&lt;/code&gt;) to authenticate a user request via the locally available authentication modules. The modules themselves will usually be located in the directory &lt;code&gt;/lib/security&lt;/code&gt; or       &lt;code&gt;/lib64/security&lt;/code&gt; and take the form of dynamically       loadable object files (see dlopen(3)).&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Overview&lt;br /&gt;&lt;p&gt;For the uninitiated, we begin by considering an example.  We take an       application that grants some service to users;       &lt;strong&gt;login&lt;/strong&gt; is one such program.       &lt;strong&gt;Login&lt;/strong&gt; does two things, it first establishes that the requesting user is whom they claim to be and second provides them with the requested service: in the case of &lt;strong&gt;login&lt;/strong&gt; the service is a command shell       (bash, tcsh, zsh, etc.) running with the identity of the user.&lt;/p&gt;&lt;p&gt;Traditionally, the former step is achieved by the       &lt;strong&gt;login&lt;/strong&gt; application prompting the user for a password and then verifying that it agrees with that located on the system; hence verifying that as far as the system is concerned the user is who they claim to be. This is the task that is delegated to &lt;em&gt;Linux-PAM&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;From the perspective of the application programmer (in this case       the person that wrote the &lt;strong&gt;login&lt;/strong&gt; application),       &lt;em&gt;Linux-PAM&lt;/em&gt; takes care of this       authentication task -- verifying the identity of the user.&lt;/p&gt;&lt;p&gt;The flexibility of &lt;em&gt;Linux-PAM&lt;/em&gt; is       that &lt;em&gt;you&lt;/em&gt;, the system administrator, have the freedom to stipulate which authentication scheme is to be used. You have the freedom to set the scheme for any/all PAM-aware applications on your Linux system. That is, you can authenticate from anything as naive as &lt;em&gt;simple trust&lt;/em&gt; (&lt;strong&gt;pam_permit&lt;/strong&gt;)       to something as paranoid as a combination of a retinal scan, a       voice print and a one-time password!&lt;/p&gt;&lt;p&gt;To illustrate the flexibility you face, consider the following situation: a system administrator (parent) wishes to improve the mathematical ability of her users (children). She can configure their favorite</code>Shoot ‘em up game’’ (PAM-aware of course) to authenticate them with a request for the product of a couple of random numbers less than 12. It is clear that if the game is any good they will soon learn their <em>multiplication tables</em>. As they mature, the       authentication can be upgraded to include (long) division!</p><p><em>Linux-PAM</em> deals with four       separate types of (management) task. These are:       <em>authentication management</em>;       <em>account management</em>;       <em>session management</em>; and       <em>password management</em>. The association of the preferred management scheme with the behavior of an application is made with entries in the relevant <em>Linux-PAM</em> configuration file.       The management functions are performed by <em>modules</em>       specified in the configuration file. The syntax for this       file is discussed in the section       <a href="http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/sag-configuration.html" title="Chapter 4. The Linux-PAM configuration file" target="_blank" rel="external">below</a>.</p><p>Here is a figure that describes the overall organization of       <em>Linux-PAM</em>:</p>+—————-+<br>  | application: X |<br>  +—————-+       /  +———-+     +================+<br>  | authentication-[—-&gt;—-] Linux-   |–&lt;–| PAM config file|<br>  |       +        [—-&lt;–/–]   PAM    |     |================|<br>  |[conversation()][–+      |          |     | X auth .. a.so |<br>  +—————-+  |    /  +-n–n—–+     | X auth .. b.so |<br>  |                |  |       <strong>|  |           |           ___</strong>/<br>  |  service user  |  A      |     |           |<em>__</em>,—–’<br>  |                |  |      V     A<br>  +—————-+  +——|—–|———+ —–+——+<br>                         +—u—–u—-+    |      |      |<br>                         |   auth….   |–[ a ]–[ b ]–[ c ]<br>                         +————–+<br>                         |   acct….   |–[ b ]–[ d ]<br>                         +————–+<br>                         |   password   |–[ b ]–[ c ]<br>                         +————–+<br>                         |   session    |–[ e ]–[ c ]<br>                         +————–+<p>By way of explanation, the left of the figure represents the application; application X. Such an application interfaces with the <em>Linux-PAM</em> library and knows none of       the specifics of its configured authentication method. The       <em>Linux-PAM</em> library (in the center) consults the contents of the PAM configuration file and loads the modules that are appropriate for application-X. These modules fall into one of four management groups (lower-center) and are stacked in the order they appear in the configuration file. These modules, when called by <em>Linux-PAM</em>, perform the various authentication tasks for the application. Textual information, required from/or offered to the user, can be exchanged through the use of the application-supplied <em>conversation</em>       function.</p><p>If a program is going to use PAM, then it has to have PAM functions explicitly coded into the program. If you have access to the source code you can add the appropriate PAM functions. If you do not have accessto the source code, and the binary does not have the PAM functions included, then it is not possible to use PAM.</p><br><br><br><br><br><br><br><br><del>end</del> <p></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2008/09/27/C-各大有名GUI库/" rel="next" title="C++各大有名GUI库">
                <i class="fa fa-chevron-left"></i> C++各大有名GUI库
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2008/09/28/Linux-command-cont/" rel="prev" title="Linux command (cont.)">
                Linux command (cont.) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  
<script type="text/javascript">
function attach () {
    $('body').append('<img src="http://p.pickbox.me/pv">');
    $(document).unbind('scroll', attach);
}
$(document).bind('scroll', attach);
</script>



</body>
</html>
