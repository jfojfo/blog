<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="my任意一个排列a3a1a5a2a4，与变进制数31524对应，以变进制数31524为索引（数组下标），即可查找到对应的这个排列。hash(a3a1a5a2a4) = 31524反之，以数组下标也可以查找到对应的排列myhttp://bbs.chinaunix.net/archiver/?tid-1283459.html我们经常使用的数的进制为“常数进制”，即始终逢p进1。例如，p进制数K可表示">
<meta property="og:type" content="article">
<meta property="og:title" content="【zz】一种变进制数及其应用（全排列之Hash实现）">
<meta property="og:url" content="http://blog.pickbox.me/2008/10/18/【zz】一种变进制数及其应用（全排列之Hash实现）/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="my任意一个排列a3a1a5a2a4，与变进制数31524对应，以变进制数31524为索引（数组下标），即可查找到对应的这个排列。hash(a3a1a5a2a4) = 31524反之，以数组下标也可以查找到对应的排列myhttp://bbs.chinaunix.net/archiver/?tid-1283459.html我们经常使用的数的进制为“常数进制”，即始终逢p进1。例如，p进制数K可表示">
<meta property="og:image" content="http://img.pickbox.me/wp-content/uploads/pic/53dbd3135df6482e5aaf53a7.jpg">
<meta property="og:image" content="http://img.pickbox.me/wp-content/uploads/pic/other_site/bbs_chinaunix_zip.gif">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【zz】一种变进制数及其应用（全排列之Hash实现）">
<meta name="twitter:description" content="my任意一个排列a3a1a5a2a4，与变进制数31524对应，以变进制数31524为索引（数组下标），即可查找到对应的这个排列。hash(a3a1a5a2a4) = 31524反之，以数组下标也可以查找到对应的排列myhttp://bbs.chinaunix.net/archiver/?tid-1283459.html我们经常使用的数的进制为“常数进制”，即始终逢p进1。例如，p进制数K可表示">
<meta name="twitter:image" content="http://img.pickbox.me/wp-content/uploads/pic/53dbd3135df6482e5aaf53a7.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2008/10/18/【zz】一种变进制数及其应用（全排列之Hash实现）/"/>


  <title> 【zz】一种变进制数及其应用（全排列之Hash实现） | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                【zz】一种变进制数及其应用（全排列之Hash实现）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2008-10-18T23:18:00+08:00" content="2008-10-18">
              2008-10-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/c-c-algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">c/c++/algorithm</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> <br><del>my</del><br><br>任意一个排列a3a1a5a2a4，与变进制数31524对应，以变进制数31524为索引（数组下标），即可查找到对应的这个排列。<br>hash(a3a1a5a2a4) = 31524<br><br>反之，以数组下标也可以查找到对应的排列<br><a target="_blank" href="http://algorithmically.blogbus.com/logs/7508802.html"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/53dbd3135df6482e5aaf53a7.jpg"></a><br><br><br><del>my</del><br><br><a target="_blank" href="http://bbs.chinaunix.net/archiver/?tid-1283459.html">http://bbs.chinaunix.net/archiver/?tid-1283459.html</a><br><br>我们经常使用的数的进制为“常数进制”，即始终逢p进1。例如，p进制数K可表示为<br>K = a0<em>p^0 + a1</em>p^1 + a2<em>p^2 + … + an</em>p^n （其中0 &lt;= ai &lt;= p-1），<br>它可以表示任何一个自然数。<br><br>对于这种常数进制表示法，以及各种进制之间的转换大家应该是很熟悉的了，但大家可能很少听说变进制数。这里我要介绍一种特殊的变进制数，它能够被用来实现 全排列的Hash函数，并且该Hash函数能够实现完美的防碰撞和空间利用（不会发生碰撞，且所有空间被完全使用，不多不少）。这种全排列Hash函数也 被称为全排列数化技术。下面，我们就来看看这种变进制数。<br><br>我们考查这样一种变进制数：第1位逢2进1，第2位逢3进1，……，第n位逢n+1进1。它的表示形式为<br>K = a1<em>1! + a2</em>2! + a3<em>3! + … + an</em>n! （其中0 &lt;= ai &lt;= i），<br>也可以扩展为如下形式（因为按定义a0始终为0），以与p进制表示相对应：<br>K = a0<em>0! + a1</em>1! + a2<em>2! + a3</em>3! + … + an<em>n! （其中0 &lt;= ai &lt;= i）。<br>（后面的变进制数均指这种变进制数，且采用前一种表示法）<br><br>先让我们来考查一下该变进制数的进位是否正确。假设变进制数K的第i位ai为i+1，需要进位，而ai</em>i!=(i+1)<em>i!=1</em>(i+1)!，即正确的向高位进1。这说明该变进制数能够正确进位，从而是一种合法的计数方式。<br><br>接下来我们考查n位变进制数K的性质：<br>（1）当所有位ai均为i时，此时K有最大值<br>MAX[K] = 1<em>1! + 2</em>2! + 3<em>3! + … + n</em>n!<br>= 1! + 1<em>1! + 2</em>2! + 3<em>3! + … + n</em>n! - 1<br>= (1+1)<em>1! + 2</em>2! + 3<em>3! + … + n</em>n! - 1<br>= 2! + 2<em>2! + 3</em>3! + … + n<em>n! - 1<br>= …<br>= (n+1)!-1<br>因此，n位K进制数的最大值为(n+1)!-1。<br>（2）当所有位ai均为0时，此时K有最小值0。<br>因此，n位变进制数能够表示0到(n+1)!-1的范围内的所有自然数，共(n+1)!个。<br><br>在一些状态空间搜索算法中，我们需要快速判断某个状态是否已经出现，此时常常使用Hash函数来实现。其中，有一类特殊的状态空间，它们是由全排列产生 的，比如N数码问题。对于n个元素的全排列，共产生n!个不同的排列或状态。下面将讨论如何使用这里的变进制数来实现一个针对全排列的Hash函数。<br><br>从数的角度来看，全排列和变进制数都用到了阶乘。如果我们能够用0到n!-1这n!个连续的变进制数来表示n个元素的所有排列，那么就能够把全排列完全地 数化，建立起全排列和自然数之间一一对应的关系，也就实现了一个完美的Hash函数。那么，我们的想法能否实现呢？答案是肯定的，下面将进行讨论。<br><br>假设我们有b0,b1,b2,b3,…,bn共n+1个不同的元素，并假设各元素之间有一种次序关系 b0&lt;b1&lt;b2&lt;…&lt;bn。对它们进行全排列，共产生(n+1)!种不同的排列。对于产生的任一排列 c0,c1,c2,..,cn，其中第i个元素ci（1 &lt;= i &lt;= n）与它前面的i个元素构成的逆序对的个数为di（0 &lt;= di &lt;= i），那么我们得到一个逆序数序列d1,d2,…,dn（0 &lt;= di &lt;= i）。这不就是前面的n位变进制数的各个位么？于是，我们用n位变进制数M来表示该排列：<br>M = d1</em>1! + d2<em>2! + … + dn</em>n!<br>因此，每个排列都可以按这种方式表示成一个n位变进制数。下面，我们来考查n位变进制数能否与n+1个元素的全排列建立起一一对应的关系。<br><br>由于n位变进制数能表示(n+1)!个不同的数，而n+1个元素的全排列刚好有(n+1)!个不同的排列，且每一个排列都已经能表示成一个n位变进制数。如果我们能够证明任意两个不同的排列产生两个不同的变进制数，那么我们就可以得出结论：<br><strong>★ 定理1 n+1个元素的全排列的每一个排列对应着一个不同的n位变进制数。</strong><br><br>对于全排列的任意两个不同的排列p0,p1,p2,…,pn（排列P）和q0,q1,q2,…,qn（排列Q），从后往前查找第一个不相同的元素，分别记为pi和qi（0 &lt; i &lt;= n）。<br>（1）如果qi &gt; pi，那么,<br>如果在排列Q中qi之前的元素x与qi构成逆序对，即有x &gt; qi，则在排列P中pi之前也有相同元素x &gt; pi（因为x &gt; qi且qi &gt; pi），即在排列P中pi之前的元素x也与pi构成逆序对，所以pi的逆序数大于等于qi的逆序数。又qi与pi在排列P中构成pi的逆序对，所以pi的 逆序数大于qi的逆序数。<br>（2）同理，如果pi &gt; qi，那么qi的逆序数大于pi的逆序数。<br>因此，由（1）和（2）知，排列P和排列Q对应的变进制数至少有第i位不相同，即全排列的任意两个不同的排列具有不同的变进制数。至此，定理1得证。<br><br>计算n个元素的一个排列的变进制数的算法大致如下（时间复杂度为O(n^2)）：<br>template &lt;typename T&gt;<br>size_t PermutationToNumber(const T permutation[], int n)<br>{<br>// n不能太大，否则会溢出（如果size_t为32位，则n &lt;= 12）<br>size_t result = 0;<br>for (int j = 1; j &lt; n; ++j) {<br>int count = 0;<br>for (int k = 0; k &lt; j; ++k) {<br>if (permutation[k] &gt; permutation[j])<br>++count;<br>}<br>// factorials[j]保存着j!<br>result += count * factorials[j];<br>}<br><br>return result;<br>}<br><br>说明：<br>（1）由于n!是一个很大的数，因此一般只能用于较小的n。<br>（2）有了计算排列的变进制数的算法，我们就可以使用一个大小为n!的数组来保存每一个排列的状态，使用排列的变进制数作为数组下标，从而实现状态的快速检索。如果只是标记状态是否出现，则可以用一位来标记状态。<br><br>最后，附上一段完整的代码来演示使用变进制数实现全排列的数化（或者Hash，随便怎么称乎了）。<br><br>2008.10.9补充：“十进制数 &lt;–&gt; 变进制数 &lt;–&gt; 排列”之间的转换算法实现见13楼<br><br>[<em> 本帖最后由 tyc611 于 2008-10-9 18:43 编辑 </em>]<br> <br><br>2008-10-8 22:48<br>下载次数: 61<img src="http://img.pickbox.me/wp-content/uploads/pic/other_site/bbs_chinaunix_zip.gif" class="absmiddle"> <a href="http://bbs.chinaunix.net/attachment.php?aid=293384" target="_blank">src.zip</a> (4.72 KB)<br><br><br><br><br><br><br><del>end</del> </p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2008/10/18/inotify-监控文件系统的活动/" rel="next" title="inotify 监控文件系统的活动">
                <i class="fa fa-chevron-left"></i> inotify 监控文件系统的活动
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2008/10/22/优先级反转/" rel="prev" title="优先级反转">
                优先级反转 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  

  

  

  

</body>
</html>
