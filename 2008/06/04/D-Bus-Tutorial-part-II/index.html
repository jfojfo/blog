<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="http://dbus.freedesktop.org/doc/dbus-tutorial.html GLib API: Using Remote ObjectsThe GLib binding is defined in the header file       &amp;lt;dbus/dbus-glib.h&amp;gt;.D-Bus - GLib type mappingsThe heart of t">
<meta property="og:type" content="article">
<meta property="og:title" content="D-Bus Tutorial - part II">
<meta property="og:url" content="http://blog.pickbox.me/2008/06/04/D-Bus-Tutorial-part-II/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="http://dbus.freedesktop.org/doc/dbus-tutorial.html GLib API: Using Remote ObjectsThe GLib binding is defined in the header file       &amp;lt;dbus/dbus-glib.h&amp;gt;.D-Bus - GLib type mappingsThe heart of t">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="D-Bus Tutorial - part II">
<meta name="twitter:description" content="http://dbus.freedesktop.org/doc/dbus-tutorial.html GLib API: Using Remote ObjectsThe GLib binding is defined in the header file       &amp;lt;dbus/dbus-glib.h&amp;gt;.D-Bus - GLib type mappingsThe heart of t">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2008/06/04/D-Bus-Tutorial-part-II/"/>


  <title> D-Bus Tutorial - part II | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                D-Bus Tutorial - part II
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2008-06-04T14:37:00+08:00" content="2008-06-04">
              2008-06-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> <a target="_blank" href="http://dbus.freedesktop.org/doc/dbus-tutorial.html">http://dbus.freedesktop.org/doc/dbus-tutorial.html</a><br><br> <a name="glib-client"></a>GLib API: Using Remote Objects</p><p>The GLib binding is defined in the header file       <code>&lt;dbus/dbus-glib.h&gt;</code>.</p><a name="glib-typemappings"></a>D-Bus - GLib type mappings<p>The heart of the GLib bindings for D-Bus is the mapping it  provides between D-Bus &quot;type signatures&quot; and GLib types  (<code>GType</code>). The D-Bus type system is composed of  a number of &quot;basic&quot; types, along with several &quot;container&quot; types.</p><a name="glib-basic-typemappings"></a>Basic type mappings<p>Below is a list of the basic types, along with their associated    mapping to a <code>GType</code>.</p> <col><col><col><col>                        D-Bus basic type            GType            Free function            Notes                                    <code>BYTE</code> <code>G_TYPE_UCHAR</code> <code>BOOLEAN</code> <code>G_TYPE_BOOLEAN</code> <code>INT16</code> <code>G_TYPE_INT</code>                         Will be changed to a <code>G_TYPE_INT16</code> once GLib has it                            <code>UINT16</code> <code>G_TYPE_UINT</code>                         Will be changed to a <code>G_TYPE_UINT16</code> once GLib has it                            <code>INT32</code> <code>G_TYPE_INT</code>                         Will be changed to a <code>G_TYPE_INT32</code> once GLib has it                            <code>UINT32</code> <code>G_TYPE_UINT</code>                         Will be changed to a <code>G_TYPE_UINT32</code> once GLib has it                            <code>INT64</code> <code>G_TYPE_GINT64</code> <code>UINT64</code> <code>G_TYPE_GUINT64</code> <code>DOUBLE</code> <code>G_TYPE_DOUBLE</code> <code>STRING</code> <code>G_TYPE_STRING</code> <code>g_free</code> <code>OBJECT_PATH</code> <code>DBUS_TYPE_G_PROXY</code> <code>g_object_unref</code>            The returned proxy does not have an interface set; use <code>dbus_g_proxy_set_interface</code> to invoke methods            <p>As you can see, the basic mapping is fairly straightforward.</p><a name="glib-container-typemappings"></a>Container type mappings<p>The D-Bus type system also has a number of &quot;container&quot;    types, such as <code>DBUS_TYPE_ARRAY</code> and    <code>DBUS_TYPE_STRUCT</code>. The D-Bus type system is fully recursive, so one can for example have an array of array of strings (i.e. type signature <code>aas</code>).</p><p>However, not all of these types are in common use; for example, at the time of this writing the author knows of no one using <code>DBUS_TYPE_STRUCT</code>, or a    <code>DBUS_TYPE_ARRAY</code> containing any non-basic type. The approach the GLib bindings take is pragmatic; try to map the most common types in the most obvious way, and let using less common and more complex types be less &quot;natural&quot;.</p><p>First, D-Bus type signatures which have an &quot;obvious&quot;    corresponding built-in GLib type are mapped using that type:</p> <col><col><col><col><col><col>                        D-Bus type signature            Description            GType            C typedef            Free function            Notes                                    <code>as</code>            Array of strings            <code>G_TYPE_STRV</code> <code>char <strong></strong></code> <code>g_strfreev</code> <code>v</code>            Generic value container            <code>G_TYPE_VALUE</code> <code>GValue <em></em></code> <code>g_value_unset</code>            The calling conventions for values expect that method callers have allocated return values; see below.            <p> </p><p>The next most common recursive type signatures are arrays of basic values. The most obvious mapping for arrays of basic types is a <code>GArray</code>.  Now, GLib does not    provide a builtin <code>GType</code> for    <code>GArray</code>. However, we actually need more than that - we need a &quot;parameterized&quot; type which includes the contained type. Why we need this we will see below.</p><p>The approach taken is to create these types in the D-Bus GLib bindings; however, there is nothing D-Bus specific about them. In the future, we hope to include such &quot;fundamental&quot; types in GLib itself.</p> <col><col><col><col><col><col>                        D-Bus type signature            Description            GType            C typedef            Free function            Notes                                    <code>ay</code>            Array of bytes            <code>DBUS_TYPE_G_BYTE_ARRAY</code> <code>GArray </code>            g_array_free                                         <code>au</code>            Array of uint            <code>DBUS_TYPE_G_UINT_ARRAY</code> <code>GArray <em></em></code>            g_array_free                                         <code>ai</code>            Array of int            <code>DBUS_TYPE_G_INT_ARRAY</code> <code>GArray </code>            g_array_free                                         <code>ax</code>            Array of int64            <code>DBUS_TYPE_G_INT64_ARRAY</code> <code>GArray <em></em></code>            g_array_free                                         <code>at</code>            Array of uint64            <code>DBUS_TYPE_G_UINT64_ARRAY</code> <code>GArray </code>            g_array_free                                         <code>ad</code>            Array of double            <code>DBUS_TYPE_G_DOUBLE_ARRAY</code> <code>GArray <em></em></code>            g_array_free                                         <code>ab</code>            Array of boolean            <code>DBUS_TYPE_G_BOOLEAN_ARRAY</code> <code>GArray </code>            g_array_free                         <p> </p><p>D-Bus also includes a special type DBUS_TYPE_DICT_ENTRY which is only valid in arrays. It’s intended to be mapped to a &quot;dictionary&quot; type by bindings. The obvious GLib mapping here is GHashTable. Again, however, there is no builtin <code>GType</code> for a GHashTable. Moreover, just like for arrays, we need a parameterized type so that the bindings can communiate which types are contained in the hash table.</p><p>At present, only strings are supported.  Work is in progress to    include more types.</p> <col><col><col><col><col><col>                        D-Bus type signature            Description            GType            C typedef            Free function            Notes                                    <code>a{ss}</code>            Dictionary mapping strings to strings            <code>DBUS_TYPE_G_STRING_STRING_HASHTABLE</code> <code>GHashTable *</code>            g_hash_table_destroy                         <p> </p><a name="glib-generic-typemappings"></a>Arbitrarily recursive type mappings<p>Finally, it is possible users will want to write or invoke D-Bus methods which have arbitrarily complex type signatures not directly supported by these bindings. For this case, we have a <code>DBusGValue</code> which acts as a kind of special    variant value which may be iterated over manually.  The    <code>GType</code> associated is    <code>DBUS_TYPE_G_VALUE</code>.</p><p>TODO insert usage of <code>DBUS_TYPE_G_VALUE</code> here.</p><a name="sample-program-1"></a>A sample program<p>Here is a D-Bus program using the GLib bindings.</p><br>int<br>main (int argc, char argv)<br>{<br>  DBusGConnection <em>connection;<br>  GError </em>error;<br>  DBusGProxy <em>proxy;<br>  char <strong>name_list;<br>  char </strong>name_list_ptr;<br> <br>  g_type_init ();<br><br>  error = NULL;<br>  connection = dbus_g_bus_get (DBUS_BUS_SESSION,<br>                               &amp;error);<br>  if (connection == NULL)<br>    {<br>      g_printerr (&quot;Failed to open connection to bus: %sn&quot;,<br>                  error-&gt;message);<br>      g_error_free (error);<br>      exit (1);<br>    }<br><br>  /</em> Create a proxy object for the &quot;bus driver&quot; (name &quot;org.freedesktop.DBus&quot;) <em>/<br> <br>  proxy = dbus_g_proxy_new_for_name (connection,<br>                                     DBUS_SERVICE_DBUS,<br>                                     DBUS_PATH_DBUS,<br>                                     DBUS_INTERFACE_DBUS);<br><br>  /</em> Call ListNames method, wait for reply <em>/<br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;ListNames&quot;, &amp;error, G_TYPE_INVALID,<br>                          G_TYPE_STRV, &amp;name_list, G_TYPE_INVALID))<br>    {<br>      /</em> Just do demonstrate remote exceptions versus regular GError <em>/<br>      if (error-&gt;domain == DBUS_GERROR &amp;&amp; error-&gt;code == DBUS_GERROR_REMOTE_EXCEPTION)<br>        g_printerr (&quot;Caught remote method exception %s: %s&quot;,<br>             dbus_g_error_get_name (error),<br>             error-&gt;message);<br>      else<br>        g_printerr (&quot;Error: %sn&quot;, error-&gt;message);<br>      g_error_free (error);<br>      exit (1);<br>    }<br><br>  /</em> Print the results <em>/<br> <br>  g_print (&quot;Names on the message bus:n&quot;);<br> <br>  for (name_list_ptr = name_list; </em>name_list_ptr; name_list_ptr++)<br>    {<br>      g_print (&quot;  %sn&quot;, <em>name_list_ptr);<br>    }<br>  g_strfreev (name_list);<br><br>  g_object_unref (proxy);<br><br>  return 0;<br>}<p> </p><a name="glib-program-setup"></a>Program initalization<p>A connection to the bus is acquired using  <code>dbus_g_bus_get</code>.  Next, a proxy  is created for the object &quot;/org/freedesktop/DBus&quot; with  interface <code>org.freedesktop.DBus</code>  on the service <code>org.freedesktop.DBus</code>.  This is a proxy for the message bus itself.</p><a name="glib-method-invocation"></a>Understanding method invocation<p>You have a number of choices for method invocation.  First, as  used above, <code>dbus_g_proxy_call</code> sends a method call to the remote object, and blocks until a reply is recieved. The outgoing arguments are specified in the varargs array, terminated with <code>G_TYPE_INVALID</code>.  Next, pointers to return values are specified, followed again  by <code>G_TYPE_INVALID</code>.</p><p>To invoke a method asynchronously, use  <code>dbus_g_proxy_begin_call</code>.  This returns a  <code>DBusGPendingCall</code> object; you may then set a  notification function using  <code>dbus_g_pending_call_set_notify</code>.</p><a name="glib-signal-connection"></a>Connecting to object signals<p>You may connect to signals using  <code>dbus_g_proxy_add_signal</code> and  <code>dbus_g_proxy_connect_signal</code>.  You must  invoke <code>dbus_g_proxy_add_signal</code> to specify  the signature of your signal handlers; you may then invoke  <code>dbus_g_proxy_connect_signal</code> multiple times.</p><p>Note that it will often be the case that there is no builtin marshaller for the type signature of a remote signal. In that case, you must generate a marshaller yourself by using glib-genmarshal, and then register  it using <code>dbus_g_object_register_marshaller</code>.</p><a name="glib-error-handling"></a>Error handling and remote exceptions<p>All of the GLib binding methods such as  <code>dbus_g_proxy_end_call</code> return a  <code>GError</code>.  This <code>GError</code> can  represent two different things:</p><ul> <li> <p>An internal D-Bus error, such as an out-of-memory condition, an I/O error, or a network timeout. Errors generated by the D-Bus library itself have the domain <code>DBUS_GERROR</code>, and a corresponding code      such as <code>DBUS_GERROR_NO_MEMORY</code>.  It will      not be typical for applications to handle these errors      specifically.</p> </li> <li> <p>A remote D-Bus exception, thrown by the peer, bus, or service. D-Bus remote exceptions have both a textual &quot;name&quot; and a &quot;message&quot;. The GLib bindings store this information in the <code>GError</code>, but some      special rules apply.</p> <p>The set error will have the domain      <code>DBUS_GERROR</code> as above, and will also      have the code      <code>DBUS_GERROR_REMOTE_EXCEPTION</code>.  In order      to access the remote exception name, you must use a      special accessor, such as      <code>dbus_g_error_has_name</code> or      <code>dbus_g_error_get_name</code>.  The remote      exception detailed message is accessible via the regular      GError <code>message</code> member.</p> </li></ul><p> </p><a name="glib-more-examples"></a>More examples of method invocation<a name="glib-sending-stuff"></a>Sending an integer and string, receiving an array of bytes<p> </p>GArray </em>arr;<br> <br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;Foobar&quot;, &amp;error,<br>                          G_TYPE_INT, 42, G_TYPE_STRING, &quot;hello&quot;,<br>     G_TYPE_INVALID,<br>     DBUS_TYPE_G_UCHAR_ARRAY, &amp;arr, G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>   g_assert (arr != NULL);<br>   printf (&quot;got back %u values&quot;, arr-&gt;len);<p> </p><a name="glib-sending-hash"></a>Sending a GHashTable<p> </p>GHashTable <em>hash = g_hash_table_new (g_str_hash, g_str_equal);<br>  guint32 ret;<br> <br>  g_hash_table_insert (hash, &quot;foo&quot;, &quot;bar&quot;);<br>  g_hash_table_insert (hash, &quot;baz&quot;, &quot;whee&quot;);<br><br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;HashSize&quot;, &amp;error,<br>                          DBUS_TYPE_G_STRING_STRING_HASH, hash, G_TYPE_INVALID,<br>     G_TYPE_UINT, &amp;ret, G_TYPE_INVALID))<br>    {<br>      /</em> Handle error <em>/<br>    }<br>  g_assert (ret == 2);<br>  g_hash_table_destroy (hash);<p> </p><a name="glib-receiving-bool-int"></a>Receiving a boolean and a string<p> </p>gboolean boolret;<br>  char </em>strret;<br> <br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;GetStuff&quot;, &amp;error,<br>     G_TYPE_INVALID,<br>                          G_TYPE_BOOLEAN, &amp;boolret,<br>                          G_TYPE_STRING, &amp;strret,<br>     G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>  printf (&quot;%s %s&quot;, boolret ? &quot;TRUE&quot; : &quot;FALSE&quot;, strret);<br>  g_free (strret);<p> </p><a name="glib-sending-str-arrays"></a>Sending two arrays of strings<p> </p>/<em> NULL terminate </em>/<br>  char <em>strs_static[] = {&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;, NULL};<br>  /</em> Take pointer to array; cannot pass array directly <em>/<br>  char <strong>strs_static_p = strs_static;<br>  char </strong>strs_dynamic;<br><br>  strs_dynamic = g_new (char </em>, 4);<br>  strs_dynamic[0] = g_strdup (&quot;hello&quot;);<br>  strs_dynamic[1] = g_strdup (&quot;world&quot;);<br>  strs_dynamic[2] = g_strdup (&quot;!&quot;);<br>  /<em> NULL terminate </em>/<br>  strs_dynamic[3] = NULL;<br> <br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;TwoStrArrays&quot;, &amp;error,<br>                          G_TYPE_STRV, strs_static_p,<br>                          G_TYPE_STRV, strs_dynamic,<br>     G_TYPE_INVALID,<br>     G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>   g_strfreev (strs_dynamic);<p> </p><a name="glib-getting-str-array"></a>Sending a boolean, receiving an array of strings<p> </p>char <strong>strs;<br>  char </strong>strs_p;<br>  gboolean blah;<br><br>  error = NULL;<br>  blah = TRUE;<br>  if (!dbus_g_proxy_call (proxy, &quot;GetStrs&quot;, &amp;error,<br>                          G_TYPE_BOOLEAN, blah,<br>     G_TYPE_INVALID,<br>                          G_TYPE_STRV, &amp;strs,<br>     G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>   for (strs_p = strs; <em>strs_p; strs_p++)<br>     printf (&quot;got string: &quot;%s&quot;&quot;, </em>strs_p);<br>   g_strfreev (strs);<p> </p><a name="glib-sending-variant"></a>Sending a variant<p> </p>GValue val = {0, };<br><br>  g_value_init (&amp;val, G_TYPE_STRING);<br>  g_value_set_string (&amp;val, &quot;hello world&quot;);<br> <br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;SendVariant&quot;, &amp;error,<br>                          G_TYPE_VALUE, &amp;val, G_TYPE_INVALID,<br>     G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>  g_assert (ret == 2);<br>  g_value_unset (&amp;val);<p> </p><a name="glib-receiving-variant"></a>Receiving a variant<p> </p>GValue val = {0, };<br><br>  error = NULL;<br>  if (!dbus_g_proxy_call (proxy, &quot;GetVariant&quot;, &amp;error, G_TYPE_INVALID,<br>                          G_TYPE_VALUE, &amp;val, G_TYPE_INVALID))<br>    {<br>      /<em> Handle error </em>/<br>    }<br>  if (G_VALUE_TYPE (&amp;val) == G_TYPE_STRING)<br>    printf (&quot;%sn&quot;, g_value_get_string (&amp;val));<br>  else if (G_VALUE_TYPE (&amp;val) == G_TYPE_INT)<br>    printf (&quot;%dn&quot;, g_value_get_int (&amp;val));<br>  else<br>    …<br>  g_value_unset (&amp;val);<p> </p><a name="glib-generated-bindings"></a>Generated Bindings<p>By using the Introspection XML files, convenient client-side bindings can be automatically created to ease the use of a remote DBus object.</p><p>Here is a sample XML file which describes an object that exposes         one method, named <code>ManyArgs</code>.</p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;<br>&lt;node name=&quot;/com/example/MyObject&quot;&gt;<br>  &lt;interface name=&quot;com.example.MyObject&quot;&gt;<br>    &lt;method name=&quot;ManyArgs&quot;&gt;<br>      &lt;arg type=&quot;u&quot; name=&quot;x&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;s&quot; name=&quot;str&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;d&quot; name=&quot;trouble&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;d&quot; name=&quot;d_ret&quot; direction=&quot;out&quot; /&gt;<br>      &lt;arg type=&quot;s&quot; name=&quot;str_ret&quot; direction=&quot;out&quot; /&gt;<br>    &lt;/method&gt;<br>  &lt;/interface&gt;<br>&lt;/node&gt;<p> </p><p>Run <code>dbus-binding-tool –mode=glib-client           <em></em></code><code>FILENAME</code> &gt;           <em><code>HEADER_NAME</code></em> to generate the header         file.  For example: <strong>dbus-binding-tool –mode=glib-client           my-object.xml &gt; my-object-bindings.h</strong>.  This will generate         inline functions with the following prototypes:</p>/<em> This is a blocking call </em>/<br>gboolean<br>com_example_MyObject_many_args (DBusGProxy <em>proxy, const guint IN_x,<br>                                const char </em> IN_str, const gdouble IN_trouble,<br>                                gdouble<em> OUT_d_ret, char <strong> OUT_str_ret,<br>                                GError </strong>error);<br><br>/</em> This is a non-blocking call <em>/<br>DBusGProxyCall</em><br>com_example_MyObject_many_args_async (DBusGProxy <em>proxy, const guint IN_x,<br>                                      const char </em> IN_str, const gdouble IN_trouble,<br>                                      com_example_MyObject_many_args_reply callback,<br>                                      gpointer userdata);<br><br>/<em> This is the typedef for the non-blocking callback </em>/<br>typedef void<br>(<em>com_example_MyObject_many_args_reply)<br>(DBusGProxy </em>proxy, gdouble OUT_d_ret, char <em> OUT_str_ret,<br> GError </em>error, gpointer userdata);<p>The first argument in all functions is a <code>DBusGProxy         <em></em></code>, which you should create with the usual         <code>dbus_g_proxy<em>new</em></code> functions.  Following that are the         &quot;in&quot; arguments, and then either the &quot;out&quot; arguments and a         <code>GError <em></em></code> for the synchronous (blocking) function, or callback and user data arguments for the asynchronous (non-blocking) function. The callback in the asynchronous function passes the <code>DBusGProxy </code>, the returned &quot;out&quot; arguments, an         <code>GError <em></em></code> which is set if there was an error otherwise         <code>NULL</code>, and the user data.</p><p>As with the server-side bindings support (see <a href="http://dbus.freedesktop.org/doc/dbus-tutorial.html#glib-server" title="GLib API: Implementing Objects" target="_blank" rel="external">the section called &ldquo;GLib API: Implementing Objects&rdquo;</a>), the exact behaviour of the client-side bindings can be manipulated using &quot;annotations&quot;. Currently the only annotation used by the client bindings is <code>org.freedesktop.DBus.GLib.NoReply</code>, which sets the flag indicating that the client isn’t expecting a reply to the method call, so a reply shouldn’t be sent. This is often used to speed up rapid method calls where there are no &quot;out&quot; arguments, and not knowing if the method succeeded is an acceptable compromise to half the traffic on the bus.</p><a name="glib-server"></a>GLib API: Implementing Objects<p>At the moment, to expose a GObject via D-Bus, you must write XML by hand which describes the methods exported by the object. In the future, this manual step will be obviated by the upcoming GLib introspection support.</p><p>Here is a sample XML file which describes an object that exposes       one method, named <code>ManyArgs</code>.</p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;<br><br>&lt;node name=&quot;/com/example/MyObject&quot;&gt;<br><br>  &lt;interface name=&quot;com.example.MyObject&quot;&gt;<br>    &lt;annotation name=&quot;org.freedesktop.DBus.GLib.CSymbol&quot; value=&quot;my_object&quot;/&gt;<br>    &lt;method name=&quot;ManyArgs&quot;&gt;<br>      &lt;!– This is optional, and in this case is redunundant –&gt;<br>      &lt;annotation name=&quot;org.freedesktop.DBus.GLib.CSymbol&quot; value=&quot;my_object_many_args&quot;/&gt;<br>      &lt;arg type=&quot;u&quot; name=&quot;x&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;s&quot; name=&quot;str&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;d&quot; name=&quot;trouble&quot; direction=&quot;in&quot; /&gt;<br>      &lt;arg type=&quot;d&quot; name=&quot;d_ret&quot; direction=&quot;out&quot; /&gt;<br>      &lt;arg type=&quot;s&quot; name=&quot;str_ret&quot; direction=&quot;out&quot; /&gt;<br>    &lt;/method&gt;<br>  &lt;/interface&gt;<br>&lt;/node&gt;<p> </p><p>This XML is in the same format as the D-Bus introspection XML format. Except we must include an &quot;annotation&quot; which give the C symbols corresponding to the object implementation prefix (<code>my_object</code>).  In addition, if particular       methods symbol names deviate from C convention       (i.e. <code>ManyArgs</code> -&gt;       <code>many_args</code>), you may specify an annotation       giving the C symbol.</p><p>Once you have written this XML, run <code>dbus-binding-tool –mode=glib-server <em></em></code><code>FILENAME</code> &gt; <em><code>HEADER_NAME</code></em>. to       generate a header file.  For example: <strong>dbus-binding-tool –mode=glib-server my-object.xml &gt; my-object-glue.h</strong>.</p><p>Next, include the generated header in your program, and invoke       <code>dbus_g_object_class_install_info</code> in the class       initializer, passing the object class and &quot;object info&quot; included in the       header.  For example:</p>dbus_g_object_type_install_info (COM_FOO_TYPE_MY_OBJECT, &amp;com_foo_my_object_info);<p>This should be done exactly once per object class.</p><p>To actually implement the method, just define a C function named e.g.       <code>my_object_many_args</code> in the same file as the info header is included. At the moment, it is required that this function conform to the following rules:</p><ul> <li> <p>The function must return a value of type <code>gboolean</code>;      <code>TRUE</code> on success, and <code>FALSE</code>      otherwise.</p> </li> <li> <p>The first parameter is a pointer to an instance of the object.</p> </li> <li> <p>Following the object instance pointer are the method      input values.</p> </li> <li> <p>Following the input values are pointers to return values.</p> </li> <li> <p>The final parameter must be a <code>GError **</code>.      If the function returns <code>FALSE</code> for an      error, the error parameter must be initalized with      <code>g_set_error</code>.</p> </li></ul><p> </p><p>Finally, you can export an object using <code>dbus_g_connection_register_g_object</code>.  For example:</p>dbus_g_connection_register_g_object (connection,<br>                                               &quot;/com/foo/MyObject&quot;,<br>                                               obj);<p> </p><a name="glib-annotations"></a>Server-side Annotations<p>There are several annotations that are used when generating the server-side bindings. The most common annotation is <code>org.freedesktop.DBus.GLib.CSymbol</code> but there are other         annotations which are often useful.</p><dl><dt><code>org.freedesktop.DBus.GLib.CSymbol</code></dt><dd><p>This annotation is used to specify the C symbol names for the various types (interface, method, etc), if it differs from the name DBus generates.</p></dd><dt><code>org.freedesktop.DBus.GLib.Async</code></dt><dd><p>This annotation marks the method implementation as an asynchronous function, which doesn’t return a response straight away but will send the response at some later point to complete the call. This is used to implement non-blocking services where method calls can take time.</p><p>When a method is asynchronous, the function prototype is different. It is required that the function conform to the following rules:</p><ul> <li> <p>The function must return a value of type <code>gboolean</code>;                       <code>TRUE</code> on success, and <code>FALSE</code>                       otherwise. TODO: the return value is currently ignored.</p> </li> <li> <p>The first parameter is a pointer to an instance of the object.</p> </li> <li> <p>Following the object instance pointer are the method                       input values.</p> </li> <li> <p>The final parameter must be a                       <code>DBusGMethodInvocation </code>.  This is used                       when sending the response message back to the client, by                       calling <code>dbus_g_method_return</code> or                       <code>dbus_g_method_return_error</code>.</p> </li></ul><p> </p></dd><dt><code>org.freedesktop.DBus.GLib.Const</code></dt><dd><p>This attribute can only be applied to &quot;out&quot;               <code>&lt;arg&gt;</code> nodes, and specifies that the parameter isn’t being copied when returned. For example, this turns a ‘s’ argument from a <code>char <strong></strong></code> to a               <code>const char </code>, and results in the argument not               being freed by DBus after the message is sent.</p></dd><dt><code>org.freedesktop.DBus.GLib.ReturnVal</code></dt><dd><p>This attribute can only be applied to &quot;out&quot;                 <code>&lt;arg&gt;</code> nodes, and alters the expected                 function signature.  It currently can be set to two values:                 <code>&quot;&quot;</code> or <code>&quot;error&quot;</code>. The argument marked with this attribute is not returned via a pointer argument, but by the function’s return value. If the attribute’s value is the empty string, the <code>GError                 <em></em></code> argument is also omitted so there is no standard way to return an error value. This is very useful for interfacing with existing code, as it is possible to match existing APIs. If the attribute’s value is <code>&quot;error&quot;</code>, then the                 final argument is a <code>GError </code> as usual.</p><p>Some examples to demonstrate the usage. This introspection XML:</p>&lt;method name=&quot;Increment&quot;&gt;<br>  &lt;arg type=&quot;u&quot; name=&quot;x&quot; /&gt;<br>  &lt;arg type=&quot;u&quot; direction=&quot;out&quot; /&gt;<br>&lt;/method&gt;<p>Expects the following function declaration:</p>gboolean<br>my_object_increment (MyObject <em>obj, gint32 x, gint32 </em>ret, GError <strong>error);<p> </p><p>This introspection XML:</p>&lt;method name=&quot;IncrementRetval&quot;&gt;<br>  &lt;arg type=&quot;u&quot; name=&quot;x&quot; /&gt;<br>  &lt;arg type=&quot;u&quot; direction=&quot;out&quot; &gt;<br>    &lt;annotation name=&quot;org.freedesktop.DBus.GLib.ReturnVal&quot; value=&quot;&quot;/&gt;<br>  &lt;/arg&gt;<br>&lt;/method&gt;<p>Expects the following function declaration:</p>gint32<br>my_object_increment_retval (MyObject <em>obj, gint32 x)<p> </p><p>This introspection XML:</p>&lt;method name=&quot;IncrementRetvalError&quot;&gt;<br>  &lt;arg type=&quot;u&quot; name=&quot;x&quot; /&gt;<br>  &lt;arg type=&quot;u&quot; direction=&quot;out&quot; &gt;<br>    &lt;annotation name=&quot;org.freedesktop.DBus.GLib.ReturnVal&quot; value=&quot;error&quot;/&gt;<br>  &lt;/arg&gt;<br>&lt;/method&gt;<p>Expects the following function declaration:</p>gint32<br>my_object_increment_retval_error (MyObject </em>obj, gint32 x, GError </strong>error)<p> </p></dd></dl><p> </p><a name="python-client"></a>Python API<p>The Python API, dbus-python, is now documented separately in       <a href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html" target="_top">the dbus-python tutorial</a> (also available in doc/tutorial.txt, and doc/tutorial.html if built with python-docutils, in the dbus-python source distribution).</p><a name="qt-client"></a>Qt API: Using Remote Objects<p>The Qt bindings are not yet documented.</p><a name="qt-server"></a>Qt API: Implementing Objects<p>The Qt bindings are not yet documented.</p> <p></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2008/06/04/D-Bus-Tutorial-part-I/" rel="next" title="D-Bus Tutorial - part I">
                <i class="fa fa-chevron-left"></i> D-Bus Tutorial - part I
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2008/06/05/a-little-upset-today/" rel="prev" title="a little upset today">
                a little upset today <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  
<script type="text/javascript">
function attach () {
    $('body').append('<img src="http://p.pickbox.me/pv">');
    $(document).unbind('scroll', attach);
}
$(document).bind('scroll', attach);
</script>



</body>
</html>
