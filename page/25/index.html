<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/25/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-C-对象的内存布局" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/07/C-对象的内存布局/">C++ 对象的内存布局</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><strong>C++</strong><strong> 对象的内存布局<br><br></strong><a href="http://blog.csdn.net/haoel/archive/2008/10/15/3081385.aspx" target="_blank">http://blog.csdn.net/haoel/archive/2008/10/15/3081385.aspx</a> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/07/C-对象的内存布局/" class="archive-article-date">
  	<time datetime="2009-10-07T05:11:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-07</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-MSVC-compiler-d1reportSingleClassLayout-d1reportAllClassLayout" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/07/MSVC-compiler-d1reportSingleClassLayout-d1reportAllClassLayout/">MSVC++ compiler /d1reportSingleClassLayout /d1reportAllClassLayout</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> Some undocumented parameter in MSVC++ compiler<br>/d1reportSingleClassLayout&lt;name&gt; and /d1reportAllClassLayout<br><br>Example1<br>// v.cpp<br><br>class B<br>{<br>    public:<br>        int ib;<br>        char cb;<br>    public:<br>        B():ib(0),cb(‘B’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B::f()&quot; &lt;&lt; endl;}<br>        virtual void Bf() { cout &lt;&lt; &quot;B::Bf()&quot; &lt;&lt; endl;}<br>};<br>class B1 :  public B<br>{<br>    public:<br>        int ib1;<br>        char cb1;<br>    public:<br>        B1():ib1(11),cb1(‘1’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B1::f()&quot; &lt;&lt; endl;}<br>        virtual void f1() { cout &lt;&lt; &quot;B1::f1()&quot; &lt;&lt; endl;}<br>        virtual void Bf1() { cout &lt;&lt; &quot;B1::Bf1()&quot; &lt;&lt; endl;}<br><br>};<br>class B2:  public B<br>{<br>    public:<br>        int ib2;<br>        char cb2;<br>    public:<br>        B2():ib2(12),cb2(‘2’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B2::f()&quot; &lt;&lt; endl;}<br>        virtual void f2() { cout &lt;&lt; &quot;B2::f2()&quot; &lt;&lt; endl;}<br>        virtual void Bf2() { cout &lt;&lt; &quot;B2::Bf2()&quot; &lt;&lt; endl;}<br><br>};<br><br>class D : public B1, public B2<br>{<br>    public:<br>        int id;<br>        char cd;<br>    public:<br>        D():id(100),cd(‘D’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;D::f()&quot; &lt;&lt; endl;}<br>        virtual void f1() { cout &lt;&lt; &quot;D::f1()&quot; &lt;&lt; endl;}<br>        virtual void f2() { cout &lt;&lt; &quot;D::f2()&quot; &lt;&lt; endl;}<br>        virtual void Df() { cout &lt;&lt; &quot;D::Df()&quot; &lt;&lt; endl;}<br><br>};<br><img src="http://img.pickbox.me/wp-content/uploads/pic/47a89950d8db2d4e853524b3.jpg" small="0" class="blogimg"><br><br><br>E:&gt;cl v.cpp -d1reportSingleClassLayoutD<br>…<br>class D size(48):<br> +—<br> | +— (base class B1)<br> | | +— (base class B)<br> 0 | | | {vfptr}<br> 4 | | | ib<br> 8 | | | cb<br>   | | | &lt;alignment member&gt; (size=3)<br> | | +—<br>12 | | ib1<br>16 | | cb1<br>   | | &lt;alignment member&gt; (size=3)<br> | +—<br> | +— (base class B2)<br> | | +— (base class B)<br>20 | | | {vfptr}<br>24 | | | ib<br>28 | | | cb<br>   | | | &lt;alignment member&gt; (size=3)<br> | | +—<br>32 | | ib2<br>36 | | cb2<br>   | | &lt;alignment member&gt; (size=3)<br> | +—<br>40 | id<br>44 | cd<br>   | &lt;alignment member&gt; (size=3)<br> +—<br><br>D::$vftable@B1@:<br> | &amp;D_meta<br> |  0<br> 0 | &amp;D::f<br> 1 | &amp;B::Bf<br> 2 | &amp;D::f1<br> 3 | &amp;B1::Bf1<br> 4 | &amp;D::Df<br><br>D::$vftable@B2@:<br> | -20<br> 0 | &amp;thunk: this-=20; goto D::f<br> 1 | &amp;B::Bf<br> 2 | &amp;D::f2             //f2的this adjustor: 20<br> 3 | &amp;B2::Bf2<br><br>D::f this adjustor: 0   //B1和B2都有f，B2的f需要对this-=20，但B1不需要<br>D::f1 this adjustor: 0<br>D::f2 this adjustor: 20<br>D::Df this adjustor: 0<br><br>Example2<br><br>// v2.cpp<br><br>class B<br>{<br>    public:<br>        int ib;<br>        char cb;<br>    public:<br>        B():ib(0),cb(‘B’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B::f()&quot; &lt;&lt; endl;}<br>        virtual void Bf() { cout &lt;&lt; &quot;B::Bf()&quot; &lt;&lt; endl;}<br>};<br>class B1 : virtual public B<br>{<br>    public:<br>        int ib1;<br>        char cb1;<br>    public:<br>        B1():ib1(11),cb1(‘1’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B1::f()&quot; &lt;&lt; endl;}<br>        virtual void f1() { cout &lt;&lt; &quot;B1::f1()&quot; &lt;&lt; endl;}<br>        virtual void Bf1() { cout &lt;&lt; &quot;B1::Bf1()&quot; &lt;&lt; endl;}<br><br>};<br>class B2: virtual public B<br>{<br>    public:<br>        int ib2;<br>        char cb2;<br>    public:<br>        B2():ib2(12),cb2(‘2’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;B2::f()&quot; &lt;&lt; endl;}<br>        virtual void f2() { cout &lt;&lt; &quot;B2::f2()&quot; &lt;&lt; endl;}<br>        virtual void Bf2() { cout &lt;&lt; &quot;B2::Bf2()&quot; &lt;&lt; endl;}<br><br>};<br><br>class D : public B1, public B2<br>{<br>    public:<br>        int id;<br>        char cd;<br>    public:<br>        D():id(100),cd(‘D’) {}<br><br>        virtual void f() { cout &lt;&lt; &quot;D::f()&quot; &lt;&lt; endl;}<br>        virtual void f1() { cout &lt;&lt; &quot;D::f1()&quot; &lt;&lt; endl;}<br>        virtual void f2() { cout &lt;&lt; &quot;D::f2()&quot; &lt;&lt; endl;}<br>        virtual void Df() { cout &lt;&lt; &quot;D::Df()&quot; &lt;&lt; endl;}<br><br>};<br><img src="http://img.pickbox.me/wp-content/uploads/pic/cb6ae4cd8dab667d0fb34584.jpg" small="0" class="blogimg"><br><br>E:&gt;cl v2.cpp -d1reportSingleClassLayoutD<br>…<br>class B size(12):<br> +—<br> 0 | {vfptr}<br> 4 | ib<br> 8 | cb<br>   | &lt;alignment member&gt; (size=3)<br> +—<br><br>B::$vftable@:<br> | &amp;B_meta<br> |  0<br> 0 | &amp;B::f<br> 1 | &amp;B::Bf<br><br>B::f this adjustor: 0<br>B::Bf this adjustor: 0<br><br><br>class B1 size(32):<br> +—<br> 0 | {vfptr}<br> 4 | {vbptr}<br> 8 | ib1<br>12 | cb1<br>   | &lt;alignment member&gt; (size=3)<br> +—<br>16 | (vtordisp for vbase B)<br> +— (virtual base B)<br>20 | {vfptr}<br>24 | ib<br>28 | cb<br>   | &lt;alignment member&gt; (size=3)<br> +—<br><br>B1::$vftable@B1@:<br> | &amp;B1_meta<br> |  0<br> 0 | &amp;B1::f1<br> 1 | &amp;B1::Bf1<br><br>B1::$vbtable@:<br> 0 | -4<br> 1 | 16 (B1d(B1+4)B)<br><br>B1::$vftable@B@:<br> | -20<br> 0 | &amp;(vtordisp) B1::f<br> 1 | &amp;B::Bf<br><br>B1::f this adjustor: 20<br>B1::f1 this adjustor: 0<br>B1::Bf1 this adjustor: 0<br><br>vbi:    class  offset o.vbptr  o.vbte fVtorDisp<br>               B      20       4       4 1<br><br><br>class B2 size(32):<br> +—<br> 0 | {vfptr}<br> 4 | {vbptr}<br> 8 | ib2<br>12 | cb2<br>   | &lt;alignment member&gt; (size=3)<br> +—<br>16 | (vtordisp for vbase B)<br> +— (virtual base B)<br>20 | {vfptr}<br>24 | ib<br>28 | cb<br>   | &lt;alignment member&gt; (size=3)<br> +—<br><br>B2::$vftable@B2@:<br> | &amp;B2_meta<br> |  0<br> 0 | &amp;B2::f2<br> 1 | &amp;B2::Bf2<br><br>B2::$vbtable@:<br> 0 | -4<br> 1 | 16 (B2d(B2+4)B)<br><br>B2::$vftable@B@:<br> | -20<br> 0 | &amp;(vtordisp) B2::f<br> 1 | &amp;B::Bf<br><br>B2::f this adjustor: 20<br>B2::f2 this adjustor: 0<br>B2::Bf2 this adjustor: 0<br><br>vbi:    class  offset o.vbptr  o.vbte fVtorDisp<br>               B      20       4       4 1<br><br><br>class D size(56):<br> +—<br> | +— (base class B1)<br> 0 | | {vfptr}<br> 4 | | {vbptr}<br> 8 | | ib1<br>12 | | cb1<br>   | | &lt;alignment member&gt; (size=3)<br> | +—<br> | +— (base class B2)<br>16 | | {vfptr}<br>20 | | {vbptr}<br>24 | | ib2<br>28 | | cb2<br>   | | &lt;alignment member&gt; (size=3)<br> | +—<br>32 | id<br>36 | cd<br>   | &lt;alignment member&gt; (size=3)<br> +—<br>40 | (vtordisp for vbase B)<br> +— (virtual base B)<br>44 | {vfptr}<br>48 | ib<br>52 | cb<br>   | &lt;alignment member&gt; (size=3)<br> +—<br><br>D::$vftable@B1@:<br> | &amp;D_meta<br> |  0<br> 0 | &amp;D::f1<br> 1 | &amp;B1::Bf1<br> 2 | &amp;D::Df<br><br>D::$vftable@B2@:<br> | -16<br> 0 | &amp;D::f2<br> 1 | &amp;B2::Bf2<br><br>D::$vbtable@B1@:<br> 0 | -4<br> 1 | 40 (Dd(B1+4)B)<br><br>D::$vbtable@B2@:<br> 0 | -4<br> 1 | 24 (Dd(B2+4)B)<br><br>D::$vftable@B@:<br> | -44<br> 0 | &amp;(vtordisp) D::f<br> 1 | &amp;B::Bf<br><br>D::f this adjustor: 44<br>D::f1 this adjustor: 0<br>D::f2 this adjustor: 16<br>D::Df this adjustor: 0<br><br>vbi:    class  offset o.vbptr  o.vbte fVtorDisp<br>               B      44       4       4 1<br><br>What is vtordisp for vbase B ?<br><br></p><p>Thr <strong>vtordisp</strong> is an offset that is used&#160;if you call any virtual functions in the constructor and destructor.</p><p>It is used very rarely - but we have to add it to classes that&#160;inherit from&#160;a virtual base class and override virtual functions just in case the user does call a virtual function in the constructor or destructor.</p><p>&#160;</p><p><a target="_blank" href="http://msdn.microsoft.com/en-us/library/ms879782.aspx">http://msdn.microsoft.com/en-us/library/ms879782.aspx</a></p><p>Enables the addition of the hidden vtordisp construction/destruction displacement member. The <strong>vtordisp</strong> pragma is applicable only to code that uses virtual bases. If a derived class overrides a virtual function that it inherits from a virtual base class, and if a constructor or destructor for the derived class calls that function using a pointer to the virtual base class, the compiler may introduce additional hidden “vtordisp” fields into classes with virtual bases.</p><p>The <strong>vtordisp</strong> pragma affects the layout of classes that follow it. The <strong>/vd0</strong> and <strong>/vd1</strong> options specify the same behavior for complete modules. Specifying <strong>off</strong> suppresses the hidden <em>vtordisp</em> members. Specifying <strong>on</strong>, the default, enables them where they are necessary. Turn off <strong>vtordisp</strong> only if there is no possibility that the class’s constructors and destructors call virtual functions on the object pointed to by the <strong>this</strong> pointer.</p><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/07/MSVC-compiler-d1reportSingleClassLayout-d1reportAllClassLayout/" class="archive-article-date">
  	<time datetime="2009-10-07T04:50:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-07</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-正态分布数据的排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/04/正态分布数据的排序/">正态分布数据的排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><a href="http://algorithmically.blogbus.com/logs/7597289.html" target="_blank">http://algorithmically.blogbus.com/logs/7597289.html</a><br></p><p>已知数组中的数据大致符合正态分布，哪种排序算法的效率最高？</p><p>答案是最常用的快速排序。常用的其他排序算法，如堆排序、合并排序甚至冒泡排序等都和数据的分布无关，他们的性能更多的取决于数据的具体顺序。只有快速排序涉及到对分割点的猜测，猜测的好坏对算法的效率有较大的影响。</p><p>在正态分布的数据中随机取一个数字，我们有较高的概率得到比较居中的数字，这一点只要看一眼正态分布的图形便知。如果快速排序算法通过在数据中随机选择数字，会有比较高的概率得到一个比较好的分割点。这也解释了为什么快速排序理论上的复杂度比较高，而在实际中效果很好。</p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/04/正态分布数据的排序/" class="archive-article-date">
  	<time datetime="2009-10-04T08:21:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-04</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-中间值" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/04/中间值/">中间值</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p> </p><p><a href="http://algorithmically.blogbus.com/logs/7533559.html" target="_blank">http://algorithmically.blogbus.com/logs/7533559.html</a></p><p>给你O(N)台联网的计算机，每台计算机上保存了O(N)个整数。假设由于内存的限制每台计算机最多能购处理O(N)个整数，请设计一个算法找出这O(N×N)个整数的中间值(Median)。</p><p>提示：可以假设有一台或几台计算机上没有保存数据（协调人），用来协调其他计算机的工作。</p><p>如果你不记得什么是中间值的话，这里有一个例子</p><p>1, 2, 3, 4, 5, 16, 17, 18, 19, 20 这里5和16都是中间值</p><p>1, 2, 3, 4, 5, 17, 18, 19, 20 这里5是中间值</p><p>我的答案：</p><p>先介绍一下总体思路，然后在讨论如何优化。&#160;</p><ol> <li>将每台计算机中保存的整数进行排序。</li> <li>计算机将各自整数的值域（最大最小值）都发送给协调人。</li> <li>协调人计算出所有整数的值域，以其最大值和最小值的平均数作为分割点，并通知其他计算机。</li> <li>每台计算机对大于等于（≥）和小于（&lt;）分割点的整数分别计数，并返回给协调人。</li> <li>综合每台计算机返回的计数，协调人可以知道中间值大于还是小于这一分割点。</li> <li>于是协调人选择中间值所在的那一半值域为当前的值域，重新计算分割点。这一过程反复进行，直到当前的值域只包含一个数字，或大于等于和小于分割点的整数数目相同为止：</li> <ul> <li>如果当前搜索的值域只包含一个数字，这个数字就是中间值。</li> <li>大于等于和小于分割点的整数数目相同，有两种情况：分割点本身出现在这些整数中的话，分割点和刚刚小于分割点的整数都是中间值，否则刚刚大于和刚刚小于分割点的数字都是中间值。</li> </ul></ol><br><p>这个算法实际上是一个分布式的二分查找过程，每一步把搜索范围缩减到原来的一半，共需要log(MAX-MIN)步才能完成搜索。算法本身可以进一步优化：</p><p>首先，计算机不需要对整数预先排序。第一次计算每组整数的值域时只需要一边扫描即可，复杂度为O(N)。为了对大于和小于分割点的整数分别计数，我们只需要采用Quick Sort的方式的一编扫描即可：</p><ol> <li>指针A从整数数组的首部开始向后扫描，直到遇到大于等于分割点的整数</li> <li>指针B从整数数组的尾部开始向前扫描，直到遇到小于分割点的整数</li> <li>将A和B所指向的数字交换，然后继续扫描。</li> <li>但A和B相遇的时候，我们已经把所有大于分割点的整数和小于分割点的整数分离了</li></ol><p>通过A和B相交的位置，我们便可以计算出大于等于和小于分割点的整数的数目。这样做我们同时避免了协调人一开始的等待时间。</p><p>其 次，当进行计数时，如果我们记住了大于和小于当前值域范围的整数的数目，我们只需要在当前值域范围内进行计数即可。因为值域的范围每次缩小一半，算法会越 来越快。第一次的计算量为N，第二次的计算量为N/2，第三次为N/4，……，总的计算量为2N，这远远小于排序算法的计算量O(N log N)。</p><p>&#160;</p><p>算法的空间复杂度O(1)<br>存储数据的计算机的总计算复杂度O(N)<br>协调人的计算复杂度和网络通信量皆为O(log N)</p><p>&#160;</p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/04/中间值/" class="archive-article-date">
  	<time datetime="2009-10-04T06:21:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-04</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Distributed-Computing/">Distributed Computing</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-分布式词频统计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/04/分布式词频统计/">分布式词频统计</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p> </p><p><a href="http://algorithmically.blogbus.com/logs/7604574.html" target="_blank">http://algorithmically.blogbus.com/logs/7604574.html</a></p><p>一个规模庞大的多语言语料库，已经经过预处理，分成了12个文件，每个文件存放在一台服务器中。每个文件中包含800亿个单词，每个单词占一行，平 均每个单词40字节。假设服务器都已经联网，每台服务器有双CPU和4G的内存，4×400GB的硬盘，换句话说，每台服务器就是一个高配置的PC机。请 设计一个方案，找出出现频率最高的一百万个单词。</p><p>这个问题基本上可能有两种思路。第一种需要先在每台服务器，完成对单词词频 的统计，进行排序，然后每两台服务器把词频统计结构进行合并，12个服务器合并到6个，然后3个，然后2个，直到所有的结果合并到一台服务器中我们就可以 找出这一百万个高频词了。由于单词在服务器之间的分布可能不均匀，即使一个单词在所有的服务器中出现频率都不高，合在一起仍有可能有较高的频率，此算法几 乎没有优化的余地。</p><p>举个例子，单词A只出现在一台机器上，出现了10万次。单词B在每台机器上都出现1万次。从每台服务器看来，A是高频 词，而B不是，但总体来说则可能正相反。每次合并统计结果时，本地机器中所有词频高于第一百万个高频词的词频的1/N的单词都要通过网络传输到另一台机器 中。这里N是当下包含词频统计的服务器的数目。总体来说这个方法效率比较低。</p><p>另一个方案要每台服务器负责一部分单词的词频统计，之后再采用分布式的分割算法找出前一百万个高频词。个人觉得这个算法更加可行，下面详细描述：</p><ol> <li>定义一个哈希函数将每个单词映射为1到12之间的一个数字，从而把单词均匀分割为12组。这样我们可以确定哪台服务器负责维护这个单词的词频。</li> <li>每台服务器建立12个分离的结构，用于统计每一组单词的词频。可以用哈希表也可以用前缀树。</li> <li>每台服务器中统计词频的过程很简单，关键的问题在于当内存不足的时候如何处理。这里要作一点区分，对于第N个服务器中：</li> <ol> <li>除第N组单词以外词频信息占用内存最多的是第X组单词，我们可以直接将现有的统计结果发送到第X个服务器中。第X个服务器会将它自身的第X组单词的统计结果和接收到的统计结果进行合并。</li> <li>第 N组单词的统计信息如果占用了过多的内存也会导致整个过程变慢。因而，当它占用内存超过比如说2G时，我们可以将当前的统计信息写入硬盘，这样可以腾出更 多的内存。只要我们保证在磁盘中和在内存里统计信息按相同的顺序排列，我们可以非常高效的将两组统计信息合并。不如说按照字典序（使用前缀树）或者按照哈 希值加字典序（使用哈希表）</li> </ol> <li>当每台服务器处理完本地的语料库後，将所有的不是自己负责的单词的统计信息发送到对应的服务器中，并进行合并。这样每个单词的词频统计信息都唯一的出现在一台服务器中。</li> <li>采用和《<a target="_blank" href="http://algorithmically.blogbus.com/logs/7533559.html">中间值</a>》类似的分布式算法，我们可以轻易地将频率最高的一百万单词和剩下的单词分开来。注意这里我们并没有为这些单词排序。</li></ol><p><br>记N为每台计算机上的单词数，M为不同的单词数。</p><p>每台服务器进行词频统计的计算复杂度为 O(N)。<br>总通讯量为O(M)。<br>寻找分割点时服务器的总计算量为O(M)<br>寻找分割点时协调人的额外计算量O(log M)</p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/04/分布式词频统计/" class="archive-article-date">
  	<time datetime="2009-10-04T06:02:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-04</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Distributed-Computing/">Distributed Computing</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-关于-fPIC选项-和-GOT表" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/10/01/关于-fPIC选项-和-GOT表/">关于-fPIC选项 和 GOT表</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>加上-fPIC参数后，编译后的文件和没有加这个参数的文件，有什么区别呢？<br>没有加这个参数的编译后的共享库，也可以使用，它和加了参数后的使用起来又有什么区别呢？</p>
<p>position independent（位置无关）<br>relocate（可重定位）</p>
<p>位置无关代码主要是在访问全局变量和全局函数的时候采用了位置无关的重定位方法，即依赖GOT和PLT来重定位。<br>普通的重定位方法需要修改代码段，比如偏移地址0x100处需要重定位，loader就修改代码段的0x100处的内容，通过查找重定位信息得到具体的值。这种方法需要修改代码段的内容，对于动态连接库来说，其初衷是让多个进程共享代码段，若对其进行写操作，就回引起COW，从而失去共享。<br>-fPIC选项告诉编绎器使用GOT和PLT的方法重定位，GOT是数据段，因此避免了COW，真正实现了共享。<br>如果不用-fPIC，动态连接库依然可以使用，但其重定位方法为一般方法，必然会引起COW，但也无所谓，除了性能在COW时稍微受些影响，其他也没啥。</p>
<p>GOT 是 data section，是一个 table，除专用的几个 entry，每个 entry 的内容可以再执行的时候修改；<br>PLT 是 text section，是一段一段的 code，执行中不需要修改。</p>
<p><a href="http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=cpu&amp;Number=688070&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1" target="_blank">http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=cpu&amp;Number=688070&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1</a></p>
<p>如何得到GOT表</p>
<p>汇编语言片段： 2f7: e8 00 00 00 00 call 2fc &lt;ok+0xc&gt;<br>2fc: 5b pop %ebx<br>2fd: 81 c3 b0 10 00 00 add $0x10b0,%ebx</p>
<p>这里的2f7中的call 2fc &lt;ok+0xc&gt;和2fc处的pop %ebx，得到运行时的eip地址，存入ebx寄存器中。</p>
<p>后面的add $0x10b0,%ebx又是什么用处？如果我们这里假定在内存中的地址是2fc，那加上10b0之后的值是0x13ac了，看在这里是什么呢？</p>
<p>Disassembly of section .got:<br>000013ac &lt;.got&gt;:<br>13ac: 34 13 xor $0x13,%al<br>…<br>可以看出这是一个got节。</p>
<p>－－－－－－－－－－－－－－－－－－－－－－－－－</p>
<p>一个例子</p>
<p>对于加了-fPIC选项的共享库，如：gcc -shared -fPIC  -o libhello.so  hello.c，<br>其.got.plt section中存放外部函数的地址，.got section中存放全局变量的地址。<br>.got.plt紧接在.got后面，ebx寄存器存放.got.plt地址，正偏移引用函数地址，负偏移引用数据地址。<br>对于static变量（不通过GOT表来引用），如static int ss; 可以用ss@GOTOFF(%ebx)来引用（相对于GOT表的偏移）。</p>
<p>// hello.c</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>int count;<br>char ch;<br>struct _s {<br>int s1;<br>int s2;<br>} s;</p>
<p>void say_hello()<br>{<br>printf(“Hello:%xn”, ++count);<br>printf(“Hello:%xn”, ++ch);<br>printf(“Hello:%xn”, ++s.s1);<br>printf(“Hello:%xn”, ++s.s2);<br>}</p>
<p>jfo@lab:~/test$ gcc -ggdb -shared -fPIC  -o libhello.so  hello.c</p>
<p>jfo@lab:~/test$ readelf -x.got libhello.so</p>
<p>Hex dump of section ‘.got’:<br>0x000016a0 00000000 00000000 00000000 00000000 …………….<br>0x000016b0 00000000 00000000 ……..</p>
<p>jfo@lab:~/test$ readelf -x.got.plt libhello.so</p>
<p>Hex dump of section ‘.got.plt’:<br>0x000016b8 d8150000 00000000 00000000 9e030000 …………….<br>0x000016c8 ae030000 be030000 ……..</p>
<p>jfo@lab:~/test$ objdump -S -j.plt libhello.so</p>
<p>libhello.so: file format elf32-i386</p>
<p>Disassembly of section .plt:</p>
<p>00000388 &lt;<strong>gmon_start</strong>@plt-0x10&gt;:<br>388: ff b3 04 00 00 00 pushl 0x4(%ebx)<br>38e: ff a3 08 00 00 00 jmp *0x8(%ebx)<br>394: 00 00 add %al,(%eax)<br>…</p>
<p>00000398 &lt;<strong>gmon_start</strong>@plt&gt;:<br>398: ff a3 0c 00 00 00 jmp *0xc(%ebx)<br>39e: 68 00 00 00 00 push $0x0<br>3a3: e9 e0 ff ff ff jmp 388 &lt;_init+0x30&gt;</p>
<p>000003a8 &lt;printf@plt&gt;:<br>3a8: ff a3 10 00 00 00 jmp *0x10(%ebx)<br>3ae: 68 08 00 00 00 push $0x8<br>3b3: e9 d0 ff ff ff jmp 388 &lt;_init+0x30&gt;</p>
<p>000003b8 &lt;__cxa_finalize@plt&gt;:<br>3b8: ff a3 14 00 00 00 jmp *0x14(%ebx)<br>3be: 68 10 00 00 00 push $0x10<br>3c3: e9 c0 ff ff ff jmp 388 &lt;_init+0x30&gt;</p>
<p>jfo@lab:~/test$ objdump -S -j.text libhello.so<br>…<br>void say_hello()<br>{<br>48c: 55 push %ebp<br>48d: 89 e5 mov %esp,%ebp<br>48f: 53 push %ebx<br>490: 83 ec 14 sub $0x14,%esp<br>493: e8 ef ff ff ff call 487 &lt;__i686.get_pc_thunk.bx&gt;<br>498: 81 c3 20 12 00 00 add $0x1220,%ebx<br>printf(“Hello:%xn”, ++count);<br>49e: 8b 83 f8 ff ff ff mov -0x8(%ebx),%eax<br>4a4: 8b 00 mov (%eax),%eax<br>4a6: 8d 50 01 lea 0x1(%eax),%edx<br>4a9: 8b 83 f8 ff ff ff mov -0x8(%ebx),%eax<br>4af: 89 10 mov %edx,(%eax)<br>4b1: 8b 83 f8 ff ff ff mov -0x8(%ebx),%eax<br>4b7: 8b 00 mov (%eax),%eax<br>4b9: 89 44 24 04 mov %eax,0x4(%esp)<br>4bd: 8d 83 fc ee ff ff lea -0x1104(%ebx),%eax<br>4c3: 89 04 24 mov %eax,(%esp)<br>4c6: e8 dd fe ff ff call 3a8 &lt;printf@plt&gt;<br>printf(“Hello:%xn”, ++ch);<br>4cb: 8b 83 f4 ff ff ff mov -0xc(%ebx),%eax<br>4d1: 0f b6 00 movzbl (%eax),%eax<br>4d4: 8d 50 01 lea 0x1(%eax),%edx<br>4d7: 8b 83 f4 ff ff ff mov -0xc(%ebx),%eax<br>4dd: 88 10 mov %dl,(%eax)<br>4df: 8b 83 f4 ff ff ff mov -0xc(%ebx),%eax<br>4e5: 0f b6 00 movzbl (%eax),%eax<br>4e8: 0f be c0 movsbl %al,%eax<br>4eb: 89 44 24 04 mov %eax,0x4(%esp)<br>4ef: 8d 83 fc ee ff ff lea -0x1104(%ebx),%eax<br>4f5: 89 04 24 mov %eax,(%esp)<br>4f8: e8 ab fe ff ff call 3a8 &lt;printf@plt&gt;<br>printf(“Hello:%xn”, ++s.s1);<br>4fd: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>503: 8b 00 mov (%eax),%eax<br>505: 8d 50 01 lea 0x1(%eax),%edx<br>508: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>50e: 89 10 mov %edx,(%eax)<br>510: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>516: 8b 00 mov (%eax),%eax<br>518: 89 44 24 04 mov %eax,0x4(%esp)<br>51c: 8d 83 fc ee ff ff lea -0x1104(%ebx),%eax<br>522: 89 04 24 mov %eax,(%esp)<br>525: e8 7e fe ff ff call 3a8 &lt;printf@plt&gt;<br>printf(“Hello:%xn”, ++s.s2);<br>52a: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>530: 8b 40 04 mov 0x4(%eax),%eax<br>533: 8d 50 01 lea 0x1(%eax),%edx<br>536: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>53c: 89 50 04 mov %edx,0x4(%eax)<br>53f: 8b 83 e8 ff ff ff mov -0x18(%ebx),%eax<br>545: 8b 40 04 mov 0x4(%eax),%eax<br>548: 89 44 24 04 mov %eax,0x4(%esp)<br>54c: 8d 83 fc ee ff ff lea -0x1104(%ebx),%eax<br>552: 89 04 24 mov %eax,(%esp)<br>555: e8 4e fe ff ff call 3a8 &lt;printf@plt&gt;<br>}<br>…</p>
<p>jfo@lab:~/test$ readelf -a libhello.so<br>…</p>
<p>Relocation section ‘.rel.dyn’ at offset 0x308 contains 7 entries:<br>Offset Info Type Sym.Value Sym. Name<br>000016d0 00000008 R_386_RELATIVE<br>000016a0 00000806 R_386_GLOB_DAT 000016dc s //offset -0x18(ebx)<br>000016a4 00000106 R_386_GLOB_DAT 00000000 <strong>gmon_start</strong> //offset -0x14(ebx)<br>000016a8 00000206 R_386_GLOB_DAT 00000000 _Jv_RegisterClasses //offset -0x10(ebx)<br>000016ac 00000d06 R_386_GLOB_DAT 000016e4 ch //offset -0xc(ebx)<br>000016b0 00000906 R_386_GLOB_DAT 000016e8 count //offset -0x8(ebx)<br>000016b4 00000406 R_386_GLOB_DAT 00000000 __cxa_finalize //offset -0x4(ebx)<br>//Offset000016a0、000016ac、000016b0位于.got section<br>//Sym.Value000016dc、000016e4、000016e8对应.bss段变量的地址</p>
<p>Relocation section ‘.rel.plt’ at offset 0x340 contains 3 entries:<br>Offset Info Type Sym.Value Sym. Name<br>000016c4 00000107 R_386_JUMP_SLOT 00000000 <strong>gmon_start</strong> //offset 0xc(ebx)<br>000016c8 00000307 R_386_JUMP_SLOT 00000000 printf //offset 0x10(ebx)<br>000016cc 00000407 R_386_JUMP_SLOT 00000000 __cxa_finalize //offset 0x14(ebx)<br>//Offset000016c4、000016c8、000016cc位于.got.plt section</p>
<p>There are no unwind sections in this file.</p>
<p>Symbol table ‘.dynsym’ contains 14 entries:<br>Num: Value Size Type Bind Vis Ndx Name<br>0: 00000000 0 NOTYPE LOCAL DEFAULT UND<br>1: 00000000 0 NOTYPE WEAK DEFAULT UND <strong>gmon_start</strong><br>2: 00000000 0 NOTYPE WEAK DEFAULT UND _Jv_RegisterClasses<br>3: 00000000 54 FUNC GLOBAL DEFAULT UND printf@GLIBC_2.0 (2)<br>4: 00000000 267 FUNC WEAK DEFAULT UND <strong>cxa_finalize@GLIBC_2.1.3 (3)<br>5: 0000048c 212 FUNC GLOBAL DEFAULT 11 say_hello<br>6: 000016ec 0 NOTYPE GLOBAL DEFAULT ABS _end<br>7: 000016d4 0 NOTYPE GLOBAL DEFAULT ABS _edata<br>8: 000016dc 8 OBJECT GLOBAL DEFAULT 22 s<br>9: 000016e8 4 OBJECT GLOBAL DEFAULT 22 count<br>10: 000016d4 0 NOTYPE GLOBAL DEFAULT ABS </strong>bss_start<br>11: 00000358 0 FUNC GLOBAL DEFAULT 9 _init<br>12: 00000598 0 FUNC GLOBAL DEFAULT 12 _fini<br>13: 000016e4 1 OBJECT GLOBAL DEFAULT 22 ch</p>
<p>Section Headers:<br>[Nr] Name Type Addr Off Size ES Flg Lk Inf Al<br>[ 0] NULL 00000000 000000 000000 00 0 0 0<br>[ 1] .hash HASH 000000b4 0000b4 00004c 04 A 3 0 4<br>[ 2] .gnu.hash GNU_HASH 00000100 000100 000048 04 A 3 0 4<br>[ 3] .dynsym DYNSYM 00000148 000148 0000e0 10 A 4 1 4<br>[ 4] .dynstr STRTAB 00000228 000228 000091 00 A 0 0 1<br>[ 5] .gnu.version VERSYM 000002ba 0002ba 00001c 02 A 3 0 2<br>[ 6] .gnu.version_r VERNEED 000002d8 0002d8 000030 00 A 4 1 4<br>[ 7] .rel.dyn REL 00000308 000308 000038 08 A 3 0 4<br>[ 8] .rel.plt REL 00000340 000340 000018 08 A 3 10 4<br>[ 9] .init PROGBITS 00000358 000358 000030 00 AX 0 0 4<br>[10] .plt PROGBITS 00000388 000388 000040 04 AX 0 0 4<br>[11] .text PROGBITS 000003d0 0003d0 0001c8 00 AX 0 0 16<br>[12] .fini PROGBITS 00000598 000598 00001c 00 AX 0 0 4<br>[13] .rodata PROGBITS 000005b4 0005b4 00000a 00 A 0 0 1<br>[14] .eh_frame PROGBITS 000005c0 0005c0 000004 00 A 0 0 4<br>[15] .ctors PROGBITS 000015c4 0005c4 000008 00 WA 0 0 4<br>[16] .dtors PROGBITS 000015cc 0005cc 000008 00 WA 0 0 4<br>[17] .jcr PROGBITS 000015d4 0005d4 000004 00 WA 0 0 4<br>[18] .dynamic DYNAMIC 000015d8 0005d8 0000c8 08 WA 4 0 4<br>[19] .got PROGBITS 000016a0 0006a0 000018 04 WA 0 0 4<br>[20] .got.plt PROGBITS 000016b8 0006b8 000018 04 WA 0 0 4<br>[21] .data PROGBITS 000016d0 0006d0 000004 00 WA 0 0 4<br>[22] .bss NOBITS 000016d4 0006d4 000018 00 WA 0 0 4<br>[23] .comment PROGBITS 00000000 0006d4 00005a 00 0 0 1<br>[24] .debug_aranges PROGBITS 00000000 000730 000070 00 0 0 8<br>[25] .debug_pubnames PROGBITS 00000000 0007a0 000037 00 0 0 1<br>[26] .debug_info PROGBITS 00000000 0007d7 0001a8 00 0 0 1<br>[27] .debug_abbrev PROGBITS 00000000 00097f 0000aa 00 0 0 1<br>[28] .debug_line PROGBITS 00000000 000a29 00013c 00 0 0 1<br>[29] .debug_frame PROGBITS 00000000 000b68 000030 00 0 0 4<br>[30] .debug_str PROGBITS 00000000 000b98 000083 01 MS 0 0 1<br>[31] .debug_loc PROGBITS 00000000 000c1b 00002c 00 0 0 1<br>[32] .debug_ranges PROGBITS 00000000 000c48 000040 00 0 0 8<br>[33] .shstrtab STRTAB 00000000 000c88 00013b 00 0 0 1<br>[34] .symtab SYMTAB 00000000 001364 000430 10 35 54 4<br>[35] .strtab STRTAB 00000000 001794 00019e 00 0 0 1</p>
<p>main函数中对于libhello.so中的函数say_hello的调用，会建立plt表（可减少relocation的次数，不需要对每个say_hello调用处都relocate，只需将GOT表中对应entry relocate）；<br>而对于count的使用，直接分配了固定地址！.rel.dyn节里标记为R_386_COPY类型，并将count变量的地址直接copy到libhello.so的GOT表对应的entry里。<br>参见：<a href="http://blog.pickbox.me/2007/11/12/%E3%80%90zz%E3%80%91%E4%BB%8E%E7%A8%8B%E5%BA%8F%E5%91%98%E8%A7%92%E5%BA%A6%E7%9C%8Belf/" target="_blank">【zz】从程序员角度看ELF</a>::<span style="text-decoration: underline;"><em>启动过程</em></span>::<em><span style="text-decoration: underline;">静态的初始化</span></em></p>
<p>// test.c</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>extern int count;</p>
<p>int main()<br>{<br>say_hello();<br>printf(“count is %xn”, count);</p>
<p>return 0;<br>}</p>
<p>jfo@lab:~/test$ gcc -ggdb -o test test.c -L. -lhello -Wl,-rpath,.</p>
<p>jfo@lab:~/test$ objdump -S test<br>…<br>int main()<br>{<br>80484e4: 8d 4c 24 04 lea 0x4(%esp),%ecx<br>80484e8: 83 e4 f0 and $0xfffffff0,%esp<br>80484eb: ff 71 fc pushl -0x4(%ecx)<br>80484ee: 55 push %ebp<br>80484ef: 89 e5 mov %esp,%ebp<br>80484f1: 51 push %ecx<br>80484f2: 83 ec 14 sub $0x14,%esp<br>say_hello();<br>80484f5: e8 02 ff ff ff call 80483fc &lt;say_hello@plt&gt;</p>
<p>printf(“count is %xn”, count);<br>80484fa: a1 08 97 04 08 mov 0x8049708,%eax //变量cout的地址固定！！！<br>80484ff: 89 44 24 04 mov %eax,0x4(%esp)<br>8048503: c7 04 24 e0 85 04 08 movl $0x80485e0,(%esp)<br>804850a: e8 0d ff ff ff call 804841c &lt;printf@plt&gt;</p>
<p>return 0;<br>804850f: b8 00 00 00 00 mov $0x0,%eax<br>}<br>8048514: 83 c4 14 add $0x14,%esp<br>8048517: 59 pop %ecx<br>8048518: 5d pop %ebp<br>8048519: 8d 61 fc lea -0x4(%ecx),%esp<br>804851c: c3 ret<br>804851d: 90 nop<br>804851e: 90 nop<br>804851f: 90 nop</p>
<p>…</p>
<p>jfo@lab:~/test$ readelf -a test<br>…<br>Relocation section ‘.rel.dyn’ at offset 0x37c contains 2 entries:<br>Offset Info Type Sym.Value Sym. Name<br>080496e0 00000106 R_386_GLOB_DAT 00000000 <strong>gmon_start</strong><br>08049708 00000905 R_386_COPY 08049708 count</p>
<p>Relocation section ‘.rel.plt’ at offset 0x38c contains 4 entries:<br>Offset Info Type Sym.Value Sym. Name<br>080496f0 00000107 R_386_JUMP_SLOT 00000000 <strong>gmon_start</strong><br>080496f4 00000307 R_386_JUMP_SLOT 00000000 say_hello<br>080496f8 00000407 R_386_JUMP_SLOT 00000000 __libc_start_main<br>080496fc 00000507 R_386_JUMP_SLOT 00000000 printf</p>
<p>…</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/10/01/关于-fPIC选项-和-GOT表/" class="archive-article-date">
  	<time datetime="2009-10-01T07:04:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-10-01</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-浮点数的表示" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/09/24/浮点数的表示/">浮点数的表示</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a target="_blank" href="http://zh.wikipedia.org/zh-cn/IEEE_754">http://zh.wikipedia.org/zh-cn/IEEE_754</a><br>32位单精度</p><p>单精度二进制小数，使用32个位元存储。</p>　　  1     8               23              位長<br>　　 +-+——+——+<br>　　 |S|  Exp    |  Fraction             |<br>　　 +-+——+——+<br>　　 31 30      23 22                    0    位編號（從右邊開始為0）<br>     偏正值 +127<p>S为符号位，Exp为指数位，Fraction为有效数位。 指数部分即使用所谓的<em>偏正值</em>形式表示，实际值为表示值与一个固定值 （32位的情况是127）的和。采用这种方式表示的目的是简化比较。因为，指数的值可能为正也可能为负，如果采用补码表示的话，全体符号位S和Exp自身 的符号位将导致不能简单的进行大小比较。正因为如此，指数部分通常采用一个无符号的正数值存储。单精度的指数部分是&#8722;126～+127加上127 ，指数值的大小从1～254（0和255是特殊值）。浮点小数计算时，指数值减去偏正值将是实际的指数大小。</p><br>对于float，e = 8<br>                        表示            指数            小数部分                            零            0            0                            非正规形式            0            非0                            正规形式            1 到 2<sup><em>e</em></sup> &#8722; 2            任意                            无穷            2<sup><em>e</em></sup> &#8722; 1            0                            NaN            2<sup><em>e</em></sup> &#8722; 1            非零            <br>1.0的二进制：0,01111111,00000000000000000000000<br><br><br>64位双精度<p>双精度二进制小数，使用64个位元存储。</p>　　  1     11                          52                             位長<br>　　 +-+——+——+<br>　　 |S|    Exp  |                   Fraction                        |<br>　　 +-+——+——+<br>　　 63 62     52 51                                                 0 位編號（從右邊開始為0）<br>     偏正值 +1023<p><br>S 为符号位，Exp为指数位，Fraction为有效数位。 指数部分即使用所谓的偏正值形式表示，实际值为表示值与一个固定值（64位的情况是1023）的和。采用这种方式表示的目的是简化比较。因为，指数的值可 能为正也可能为负，如果采用补码表示的话，全体符号位S和Exp自身 的符号位将导致不能简单的进行大小比较。正因为如此，指数部分通常采用一个无符号的正数值存储。双精度的指数部分是&#8722;1022～+1023加上1023 ，指数值的大小从1～2046（0(2进位全为0)和2047(2进位全为1)是特殊值）。浮点小数计算时，指数值减去偏正值将是实际的指数大小。</p><p> </p><p> </p><p> </p><p> </p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/09/24/浮点数的表示/" class="archive-article-date">
  	<time datetime="2009-09-24T06:37:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-09-24</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-智力题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/09/19/智力题/">智力题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 菲波那契数列 1,1,2,3,5,8,13……的第40位除以第39位得多少？即，N40/N39=？<br>a. 1.666666<br>b. 1.618xxx(后面几位记不清了)<br>c. 1.600000<br>d. 以上都不对<br>答案：b<br>N40/N39 = (N39 + N38) / N39 = 1 + N38 / N39 = 1 + 1 / (N39 / N38)<br>===&gt; Dn = 1 + 1 / Dn-1<br>f(x) = 1 + 1/x, f(f(x)) = 1 + 1 / f(x), …<br>如果收敛，则趋近于<br>y = 1 + 1 / y ===&gt; y^2 -y - 1 = 0 ===&gt; y = (sqrt(5) + 1) / 2 = 1.6180339887…<br><br><br><br>实验室里有1000个一模一样的瓶子，但是其中的一瓶有毒。可以用实验室的小白鼠来测试哪一瓶是毒药。如果小白鼠喝掉毒药的话，会在一个星期的时候死去，其他瓶子里的药水没有任何副作用。请问最少用多少只小白鼠可以在一个星期以内查出哪瓶是毒药：<br>a. 9<br>b. 10<br>c. 32<br>d. 999<br>e. 以上都不对<br>参考答案：b<br>二进制编码<br><br><br>有一家人，老公、老婆、儿子还有老公的妈妈，其中有一个是律师，一个是医生<br>如果医生比律师年轻，则医生与律师没有血缘关系<br>如果医生的女的，那么医生和律师有血缘关系<br>如果律师是男的，医生也是男的<br>请问我们能确定这家人里的那一个人<br>a. 老公是医生<br>b. 老婆是医生<br>c. 儿子是医生<br>d. 老公的妈妈是医生<br>e. 以上都不对<br>答案：a<br><br><br><br>麦当劳有6块9块20块鸡的袋子，问大于等于N块的鸡都能正好用前述袋子装走的最小N是多少？正好的意思是每个袋子要么装满要么为空，答案是44<br>－－－－－－－－－－－－－－－－<br>1，充分条件是：<br>如果n开始，能找到若干个20和若干个9之和，除以6的各个余数，1，2，3，4，5。<br><br>2，9和20组合一下，不难发现：<br><strong>9</strong> ：<br>9 % 6 =   3，1次9<br>(9 + 9) % 6 = 0，2次9，没意义了，加1次有意义。<br><br><strong>20</strong> ：<br>20 % 6 =   2，1次20，<br>(20 + 20) % 6 = 4，2次20，<br>(20 + 20 + 20) % 6 = 0，3次20，没意义，最多加2次。<br><br><strong>20 和 9 组合</strong>，1次9，2次20：<br>(20 + 9) % 6 =   5，1次9，1次20<br>(20 + 20 + 9) % 6 = 1，2次20，1次9<br><br>3，求最小的<br>2中我们发现20 + 20 + 9 = 49，为了 余1，49以上肯定行，那么49一下的呢？<br>减掉一次循环，肯定不行，因为不能余1。但是除了余1，其他的都能余了，再加1就行。所以答案是：<br>49 - 6 + 1 = 44<br>－－－－－－－－－－－－－－－－<br>这个问题可以用不等式解决：<br>首先要满足：<br>6x + 9y + 20z = N;&#160; &#160;&#160; &#160;&#160; &#160;&#160;&#160;………………式1<br>然后还要分析如何用这几种类型的袋子实现N+1；可以得到：<br>6(x+2) + 9(y+1) + 20(z-1) = N+1&#160; &#160;&#160; &#160;&#160;&#160;……………式2<br>不难发现这个式子是实现N+1的最有效方式。<br>然后再分析如何用这几种类型的袋子 实现N+2；可以得到：<br>6x + 9(y-2) + 20(z+1) = N+2&#160; &#160;&#160; &#160;&#160; &#160; ……………..式3<br>同样，这也是实现N+2的最有效的方法（原因是只比原来多用了一个袋子）。<br>再分析如何用这同种类型的袋子 实现N+3；可以得到：<br>6(x-1) + 9(y+1) + 20z = N+3;&#160; &#160;&#160; &#160;&#160; &#160;……………..式4<br>同样，这也是实现N+3的最有效的方法。<br><br>再往下实现N+4，N+5，N+6……….直到N+无穷，都可以用实现N+1，N+2，N+3这两种组合实现，所以只要找到满足式2，式3， 式4 的条件的x,y,z即可。<br><br>这里必须满 足的条件是 z-1 &gt;= 0(由式2 得出)即——–&gt;z &gt;=1<br>y-2 &gt;= 0(由式3 得出)即———&gt;y &gt; = 2<br>x-1 &gt;= 0(由式4得出)即———-&gt;x &gt; = 1<br><br>所以，6x + 9y + 20z &gt;=44.<br>完毕。<br><br><br>25匹马，每次赛5匹，问最少需要赛多少次可以决出前3名？<br>参考答案：25匹马分5组A,B,C,D,E，每组决出第一名A1,B1,C1,D1,E1；<br>5个第一名再赛一次，决出前三名A1,B1,C1；<br>然后再取(A2, A3, B1, B2, C1)赛出头两名即可。<br><br><br>1,2,3…n千克的砝码可以称出1,2,3..n千克的所有重量，那请问要想称出1,<br>2,3….n千克的所有重量，最少用多少砝码？<br>参考答案：1、3、9、27…<br>2=3-1，5=9-1-3，11=9+3-1，<br><br><br>飞机上有100个座位，按顺序从1到100编号。有100个乘客，他们分别拿到了从1号到100  <br>号的座位，他们按号码顺序登机并应当对号入座，如果他们发现对应号座位被别人坐了， <br>他会在剩下空的座位随便挑一个坐。现在假如1号乘客疯了 -_-! (其他人没疯)，他会在100 <br>个座位中随机座一个座位。那么第100人正确坐自己座位的概率是多少？    <br>答案：50％<br>如果1号乘客挑中1号座位，则第100人肯定可以坐到自己座位；如果挑中第100号座位，那么第100人肯定不会坐到自己的座位。<br>挑到1号座位与挑到100号座位的概率相同，设为x，此时不需考虑后继乘客的选择；<br>否则如果1号乘客没有挑到上面的两个座位（概率记为unknown），就需要继续考虑后继乘客的选择；<br>对于概率，如下公式成立：<br>1 ＝ x ＋ x ＋ unknown<br><br>后继乘客怎样选择？<br>假设1好乘客挑到了第30个座位，那么从第2号到第29号乘客都正确坐到了自己的座位，下面轮到第30号乘客挑选。同样，挑到1号座位与挑到100号座位的概率相同，设为y，此时选择可以终止；未挑到这两个座位的概率记为unknown_2，此时需继续选择；<br>unknown ＝ y ＋ y ＋ unknown_2<br>依次类推，直到所有乘客坐好。<br>可以看到，每次unknown里选中1号座位的概率始终和选中100号座位的概率相等，因此最后一个乘客正确坐到自己座位的为50％<br><br><br>有一个100层高的大厦，你手中有两个相同的玻璃围棋子。从这个大厦的某一层扔下围棋子就会碎，用你手中的这两个玻璃围棋子，找出一个最优的策略，来得知那个临界层面。答案：<br>One drop allows us to test 1 floor.Two drops can test 3 floors: Test the second floor first. If it breaks, test the first floor with the other ball. If not, test the top floor with either ball.Three drops can test 6 floors: Test the third floor first. If it breaks, test the bottom 2 floors in order with the other ball. If not, test the top 3 floors as described above.Four drops can test 10 floors: Test the fourth floor first. If it breaks, test the bottom 3 floors in order with the other ball. If not, test the top 6 floors as described above.N drops allows you to test the number of floors equal to the sum of 1 to n. Fourteen drops can test 105 floors: Test the fourteenth floor first. If it breaks, test the bottom 13 floors in order with the other ball. If not, test the twenty-seventh floor next (14 3), and so on.For any given drop, the number of drops you’ll need after that should be the same if that ball breaks or not (or sometimes they are off by 1 if your total is not an even sum-of-1-to-n).The optimum test protocol for 100 floors, then, requires a maximum of 14 drops. The next step is to derive a testing strategy that divides the 100 floors using the series 14+13+12+11+10+9+8+7+6+5+4+3+2+1.The best testing strategy starts with a drop from floor 14; then a drop from floor 27 (14+13); then 39 (14+13+12);etc. The full pattern is 14, 27, 39, 50, 60, 69, 77, 84, 90, 95, 99, 100.In practice, this series sacrifices the first ball to point to an everdecreasing series of possible target floors. A small number of drops using the second ball then identifies the target floor. Simply go back to the previously tested floor and start working up a floor at a time.Eventually,you will determine the floor at which the bowling ball shatters.This is the most efficient testing algorithm.<br>另外一种思路也很好，但是次数比14要大：类似于基数排序，将楼层数看成十位和个位，先用其中一个ball从10层、20层、30层一直往上测，最多到100层，总共尝试10次；当在某一层破碎，则在该层的下面10层尝试，比如第30层第一个球破碎，则在第21层、22层、23层一直到第29层尝试，相当于测试个位，总共尝试9次，最后加起来10+9=19次。<br><br><br><br>23枚硬币中有10枚是面朝上的，不许看，只许将硬币翻面（手摸不出正反面），现在要将这些硬币分成两组，两组中面朝上的硬币的数目相等，问如何分？<br>答案：将硬币分成10枚一堆和13枚一堆，将10枚那堆硬币全部翻转即可<br><br><br>A和B两个桶，分别装有10kg红色颜料和10kg蓝色颜料，现从A桶取一勺颜料装入B桶，搅拌均匀，再从B桶取同等质量的一勺装回A桶，问A桶中蓝色颜料占得比例和B桶中红色颜料的比例之间的关系？<br>答案：相等<br>A中的多出来的蓝色颜料部分和从A中分出去的红色颜料部分是一样多的<br>考虑极端情况：将A中全部颜料装入B中，再取一半回来<br>实际上，这道题的答案与搅拌均匀与否没有关系，和硬币的那道题类似<br><br><br>Allen and Brenda, both have a note stuck on their forehead, with a positive integer number written on it .Both Allen and Brenda can see each other’s number. They also know that the two numbers have a difference of one. They are trying to figure out the number on their own forehead.<br>Allen first says,”I don’t know my number.”<br>Brenda says,” I don’t know my number either”<br>Then Allen says “Now, I know my number”<br>Brenda now says, “Yeah, I know my number also!”<br>What is the number of Allen and Brenda?<br>A. 2,1<br>B. 1,2<br>C. 3,2<br>D. 2,3<br>E. 4,3<br>answer：C、E<br><br><br><br>Ctrl+a查看答案<br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/09/19/智力题/" class="archive-article-date">
  	<time datetime="2009-09-19T05:48:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-09-19</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【★】Censored-（Forbidden-Words）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/09/15/【★】Censored-（Forbidden-Words）/">【★】Censored!（Forbidden Words）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>POJ 1625<br><br>Censored!                        <strong>Time Limit:</strong> 5000MS                         <strong>Memory Limit:</strong> 10000K                            <strong>Total Submissions:</strong> 1859                         <strong>Accepted:</strong> 489            </p><p>Description</p>The alphabet of Freeland consists of exactly N letters. Each sentence of Freeland language (also known as Freish) consists of exactly M letters without word breaks. So, there exist exactly N^M different Freish sentences. <br><br>But after recent election of Mr. Grass Jr. as Freeland president some words offending him were declared unprintable and all sentences containing at least one of them were forbidden. The sentence S contains a word W if W is a substring of S i.e. exists such k &gt;= 1 that S[k] = W[1], S[k+1] = W[2], …,S[k+len(W)-1] = W[len(W)], where k+len(W)-1 &lt;= M and len(W) denotes length of W. Everyone who uses a forbidden sentence is to be put to jail for 10 years. <br><br>Find out how many different sentences can be used now by freelanders without risk to be put to jail for using it.<p>Input</p>The first line of the input file contains three integer numbers: N – the number of letters in Freish alphabet, M – the length of all Freish sentences and P – the number of forbidden words (1 &lt;= N &lt;= 50, 1 &lt;= M &lt;= 50, 0 &lt;= P &lt;= 10). <br><br>The second line contains exactly N different characters – the letters of the Freish alphabet (all with ASCII code greater than 32). <br><br>The following P lines contain forbidden words, each not longer than min(M, 10) characters, all containing only letters of Freish alphabet.<p>Output</p>Output the only integer number – the number of different sentences freelanders can safely use.<p>Sample Input</p>2 3 1<br>ab<br>bb<p>Sample Output</p>5<p>Source</p><a href="http://acm.pku.edu.cn/JudgeOnline/searchproblem?field=source&amp;key=Northeastern+Europe+2001" target="_blank" rel="external">Northeastern Europe 2001</a>, Northern Subregion<br><br><br><hr><p>此题需要建立trie，再建ac完全性的自动机（也被一些人成为trie图，一回事）。即任何状态，对应任何字符都是有转移的。如果是基本ac自动机，下面所说的动归过程中，如果碰到无法识别的转移，就需要通过回溯prefix link去获取转移到的状态。</p><p>动态规划的过程不难。</p><p>用dp[i][j]表示第i步，有多少种方式能到达j状态。</p><p>那么dp[i][j] = sigma(dp[i-1][k]) (trans[k][x] == j(x在字母表中))</p><p>用代码表示似乎简洁些</p><p>for (i = 0; i &lt; 单词长度; i++) {<br>    for (cur = 0; cur &lt; 状态数; cur++) {<br>        for each 字母k in 字母表 {<br>            next = trans[cur][k];<br>            if (next 不是终止状态)<br>                dp[i+1][next] += dp[i][cur]; //(可使用滚动数组)<br>        }<br>    }<br>}</p><p>注意第4行，在非完全自动机中你需要回溯prefix link去获取转移。</p><p>最后，把所有dp[单词长度]的状态加起来。</p><p>用代码表示：</p><p>int sum = 0;</p><p>for (cur = 0; cur &lt; 状态数; cur++) {<br>    sum += dp[单词长度][cur];<br>}</p><br><br><p>// author: jfo()</p><p>////////////////////////////////////////////////////////////////////////////</p><p>#include &lt;iostream&gt;<br>#include &lt;algorithm&gt;<br>#include &lt;string&gt;<br>#include &lt;vector&gt;<br>#include &lt;map&gt;<br>#include &lt;deque&gt;<br>#include &lt;cassert&gt;<br>//#include &quot;bigint.h&quot;<br>using namespace std;<br><br><br>int N, M, P;<br>string Alphabet;<br>int L;<br>vector&lt;string&gt; forbidden;<br><br>int gState = 1;<br>int A = ‘A’; // ASCII ‘A’ -&gt; value:65<br><br>typedef struct TrieNode {<br>    struct TrieNode <em>child[50];<br>    struct TrieNode </em>parent;<br>    struct TrieNode <em>fault;<br>    int color;<br>} TrieNode;<br>TrieNode trans[101];<br>TrieNode </em>root;<br><br>class BigInt<br>{<br>public:<br>    BigInt() : m_val(&quot;0&quot;) {}<br>    BigInt(int v)<br>    {<br>        do {<br>            m_val = char(‘0’ + v % 10) + m_val;<br>        } while(v = v / 10);<br>    }<br>    BigInt(const BigInt&amp; rhs)<br>    {<br>        m_val = rhs.m_val;<br>    }<br>    const BigInt operator +=(int v)<br>    {<br>        return <em>this += BigInt(v);<br>    }<br>    const BigInt operator +=(const BigInt&amp; v)<br>    {<br>        int carry = 0;<br>        string result;<br>        string rhs = v.m_val;<br>        int len = m_val.length();<br>        int len2 = rhs.length();<br><br>        if(len &lt; len2)<br>            m_val = string(len2 - len, ‘0’) + m_val;<br>        else if(len &gt; len2)<br>            rhs = string(len - len2, ‘0’) + rhs;<br><br>        len = m_val.length();<br>        for(int i = len - 1; i &gt;= 0; i–) {<br>            int a = m_val[i] - ‘0’;<br>            int b = rhs[i] - ‘0’;<br>            int sum = a + b + carry;<br>            result = (char)(sum % 10 + ‘0’) + result;<br>            carry = sum &gt;= 10 ? 1 : 0;<br>        }<br>        if(carry)<br>            result = ‘1’ + result;<br>        m_val = result;<br>        return </em>this;<br>    }<br>    const BigInt operator +(int v) const<br>    {<br>        return <em>this + BigInt(v);<br>    }<br>    const BigInt operator +(const BigInt&amp; rhs) const<br>    {<br>        BigInt tmp(</em>this);<br>        return tmp += (rhs);<br>    }<br>    operator const string() const<br>    {<br>        return m_val;<br>    }<br>private:<br>    string m_val;<br>};<br><br>typedef BigInt BIGINT;<br><br>const BigInt operator +(int v1, const BigInt&amp; v2)<br>{<br>    return v2 + v1;<br>}<br>basic_ostream&lt;char&gt;&amp; operator &lt;&lt;(basic_ostream&lt;char&gt;&amp; out, const BIGINT&amp; v)<br>{<br>    return out &lt;&lt; (string)v;<br>}<br><br><br>//typedef RossiBigInt BIGINT;<br>BIGINT dp[2][sizeof(trans) / sizeof(trans[0])];<br><br>/<em><br>void input()<br>{<br>    cin &gt;&gt; N &gt;&gt; M &gt;&gt; P;<br>    L = min(M, 10);<br>    cin &gt;&gt; Alphabet;<br><br>    map&lt;char, char&gt; m;<br>    for(int i = 0; i &lt; Alphabet.length(); i++)<br>        m[Alphabet[i]] = (char)(A + i);<br><br>    string s;<br>    int t = P;<br>    while(t–) {<br>        cin &gt;&gt; s;<br>        for(int i = 0; i &lt; s.length(); i++)<br>            s[i] = m[s[i]];<br>        forbidden.push_back(s);<br>    }<br>}<br></em>/<br><br>void input()<br>{<br>    char buf[51];<br>    scanf(&quot;%d%d%d&quot;,&amp;N,&amp;M,&amp;P);<br>    scanf(&quot;%s&quot;,buf);<br>    //Alphabet = buf;<br>    Alphabet.clear();<br><br>    map&lt;char, char&gt; m;<br>    for(int i = 0; i &lt; strlen(buf); i++) {<br>        //m[Alphabet[i]] = (char)(A + i);<br>        m[buf[i]] = (char)(A + i);<br>    }<br><br>    string s;<br>    int t = P;<br>    while(t–) {<br>        scanf(&quot;%s&quot;,buf);<br>        //s = buf;<br>        s.clear();<br>        for(int i = 0; i &lt; strlen(buf); i++)<br>            //s[i] = m[s[i]];<br>            s += m[buf[i]];<br>        forbidden.push_back(s);<br>    }<br>}<br><br>void bfs(TrieNode <em>parent)<br>{<br>    if(!parent)<br>        return;<br>    deque&lt;TrieNode</em>&gt; queue;<br>    queue.push_front(parent);<br>    while(!queue.empty()) {<br>        parent = queue.back();<br>        queue.pop_back();<br>        for(int i = 0; i &lt; sizeof(parent-&gt;child) / sizeof(parent-&gt;child[0]); i++) {<br>            TrieNode <em>child = parent-&gt;child[i];<br>            if(!child)<br>                continue;<br>            TrieNode </em>parent_fault = parent-&gt;fault;<br>            while(parent_fault) {<br>                if(parent_fault-&gt;child[i])<br>                    break;<br>                parent_fault = parent_fault-&gt;fault;<br>            }<br>            child-&gt;fault = parent_fault ? parent_fault-&gt;child[i] : root;<br>            queue.push_front(child);<br>        }<br>    }<br>}<br><br>void set_color(TrieNode <em>parent)<br>{<br>    if(!parent)<br>        return;<br>    int i, j;<br>    for(i = 0; i &lt; P; i++) {<br>        TrieNode </em>cur = parent;<br>        for(j = 0; j &lt; forbidden[i].length(); j++) {<br>            int ch = forbidden[i][j] - A;<br>            if(!cur-&gt;child[ch])<br>                break;<br>            cur = cur-&gt;child[ch];<br>        }<br>        if(j == forbidden[i].length())<br>            cur-&gt;color = 1;<br>    }<br>    for(i = 0; i &lt; sizeof(parent-&gt;child) / sizeof(parent-&gt;child[0]); i++) {<br>        TrieNode <em>child = parent-&gt;child[i];<br>        if(child)<br>            set_color(child);<br>    }<br>}<br><br>void calc_trans()<br>{<br>    root = &amp;trans[0];<br>    int i, j;<br>    for(i = 0; i &lt; P; i++) {<br>        TrieNode </em>cur = root;<br>        int ch;<br>        for(j = 0; j &lt; forbidden[i].length(); j++) {<br>            ch = forbidden[i][j] - A;<br>            if(!cur-&gt;child[ch]) {<br>                cur-&gt;child[ch] = &amp;trans[gState++];<br>                cur-&gt;child[ch]-&gt;parent = cur;<br>                assert(gState &lt;= 101);<br>            }<br>            cur = cur-&gt;child[ch];<br>            //if(1 == cur-&gt;color)<br>            //    break;<br>        }<br>        cur-&gt;color = 1;<br>    }<br>//    root-&gt;fault = root;<br>    bfs(root); // calculate fault ptr<br>    set_color(root);<br>}<br><br>void solve()<br>{<br>    int flag = 0;<br>    calc_trans();<br>    int state = 0;<br>    dp[0][0] = BIGINT(1);<br>    for(int i = 0; i &lt; M; i++) {<br>        for(int j = 0; j &lt; gState; j++) {<br>            for(int k = 0; k &lt; N; k++) {<br>                int next_state;<br>                if(trans[j].child[k])<br>                    next_state = trans[j].child[k] - root;<br>                else {<br>                    next_state = j;<br>                    while(trans[next_state].fault) {<br>                        next_state = trans[next_state].fault - root;<br>                        if(trans[next_state].child[k]) {<br>                            next_state = trans[next_state].child[k] - root;<br>                            break;<br>                        }<br>                    }<br>                }<br>                if(1 != trans[next_state].color)<br>                    //dp[i + 1][next_state] += dp[i][j];<br>                    dp[1 - flag][next_state] += dp[flag][j];<br>            }<br>        }<br>        for(int t = 0; t &lt; gState; t++)<br>            dp[flag][t] = (BIGINT)0;<br>        flag = 1 - flag;<br>    }<br>    BIGINT sum = (BIGINT)0;<br>    for(int t = 0; t &lt; gState; t++)<br>        sum += dp[flag][t];<br>    cout &lt;&lt; sum &lt;&lt; endl;<br>}<br><br>int main()<br>{<br>    input();<br>    solve();<br>    return 0;<br>}</p><br>和AC过的代码运行的数据对比过，代码答案应当是正确的，但是提交时超过了Time Limit，还有很大改进空间。<br><br>my sample test data：<br>Input:<br>3 3 2<br>ABC<br>BC<br>CA<br>Output:<br>16<br><br>Input:<br>2 5 2<br>AB<br>AB<br>ABA<br>Output:<br>6<br><br>Input:<br>2 3 2<br>AB<br>AB<br>ABA<br>Output:<br>4<br><br>Input:<br>2 3 1<br>AB<br>AB<br>Output:<br>4<br><br>Input:<br>3 4 2<br>ABC<br>CACA<br>CB<br>Output:<br>54<br><br>Input:<br>3 5 2<br>ABC<br>BABCA<br>AB<br>Output:<br>144<br><br>Input:<br>4 31 9<br>ABCD<br>AAAD<br>BDDBB<br>CDCAC<br>BDA<br>AA<br>DBBDBBB<br>CACDBDBDA<br>DBBCDDDB<br>B<br>Output:<br>30176034781985<br><br>Input:<br>6 37 7<br>ABCDEF<br>BC<br>DAFBEA<br>AFEEAE<br>FF<br>CDACEEE<br>EBEBCDE<br>AE<br>Output:<br>2386649102384848081060089069<br><br>Input:<br>4 13 9<br>ABCD<br>AD<br>ACBCDCDDA<br>DBD<br>CB<br>BBDDBADCDC<br>BDCCDACC<br>DDDDAC<br>BCCCBA<br>ACBCCDDABC<br>Output:<br>8189198<br><br>Input:<br>4 12 3<br>ABCD<br>BBDDBADCDC<br>BDCCDACC<br>DDDDAC<br>Output:<br>16747217<br><br>Input:<br>4 5 6<br>ABCD<br>AA<br>BCB<br>DBA<br>BDDAD<br>CCBD<br>ADBCC<br>Output:<br>725<br><br>Input:<br>4 5 3<br>ABCD<br>CDBAD<br>DBC<br>AC<br>Output:<br>733<br><br><br><br>2 5 4<br>AB<br>ABBBB<br>BBA<br>AABAA<br>AA<br>ref: 5<br><br>3 5 3<br>ABC<br>ACBBB<br>CBAB<br>BC<br>ref: 139<br><br>2 3 2<br>AB<br>BB<br>BB<br>ref: 5<br><br>2 5 3<br>AB<br>AA<br>BBBA<br>ABBAB<br>ref: 9<br><br>2 5 6<br>AB<br>ABABA<br>BAAB<br>ABB<br>AAB<br>BBBAB<br>ABBBB<br>ref: 10<br><br>2 5 5<br>AB<br>BBA<br>BABAB<br>BBAAA<br>ABBBB<br>BBAAA<br>ref: 18<br><br>2 6 2<br>AB<br>BBA<br>ABBBBA<br>ref: 33<br><br>2 11 2<br>AB<br>BBA<br>ABBBB<br>ref: 323<br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/09/15/【★】Censored-（Forbidden-Words）/" class="archive-article-date">
  	<time datetime="2009-09-15T03:34:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-09-15</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-AC自动机算法详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/09/13/AC自动机算法详解/">AC自动机算法详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AC自动机是用来处理多串匹配问题的，即给你很多串，再给你一篇文章，让你在文章中找这些串是否出现过，在哪出现。对于两个字符串匹配问题可用<a href="http://blog.pickbox.me/2009/09/09/kmp%E7%AE%97%E6%B3%95%EF%BC%88%E5%AD%90%E4%B8%B2%E5%8C%85%E5%90%AB%E9%97%AE%E9%A2%98%EF%BC%89/" target="_blank">KMP</a>算法，多字符串则用AC自动机。</p>
<p>看下面这个例子：给定5个单词：say she shr he her，然后给定一个字符串yasherhs。问一共有多少单词在这个字符串中出现过。</p>
<p>构造Trie树<br>首先构造一棵树，如下所示，我们称之为Trie树。<br><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/2aba2a34ba2cd3105ab5f510.jpg"><br>构造失败指针<br>然后构造失败指针，应当使用BFS算法。失败指针满足下面的性质：<br>假设有一个节点k，他的失败指针指向j。那么k,j满足：设root到j的距离为n，则从k之上的第n个节点到k所组成的长度为n的单词，与从root到j所组成的单词相同。<br>即图中红框部分是完全一样的，she中的’e’的失败指针就应该指向her中的’e’。<br><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/8856a5ef09a54d3dfcfa3c1f.jpg"><br>构造好失败指针如图所示：（为方便递归判断，root的失败指针可指向NULL）<br><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/9c49f0d336e7c1f4a8ec9aec.jpg"></p>
<p>标记终止节点<br>应当对每个节点都遍历一次所有单词，如果读完某个单词依然可以停留在某个子节点上，则应该将该子节点标记为终止节点。<br>例如，除了say she shr he her 这5个单词，如果再加入一个单词h，终止节点还应多两个：<br><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/47a89950f0210549843524c4.jpg"></p>
<p>匹配过程</p>
<p>一开始，Trie中有指针t1指向root，指针t2指向待匹配串(也就是“文章”)的串头。</p>
<p>接下来的操作和KMP很相似：如果t2指向的字母存在于Trie树中，则t1指向该节点，t2 = t2+1；否则t1顺这当前节点的失败指针向上找，直到t2是t1的一个儿子，或者t1指向NULL（t1指向树根后，t2仍然不是t1的儿子）。</p>
<p>匹配过程中，如果t1路过了一个绿色的节点，那么以这个点结尾的单词就算出现过了。或者如果t1所在的点可以顺着失败指针走到一个绿色点，那么以那个绿点结尾的单词就算出现过了。</p>
<p>Reference<br><a href="http://hi.baidu.com/lightxianjian/blog/item/d0f0b8de8041125095ee3710.html" target="_blank">http://hi.baidu.com/lightxianjian/blog/item/d0f0b8de8041125095ee3710.html</a><br><a href="http://www.cppblog.com/mythit/archive/2009/04/21/80633.html" target="_blank">http://www.cppblog.com/mythit/archive/2009/04/21/80633.html</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/09/13/AC自动机算法详解/" class="archive-article-date">
  	<time datetime="2009-09-13T13:16:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-09-13</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/24/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/26/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>