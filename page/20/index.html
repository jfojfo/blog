<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/20/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-如何调试跟踪Android源代码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/26/如何调试跟踪Android源代码/">如何调试跟踪Android源代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="http://www.cnblogs.com/jacktu/archive/2009/08/31/1557742.html" target="_blank">http://www.cnblogs.com/jacktu/archive/2009/08/31/1557742.html</a><br><strong><a href="http://www.top-e.org/jiaoshi/class/?70.html" target="_blank" rel="external"><br>Android</a></strong><strong><a href="http://www.top-e.org/jiaoshi/class/?70.html" target="_blank" rel="external">平台</a></strong>代码很多，关系也很复杂，通常我们调试程序的时候是无法跟踪到Android framework code里的，如果能调试跟踪Android source code将给我们这些初学者带来很多便利，本文将给出一个调试跟踪Android source code 的方法。</p><p>1.&#160;&#160;&#160; 首先，得到Android 源代码（可参考之前的文章–如何获取Android源代码并编译.doc），并且编译，得到output&#160;file，在(Android source)/out目录下，也可通过别的途径获取Android source code (以<strong><em>androidsrc.tgz</em></strong><strong><em>为例</em></strong>) 和别人编译好的 output file(<strong><em>out.tgz</em></strong>) </p><p>&#160;</p><p>2.&#160;&#160;&#160; 解压缩这两个 tgz 文件，并把解压出来的<strong><em>out</em></strong> 目录放到 <strong><em>myandroid</em></strong> 目录下，如下图所示。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/af9fdbf91edaf01d242df2a2.jpg">&#160;</p><p>3.&#160;&#160;&#160; 拷贝 <strong><em>myandroid&quot;development&quot;ide&quot;eclipse&quot;.classpath</em></strong> 到 <strong><em>myandroid&quot;.classpath</em></strong>.</p><p>&#160;</p><p>4.&#160;&#160;&#160; 拷贝 <strong><em>myandroid&quot;out&quot;target&quot;product&quot;generic&quot;*.img</em></strong> 到 <strong><em>{Android SDK}&quot;tools&quot;lib&quot;images</em></strong> 并且覆盖源文件.</p><p>&#160;</p><p>5.&#160;&#160;&#160; 运行<strong><em>{Android SDK}&quot;tools</em></strong><strong><em>目录下的</em></strong><strong><em> emulator.exe</em></strong>.</p><p>&#160;</p><p>6.&#160;&#160;&#160; 运行<strong><em>{Android SDK}&quot;tools</em></strong><strong><em>目录下的</em></strong><strong><em> ddms.bat</em></strong>。你可以看到下面的窗口，里面会列出当前emulator里跑的进程:</p><p>&#160;</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/29ba6259eedd446e2934f0a2.jpg">&#160;</p><p>7.&#160;&#160;&#160; 启动 eclipse ，按照这个步骤 <strong><em>File-&gt;New-&gt;Java Project</em></strong> (不是 Android Project!) <strong><em>-&gt;Create project from existing source</em></strong> 选到 <strong><em>myandroid</em></strong><strong><em> </em></strong><strong><em>目录</em></strong> .</p><p>&#160;</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/dbbdd62ae5c4a4df023bf6a2.jpg">&#160;</p><p>8.&#160;&#160;&#160; 在经过长时间等待之后，Android source code将被导入project，正常情况下应该没有error，但是会有很多warning，如果有error后面的debug将不会成功，原因可能是output file ，out.tgz在解压得过程中出错，重新copy out.tgz，或者完整拷贝 out/ 目录到本地目录下，即可解决。</p><p>&#160;</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/fdab59b5181a858a37d3caa2.jpg"></p><p>9.&#160;&#160;&#160; 选择想要调试的进程在 DDMS, 用 <strong><em>phone</em></strong> 进程为例，ddms一定要在eclipse之前启动，否则eclipse启动的时候也会启一个ddms，会造成冲突。</p><p>&#160;</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/377a17cee523457db700c8a2.jpg">&#160;</p><p>10. 在eclipse里, <strong><em>Run-&gt;Debug Configuration-&gt;Remote Java Application-&gt;New</em></strong>, 设置 Connection port to 8700 (DDMS’s 默认端口，你可以改变它).</p><p>&#160;</p><p>&#160;<img src="http://img.pickbox.me/wp-content/uploads/pic/c843d73963f0aab73b87cea2.jpg"></p><p>11. 设置断点在source code，然后就可以像往常一样进行调试了。</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/489038f3ed777914342acca2.jpg"></p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/26/如何调试跟踪Android源代码/" class="archive-article-date">
  	<time datetime="2010-08-26T08:12:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android窗口管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/26/Android窗口管理/">Android窗口管理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br></p><p> </p><p>在Activity在performLaunchActivity时，会使用Activity.attach（）建立一个PhoneWindow主窗口。</p><p>这个主窗口的建立并不是一个重点。handleResumeActivity真正要启动一个Activity时候，</p><p>将主窗口decorView加入到WindowManager<br>onCreate()@UserActivity.java &gt;<br>setContentView()@Activity.java &gt;<br>mWindow.setContentView() &gt;<br>setContentView()@PhoneWindow.java &gt;<br>installDecor():<br>    generateDecor() –&gt; DecorView:ViewGroup<br>    generateLayout() –&gt; screen_simple.xml:id:content (FrameLayout)<br>        decor.addView( screen_simple.xml )<br><br>handleLaunchActivity()@ActivityThread.java &gt;<br>handleResumeActivity()@ActivityThread.java &gt; …<br>addView(decor)@WindowManagerImpl.java &gt;<br>    root = new ViewRoot();<br>        getWindowSession() –&gt; sWindowSession –&gt; IWindowSession<br>        mWindow = new W() –&gt; IWindow<br>    root.setView(decor)<br>        sWindowSession.add(mWindow…) 将mWindow.asBinder()作为参数调用服务端<br>        decor.assignParent(root);<br><br>{ IWindow: Window Manager —IWindow–&gt; Client<br>API back to a client window that the Window Manager uses to inform it of interesting things happening. }<br>{ IWindowSession: Client —IWindowSession–&gt; Window Manager }</p><p> </p><p> </p><br><a href="http://www.cnblogs.com/jacktu/archive/2010/06/17/1759668.html" target="_blank" rel="external">Android 核心分析(13) —–Android GWES之Android窗口管理</a>Android  GWES之Android窗口管理 1基本构架原理 &#160;&#160;&#160;&#160;&#160;  Android的窗口管理是C/S模式的。Android中的Window是表示Top  Level等顶级窗口的概念。DecorView是Window的Top-Level  View，这个View我称之为主View，DecorView会缺省的attach到Activity的主窗口中。主View被加入到 WindowManager中，WM使用WindowState与这个主View对应。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/af4a83cb6c5a39b953664f32.jpg"><br><br>Activity建立一个主窗口后，在将主窗口添加到WindowManager时，首先要建立WindowManager代理对象，并打开一个会话（实 现IWindowSession  AIDL接口），并维持该会话。Activity将通过该会话与WindowManager建立联系，这个Session是C/S体系的基 础，Client通过WindowSession将window加入到Window Manager中。<br>一个完整的窗口概念横跨了View，ViewRoot，WindowManager Service。Window，DecorView，View，IWindow ,ISession，WindowState之间的关系如下<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/c74bb4fd05e75f5208244d32.jpg"><br><br>Client端的Activity通过Session会话与WindowManager建立对话，而WindowManager则通过IWindow接口访问Client，将消息传递到Client端，通过消息分发渠道，将消息传递到处理函数OnXXX。<br>后面我们将通过Client，WM Service分别加以分析。<br>2  Client端 &#160;&#160;&#160;&#160;  我一致认为在Android中Window的概念并不是个很重要的概念。他的Window类，只是在PhoneWindow和MidWindow中使用。 而PhoneWindow只是做了一个具体跟手机功能相关的公用事件的处理，所以在Android中PhoneWindow并不是一个抽象的纯正概念，而 是一个跟手机系统相关的一个特别窗口概念，例如按键的默认动作处理，按键音的发出等等。<br>2.1 View 在Activity中真正重要的概念是View，以下是Google官方对View的定义：<br>This  class represents the basic building block for user interface  components. A View&#160; occupies a rectangular area on the screen and is  responsible for drawing and event handling. View is the base class for&#160;<em>widgets</em>,  which are&#160; used to create interactive UI components (buttons, text  fields, etc.). The {@link android.view.ViewGroup} subclass is the base  class&#160; for&#160;<em>layouts</em>, which&#160; are invisible containers that hold other Views (or other ViewGroups) and define their layout properties.<br>我对View不做翻译，翻译成视图好像不太佳，View在Android中，View比视图具有广的外延。View包含了用户交互，包含了显示，视图在中 文中仅仅表示了静态的显示。对于View的理解应该从最容易的理解开始。我们使用过编辑器，在Android中这个编辑器就是一个View，这个编辑器需 要显示文字，需要接收用户的键盘输入和鼠标选择，但是一个屏幕上有多个编辑器，如何管理，如何切换焦点编辑器，这些都是需要管理的。<br>客户端的组成：（Window，View，ViewRoot，WindowManager Proxy）<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/acf6d21650a5245c962b4332.jpg"><br><br>在Activity在performLaunchActivity时，会使用Activity.attach（）建立一个PhoneWindow主窗口。 这个主窗口的建立并不是一个重点。handleResumeActivity真正要启动一个Activity时候，将主窗口加入到 WindowManager，当然并不是将主窗口本身，而是将主窗口的DecorView加入到WindowManager中。<br>真正Window核心的抽象概念存在于View，ViewRoot，WindowManger中的WindowState。为了描述概念的方便性，我特别 提出主View这个概念，这个主View就是Top-Level View of the window.  主View与View想对，突出主View是attatch到主窗口上的。而一般的View则是存在于主View中的。主窗口这个概念，我讲的主窗口实际 上就是Android提到的Top Level Window。<br>我们所提到的概念：View，GroupView，DecorView，ViewRoot都是存在于Client端，只有WindowState这个概念存在于Window Manager Service端。<br>DecorView实际上是一个ViewGroup。在依存关系上来讲，对看个主窗口来讲，DecorView是Top-Level  View.View并不是关注的重点，重要的是我们如何需要知道分发路径是建立在什么关系上的。View的成员变量mParent用来管理View上级关 系的。而ViewGroup顾名思义就是一组View的管理，于是在ViewGroup构建了焦点管理和子View节点数组。这样通过View的 mParent和ViewGroup的mChildren构建了Android中View直接的关系网。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/f7b4a918ccaa5b4334fa4132.jpg"><br><br>2.2  Focus Path &#160;&#160;&#160;&#160; 所谓的Foucs  Path就是我们的KeyEvent传递的路线。一般的我们的KeyEvent在主循环中主View通过View的焦点记录关系传递到焦点View上。例 如下图，View22是焦点，我们从最顶层的View通过mFcous的关系链找到最后所形成的路径就是Focus Path。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/69bbd607687b69897a894732.jpg"><br><br>2.3  ViewRoot，Window Manager Proxy ViewRoot与Window  Manager的核心是IWindowSession和IWindow。ViewRoot通过IWindowSession添加窗口到Window  Manager。而IWindow这是Window Manager分发消息给Client ViewRoot的渠道。利用AIDL接口进行进程间通信。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/cb6ae4cd240811150eb34532.jpg"><br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/85199c516e32806043a75b32.jpg"><br><br>ViewRoot实际是一个Handler，ViewRoot建立主View与WindowsManger通讯的桥梁。ViewRoot在本质上一个Handler。我们知道Handler的基本功能就是处理回调，发送消息。<br>Activity在使用getSystemService获取WindowManagerImpl ，建立了一个WindowManagerImpl实例，即Window Manager服务的代理：<br>wm=(WindowManagerImpl)context.getSystemService(Context.WINDOW_SERVICE);并调用wm.addview添加窗口到WMService中。<br>这 个过程在客户端建立了什么样的管理框架，并如何这个会话？在Window Manager Proxy中建立了View，Layout  ,ViewRoot三者的对应关系表。构造一个ViewRoot就会打开一个session,并利用IWindowSession建立会话上下文。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/f1230d2421265677c9955932.jpg"><br><br>4 Window Manager Service 本次对于Window Manager Service的研究仅限于FocusWindow,消息系统。其他的部分将在后面的专门章节讨论。&#160;&#160;&#160;<br>Window   Manager管理的窗口是应用程序的Top-level窗口，我这里参照Window的概念叫主窗口。主窗口为什么要放在在Service这边来管理 呢？为什么不放在Client那边？主窗口放置在一起管理是为了计算Z-order序列，根据应用程序的状态来显隐应用程序的窗口。我想Android设 计者在考虑设计窗口系统的时候，一定首先考虑：<br>窗口z-order序的管理<br>活动窗口的计算，及其变化通知<br>窗口归属（属于哪个应用）<br>输入法管理<br><br>Window Service大体上实现了如下的功能：，<br>（1）Z-ordered的维护函数<br>（2）输入法管理<br>（3）AddWindow/RemoveWindow<br>（4）Layerout<br>（5）Token管理，AppToken<br>（6）活动窗口管理（FocusWindow）<br>（7）活动应用管理（FocusAPP）<br>（8）转场动画<br>（9）系统消息收集线程<br>（11）系统消息分发线程<br>在服务端的窗口对象叫做WindowState。在Service维护了一个mWindow数组，这个mWindow就是Window的Z-order序数组。mWindowMap用于记录。<br>WindowState有一个叫做mClient成员变量来记录客户端IWindow实例，通过IWindow接口实例，Service可以访问客户端的信息，说以IWindow是Service连接View桥梁。<br>（1） FocusWindow活动窗口如何计算?<br>基本原理就是查找前景应用（FousActivity），并同Z-Order序中找出属于该FousActivity（AppToken）的主窗口，这个窗口就是计算出来的Focus Window。<br>（2）为什么要提出Token这个概念呢？<br>一个应用程序要管理自己的窗口，那么如何来标识该窗口是属于某个Activity，Andoid设计者提出了AppToken这个概念。AppToken在本质上的描述：通过Token找到属于该Token的allWindows。使用Token开始完成该应用程序的所有窗口的显示和隐藏。<br>（3）系统消息收集与处理<br>我们下面重点研究Ｓｅｒｖｉｃｅ中的系统消息收集模式及其分发模式。Ｓｅｒｖｉｃｅ使用ＫｅｙＱ作为专门的消息队列。<br>ＫeyEvent<br>TouchEvent<br>TrackballEvent<br><br>系统有两个线程：<br>KeyQ线程，通过Navite函数readEvent轮询设备,将读取的结果放置在KeyQ队列中。<br>系统dispatcher 等待在KeyQ消息队列上，一旦从消息队列中获取到消息，就通过分发函数通过mClient传递到Client端。 <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/26/Android窗口管理/" class="archive-article-date">
  	<time datetime="2010-08-26T07:23:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-Framework-分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/23/Android-Framework-分析/">Android Framework 分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="http://raymond1860.spaces.live.com/Blog/cns!BF47B6FD104579C9!797.entry" target="_blank">http://raymond1860.spaces.live.com/Blog/cns!BF47B6FD104579C9!797.entry</a><br></p><p>1.目录树<br></p><p>/framework/base/api&#160;<br></p><p>/framework/base/awt<br></p><p>/framework/base/build<br></p><p>/framework/base/camera </p><p>关 于camera的HAL接口库。最终生成native共享库libcamera.so  ,编译时根据是否定义USE_CAMERA_STUB来决定系统是否有Camera硬件支持。若没有实际的Camera硬件，则编译时会和虚拟 camera静态库（libcamerastub.a,由camerahardwarestub.cpp,fakecamera生成）链接生成 libcamera.so。<br></p><p>/framework/base/cmds 关于android系统启动时用到的command等<br></p><p>/framework/base/cmds/am<br></p><p>/framework/base/cmds/app_process&#160;<br></p><p>可 执行文件app_process，该文件可以根据输入参数决定是Zygote启动（参考init.rc中的语句 service zygote  /system/bin/app_process -Xzygote /system/bin –zygote  –start-system-server）.<br></p><p>该执行程式会链接libandroid_runtime.so去链接android runtime。后面我会在详细分析此部分。<br></p><p>/framework/base/cmds/backup&#160;<br></p><p>可执行程式btool<br></p><p>/framework/base/cmds/bmgr<br></p><p>java可执行程式， backup manager, java库形式分发到目标系统/system/framework/bmgr.jar<br></p><p>/framework/base/cmds/bootanimation<br></p><p>android启动动画效果程式，该程式必须在android runtime启动后运行。<br></p><p>/framework/base/cmds/dumpstate<br></p><p>android系统调试辅助工具,生成可执行程式dumpstate,同时建立两个程式dumpcrash bugreport指向该程式。<br></p><p>/framework/base/cmds/dumpsys<br></p><p>生成可执行程式dumpsys<br></p><p>/framework/base/cmds/ime<br></p><p>java可执行程式 ，IME输入法 input method manager, java库形式分发到目标系统/system/framework/ime.jar<br></p><p>/framework/base/cmds/input<br></p><p>java可执行程式，管理input事件例如key event,text event 等，java库形式分发到目标系统/system/framework/input.jar<br></p><p>/framework/base/cmds/installd<br></p><p>可执行程式installd,install manager,仅在非simulator系统中运行，安装到目标系统/system/bin/installd<br></p><p>/framework/base/cmds/keystore<br></p><p>可执行程式keystore,用途？？？仅在非simulator系统中运行，安装到目标系统/system/bin/keystore<br></p><p>/framework/base/cmds/pm<br></p><p>java可执行程式，package manager，java库形式分发到目标系统/system/framework/pm.jar<br></p><p>/framework/base/cmds/runtime<br></p><p>runtime可执行程式，仅在simulator中使用<br></p><p>/framework/base/cmds/service<br></p><p>service可执行程式，用来查找，检查，呼叫service，安装到目标系统/system/bin/service<br></p><p>/framework/base/cmds/servicemanager<br></p><p>android系统的service manager，可执行文件，安装到目标系统/system/bin/servicemanager<br></p><p>servicemanager会和kernel的binder driver协作共同完成service的添加、查询、获取、检查等。<br></p><p>/framework/base/cmds/surfaceflinger<br></p><p>surfaceflinger可执行程式，安装到目标系统/system/bin/surfaceflinger,<br></p><p>该程式会初始化surfaceflinger,surfaceflinger::inistantiate(),该程式会链接到libsurfaceflinger.so<br></p><p>/framework/base/cmds/svc<br></p><p><br></p><p>/framework/base/cmds/system_server<br></p><p>system server库libsystem_server.so-&gt;system/lib/libsystem_server.so和system_server可执行程式-&gt;system/bin/system_server.<br></p><p>该可执行程式不清楚什么用途????<br></p><p>/framework/core/<br></p><p>/framework/core/config<br></p><p>几个简单java常量，（debug标志等）<br></p><p>/framework/core/java/<em><br></em></p><p>framewor</p><p>k的核心，此处主要指application framework,java库形式分发到/system/framework/<br></p><p>包括framework.jar,framework-tests.jar sure？？？<br></p><p>/framework/core/jni<br></p><p>framework所需的JNI接口实现库,分发到/system/lib/lib/libandroid_runtime.so<br></p><p>/framework/core/res<br></p><p>framework所需的资源文件打包，/system/framework/framework-res.apk,<br></p><p>/framework/libs<br></p><p>/framework/libs/audioflinger,</p><p>生成libaudioflinger.so,</p><p>若无实际硬件和静态库libaudiointerface.a（audio interface虚拟设备）链接。<br></p><p>若有实际硬件和libaudio.so链接，若支持bluetooth，则和liba2dp.so链接<br></p><p>/framework/libs/surfaceflinger<br></p><p>生成libsurfaceflinger.so<br></p><p>/framework/libs/ui<br></p><p>生成libui.so<br></p><p>/framework/libs/utils<br></p><p>生成libutils.so<br></p><p>/framework/services/java/<br></p><p>system server java可执行程式service.jar,分发到/system/framework/service.jar<br></p><p>/framework/services/jni/<em><br></em></p><p>system server JNI接口实现库,libanroid_servers.so，分发到/system/lib/libanroid_servers.so<br></p><p> </p><p></p><p>启动 Zygote<br></p><p>-Xzygote /system/bin –zygote –start-system-server<br></p><p>AndroidRuntime-&gt;AppRuntime<br></p><p>int main(int argc,const char const argv[])<br></p><p>{<br></p><p>&#160; AppRuntime runtime;生成AndroidRuntime实例<br></p><p>&#160; …<br></p><p>&#160; AndroidRuntime.Start(&quot;com.android.internal.os.ZygoteInit&quot;,startSystemServer);<br></p><p>}<br></p><p>其中AndroidRuntime.Start(&quot;com.android.internal.os.ZygoteInit&quot;,startSystemServer);<br></p><p>呼叫Android::Start(const char* className,const bool startSystemServer)<br></p><p>/framework/base/core/jni/AndroidRuntime.cpp<br></p><p>该函数的处理内容：</p><p>1.处理Jave Virtual Machine的一些参数选项；<br></p><p>2.创建Dalvik Java虚拟机，JNI_CreateJavaVM(&amp;mJavaVM,&amp;env,&amp;initArgs)；<br></p><p>3.注册Android Runtime中的JNI接口给虚拟机；<br></p><p>4.呼叫Java类com.android.internal.os.ZygoteInit的main函数<br></p><p><br></p><p>在类com.android.internal.os.ZygoteInit的main函数中，<br></p><p>1.注册Zygote socket用来接收请求;<br></p><p>2.加载preloaded class、resources用来加快启动速度，文件清单在framework.jar中的preloaded-classes,framework-res.apk中的res中;<br></p><p>3.启动System Server;<br></p><p>&#160; fork出独立的进程名称为system-server，呼叫com.android.server.SystemServer类的main函数；<br></p><p>&#160; 在HandleSystemServerProcess函数中，RuntimeInit.ZygoteInit调用会呼叫AppRuntime的OnZygoteInit函数<br></p><p>4.RuntimeInit.ZygoteInit函数会呼叫com.android.server.SystemServer类的main函数。<br></p><p>&#160; 在此main函数中，系统首先加载android_server共享库libandroid_server.so 源代码位于/framework/base/service/jni<br></p><p>&#160; 在该库中有定义JNI_OnLoad函数，所以Dalvik在加载libandroid_server.so 的时候会首先呼叫该JNI_OnLoad函数，该函数将android  server注册到Java虚拟机中，包括 KeyInputQueue,HardwareService,AlarmManager,BatteryService,SensorService,SystemServer 等；<br></p><p>&#160; 呼叫在libanroid_server.so中注册的native函数init1，该函数位于/frameworks/base/services/jni/com_android_server_SystemServer.cpp中；<br></p><p>&#160;   init1函数呼叫libsystem_server中的system_init函数，该函数位于/frameworks/base/cmds /system_server/library/system_init.cpp中，该函数将SurfaceFlinger/AudioFlinger /MediaPlayer/CameraService等组件注册到ServiceManager中<br></p><p>&#160; system_init函数反过来呼叫java类com.android.server.SystemServer的init2函数；<br></p><p>5.在init2函数中，android创建了serverthread，在该thread中android开始注册各种service到service manager中<br></p><p>包括EntropyService,PowerManager,ActivityManager,Telephony,PackageManager,ContentManager,ContentProvider,</p><p>BatteryService,HardwareService,AlarmManager等等。<br></p><p>&#160; 注意该线程使用Looper来执行thread<br></p><p>至此android system server启动完成。<br></p><p><br></p><p><a rel="external" href="https://lpjk6g.blu.livefilestore.com/y1mwdwkcvIV41R3M6XBFVubDfpRaRr7mow2aCjnUHIOypRLxRW5syV1bGC_mrTbWx0y0qNraG2kXQjn8F6t1qtMEbVOprsbVnd8Ukj4OsUjWhZmfKGGC1ZZ-SPURmp2kWQHNW3R15L1LrnW-iXNKjrX3w/android%20boot%20sequence%5B3%5D.jpg" target="_blank"><img src="http://img.pickbox.me/wp-content/uploads/pic/c782b11b915b0b5a8618bfbb.jpg" small="0" class="blogimg"><br></a> <br></p><p><br></p><p><br></p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/23/Android-Framework-分析/" class="archive-article-date">
  	<time datetime="2010-08-23T06:54:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-23</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Activity启动流程-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/21/Activity启动流程-1/">Activity启动流程(1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>Instrumentation.callActivityOnCreate(Activity, Bundle) line: 1047&#160;&#160;&#160; <br>ActivityThread.performLaunchActivity(ActivityThread$ActivityRecord, Intent) line: 2459&#160;&#160;&#160; <br>ActivityThread.handleLaunchActivity(ActivityThread$ActivityRecord, Intent) line: 2512&#160;&#160;&#160; <br>ActivityThread.access$2200(ActivityThread, ActivityThread$ActivityRecord, Intent) line: 119&#160;&#160;&#160; <br>ActivityThread$H.handleMessage(Message) line: 1863&#160;&#160;&#160; <br>ActivityThread$H(Handler).dispatchMessage(Message) line: 99&#160;&#160;&#160; <br>Looper.loop() line: 123&#160;&#160;&#160; <br>ActivityThread.main(String[]) line: 4363&#160;&#160;&#160; <br>Method.invokeNative(Object, Object[], Class, Class[], Class, int, boolean) line: not available [native method]&#160;&#160;&#160; <br>Method.invoke(Object, Object…) line: 521&#160;&#160;&#160; <br>ZygoteInit$MethodAndArgsCaller.run() line: 860&#160;&#160;&#160; <br>ZygoteInit.main(String[]) line: 618&#160;&#160;&#160; <br>NativeStart.main(String[]) line: not available [native method]&#160;&#160;&#160; <br><br><br>Dalvik_dalvik_system_Zygote_fork()@dalvik/vm/native/dalvik_system_Zygote.c<br>Dalvik_dalvik_system_Zygote_forkAndSpecialize()@dalvik/vm/native/dalvik_system_Zygote.c<br>Dalvik_dalvik_system_Zygote_forkSystemServer()@dalvik/vm/native/dalvik_system_Zygote.c<br>const DalvikNativeMethod dvm_dalvik_system_Zygote[] = {<br>{ &quot;fork&quot;,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;()I&quot;,<br>Dalvik_dalvik_system_Zygote_fork },<br>{ &quot;forkAndSpecialize&quot;,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;(II[II[[I)I&quot;,<br>Dalvik_dalvik_system_Zygote_forkAndSpecialize },<br>{ &quot;forkSystemServer&quot;,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &quot;(II[II[[I)I&quot;,<br>Dalvik_dalvik_system_Zygote_forkSystemServer },<br>{ NULL, NULL, NULL },<br>};<br><br><br><br><a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx" target="_blank">Android Application</a></p><p>&#160;&#160;&#160; Android提供给开发程序员的概念空间中Application只是一个松散的表征概念，没有多少实质上的表征。在Android实际空间中看不到实 际意义上的应用程序的概念,即使有一个叫Application的类，这个也就是个应用程序上下文状态，是一个极度弱化的概念。Application只 是一个空间范畴的概念，Application就是Activity，Service之类的组件上下文描述。Application并不是Android 的核心概念，而Activity才是Android的核心概念。</p><p>&#160;&#160;&#160; 从Android的SDK文档中，我们知道一般情况Android应用程序是由以下四种组件构造而成的：Activity，Broadcast Intent Receiver，服务（Service），内容提供器（Content Provider）。我们可以使用下面的图来表示一下Android的概念空间。这些组件依附于应用程序中，应用程序并不会一开始就建立起来，而是在这些 组件建立起来后，需要运行时，才开始建立应用程序对象。</p><p><a href="http://hi.csdn.net/attachment/201005/24/0_1274715036pPGc.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/486d5066de7fd060aa184c5a.jpg"><br></a></p>2.1应用进程名称<p>&#160;&#160;&#160; 为什么要从应用进程名称开始？作为内核研究，我们还是回到问题的最本质处：不管Activity，Service等组件如何设计和运行，它要提供服务，就 必须要依附在Linux的进程上，建立消息循环，组件才能够真正的运作。Activity实例是如何Hosting在Linux进程上的？这个是我们首先 想要弄明白的。</p><p>我们在<a href="http://androidappdocs.appspot.com/guide/topics/manifest/manifest-element.html" target="_blank" rel="external"></a>的<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#proc#proc" target="_blank" rel="external">process</a>=&quot;string&quot;这个定义。</p><blockquote><p><a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#clear#clear" target="_blank" rel="external">allowClearUserData</a>=[&quot;true&quot; | &quot;false&quot;]        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#reparent#reparent" target="_blank" rel="external">allowTaskReparenting</a>=[&quot;true&quot; | &quot;false&quot;]        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#agent#agent" target="_blank" rel="external">backupAgent</a>=&quot;string&quot;        <br>…</p><p>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#label#label" target="_blank" rel="external">label</a>=&quot;string resource&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#space#space" target="_blank" rel="external">manageSpaceActivity</a>=&quot;string&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#nm#nm" target="_blank" rel="external">name</a>=&quot;string&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#prmsn#prmsn" target="_blank" rel="external">permission</a>=&quot;string&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#persistent#persistent" target="_blank" rel="external">persistent</a>=[&quot;true&quot; | &quot;false&quot;]        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#proc#proc" target="_blank" rel="external">process</a>=&quot;string&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#restoreany#restoreany" target="_blank" rel="external">restoreAnyVersion</a>=[&quot;true&quot; | &quot;false&quot;]        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#aff#aff" target="_blank" rel="external">taskAffinity</a>=&quot;string&quot;        <br>android:<a href="http://blog.csdn.net/maxleng/archive/2010/05/24/5621345.aspx#theme#theme" target="_blank" rel="external">theme</a>=&quot;resource or theme&quot; &gt;        <br>. . .         <br></p></blockquote><p>在SDK用已经描述的很清楚到了。</p><p>android:process</p><p>The name of a process where all components of the application should run. Each component can override this default by setting its own process attribute.</p><p>By default, Android creates a process for an application when the first of its components needs to run. All components then run in that process. The name of the default process matches the package name set by the <a href="http://androidappdocs.appspot.com/guide/topics/manifest/manifest-element.html" target="_blank" rel="external"></a> element.</p><p>By setting this attribute to a process name that’s shared with another application, you can arrange for components of both applications to run in the same process — but only if the two applications also share a user ID and be signed with the same certificate.</p><p>为什么要提出这么一个定义？android:process名称。</p><p>&#160;&#160;&#160; 默认状态下，Activity Manager Service在应用程序的第一个组件需要运行时将会为应用程序建立一个进程，而这个进程的名字就是android:process=”string”所 指定，缺省的是应用程序包的名字。该进程一旦建立，后面的该应用的组件都将运行在该进程中，他们绑定的根据就是这个Android：Process指定的 名称，因为在他们都在同一个应用程序包里，也就具有了同样的进程名字，于是他们都托管在了同一进程中。组件将通过ClassLoader从Package 中获取到应用程序的信息。</p><p>&#160;&#160;&#160; 在建立Actvitiy时，如果在应用进程端没有应用对象，系统在该过程中利用makeApplication建立一个Application对象，实例 化&quot;android.app.Application&quot;，建立一个应用程序上下文完成例如资源，package等信息管理。</p>2.2&#160; ActivityThread运行框架<p>&#160;&#160;&#160; 在分析中，我们可以看到真正对应应用进程的不是Application而是ActivityThread。我们从实际的应用堆栈可以看到：</p><blockquote><p>NaiveStart.main()</p></blockquote><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; ZygoteInit.main</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ZygoteInit$MethodAndArgsCall.run</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Method.Invoke</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; method.invokeNative</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ActivityThread.main()</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Looper.loop()</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ….</p><p>&#160;&#160;&#160; 每个应用程序都以ActivityThread.main()为入口进入到消息循环处理。对于一个进程来讲，我们需要这个闭合的处理框架。</p><p><a href="http://hi.csdn.net/attachment/201005/24/0_1274715037oaa7.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/2f90b8a13b7cabcf46106427.jpg"><br></a></p><p>&#160;&#160;&#160; ActivitiyThread是应用程序概念空间的重要概念，他建立了应用进程运行的框架，并提供了一个IActivityThread接口作为与 Activity Manager Service的通讯接口.通过该接口AMS可以将Activity的状态变化传递到客户端的Activity对象。</p>2．3 ActivitiyThread的建立<p>为了叙述的方便我将Actvitiy Manager Service简写成AMS。</p><p>&#160;&#160;&#160; 在AMS中关于应用程序的概念是ProcessRecord，请求都是从Activity，Service…等开始的，在Activity需要Resume时，此时如果与Activity相关的应用进程没有起来，AM则启动应用进程。</p><p>AMS与应用进程的绑定分为两个部分，第一部分就是AM建立应用进程，第二部分就是应用进程Attach到AM，与AM建立通讯通道。</p><p>1）创建建立进程：startProcessLocked(processName,Appinfo.uid)。该函数在StartSecificActivityLocked等调用。</p><p>（1） 建立ProcessRecord对象app,并将该对象添加到mProcessNames中。应用对象在mProcessNames中使用应用名字和 uid来标识自己。如果在同一个Package中的Activity,如果都使用默认设置，那么这些Activity都会托管在同一个进程中，这是因为他 们在带的ApplicationInfo中的ProcessName都是一样的。</p><p><a href="http://hi.csdn.net/attachment/201005/24/0_1274715038X0aT.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/2ba9b400b79ce3c3e850cd21.jpg"><br></a>&#160;</p><p><a href="http://hi.csdn.net/attachment/201005/24/0_12747150398uU3.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/61adfadc257063e5cc116622.jpg"><br></a></p><p>mPidsSelfLocked数组记录了PID，这个将会在应用进程跑起来后，将自己Attach到AM时，根据pid找到自己的前世：ProcessRecord.</p><p>2）android.app.ActivityThread进程启动</p><p>&#160;&#160;&#160;&#160; Android.app.ActivityThread进程建立后，将跳入到ActivityThread的main函数开始运行，进入消息循环。<a href="http://hi.csdn.net/attachment/201005/24/0_1274715040RR9z.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/69bbd60726893f897a89472c.jpg"><br></a></p><p>&#160;&#160;&#160; 应用进程使用thread.attach()发起AMS的AttachApplicationLocked调用，并传递 ActvitiyThread对象和CallingPid。AttachApplicationLocked将根据CallingPid在 mPidsSelfLocked找到对应的ProcessRecord实例app,将ActvitiyThread放置app.thread中。这样应用 进程和AMS建立起来双向连接。AM可以使用AIDL接口，通过app.thread可以访问应用进程的对象。</p><p>&#160;&#160;&#160; 应用程序通过ActivityThread提供的框架，建立消息循环Looper和Handler。从前面的相关章节我们知道有Looper和Handler,整个系统就可以运作了。</p><p>为了更为系统的了解应用程序的建立时序及其涉及到数据操作，我给出了应用进程的建立过程示意图：</p><p>&#160;<a href="http://hi.csdn.net/attachment/201005/24/0_12747150430h53.gif" target="_blank" rel="external"><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/47a89950f9b70c268435242f.jpg"><br></a></p><br><br><br><del>to be continue</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/21/Activity启动流程-1/" class="archive-article-date">
  	<time datetime="2010-08-21T14:08:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-21</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-android-启动流程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/20/android-启动流程/">android 启动流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>SystemServer的启动<br>frameworks/base/services/java/com/android/server/SystemServer.java: run()<br>其中调用ActivityManagerService.installSystemProviders()，<br>最终会调用到frameworks/base/packages/SettingsProvider/src/com/android/providers/settings/下<br>的各个content providers的onCreate()函数，初始化数据库内容。。。<br><br><br><br><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/c782b11b915b0b5a8618bfbb.jpg"><br><br><br>other ref：<a target="_blank" href="http://www.cnblogs.com/jacktu/archive/2010/07/02/1769939.html">http://www.cnblogs.com/jacktu/archive/2010/07/02/1769939.html</a><br><a target="_blank" href="http://blog.csdn.net/maxleng/archive/2010/04/20/5508372.aspx">Android 核心分析 之八——Android 启动过程详解</a><br></p><p>Android从Linux系统启动有4个步骤；</p><p>(1) init进程启动</p><p>(2) Native服务启动</p><p>(3) System Server，Android服务启动</p><p>(4) Home启动</p><p> </p><p>总体启动框架图如：</p><p><a href="http://hi.csdn.net/attachment/201005/14/0_1273850751070U.gif" target="_blank" rel="external"><img src="http://img.pickbox.me/wp-content/uploads/pic/53dbd31376f271415aaf53b2.jpg" small="0" class="blogimg"><br></a></p><p>&#160;</p>第一步：initial进程(systemcoreinit)<p> </p><p>&#160;&#160;&#160;&#160; init进程，它是一个由内核启动的用户级进程。内核自行启动（已经被载入内存，开始运行，并已初始化所有的设备驱动程序和数据结构等）之后，就通过启动一个用户级程序init的方式，完成引导进程。init始终是第一个进程.</p><p>Init.rc</p><p>Init.marvell.rc</p><p> <br></p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/9ba80ed71020649ea144dfbc.jpg" small="0" class="blogimg"></p><p>Init进程一起来就根据init.rc和init.xxx.rc脚本文件建立了几个基本的服务：</p><ul> <li>&#160;servicemanamger </li> <li>&#160;zygote </li></ul><p> 。。。</p><p>最后Init并不退出，而是担当起property service的功能。</p><p> </p>1.1脚本文件<p>init@System/Core/Init</p><p>Init.c： parse_config_file(Init.rc)</p><p>&#160;   @parse_config_file(Init.marvel.rc)</p><p>解析脚本文件：Init.rc和Init.xxxx.rc(硬件平台相关)</p><p> </p><p>Init.rc是Android自己规定的初始化脚本(Android Init Language, System/Core/Init/readme.txt)</p><p>该脚本包含四个类型的声明：</p><ul> <li>Actions </li> <li>Commands </li> <li>Services </li> <li>Options. </li></ul>1.2 服务启动机制<p> </p><p>我们来看看Init是这样解析.rc文件开启服务的。</p><p>（1）打开.rc文件，解析文件内容@ systemcoreinitinit.c</p><p>将service信息放置到service_list中。@ systemcoreinit parser.c</p><p>（2）restart_service()@ systemcoreinitinit.c</p><p> service_start</p><p> execve(…).建立service进程。</p><p> </p>第二步 Zygote<p> Servicemanager和zygote进程就奠定了Android的基础。Zygote这个进程起来才会建立起真正的Android运行空间，初始化建立的Service都是Navtive service.在.rc脚本文件中zygote的描述：</p><p>service zygote /system/bin/app_process -Xzygote /system/bin –zygote –start-system-server</p><p>所以Zygote从main(…)@frameworksbasecmdsapp_processapp_main.cpp开始。</p><p>(1) main(…)@frameworksbasecmdsapp_processapp_main.cpp</p><ul> <li>建立Java Runtime </li> <li>runtime.start(&quot;com.android.internal.os.ZygoteInit&quot;, startSystemServer); </li></ul><p> </p><p>(2) runtime.start@frameworks/base/core/jni/AndroidRuntime.cpp</p><ul> <li>建立虚拟机：startVM(…) </li> <li>运行：com.android.internal.os.ZygoteInit：main函数。 </li></ul><p> </p><p>（3）main()@com.android.internal.os.ZygoteInit//正真的Zygote。</p><ul> <li>registerZygoteSocket();//登记Listen端口 </li> <li>startSystemServer(); </li> <li>进入Zygote服务框架。 </li></ul><p>经过这几个步骤，Zygote就建立好了，利用Socket通讯，接收ActivityManangerService的请求，Fork应用程序。</p><p> </p><p> </p>第三步 System Server<p> </p><p>上fork了一个进程:&#160;com.android.server.SystemServer.于是SystemServer@(SystemServer.java）就建立了。Android的所有服务循环框架都是建立SystemServer@(SystemServer.java）上。在SystemServer.java中看不到循环结构，只是可以看到建立了init2的实现函数，建立了一大堆服务，并AddService到service Manager。</p><p>main() @ com/android/server/SystemServer </p><p>{</p><p> init1();</p><p>}</p><p>Init1()是在Native空间实现的（com_andoird_server_systemServer.cpp）。我们一看这个函数就知道了，init1-&gt;system_init() @System_init.cpp</p><p> </p><p>在system_init()我们看到了循环闭合管理框架。</p><p>{</p><p> Call &quot;com/android/server/SystemServer&quot;, &quot;init2&quot;</p><p> ….. </p><p> ProcessState::self()-&gt;startThreadPool();</p><p>&#160;&#160;&#160;  IPCThreadState::self()-&gt;joinThreadPool();</p><p>}</p><p> <br></p><p>init2()@SystemServer.java中建立了Android中所有要用到的服务。</p><p>这个init2（）建立了一个线程，来New Service和AddService来建立服务</p><p> <br></p><p> </p>第三步 Home启动<p>后半段，我们可以看到系统在启动完所有的Android服务后，做了这样一些动作：</p><p>（1） 使用xxx.systemReady()通知各个服务，系统已经就绪。</p><p> (2)&#160; 特别对于ActivityManagerService.systemReady(回调)</p><p> Widget.wallpaper,imm(输入法)等ready通知。</p><p> </p><p>Home就是在ActivityManagerService.systemReady()通知的过程中建立的。下面是ActivityManagerService.systemReady()的伪代码：</p><p>systemReady()@ActivityManagerService.java</p><p> resumeTopActivityLocked()</p><p> startHomeActivityLocked();//如果是第一个则启动HomeActivity。</p> startActivityLocked（。。。）CATEGORY_HOME<br><br><br>—————————————————————<br><a href="http://www.cnblogs.com/adamzuocy/archive/2009/10/27/1590525.html" target="_blank" rel="external">android 启动流程</a><p>In this topic you will learn some information about Android process  management. First let’s take a look at the launched processes during  Android booting.</p><p><em>USER PID PPID VSIZE RSS WCHAN PC NAME </em></p><p><em>root 1 0 264 176 c00acc6c 0000c36c S /init </em></p><p><em>root 28 1 724 308 c0051354 afe0c4cc S /system/bin/sh </em></p><p><em>system 30 1 796 248 c026516c afe0b74c S /system/bin/servicemanager </em></p><p><em>root 31 1 1824 316 ffffffff afe0b50c S /system/bin/mountd </em></p><p><em>root 32 1 652 248 c02976e0 afe0c0bc S /system/bin/debuggerd </em></p><p><em>radio 33 1 5344 664 ffffffff afe0bdbc S /system/bin/rild </em></p><p><em>root 34 1 71028 18828 c00ad308 afe0b874 S zygote </em></p><p><em>media 37 1 16812 3456 ffffffff afe0b74c S /system/bin/mediaserver </em></p><p><em>root 39 1 788 288 c02f9ae4 afe0b50c S /system/bin/installd </em></p><p><em>system 86 34 187756 21836 ffffffff afe0b74c S system_server </em></p><p><em>radio 118 34 103476 13896 ffffffff afe0c824 S com.android.phone </em></p><p><em>app_4 124 34 117848 19248 ffffffff afe0c824 S android.process.acore </em></p><p><em>app_5 139 34 98672 11516 ffffffff afe0c824 S com.android.mms </em></p><p><em>app_3 151 34 92096 10976 ffffffff afe0c824 S com.android.alarmclock </em></p><p><em>app_6 161 34 94436 12616 ffffffff afe0c824 S com.android.calendar </em></p><p><em>app_9 173 34 93248 11728 ffffffff afe0c824 S android.process.media </em></p><p><em>app_15 182 34 91848 9764 ffffffff afe0c824 S com.android.voicedialer </em></p><p><em>app_16 190 34 94524 10812 ffffffff afe0c824 S android.process.im</em></p><p>They can be divided into three kinds.</p>Root Process<p>init is the first process after kernel booting. The major task it performs:</p><p>l Parser and execute init.rc and init.%hardware%.rc</p><p>l Automatically generate device node under /dev</p><p>l Start log and property service</p><p>l Monitor for device, property set and child process exit events</p>Native Application Process<p>According to init.rc, init will fork the following native application process.</p><p><strong>console</strong>: star a shell.</p><p><strong>servicemanager</strong>: start binder IPC service manager.</p><p><strong>mountd</strong>: mount all fs defined in /system/etc/mountd.conf if started, receive commands through local socket to mount any fs.</p><p><strong>debuggerd</strong>: start debug system.</p><p><strong>rild</strong>: start radio interface layer daemon.</p><p><strong>zygote</strong>: start Android Java VM Runtime and start system server. It’s the most important process.</p><p><strong>mediaserver</strong>: start AudioFlinger, MediaPlayerService and CameraService.</p><p><strong>installd</strong>: start install package daemon.</p>JAVA Application Process<p>Every JAVA application process is forked from zygote process.  system_server is a special JAVA process, which is directly forked from  zygote.. Other JAVA process is created from ActivityManagerService(run  in system_server process) like this.</p><p><em>int pid = Process.start(&quot;android.app.ActivityThread&quot;, </em></p><p><em>mSimpleProcessManagement ? app.processName : null, uid, uid, </em></p><p><em>gids, ((app.info.flags&amp;ApplicationInfo.FLAG_DEBUGGABLE) != 0), null);</em></p><p>While Process.java use UNIX domain socket to communicate with zygote. So the overall picture is shown as following.</p><p><a target="_blank" href="http://blufiles.storage.msn.com/y1pySHLglI8hr1QG90DfDA8rJPCI543BJ1x0D41pF_ZMLy-f3FxRn5p7mgGuy2WAnph50vRzK2gehM2DmT6KF7mPw?PARTNER=WRITER"><img src="http://img.pickbox.me/wp-content/uploads/pic/49d541a995e13dbf1f17a2f8.jpg" small="0" class="blogimg"><br></a></p>System Server<p>It’s the first JAVA application launched by zygote. It starts the  core Android services, e.g. ActivityManager, WindowManager,  PackageManager etc. It’s the Android core engine.</p>Persistent Application<p>During booting, ActivityManagerService.systemReady will start all persistent applications.</p><p><em>List apps = ActivityThread.getPackageManager(). </em></p><p><em>getPersistentApplications(PackageManager.GET_SHARED_LIBRARY_FILES); </em></p><p><em>if (apps != null) { </em></p><p><em>int N = apps.size(); </em></p><p><em>int i; </em></p><p><em>for (i=0; i&lt;N; i++) { </em></p><p><em>ApplicationInfo info </em></p><p><em>= (ApplicationInfo)apps.get(i); </em></p><p><em>if (info != null &amp;&amp; </em></p><p><em>!info.packageName.equals(&quot;android&quot;)) { </em></p><p><em>addAppLocked(info); </em></p><p><em>} </em></p><p><em>} </em></p><p><em>}</em></p><p>Currently only Phone application is registered as a persistent app in AndroidManifest.xml like this.</p><p><em>&lt;application android:name=&quot;PhoneApp&quot; </em></p><p><em>android:persistent=&quot;true&quot; </em></p><p><em>android:label=&quot;@string/dialerIconLabel&quot; </em></p><p><em>android:icon=&quot;@drawable/ic_launcher_phone&quot;&gt;</em></p><p>So during booting, only phone application is automatically launched. It’s the “com.android.phone” process.</p>The First Activity<p>The first activity is launched by senting Intent.CATEGORY_HOME intent from ActivityManagerService.</p><p><em>Intent intent = new Intent( </em></p><p><em>mTopAction, </em></p><p><em>mTopData != null ? Uri.parse(mTopData) : null); </em></p><p><em>intent.setComponent(mTopComponent); </em></p><p><em>if (mFactoryTest != SystemServer.FACTORY_TEST_LOW_LEVEL) { </em></p><p><em>intent.addCategory(Intent.CATEGORY_HOME); </em></p><p><em>} </em></p><p><em>ActivityInfo aInfo = </em></p><p><em>intent.resolveActivityInfo(mContext.getPackageManager(), </em></p><p><em>PackageManager.GET_SHARED_LIBRARY_FILES); </em></p><p><em>if (aInfo != null) { </em></p><p><em>intent.setComponent(new ComponentName( </em></p><p><em>aInfo.applicationInfo.packageName, aInfo.name)); </em></p><p><em>// Don’t do this if the home app is currently being </em></p><p><em>// instrumented. </em></p><p><em>ProcessRecord app = getProcessRecordLocked(aInfo.processName, </em></p><p><em>aInfo.applicationInfo.uid); </em></p><p><em>if (app == null || app.instrumentationClass == null) { </em></p><p><em>intent.setFlags(intent.getFlags() | Intent.FLAG_ACTIVITY_NEW_TASK); </em></p><p><em>startActivityLocked(null, intent, null, null, 0, aInfo, </em></p><p><em>null, null, 0, 0, 0, false); </em></p><p><em>} </em></p><p><em>}</em></p><p>It’s the “android.process.acore” process. (The process name is defined in AndroidManifest.xml)</p>Auto-launched Application After Booting<p>When activity idle is detected in ActivityManagerService, it will broadcast ACTION_BOOT_COMPLETED intent at the first time.</p><p><em>if (mFactoryTest != SystemServer.FACTORY_TEST_LOW_LEVEL) { </em></p><p><em>// Tell anyone interested that we are done booting! </em></p><p><em>synchronized (this) { </em></p><p><em>broadcastIntentLocked(null, null, </em></p><p><em>new Intent(Intent.ACTION_BOOT_COMPLETED, null), </em></p><p><em>null, null, 0, null, null, </em></p><p><em>android.Manifest.permission.RECEIVE_BOOT_COMPLETED, </em></p><p><em>false, false, MY_PID, Process.SYSTEM_UID); </em></p><p><em>} </em></p><p><em>}</em></p><p>Currently, MMS, AlarmClock, Calendar, MediaProvider, VoiceDialer and  IM have registered as a receiver for ACTION_BOOT_COMPLETED intent in  their AndroidManifest.xml. So they will be automatically launched. (This  explains the remained JAVA process.)</p><p>Email also registers as a receiver for ACTION_BOOT_COMPLETED intent  in its AndroidManifest.xml, but it defines android:enable=”false”. So it  won’t be launched.</p><p><em>&lt;receiver android:name=&quot;.service.BootReceiver&quot; </em></p><p><em>android:enabled=&quot;false&quot; </em></p><p><em>&gt; </em></p><p><em>&lt;intent-filter&gt; </em></p><p><em>&lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot; /&gt; </em></p><p><em>&lt;/intent-filter&gt; </em></p><p><em>&lt;intent-filter&gt; </em></p><p><em>&lt;action android:name=&quot;android.intent.action.DEVICE_STORAGE_LOW&quot; /&gt; </em></p><p><em>&lt;/intent-filter&gt; </em></p><p><em>&lt;intent-filter&gt; </em></p><p><em>&lt;action android:name=&quot;android.intent.action.DEVICE_STORAGE_OK&quot; /&gt; </em></p><p><em>&lt;/intent-filter&gt; </em></p><p><em>&lt;/receiver&gt; </em></p><p>DownloadProvider also registers as a receiver for  ACTION_BOOT_COMPLETED intent in its AndroidManifest.xml, but it defines  android:exported=”false”. So it won’t be launched.</p><p><em>&lt;receiver android:name=&quot;.DownloadReceiver&quot; android:exported=&quot;false&quot;&gt; </em></p><p><em>&lt;intent-filter&gt; </em></p><p><em>&lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot; /&gt; </em></p><p><em>&lt;action android:name=&quot;android.net.conn.CONNECTIVITY_CHANGE&quot; /&gt; </em></p><p><em>&lt;/intent-filter&gt; </em></p><p><em>&lt;/receiver&gt; </em></p>Behind the JAVA process<p>system_server is a special case. It calls ActivityThread.java’s  systemMain static function, which creates an instance of ActivityThread.  ActivityThread then creates an instance of ApplicationThread,  Application and ApplicationContext.</p><p>Every other JAVA process works in a different way. It’s controlled by  system_server while forked by zygote. When any JAVA process other than  system_server is forked from zygote, it automatically calls  ActivityThread.java’s main static function(See Process.java and the  following code snippet).</p><p><em>try { </em></p><p><em>ZygoteInit.invokeStaticMain(cloader, className, mainArgs); </em></p><p><em>} catch (RuntimeException ex) { </em></p><p><em>logAndPrintError (newStderr, &quot;Error starting. &quot;, ex); </em></p><p><em>} </em></p><p>The ActivityThread.java’s main function creates an instance of  ActivityThread. ActivityThread then creates an instance of  ApplicationThread. The ApplicationThread will work as an IBinder object  to interact with ActivityManagerService in system_server. The new  process does nothting at this time other than waiting IPC call from  system_server. The Application and ApplicationContext object won’t be  created at this time. Actually it’s deferred to when the process really  works, eg. start an activity, receive intent or start a service.</p><p>For example, when start an activity, ActivityManagerService know  which process the to-be-launched activity should run in, so it will RPC  call ApplicationThread’s scheduleLaunchActivity to launch a new activity  in that process. ApplicationThread then post a message to let  ActivityThread know it needs to start an activity. ActivityThread then  creates Application and ApplicationContext object. After that, it calls  Instrumentation, then Instrumentation finally calls JAVA dalvik VM to  really create an activity JAVA object.</p><p> </p><p> </p><p> </p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/20/android-启动流程/" class="archive-article-date">
  	<time datetime="2010-08-20T03:21:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-How-to-Create-Android-Update-Zip-Package" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/11/How-to-Create-Android-Update-Zip-Package/">How to Create Android Update Zip Package</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="http://www.londatiga.net/it/how-to-create-android-update-zip-package/" rel="external" title="Permanent Link to How to Create Android Update Zip Package" target="_blank">How to Create Android Update Zip Package</a></p><p>There are several ways to install applications or&#160; library files to an <a title="Android" href="http://www.android.com/" target="_blank">Android</a> <a href="http://www.londatiga.net/it/samsung-i5700-galaxy-spica-android-2-1-flashing-guide/" target="_blank">Phone</a>. You can use <em>Market</em> application to find and install or <a title="Android ADB Tool" href="http://www.londatiga.net/it/how-to-create-android-update-zip-package/developer.android.com/guide/developing/tools/adb.html" target="_blank">adb</a>  command line tool to install or push the files to Android file system.  These are all easy to implement for&#160; single&#160; file but if you have  several applications or library files to install at once, it might be  better to use <strong>update zip</strong> file. The update zip file is  Android advanced system to install applications or lib files to Android  file system using recovery tool. This method is commonly used by rom or  theme developers to distribute their package.</p><p>Creating an update zip file is quite easy, all you have to do is put  the files in corresponding directory in Android file system and an update-script file to copy the files. For example, to install Calculator.apk into system/app and copy libsec-ril.so file into system/lib :</p><ul> <li>Create an empty folder (eg. C:myupdate)</li> <li>Create C:myupdatesystemapp folder for Calculator.apk and&#160; C:myupdatesystemlib folder for libsec-ril.so</li> <li>Create C:myupdateMETA-INFcomgoogleandroid folder for update-script file.</li> <li>Create the update-script file with the following syntax:</li>    show_progress 0.1 0<br><br>copy_dir PACKAGE:system SYSTEM:<br><br>show_progress 0.1 10    <p>Line 1&amp;5 : show progress bar<br>    Line 3: copy system folder from update package to Android’s /system</p> <p>Note: you should add one extra&#160; line at the end of the file (Line 6)</p> <li>Compress the entire contents of C:myupdate folder to zip (not the myupdate folder itself)</li> <li>Sign the myupdate.zip file</li> <p>java -jar signapk.jar certificate.pem key.pk8 myupdate.zip update.zip</p> <p>Note: you can find tutorial on how to sign the update.zip file <a title="How to sign android update.zip file" href="http://www.londatiga.net/it/how-to-sign-apk-zip-files/" target="_blank">here</a></p> <li>Copy the update.zip file to sdcard and apply it from recovery console</li></ul><p>update-script syntax reference (definitions from recovery.c android source code):</p><ul> <li><strong>copy_dir</strong></li> <p>Syntax: copy_dir &lt;src-dir&gt; &lt;dst-dir&gt; [&lt;timestamp&gt;]<br>    Copy the contents  of &lt;src-dir&gt; to&#160; &lt;dst-dir&gt;. The original  contents of &lt;dst-dir&gt; are preserved unless something in   &lt;src-dir&gt; overwrote them.<br>    Ex: copy_dir PACKAGE:system SYSTEM:</p> <li><strong>format</strong></li> <p>Syntax: format &lt;root&gt;<br>    Format a partiti0n<br>    Ex:<strong> </strong>format SYSTEM:, will format entire /system . Note: formatting erases data irreversibly.</p> <li><strong>delete</strong></li> <p>Syntax: delete  &lt;file1&gt; [… &lt;fileN&gt;]<br>    Delete&#160; file.<br>    EX: delete SYSTEM:app/Calculator.apk, will delete Calculator.apk from system/app directory.</p> <li><strong>delete_recursive</strong></li> <p>Syntax: delete_recursive  &lt;file-or-dir1&gt; [… &lt;file-or-dirN&gt;]<br>    Delete a file or directory with all of it’s contents recursively<br>    Ex: delete_recursive DATA:dalvik-cache, will delete /data/dalvik-cache directory with all of it’s contents</p> <li><strong>run_program</strong></li> <p>Syntax: run_program &lt;program-file&gt; [&lt;args&gt; …]<br>    Run an external program included in the update package.<br>    Ex: run_program PACKAGE:install_busybox.sh, will run install_busybox.sh script (shell command) included in the update package.</p> <li><strong>set_perm</strong></li> <p>Syntax: set_perm &lt;uid&gt; &lt;gid&gt; &lt;mode&gt; &lt;path&gt; [… &lt;pathN&gt;]<br>    Set ownership and permission of single file or entire directory trees, like ‘chmod’, ‘chown’, and ‘chgrp’ all in one<br>    Ex: set_perm 0 2000 0550 SYSTEM:etc/init.goldfish.sh</p> <li><strong>set_perm_recursive</strong></li> <p>Syntax: set_perm_recursive &lt;uid&gt; &lt;gid&gt; &lt;dir-mode&gt; &lt;file-moe&gt; &lt;path&gt; [… &lt;pathN&gt;]<br>    Set ownership and permission of a directory with all of it’s contents recursively</p> <p>Ex: set_perm_recursive 0 0 0755 0644 SYSTEM:app</p> <li><strong>show_progress </strong></li> <p>Syntax: show_progress &lt;fraction&gt; &lt;duration&gt;<br>    Use  of the on-screen progress meter for the next operation,  automatically advancing the meter over  &lt;duration&gt; seconds (or  more rapidly if the actual rate of progress can be determined).<br>    Ex: show_progress 0.1 0</p> <li><strong>symlink</strong></li> <p>Syntax: symlink &lt;link-target&gt; &lt;link-path&gt;</p> <p>Create a symlink (like ‘ln-s’). The &lt;link-path&gt; is in root:path format, but &lt;link-target&gt; is<br>    for the target filesystem (and may be relative)</p> <p> </p></ul>———-MOTO XT800 root达成，附update.zip下载Jan 22nd, 2010               <a href="http://epis.me/592#respond" target="_blank" rel="external">Leave a comment</a> <a href="http://epis.me/592#comments" target="_blank" rel="external">Go to comments</a><p>花了一天时间弄这东西，终于在天黑之前搞定了xt800的<a target="_blank" title="View all posts in root" href="http://epis.me/tag/root">root</a>，让时间回味这一刻 ，让岁月铭记这一回o(╯□╰)o。</p><p><a href="http://epis.me/wp-content/uploads/2010/01/IMG_3210.jpg" target="_blank" rel="external"><img height="480" width="319" src="http://img.pickbox.me/wp-content/uploads/pic/82498f1079c73442203f2e66.jpg" title="IMG_3210" class="aligncenter size-medium wp-image-593"></a></p><p> </p><ol> <li>下载update.zip，放到储存卡的根目录上</li> <li>关机</li> <li>按住搜索键 + 拍照键 + 电源开关键， 开机</li> <li>出现感叹号警告图标后，按音量键向上+拍照键，进入recovery模式</li> <li>音量键上下调整高亮条，选择apply sdcard:update.zip 来安装update.zip</li> <li>待完成后，重启，即有<a target="_blank" title="View all posts in root" href="http://epis.me/tag/root">root</a>权限</li></ol><p>以下不是必须，只是使在adb shell下也能获得root权限</p><ol> <li>下载<a href="http://www.magicandroidapps.com/su.zip" rel="external" title="http://www.magicandroidapps.com/su.zip" target="_blank">http://www.magicandroidapps.com/su.zip</a>，解压缩，放到SDK的tools文件夹下</li> <li>输入如下命令            C:<a target="_blank" title="View all posts in Android" href="http://epis.me/tag/android">Android</a>&gt;adb push su /data/local            </li> <li>利用Root Explorer或其他方式mount整个系统，使其处在可读写状态</li> <li>输入以下命令            $ su<br># mount -o remount,rw -t yaffs2 /dev/block/mtdblock6 /system<br># cd /system/bin<br># mv su osu<br># cat /data/local/su &gt; su<br># chmod 6755 su<br># ls -l *su            <p>如果最后显示如下，表示成功了</p>            -rwsr-sr-x root root 76200 2008-08-01 05:00 osu<br>-rwsr-sr-x root root 76200 2009-05-30 11:28 su            </li> <li>最后输入以下命令，机器会重启，重启后即可            # sync<br> # reboot            </li></ol><p>下载：<a title="root for moto xt800, downloaded 11108 times" href="http://epis.me/downloads/update_root.zip" target="_blank" rel="external">Android_xt800_root_1</a> (2010-01-22, 3.11 MB)</p><ul> </ul> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/11/How-to-Create-Android-Update-Zip-Package/" class="archive-article-date">
  	<time datetime="2010-08-11T11:19:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-11</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-经典小故事" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/08/10/经典小故事/">经典小故事</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 扁鹊的医术<br></p><p>魏文王问名医扁鹊说：“你们家兄弟三人，都精于医术，到底哪一位最好呢？”<br>扁鹊答：“长兄最好，中兄次之，我最差。”<br>文王再问：“那么为什么你最出名呢？”<br>扁 鹊答：“长兄治病，是治病于病情发作之前。由于一般人不知道他事先能铲除病因，所以他的名气无法传出去；中兄治病，是治病于病情初起时。一般人以为他只能 治轻微的小病，所以他的名气只及本乡里。而我是治病于病情严重之时。一般人都看到我在经脉上穿针管放血、在皮肤上敷药等大手术，所以以为我的医术高明，名 气因此响遍全国。”</p><p>管理心得：事后控制不如事中控制，事中控制不如事前控制，可惜大多数的事业经营者均未能体会到这一点，等到错误的决策造成了重大的损失才寻求弥补。而往往是即使请来了名气很大的“空降兵”，结果于事无补。</p><p> </p><p>曲突徒薪</p><p><br>有位客人到某人家里做客，看见主人家的灶上烟囱是直的，旁边又有很多木材。客人告诉主人说，烟囱要改曲，木材须移去，否则将来可能会有火灾，主人听了没有作任何表示。<br>不 久主人家里果然失火，四周的邻居赶紧跑来救火，最后火被扑灭了，于是主人烹羊宰牛，宴请四邻，以酬谢他们救火的功劳，但并没有请当初建议他将木材移走，烟 囱改曲的人。 有人对主人说：“如果当初听了那位先生的话，今天也不用准备筵席，而且没有火灾的损失，现在论功行赏，原先给你建议的人没有被感恩，而救火的人却是座上 客，真是很奇怪的事呢！”主人顿时省悟，赶紧去邀请当初给予建议的那个客人来吃酒。</p><p>管理心得：一般人认为，足以摆平或解决企业经营过程中的各种棘手问题的人，就是优秀的管理者，其实这是有待商榷的，俗话说：“预防重于治疗”，能防患于未然之前，更胜于治乱于已成之后，由此观之，企业问题的预防者，其实是优于企业问题的解决者。</p><p> </p><p>救   人</p><p>在一场激烈的战斗中，上尉忽然发现一架敌机向阵地俯冲下来。照常理，发现敌机俯冲时要毫不犹豫地卧倒。可上尉并没有立刻 卧倒，他发现离他四五米远处有一个小战士还站在哪儿。他顾不上多想 ，一个鱼跃飞身将小战士紧紧地压在了身下。此时一声巨响，飞溅起来的泥土纷纷落在他们的身上。上尉拍拍身上的尘土，回头一看，顿时惊呆了：刚才自己所处的 那个位置被炸成了一个大坑。</p><p><br>古时候，有两个兄弟各自带着一只行李箱出远门。一路上，重重的行李箱将兄弟俩都压得 喘不过气来。他们只好左手累了换右手，右手累了又换左手。忽然，大哥停了下来，在路边买了一根扁担，将两个行李箱一左一右挂在扁担上。他挑起两个箱子上 路，反倒觉得轻松了很多。<br><br>把这两个故事联系在一起也许有些牵强，但他们确实有着惊人的相似之处：故事中的小战士和弟弟是幸运的，但更加幸运的是故事中的上尉和大哥，因为他们在帮助别人的同时也帮助了自己！</p><p>管理心得：在我们人生的大道上，肯定会遇到许许多多的困难。但我们是不是都知道，在前进的道路上，搬开别人脚下的绊脚石，有时恰恰是为自己铺路？</p><p> </p><p> </p><p>河边的苹果</p><p><br>一位老和尚，他身边聚拢着一帮虔诚的弟子。这一天，他嘱咐弟子每人去南山打一担柴回来。弟子们匆匆行至离山不远的河边，人人目瞪口呆。只见洪水从山上奔泻 而下，无论如何也休想渡河打柴了。无功而返，弟子们都有些垂头丧气。唯独一个小和尚与师傅坦然相对。师傅问其故，小和尚从怀中掏出一个苹果，递给师傅说， 过不了河，打不了柴，见河边有棵苹果树，我就顺手把树上唯一的一个苹果摘来了。后来，这位小和尚成了师傅的衣钵传人。<br><br>世上有走不完的路，也有过不了的河。过不了的河掉头而回，也是一种智慧。但真正的智慧还要在河边做一件事情：放飞思想的风筝，摘下一个“苹果”。历览古今，抱定这样一种生活信念的人，最终都实现了人生的突围和超越。</p><p> </p><p>并不是你想象中那样</p><p><br>两个旅行中的天使到一个富有的家庭借宿。这家人对他们并不友好，并且拒绝让他们在舒适的客人卧室过夜，而是在冰冷的地下室给他们找了一个角落。当他们铺床 时，较老的天使发现墙上有一个洞，就顺手把它修补好了。年轻的天使问为什么，老天使答到：“有些事并不象它看上去那样。”<br>第二晚，两人又到了 一个非常贫穷的农家借宿。主人夫妇俩对他们非常热情，把仅有的一点点食物拿出来款待客人，然后又让出自己的床铺给两个天使。第二天一早，两个天使发现农夫 和他的妻子在哭泣，他们唯一的生活来源——一头奶牛死了。年轻的天使非常愤怒，他质问老天使为什么会这样，第一个家庭什么都有，老天使还帮助他们修补墙 洞，第二个家庭尽管如此贫穷还是热情款待客人，而老天使却没有阻止奶牛的死亡。<br>“有些事并不象它看上去那样。”老天使答道，“当我们在地下室过夜时，我从墙洞看到墙里面堆满了金块。因为主人被贪欲所迷惑，不愿意分享他的财富，所以我把墙洞填上了。昨天晚上，死亡之神来召唤农夫的妻子，我让奶牛代替了她。所以有些事并不象它看上去那样。”<br></p><p>有些时候事情的表面并不是它实际应该的样子。如果你有信念，你只需要坚信付出总会得到回报。你可能不会发现，直到后来……</p><p> </p><p>养牛之道</p><p>我们旅行到乡间，看到一位老农把喂牛的草料铲到一间小茅屋的屋檐上，不免感到奇怪，于是就问道：“老公公，你为什么不把喂牛的草放在地上，让它吃？”<br>老农说：“这种草草质不好，我要是放在地上它就不屑一顾；但是我放到让它勉强可够得着的屋檐上，它会努力去吃，直到把全部草料吃个精光。”</p><p> </p><p>爱人之心<br></p><p>这是发生在英国的一个真实故事。<br>有位孤独的老人，无儿无女，又体弱多病。他决定搬到养老院去。老人宣 布出售他漂亮的住宅。购买者闻讯蜂拥而至。住宅底价8万英镑，但人们很快就将它炒到了10万英镑。价钱还在不断攀升。老人深陷在沙发里，满目忧郁，是的， 要不是健康情形不行，他是不会卖掉这栋陪他度过大半生的住宅的。<br>一个衣着朴素的青年来到老人眼前，弯下腰，低声说：“先生，我也好想买这栋住宅，可我只有1万英镑。可是，如果您把住宅卖给我，我保证会让您依旧生活在这里，和我一起喝茶，读报，散步，天天都快快乐乐的——相信我，我会用整颗心来照顾您！”<br>老人颔首微笑，把住宅以1万英镑的价钱卖给了他。　　</p><p>完成梦想，不一定非得要冷酷地厮杀和欺诈，有时，只要你拥有一颗爱人之心就可以了。</p><p> </p><p> </p><p>给 予<br></p><p>&#160;</p><p>有个老木匠准备退休，他告诉老板，说要离开建筑行业，回家与妻子儿女享受天伦之乐。<br>老板舍不得他的好工人走，问他是否能帮忙再建一座房子，老木匠说可以。但是大家后来都看得出来，他的心已不在工作上，他用的是软料，出的是粗活。房子建好的时候，老板把大门的钥匙递给他。<br>“这是你的房子，”他说，“我送给你的礼物。”<br>他震惊得目瞪口呆，羞愧得无地自容。如果他早知道是在给自己建房子，他怎么会这样呢？现在他得住在一幢粗制滥造的房子里！</p><p>我 们又何尝不是这样。我们漫不经心地“建造”自己的生活，不是积极行动，而是消极应付，凡事不肯精益求精，在关键时刻不能尽最大努力。等我们惊觉自己的处 境，早已深困在自己建造的“房子”里了。把你当成那个木匠吧，想想你的房子，每天你敲进去一颗钉，加上去一块板，或者竖起一面墙，用你的智慧好好建造吧！ 你的生活是你一生唯一的创造，不能抹平重建，即使只有一天可活，那一天也要活得优美、高贵，墙上的铭牌上写着：“生活是自己创造的。”</p><br><br><br><br>提醒自我<p><br>有个老太太坐在马路边望着不远处的一堵高墙，总觉得它马上就会倒塌，见有人向媾走过去，她就善意地提醒道：“那堵墙要倒了，远着点走吧。”被提醒的人不解 地看着她大模大样地顺着墙根走过去了——那堵墙没有倒。老太太很生气：“怎么不听我的话呢？！”又有人走来，老太太又予以劝告。三天过去了，许多人在墙边 走过去，并没有遇上危险。第四天，老太太感到有些奇怪，又有些失望，不由自主便走到墙根下仔细观看，然而就在此时，墙缍倒了，老太太被掩埋在灰尘砖石中， 气绝身亡。</p><p>提醒别人时往往很容易，很清醒，但能做到时刻清醒地提醒自己却很难。所以说，许多危险来源于自身，老太太的悲哀便因此而生。</p><br><br><br><br>习惯与自然<p>　　一根小小的柱子，一截细细的链子，拴得住一头千斤重的大象，这不荒谬吗？可这荒谬的场景在印度和秦国随处可见。那些驯 象人，在大象还是小象的时候，就用一条铁链将它绑在水泥柱或钢柱上，无论小象怎么挣扎都无法挣脱。小象渐渐地习惯了不挣扎，直到长成了大象，可以轻而易举 地挣脱链子时，也不挣扎。<br>驯虎人本来也像驯象人一样成功，他让小虎从小吃素，直到小虎长大。老虎不知肉味，自然不会伤人。驯虎人的致命错误在于他摔了交之后让老虎舔净他流在地上的血，老虎一舔不可收，终于将驯虎人吃了。</p><p>小象是被链子绑住，而大象则是被习惯绑住。<br>虎曾经被习惯绑住，而驯虎人则死于习惯（他已经习惯于他的老虎不吃人）。<br>习惯几乎可以绑住一切，只是不能绑住偶然。比如那只偶然尝了鲜血的老虎。</p><p> </p><p> </p><p> </p><p> </p><p> </p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/08/10/经典小故事/" class="archive-article-date">
  	<time datetime="2010-08-10T14:25:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-08-10</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Saying/">Saying</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Data-Storage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/07/18/Data-Storage/">Data Storage</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>Using the Internal StorageYou can save files directly on the device’s internal storage. By default, files saved to the internal storage are private to your application and other applications cannot access them (nor can the user). When the user uninstalls your application, these files are removed.<br>String FILENAME = &quot;hello_file&quot;;<br>String string = &quot;hello world!&quot;;<br><br>FileOutputStream fos = openFileOutput(FILENAME, Context.MODE_PRIVATE);<br>fos.write(string.getBytes());<br>fos.close();<strong>Tip:</strong> If you want to save a static file in your application at compile time, save the file in your project <code>res/raw/</code> directory. You can open it with <code><a href="http://androidappdocs.appspot.com/reference/android/content/res/Resources.html#openRawResource%28int%29" target="_blank" rel="external">openRawResource()</a></code>, passing the <code>R.raw.<em>&lt;filename&gt;</em></code> resource ID. This method returns an <code><a href="http://androidappdocs.appspot.com/reference/java/io/InputStream.html" target="_blank" rel="external">InputStream</a></code> that you can use to read the file (but you cannot write to the original file). <br><br><br><strong>Funtion references</strong><br>————————————-<br>         public                              abstract                    <a href="http://androidappdocs.appspot.com/reference/java/io/File.html" target="_blank" rel="external">File</a>              getFilesDir       ()</p><p>Returns the absolute path to the directory on the filesystem where  files created with <code><a href="http://androidappdocs.appspot.com/reference/android/content/Context.html#openFileOutput%28java.lang.20int%29" target="_blank" rel="external">openFileOutput(String, int)</a></code> are stored.</p><p>&#160;</p>         public                              abstract                    <a href="http://androidappdocs.appspot.com/reference/java/lang/String.html" target="_blank" rel="external">String[]</a>              fileList       ()<p>Returns an array of strings naming the private files associated with  this Context’s application package.</p><br>         public          static                                        <a href="http://androidappdocs.appspot.com/reference/java/io/File.html" target="_blank" rel="external">File</a>              getExternalStorageDirectory       ()Since: <a href="http://androidappdocs.appspot.com/guide/appendix/api-levels.html#level1" target="_blank" rel="external">API Level 1</a>Gets the Android external storage directory. <br><br><br><br>Using the External Storage<br>Checking External Storage availabilityboolean mExternalStorageAvailable = false;<br>boolean mExternalStorageWriteable = false;<br>String state = Environment.getExternalStorageState();<br><br>if (Environment.MEDIA_MOUNTED.equals(state)) {<br>&#160; &#160; // We can read and write the media<br>&#160; &#160; mExternalStorageAvailable = mExternalStorageWriteable = true;<br>} else if (Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {<br>&#160; &#160; // We can only read the media<br>&#160; &#160; mExternalStorageAvailable = true;<br>&#160; &#160; mExternalStorageWriteable = false;<br>} else {<br>&#160; &#160; // Something else is wrong. It may be one of many other states, but all we need<br>&#160; &#160; // &#160;to know is we can neither read nor write<br>&#160; &#160; mExternalStorageAvailable = mExternalStorageWriteable = false;<br>}<br>         public          static                                        <a href="http://androidappdocs.appspot.com/reference/java/io/File.html" target="_blank" rel="external">File</a>              getExternalStorageDirectory       ()Since: <a href="http://androidappdocs.appspot.com/guide/appendix/api-levels.html#level1" target="_blank" rel="external">API Level 1</a>Gets the Android external storage directory. <br><br><br><br><br>         public          static                                        <a href="http://androidappdocs.appspot.com/reference/java/io/File.html" target="_blank" rel="external">File</a>              getExternalStoragePublicDirectory       (<a href="http://androidappdocs.appspot.com/reference/java/lang/String.html" target="_blank" rel="external">String</a> type)Since: <a href="http://androidappdocs.appspot.com/guide/appendix/api-levels.html#level8" target="_blank" rel="external">API Level 8</a><p>Get a top-level public external storage directory for placing files of  a particular type.  This is where the user will typically place and  manage their own files, so you should be careful about what you put here  to ensure you don’t erase their files or get in the way of their own  organization.</p><p>Here is an example of typical code to manipulate a picture on  the public external storage:</p>void createExternalStoragePublicPicture() {<br>&#160; &#160; // Create a path where we will place our picture in the user’s<br>&#160; &#160; // public pictures directory. &#160;Note that you should be careful about<br>&#160; &#160; // what you place here, since the user often manages these files. &#160;For<br>&#160; &#160; // pictures and other media owned by the application, consider<br>&#160; &#160; // Context.getExternalMediaDir().<br>&#160; &#160; File path = Environment.getExternalStoragePublicDirectory(<br>&#160; &#160; &#160; &#160; &#160; &#160; Environment.DIRECTORY_PICTURES);<br>&#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br><br>&#160; &#160; try {<br>&#160; &#160; &#160; &#160; // Make sure the Pictures directory exists.<br>&#160; &#160; &#160; &#160; path.mkdirs();<br><br>&#160; &#160; &#160; &#160; // Very simple code to copy a picture from the application’s<br>&#160; &#160; &#160; &#160; // resource into the external file. &#160;Note that this code does<br>&#160; &#160; &#160; &#160; // no error checking, and assumes the picture is small (does not<br>&#160; &#160; &#160; &#160; // try to copy it in chunks). &#160;Note that if external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted this will silently fail.<br>&#160; &#160; &#160; &#160; InputStream is = getResources().openRawResource(R.drawable.balloons);<br>&#160; &#160; &#160; &#160; OutputStream os = new FileOutputStream(file);<br>&#160; &#160; &#160; &#160; byte[] data = new byte[is.available()];<br>&#160; &#160; &#160; &#160; is.read(data);<br>&#160; &#160; &#160; &#160; os.write(data);<br>&#160; &#160; &#160; &#160; is.close();<br>&#160; &#160; &#160; &#160; os.close();<br><br>&#160; &#160; &#160; &#160; // Tell the media scanner about the new file so that it is<br>&#160; &#160; &#160; &#160; // immediately available to the user.<br>&#160; &#160; &#160; &#160; MediaScannerConnection.scanFile(this,<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new String[] { file.toString() }, null,<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new MediaScannerConnection.OnScanCompletedListener() {<br>&#160; &#160; &#160; &#160; &#160; &#160; public void onScanCompleted(String path, Uri uri) {<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Log.i(&quot;ExternalStorage&quot;, &quot;Scanned &quot; + path + &quot;:&quot;);<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Log.i(&quot;ExternalStorage&quot;, &quot;-&gt; uri=&quot; + uri);<br>&#160; &#160; &#160; &#160; &#160; &#160; }<br>&#160; &#160; &#160; &#160; });<br>&#160; &#160; } catch (IOException e) {<br>&#160; &#160; &#160; &#160; // Unable to create file, likely because external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted.<br>&#160; &#160; &#160; &#160; Log.w(&quot;ExternalStorage&quot;, &quot;Error writing &quot; + file, e);<br>&#160; &#160; }<br>}<br><br>void deleteExternalStoragePublicPicture() {<br>&#160; &#160; // Create a path where we will place our picture in the user’s<br>&#160; &#160; // public pictures directory and delete the file. &#160;If external<br>&#160; &#160; // storage is not currently mounted this will fail.<br>&#160; &#160; File path = Environment.getExternalStoragePublicDirectory(<br>&#160; &#160; &#160; &#160; &#160; &#160; Environment.DIRECTORY_PICTURES);<br>&#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br>&#160; &#160; file.delete();<br>}<br><br>boolean hasExternalStoragePublicPicture() {<br>&#160; &#160; // Create a path where we will place our picture in the user’s<br>&#160; &#160; // public pictures directory and check if the file exists. &#160;If<br>&#160; &#160; // external storage is not currently mounted this will think the<br>&#160; &#160; // picture doesn’t exist.<br>&#160; &#160; File path = Environment.getExternalStoragePublicDirectory(<br>&#160; &#160; &#160; &#160; &#160; &#160; Environment.DIRECTORY_PICTURES);<br>&#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br>&#160; &#160; return file.exists();<br>}Parameters                        type            The type of storage directory to return.  Should be one of  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_MUSIC" target="_blank" rel="external">DIRECTORY_MUSIC</a></code>, <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_PODCASTS" target="_blank" rel="external">DIRECTORY_PODCASTS</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_RINGTONES" target="_blank" rel="external">DIRECTORY_RINGTONES</a></code>, <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_ALARMS" target="_blank" rel="external">DIRECTORY_ALARMS</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_NOTIFICATIONS" target="_blank" rel="external">DIRECTORY_NOTIFICATIONS</a></code>, <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_PICTURES" target="_blank" rel="external">DIRECTORY_PICTURES</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_MOVIES" target="_blank" rel="external">DIRECTORY_MOVIES</a></code>, <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_DOWNLOADS" target="_blank" rel="external">DIRECTORY_DOWNLOADS</a></code>, or  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_DCIM" target="_blank" rel="external">DIRECTORY_DCIM</a></code>.  May not be null.            Returns<ul> <li>Returns the File path for the directory.  Note that this  directory may not yet exist, so you must make sure it exists before  using it such as with <code><a href="http://androidappdocs.appspot.com/reference/java/io/File.html#mkdirs%28%29" target="_blank" rel="external">File.mkdirs()</a></code>.</li></ul><br><br>         public                              abstract                    <a href="http://androidappdocs.appspot.com/reference/java/io/File.html" target="_blank" rel="external">File</a>              getExternalFilesDir       (<a href="http://androidappdocs.appspot.com/reference/java/lang/String.html" target="_blank" rel="external">String</a> type)Since: <a href="http://androidappdocs.appspot.com/guide/appendix/api-levels.html#level8" target="_blank" rel="external">API Level 8</a><p>Returns the absolute path to the directory on the external filesystem  (that is somewhere on <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#getExternalStorageDirectory%28%29" target="_blank" rel="external">Environment.getExternalStorageDirectory()</a></code>) where the application can  place persistent files it owns.  These files are private to the  applications, and not typically visible to the user as media.</p><p>This is like <code><a href="http://androidappdocs.appspot.com/reference/android/content/Context.html#getFilesDir%28%29" target="_blank" rel="external">getFilesDir()</a></code> in that these  files will be deleted when the application is uninstalled, however there  are some important differences:</p><ul> <li>External files are not always available: they will disappear if the  user mounts the external storage on a computer or removes it.  See the  APIs on <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html" target="_blank" rel="external">Environment</a></code> for information in the storage state.</li> <li>There is no security enforced with these files.  All applications  can read and write files placed here.</li></ul><p>Here is an example of typical code to manipulate a file in  an application’s private storage:</p>void createExternalStoragePrivateFile() {<br>&#160; &#160; // Create a path where we will place our private file on external<br>&#160; &#160; // storage.<br>&#160; &#160; File file = new File(getExternalFilesDir(null), &quot;DemoFile.jpg&quot;);<br><br>&#160; &#160; try {<br>&#160; &#160; &#160; &#160; // Very simple code to copy a picture from the application’s<br>&#160; &#160; &#160; &#160; // resource into the external file. &#160;Note that this code does<br>&#160; &#160; &#160; &#160; // no error checking, and assumes the picture is small (does not<br>&#160; &#160; &#160; &#160; // try to copy it in chunks). &#160;Note that if external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted this will silently fail.<br>&#160; &#160; &#160; &#160; InputStream is = getResources().openRawResource(R.drawable.balloons);<br>&#160; &#160; &#160; &#160; OutputStream os = new FileOutputStream(file);<br>&#160; &#160; &#160; &#160; byte[] data = new byte[is.available()];<br>&#160; &#160; &#160; &#160; is.read(data);<br>&#160; &#160; &#160; &#160; os.write(data);<br>&#160; &#160; &#160; &#160; is.close();<br>&#160; &#160; &#160; &#160; os.close();<br>&#160; &#160; } catch (IOException e) {<br>&#160; &#160; &#160; &#160; // Unable to create file, likely because external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted.<br>&#160; &#160; &#160; &#160; Log.w(&quot;ExternalStorage&quot;, &quot;Error writing &quot; + file, e);<br>&#160; &#160; }<br>}<br><br>void deleteExternalStoragePrivateFile() {<br>&#160; &#160; // Get path for the file on external storage. &#160;If external<br>&#160; &#160; // storage is not currently mounted this will fail.<br>&#160; &#160; File file = new File(getExternalFilesDir(null), &quot;DemoFile.jpg&quot;);<br>&#160; &#160; if (file != null) {<br>&#160; &#160; &#160; &#160; file.delete();<br>&#160; &#160; }<br>}<br><br>boolean hasExternalStoragePrivateFile() {<br>&#160; &#160; // Get path for the file on external storage. &#160;If external<br>&#160; &#160; // storage is not currently mounted this will fail.<br>&#160; &#160; File file = new File(getExternalFilesDir(null), &quot;DemoFile.jpg&quot;);<br>&#160; &#160; if (file != null) {<br>&#160; &#160; &#160; &#160; return file.exists();<br>&#160; &#160; }<br>&#160; &#160; return false;<br>}<p>If you supply a non-null <var>type</var> to this function, the returned  file will be a path to a sub-directory of the given type.  Though these files  are not automatically scanned by the media scanner, you can explicitly  add them to the media database with  <code><a href="http://androidappdocs.appspot.com/reference/android/media/MediaScannerConnection.html#scanFile%28android.content.Context,%20java.lang.5B%5D,%20java.lang.5B%5D,%20android.media.MediaScannerConnection.OnScanCompletedListener%29" target="_blank" rel="external">MediaScannerConnection.scanFile</a></code>.  Note that this is not the same as  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#getExternalStoragePublicDirectory%28java.lang.29" target="_blank" rel="external">Environment.getExternalStoragePublicDirectory()</a></code>, which provides  directories of media shared by all applications.  The  directories returned here are  owned by the application, and their contents will be removed when the  application is uninstalled.  Unlike  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#getExternalStoragePublicDirectory%28java.lang.29" target="_blank" rel="external">Environment.getExternalStoragePublicDirectory()</a></code>, the directory  returned here will be automatically created for you.</p><p>Here is an example of typical code to manipulate a picture in  an application’s private storage and add it to the media database:</p>void createExternalStoragePrivatePicture() {<br>&#160; &#160; // Create a path where we will place our picture in our own private<br>&#160; &#160; // pictures directory. &#160;Note that we don’t really need to place a<br>&#160; &#160; // picture in DIRECTORY_PICTURES, since the media scanner will see<br>&#160; &#160; // all media in these directories; this may be useful with other<br>&#160; &#160; // media types such as DIRECTORY_MUSIC however to help it classify<br>&#160; &#160; // your media for display to the user.<br>&#160; &#160; File path = getExternalFilesDir(Environment.DIRECTORY_PICTURES);<br>&#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br><br>&#160; &#160; try {<br>&#160; &#160; &#160; &#160; // Very simple code to copy a picture from the application’s<br>&#160; &#160; &#160; &#160; // resource into the external file. &#160;Note that this code does<br>&#160; &#160; &#160; &#160; // no error checking, and assumes the picture is small (does not<br>&#160; &#160; &#160; &#160; // try to copy it in chunks). &#160;Note that if external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted this will silently fail.<br>&#160; &#160; &#160; &#160; InputStream is = getResources().openRawResource(R.drawable.balloons);<br>&#160; &#160; &#160; &#160; OutputStream os = new FileOutputStream(file);<br>&#160; &#160; &#160; &#160; byte[] data = new byte[is.available()];<br>&#160; &#160; &#160; &#160; is.read(data);<br>&#160; &#160; &#160; &#160; os.write(data);<br>&#160; &#160; &#160; &#160; is.close();<br>&#160; &#160; &#160; &#160; os.close();<br><br>&#160; &#160; &#160; &#160; // Tell the media scanner about the new file so that it is<br>&#160; &#160; &#160; &#160; // immediately available to the user.<br>&#160; &#160; &#160; &#160; MediaScannerConnection.scanFile(this,<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new String[] { file.toString() }, null,<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; new MediaScannerConnection.OnScanCompletedListener() {<br>&#160; &#160; &#160; &#160; &#160; &#160; public void onScanCompleted(String path, Uri uri) {<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Log.i(&quot;ExternalStorage&quot;, &quot;Scanned &quot; + path + &quot;:&quot;);<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Log.i(&quot;ExternalStorage&quot;, &quot;-&gt; uri=&quot; + uri);<br>&#160; &#160; &#160; &#160; &#160; &#160; }<br>&#160; &#160; &#160; &#160; });<br>&#160; &#160; } catch (IOException e) {<br>&#160; &#160; &#160; &#160; // Unable to create file, likely because external storage is<br>&#160; &#160; &#160; &#160; // not currently mounted.<br>&#160; &#160; &#160; &#160; Log.w(&quot;ExternalStorage&quot;, &quot;Error writing &quot; + file, e);<br>&#160; &#160; }<br>}<br><br>void deleteExternalStoragePrivatePicture() {<br>&#160; &#160; // Create a path where we will place our picture in the user’s<br>&#160; &#160; // public pictures directory and delete the file. &#160;If external<br>&#160; &#160; // storage is not currently mounted this will fail.<br>&#160; &#160; File path = getExternalFilesDir(Environment.DIRECTORY_PICTURES);<br>&#160; &#160; if (path != null) {<br>&#160; &#160; &#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br>&#160; &#160; &#160; &#160; file.delete();<br>&#160; &#160; }<br>}<br><br>boolean hasExternalStoragePrivatePicture() {<br>&#160; &#160; // Create a path where we will place our picture in the user’s<br>&#160; &#160; // public pictures directory and check if the file exists. &#160;If<br>&#160; &#160; // external storage is not currently mounted this will think the<br>&#160; &#160; // picture doesn’t exist.<br>&#160; &#160; File path = getExternalFilesDir(Environment.DIRECTORY_PICTURES);<br>&#160; &#160; if (path != null) {<br>&#160; &#160; &#160; &#160; File file = new File(path, &quot;DemoPicture.jpg&quot;);<br>&#160; &#160; &#160; &#160; return file.exists();<br>&#160; &#160; }<br>&#160; &#160; return false;<br>}Parameters                        type            The type of files directory to return.  May be null for  the root of the files directory or one of  the following Environment constants for a subdirectory:  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_MUSIC" target="_blank" rel="external">DIRECTORY_MUSIC</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_PODCASTS" target="_blank" rel="external">DIRECTORY_PODCASTS</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_RINGTONES" target="_blank" rel="external">DIRECTORY_RINGTONES</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_ALARMS" target="_blank" rel="external">DIRECTORY_ALARMS</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_NOTIFICATIONS" target="_blank" rel="external">DIRECTORY_NOTIFICATIONS</a></code>,  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_PICTURES" target="_blank" rel="external">DIRECTORY_PICTURES</a></code>, or  <code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#DIRECTORY_MOVIES" target="_blank" rel="external">DIRECTORY_MOVIES</a></code>.            Returns<ul> <li>Returns the path of the directory holding application files  on external storage.  Returns null if external storage is not currently  mounted so it could not ensure the path exists; you will need to call  this method again when it is available.</li></ul>See Also<ul> <li><code><a href="http://androidappdocs.appspot.com/reference/android/content/Context.html#getFilesDir%28%29" target="_blank" rel="external">getFilesDir()</a></code></li> <li><code><a href="http://androidappdocs.appspot.com/reference/android/os/Environment.html#getExternalStoragePublicDirectory%28java.lang.29" target="_blank" rel="external">getExternalStoragePublicDirectory(String)</a></code></li></ul><br>getExternalCacheDir       () …&#160;&#160;&#160; Since: <a href="http://androidappdocs.appspot.com/guide/appendix/api-levels.html#level8" target="_blank" rel="external">API Level 8</a><br><br><br>External dir example:<br>/sdcard/Android/data/<code>com.example.android.app</code>/cache/<code><br></code>/sdcard/Android/data/<em>&lt;package_name&gt;</em>/files/<br>/sdcard/<code>Music/</code><br>/sdcard/Podcasts/<br>/sdcard/Ringtones/<br>/sdcard/Alarms/<br>/sdcard/Notifications/<br>/sdcard/Pictures/<br>/sdcard/Movies/<br>/sdcard/Download/Hiding your files from the Media Scanner<p>Include an empty file named <code>.nomedia</code> in your external files directory (note the dot prefix in the filename). This will prevent Android’s media scanner from reading your media files and including them in apps like Gallery or Music.</p><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/07/18/Data-Storage/" class="archive-article-date">
  	<time datetime="2010-07-18T09:53:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-07-18</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-通过Theme设置一些判断标志" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/07/15/通过Theme设置一些判断标志/">通过Theme设置一些判断标志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>有时候需要通过当前应用的Theme，来判断当前应用所处的环境。<br>可以通过在Theme中设置一些flag来实现。<br><br>1. 添加flag属性<br>在frameworks/base/core/res/res/values/attrs.xml的“&lt;declare-styleable name=&quot;Theme&quot;&gt;”中添加：<br></p><p>&lt;declare-styleable name=&quot;Theme&quot;&gt;<br><br>        &lt;!– flag to decide whether it is our theme –&gt;<br>        &lt;attr name=&quot;myflag&quot; format=&quot;boolean&quot; /&gt;</p><p>…<br>    &lt;/declare-styleable&gt;</p><br>2.自定义Theme<br>在所需的应用中添加一下判断语句即可：<br><p>&lt;style name=&quot;myTheme&quot; parent=&quot;android:Theme.Light.NoTitleBar&quot;&gt; <br>        &lt;item name=&quot;android:myflag&quot;&gt;true&lt;/item&gt;<br>        …<br>    &lt;/style&gt;</p><br>3.在应用中获得flag<br>在所需的应用（设置了myTheme）中添加以下判断语句即可：<br><p>TypedArray ta = context.obtainStyledAttributes(<br>        null, com.android.internal.R.styleable.Theme,<br>        com.android.internal.R.attr.myflag,<br>        0);<br>boolean flag = ta.getBoolean(<br>        com.android.internal.R.styleable.Theme_myflag, false);<br>mFlagTheme = flag ? 1 : 0;<br>ta.recycle();</p><br><br>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<br><br>函数说明：<br>         public                                                                obtainStyledAttributes       ( set, int[] attrs, int defStyleAttr, int defStyleRes)Since: <p>Return a StyledAttributes holding the attribute values in  <var>set</var>  that are listed in <var>attrs</var>.  In addition, if the given  AttributeSet specifies a style class (through the &quot;style&quot; attribute),  that style will be applied on top of the base attributes it defines.</p><p>Be sure to call StyledAttributes.recycle() when you are done with  the array.</p><p>When determining the final value of a particular attribute, there  are four inputs that come into play:</p><ol> <li>Any attribute values in the given AttributeSet.</li> <li>The style resource specified in the AttributeSet (named      &quot;style&quot;).</li> <li>The default style specified by <var>defStyleAttr</var> and      <var>defStyleRes</var></li> <li>The base values in this theme.</li></ol><p>Each of these inputs is considered in-order, with the first listed  taking precedence over the following ones.  In other words, if in the  AttributeSet you have supplied <code>&lt;Button  textColor=&quot;#ff000000&quot;&gt;</code>, then the button’s text will  <em>always</em> be black, regardless of what is specified in any of  the styles.</p>Parameters                        set            The base set of attribute values.  May be null.                            attrs            The desired attributes to be retrieved.                            defStyleAttr            An attribute in the current theme that contains a                      reference to a style resource that supplies                      defaults values for the StyledAttributes.  Can be                      0 to not look for defaults.                            defStyleRes            A resource identifier of a style resource that                     supplies default values for the StyledAttributes,                     used only if defStyleAttr is 0 or can not be found                     in the theme.  Can be 0 to not look for defaults.            Returns<ul> <li>Returns a TypedArray holding an array of the attribute values.  Be sure to call <code></code>  when done with it.</li></ul>See Also<ul> <li><code></code></li> <li><code></code></li> <li><code></code></li></ul><br><br><br>获取dimen值<br>int padding = 5 * mContext.getResources().getDimensionPixelSize(<br>com.android.internal.R.dimen.one_dip);<br><br><br><br><br> <br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/07/15/通过Theme设置一些判断标志/" class="archive-article-date">
  	<time datetime="2010-07-15T12:17:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-07-15</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-Surface-double-buffered" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/07/12/Android-Surface-double-buffered/">Android Surface (double buffered)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="http://blog.chinaunix.net/u2/85805/showart_1882368.html" target="_blank">http://blog.chinaunix.net/u2/85805/showart_1882368.html<br></a><br>&gt; Hi All, <br>&gt; I’ve been using SurfaceView and Surface for one of my graphics <br>&gt; project. <br>&gt; The problem keep bothering me is that the content in Surface’s two <br>&gt; graphic buffers does not synchronized so that when the &quot;lockCanvas- <br>&gt; drawCanvas-unlockCanvas&quot; cycle is running, it shows different content <br>&gt; and generate screen flicker. <br><br>Here is some information on how the Android graphics system works: <br></p><p>In Android, every window is implemented with an underlaying Surface <br>object. A Surface is an object that gets composited onto the <br>framebuffer by SurfaceFlinger, the sytem-wide screen composer. <br>Each Surface is double-buffered, it has a back buffer which is where <br>drawing takes place and a front buffer which is used for composition.</p><p>When &quot;unlockCanvas()&quot; is called, the back buffer is &quot;posted&quot;, which <br>means it’s being displayed and &#160;becomes available again.</p><p>However, the <em>implementation</em> of this mechanism is done by swapping <br>the front and back buffers. The back buffer becomes the front buffer <br>and vice-versa.</p><p>This mechanism ensures that there is a minimal amount of buffer <br>copying (a post operation doesn’t move any pixels around) and that <br>there is always a buffer for SurfaceFlinger to use for composition. <br>This last feature is very important because it ensures that the screen <br>never flickers and never shows any artifacts <em>and</em> that <br>SurfaceFlinger never has to wait for a Surface to be ready (its front <br>buffer is always ready by definition), this means that a badly written <br>application cannot slowdown or interfere with other application’s <br>windows.</p><p>As a side note, it is worth noting that the main screen itself (the <br>frame buffer) is double-buffered as well and uses the same posting <br>mechanism than any regular surface.</p><p>It should appear now that because of this posting mechanism, <br>incremental updates are not supported; and this is /the/ key point.</p><p>Back to your question now:</p><br>&gt; After doing a bit research, I got my conclusion (not sure if it is <br>&gt; correct though) here: <br>&gt; 1. There are two separate buffers of each Surface object. According to <br>&gt; SDK, they were called &quot;front buffer&quot; and &quot;back buffer&quot;. <br><p>&gt; 2. Android’s Surface does not behaves like regular &quot;double-buffer&quot; <br>&gt; system, which means: draw everything in back buffer and then flip the <br>&gt; back buffer into the front buffer. <br>&gt; What Android Surface does seems to be: draw in buffer A and flip it on <br>&gt; the screen, then in next cycle, draw buffer B and flip it on the <br>&gt; screen. As the result, the content visible on the screen comes from <br>&gt; buffer A, B, A, B, A, …. I’m using buffer &quot;A&quot; and &quot;B&quot; here instead <br>&gt; of &quot;front&quot; and &quot;back&quot; because I think they have equal role in <br>&gt; rendering cycle.</p><p>&gt; 3. The Surface buffer’s alternate work style causes problem when I’m <br>&gt; doing partial update (repaint only a portion of the Surface) for the <br>&gt; performance purpose. Because one &quot;lockCanvas-drawCanvas-unlockCanvas&quot; <br>&gt; cycle only update one buffer, the other one remains untouched, then <br>&gt; when next &quot;lockCanvas-drawCanvas-unlockCanvas&quot; comes, it shows you an <br>&gt; old content on the screen so that the flicker happens.</p>You are correct in your analysis. Something that the documentation <br> doesn’t emphasis clearly is that with such a mechanism, your <em>must</em> <br> draw every single pixel of the Surface’s back buffer each-time. In <br> essence, the back buffer is not preserved in post. This is a common <br> behavior &#160;of hardware-accelerated graphics systems. <br><p>There is fact an API on the underlaying Surface object that allows to <br>update only a portion of the back buffer (but even then, every pixel <br>of that portion need to be redrawn). It is implemented by copying back <br>the former back buffer (now in the front) to the new back buffer <br>(formerly in the front). Unfortunately, this API is not exposed to <br>SurfaceView at the moment. I’m hoping to have this feature added <br>eventually.</p><br>&gt; 4. My work around (works but with tremendous performance penalty) <br>&gt; When I’m doing partial Surface update, I do the following thing in <br>&gt; each rendering cycle: <br><br>The best solution available right now to solve this problem, is to do <br> all of your rendering into your own bitmap and simply copy it into the <br> back buffer: <br><p>- create a bitmap <br>- attach a canvas to it <br>- do the rendering into that canvas <br>- lockCanvas <br>- draw your bitmap into the backbuffer <br>- unlockAndPost</p><p>Note that this method involves an extra copy of the whole buffer size, <br>but it is in fact not slower than what it would have been if the <br>posting mechanism worked as you expected/suggested.</p><br>&gt; 5. In order to improve my solution a bit, I try to use <br>&gt; &quot;s.unlockCanvas(b);&quot; instead of &quot;s.unlockCanvasAndPost(b);&quot; because I <br>&gt; really do not need to make the second buffer flipping, I just need to <br>&gt; synchronize its content. However, unlockCanvas() generates a &quot;Illegal <br>&gt; argument&quot; exception. I can not figure out the reason. <br><br>I will investigate the error you are reporting. However, this solution <br> would not have worked because unlockCanvas() is essentially a no-op, <br> it doesn’t post the back buffer, which means it won’t make it visible. <br> It is only intended to be used in very special situations. <br><br>&gt; I have noticed someone has met the similar SurfaceView problem, see <br>&gt; the following topic:<a href="http://groups.google.com/group/android-developers/browse_thread/threa" target="_blank" rel="external">http://groups.google.com/group/android-developers/browse_thread/threa</a>… <br>&gt; I’m not sure if someone has any better solution than mine? <br>&gt; Is there a way to notify Surface that I would like to use a fixed <br>&gt; buffer as front buffer? <br><br>There is no way to do that at the moment, but we might add this <br> functionality eventually. Note that in that case, your Surface will <br> suffer from tearing, so it won’t be suited for Surfaces that do a lot <br> of animations <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/07/12/Android-Surface-double-buffered/" class="archive-article-date">
  	<time datetime="2010-07-12T15:24:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-07-12</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/19/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/21/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>