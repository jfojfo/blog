<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/22/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-豌豆荚" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/06/13/豌豆荚/">豌豆荚</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 发现一个好用的Android手机客户端, <br> 豌豆荚手机精灵：能够备份通讯录、安装应用、下载视频、音乐并自动传到手机,<br><br><a href="http://wandou.im/9" target="_blank" rel="external">http://wandou.im/9</a><br><br><br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/06/13/豌豆荚/" class="archive-article-date">
  	<time datetime="2010-06-13T04:31:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-06-13</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-CTS-Compatibility-Test-Suite-introduction" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/06/02/Android-CTS-Compatibility-Test-Suite-introduction/">Android CTS (Compatibility Test Suite) introduction</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><a target="_blank" href="http://i-miss-erin.blogspot.com/2010/04/android-cts-compatibility-test-suite.html">http://i-miss-erin.blogspot.com/2010/04/android-cts-compatibility-test-suite.html</a><br><br>What is CTS?<br><br>Compatibility Test Suite is a command mode tool to run a series of test cases in Android. They published all  from Eclair branch on January 2010.<br><br>git repository <br><a href="http://android.git.kernel.org/?p=platform/cts.git;a=summary" target="_blank" rel="external">http://android.git.kernel.org/?p=platform/cts.git;a=summary</a><br><br>How to run CTS in host machine?<br><br>$ cd $MYDROID<br>$  . build/envsetup.sh<br>$ make cts<br>(it would generate all test plans, packages, cases, result report format and then zip to a android-cts.zip file)<br><br><ul> <li>Package CTS: out/host/linux-x86/cts/android-cts.zip</li> <li>cts make file: mydroid/build/core/tasks/cts.mk</li> <li>run cts program: mydroid/out/host/linux-x86/bin/cts</li> <li>test plans: mydroid/out/host/linux-x86/cts/android-cts/repository/plans</li> <li>test packages: mydroid/out/host/linux-x86/cts/android-cts/repository/testcases</li> <li>test results: mydroid/out/host/linux-x86/cts/android-cts/repository/results</li> <li>CTS program settings value: mydroid/cts/tools/utils/host_config.xml</li></ul><br><br>run cts<br>$ cd $mydroid/out/host/linux-x86/bin/<br>$ ./cts<br>Screen would like this: <br><br>erin@midnight:~/eclair/mydroid/out/host/linux-x86/bin$ ./cts<br>Android CTS version 2.1_r1<br>cts_host &gt; help<br>Usage: command options<br>Avaiable commands and options:<br>Host:<br>help: show this message<br>exit: exit cts command line<br>Plan:<br>ls –plan: list available plans<br>ls –plan plan_name: list contents of the plan with specified name<br>add –plan plan_name: add a new plan with specified name<br>add –derivedplan plan_name -s/–session session_id -r/–result result_type: derive a plan from the given session<br>rm –plan plan_name/all: remove a plan or all plans from repository<br>start –plan test_plan_name: run a test plan<br>start –plan test_plan_name -d/–device device_ID: run a test plan using the specified device<br>start –plan test_plan_name -t/–test test_name: run a specific test<br>start –plan test_plan_name -p/–package java_package_name: run a specific java package<br>start –plan test_plan_name -t/–test test_name -d/–device device_ID: run a specific test using the specified device<br>start –plan test_plan_name -p/–package java_package_name -d/–device device_ID: run a specific java package using the specified device<br>Package:<br>ls -p/–package: list available packages<br>ls -p/–package package_name: list contents of the package with specified name<br>add -p/–package root: add packages from root to repository<br>rm -p/–package package_name/all: remove a package or all packages from repository<br>Result:<br>ls -r/–result: list all result of sessions<br>ls -r/–result -s/–session session_id: list detail case result of a specified session<br>ls -r/–result [pass/fail/notExecuted/timeout] -s/–session session_id: list detail cases of a specified session by the specified result.<br>History:<br>history/h: list all commands in command history<br>history/h count: list the latest count records in command history<br>history/h -e num: run the command designated by ‘num’ in command history<br>Device:<br>ls -d/–device: list available devices<br><br><a href="http://1.bp.blogspot.com/_fB3UGiuVTOI/S9Vk0te3oPI/AAAAAAAAF_Q/BtbStNDCH-A/s1600/cts.jpg" target="_blank" rel="external"><img src="http://img.pickbox.me/wp-content/uploads/pic/2f99b1de312fd564cdbf1a1e.jpg" small="0" class="blogimg"><br></a><br><br>How to add test plan, test packages to CTS?<br><br><ol> <li>Add test package name to cts.mk, it would generate apk file when we build cts.</li> <li>Add all source folder (includes src java files, Android.mk and its Manifest file) to mydroid/cts/tests/tests</li> <li>If you’d like to create a test plan for this test package. Modify this python script: mydroid/cts/tools/utils/buildCts.py</li></ol><br>Adjust CTS program settings?<br><br>Modify $mydroid/cts/tools/utils/host_config.xml<br><ul> <li>Number of tests executed between reboots. A value &lt;= 0 disables reboots.  (maxTestCount)</li> <li>Max size [tests] for a package to be run in batch mode. (maxTestInBatchMode)    </li> <li>Max time [ms] between test status updates. (testStatusTimeoutMs)    </li> <li>Max time [ms] from start of package in batch mode and the first test status update. (batchStartTimeoutMs)    </li> <li>Max time [ms] from start of test in individual mode to the first test status update. (individualStartTimeoutMs)    </li> <li>Timeout [ms] for the signature check. (signatureTestTimeoutMs)    </li> <li>Timeout [ms] for package installations. (packageInstallTimeoutMs)    </li> <li>Time to wait [ms] after a package installation or removal. (postInstallWaitMs)  </li></ul>Write your own testing package?<br><br>If you would like to write your own testing package, you may reference the<a href="http://www.netmite.com/android/mydroid/development/pdk/docs/instrumentation_framework.html" target="_blank" rel="external"> Instrumentation Testing document</a> from Android porting guide. Also, you could reference the source code from few Android application, like Browser, Messages, Gallery, Email, Camera, Calculator….etc. You can build its test apk file and upload it to device.<br><br>How to write test cases?<br>Each instrumentation test case is similar to an Android application with the distinction that it starts another application. For example, have a look in the $MYDROID/packages/apps/Music directory.<br><ul> <li>There should be a Makefile and an Android Manifest file</li> <li>Tests are located in $MYDROID/packages/apps/Music/tests.</li> <li>The Instrumentation Test Runner is located at packages/apps/Music/tests/src/com/android/music/MusicPlayerFunctionalTestRunner.java.</li></ul><br>Build package apk file<br><br>erin@midnight:~/eclair/mydroid/packages/apps/Music/tests$ mm<br>Install: out/target/product/generic/data/app/MusicTests.apk<br><br>Install it to the device<br>erin@midnight:~/eclair/mydroid/packages/apps/Music/tests$ adb install ../../../../out/target/product/generic/data/app/MusicTests.apk<br><br>How to run test cases in device?<br><br>Running Tests<br><br>erin@midnight:~/$ adb shell pm list instrumentation<br>instrumentation:com.android.music.tests/.MusicPlayerStressTestRunner (target=com.android.music)<br>instrumentation:com.android.music.tests/.MusicPlayerFunctionalTestRunner (target=com.android.music)<br>instrumentation:com.android.music.tests/.MusicPlayerLaunchPerformance (target=com.android.music)<br><br>The am command is a command-line interface to the ActivityManager. ‘am’ is used to start and instrument activities using the adb shell command, as shown in the snippet below:<br><br><br>&gt; adb shell am<br>usage: am [start|instrument]<br>      am start [-a &lt;ACTION&gt;] [-d &lt;DATA_URI&gt;] [-t &lt;MIME_TYPE&gt;]<br>               [-c &lt;CATEGORY&gt; [-c &lt;CATEGORY&gt;] …]<br>               [-e &lt;EXTRA_KEY&gt; &lt;EXTRA_VALUE&gt; [-e &lt;EXTRA_KEY&gt; &lt;EXTRA_VALUE&gt; …]<br>               [-n &lt;COMPONENT&gt;] [-D] [&lt;URI&gt;]<br>      am instrument [-e &lt;ARG_NAME&gt; &lt;ARG_VALUE&gt;] [-p &lt;PROF_FILE&gt;]<br>               [-w] &lt;COMPONENT&gt;<br><br>For example, to start the Contacts application you can use<br>&gt; adb shell am start -n com.google.android.contacts/.ContactsActivity<br><br>Eg. verify Music player launcher performance<br><br>erin@midnight:~/$ adb shell am instrument -w -r com.android.music.tests/.MusicPlayerLaunchPerformance<br>Eg. verify Music player stress test<br><br>erin@midnight:~/$ adb shell am instrument -w -r com.android.music.tests/.MusicPlayerStressTestRunner<br>Here is a <a href="http://www.youtube.com/watch?v=qRdGOouAg_c" target="_blank" rel="external">video</a> about running a cts test case by Android emulator! </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/06/02/Android-CTS-Compatibility-Test-Suite-introduction/" class="archive-article-date">
  	<time datetime="2010-06-02T13:10:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-06-02</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-常用目录结构" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/06/02/Android-常用目录结构/">Android 常用目录结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>frameworks/base/core/java/android/{os, view, widget, preference …}<br><br>frameworks/base/core/java/android/widget/<br></p><p>ImageView.java, TextView.java, Button.java, ListView.java, ListAdapter.java, <br>SeekBar.java, CursorAdapter.java, Toast.java, FrameLayout.java, LinearLayout.java …</p><p> </p><br>frameworks/base/core/java/android/app/<br><p>Activity.java, Service.java, Dialog.java, AlertDialog.java, ProgressDialog.java, ListActivity.java, <br>Notification.java, NotificationManager.java, PendingIntent.java</p><br>frameworks/base/core/java/android/view/<br><p>View.java, ViewGroup.java, LayoutInflater.java, Menu.java, SurfaceView.java, SurfaceHolder.java    for (cur = 0; cur &lt; 状态数; cur++) {<br>Surface.java, Window.java, WindowManager.java, WindowManagerPolicy.java, WindowManagerImpl.java</p><br>frameworks/base/core/java/android/provider/<br><p>Setting.java, MediaStore.java(MediaStore.Audio.AudioColumns, MediaStore.Video …)</p><br>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<br><br>frameworks/base/services/java/com/android/server/<br>MountService.java<br>PowerManagerService.java<br>PackageManagerService.java<br>WindowManagerService.java<br>…<br><br><br><br>frameworks/base/media/{jni, libmedia, java …}<br><br>frameworks/base/media/java/android/media/<br>MediaScanner.java<br>MediaScannerClient.java<br>MediaPlayer.java<br>MediaScannerConnection.java<br>MediaMetadataRetriever.java<br>MediaRecorder.java<br>AudioManager.java<br>AudioService.java<br>ToneGenerator.java<br>…<br><br>frameworks/base/media/jni/<br>android_media_MediaScanner.cpp<br>android_media_MediaMetadataRetriever.cpp<br>…<br><br>frameworks/base/media/libmedia/<br>mediametadataretriever.cpp<br>IMediaPlayerService.cpp<br>ToneGenerator.cpp<br>…<br><br><br><br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/06/02/Android-常用目录结构/" class="archive-article-date">
  	<time datetime="2010-06-02T12:55:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-06-02</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-改变Android系统默认铃声" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/06/02/改变Android系统默认铃声/">改变Android系统默认铃声</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>修改系统notification, ringtone, alarm：<br>在build/target/product/core.mk中添加<br>PRODUCT_PROPERTY_OVERRIDES :=<br>ro.config.alarm_alert=my_alarm.wav<br>ro.config.ringtone=my_ringtone.wav<br>ro.config.notification_sound=my_notification.wav<br>注意：alarm.wav必须位于/system/media/audio/alarms/目录下，<br>相应的ringtone.wav、notification.wav必须位于ringtones、notifications目录下。<br>（参考frameworks/base/data/sounds/AudioPackage2.mk）</p>
<p>PRODUCT_PROPERTY_OVERRIDES的设置，最终会在编译生成的out/target/product/generic/system/build.prop中添加相应属性：<br>ro.config.alarm_alert=my_alarm.wav<br>ro.config.ringtone=my_ringtone.wav<br>ro.config.notification_sound=my_notification.wav</p>
<p>frameworks/base/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java:onCreate() &gt; loadSettings() &gt; loadSystemSettings()<br>设置了很多初始默认设置。</p>
<p>对于ro.config.ringtone，是在MediaScanner.java中设置的：<br>frameworks/base/media/java/android/media/MediaScanner.java<br>setDefaultRingtoneFileNames(),<br>endFile():<br>setSettingIfNotSet(Settings.System.NOTIFICATION_SOUND, tableUri, rowId);</p>
<p>frameworks/base/core/java/android/os/SystemProperties.java<br>frameworks/base/core/jni/android_os_SystemProperties.cpp</p>
<p>providers在何处被调用的？<br><a href="http://blog.pickbox.me/archives/415" target="_blank">SystemServer启动时</a><br>frameworks/base/services/java/com/android/server/SystemServer.java: run()<br>其中调用ActivityManagerService.installSystemProviders()，<br>最终会调用到frameworks/base/packages/SettingsProvider/src/com/android/providers/settings/下<br>的各个content providers的onCreate()函数，初始化数据库内容</p>
<p>SD卡mount和umount时的声音：<br>对应ACTION_MEDIA_MOUNTED和ACTION_MEDIA_UNMOUNTED<br>MountService.java中的<br>notifyMediaMounted()会调用setMediaStorageNotification()向NotificationManager发通知，<br>其中设置了通知时的铃声为Notification.DEFAULT_SOUND，即系统默认铃声，<br>可以设置为自定义铃声：<br>mMediaStorageNotification.sound = Uri.parse(“file:///sdcard/notification/ringer.mp3”);</p>
<p>然后NotificationManager.java的notify()，调用NotificationManagerService的<br>enqueueNotificationWithTag()向队列中加新的notification</p>
<p>对应文件为：<br>frameworks/base/services/java/com/android/server/MountService.java<br>frameworks/base/core/java/android/app/NotificationManager.java<br>frameworks/base/services/java/com/android/server/NotificationManagerService.java</p>
<p>对于其他ACTION，如ACTION_POWER_CONNECTED、ACTION_POWER_DISCONNECTED，方法应当类似。</p>
<p>Dialer数字键盘按键声：<br>ToneGenerator.java中定义了一系列声音，Dialer拨号数字键盘使用的就是这里定义的声音。<br>(frameworks/base/media/java/android/media/ToneGenerator.java)<br>在frameworks/base/media/libmedia/ToneGenerator.cpp中，定义了数字键盘的发声参数，包括频率等。</p>
<p>按音量键（VolumeUp,VolumeDown）的声音：<br>frameworks/base/core/java/android/view/VolumePanel.java<br>onPlaySound()函数中调用ToneGenerator的startTone()播放，和Dialer的数字键盘的实现一样。</p>
<p>Settings &gt; 声音和显示设置 &gt; 调节ringtone/media音量：<br>frameworks/base/core/java/android/preference/VolumePreference.java<br>在initSeekBar()中会根据StreamType选择调节音量时播放的音频文件，为下列三者之一：<br>Settings.System.DEFAULT_RINGTONE_URI<br>Settings.System.DEFAULT_NOTIFICATION_URI<br>Settings.System.DEFAULT_ALARM_ALERT_URI<br>其中Settings在frameworks/base/core/java/android/provider/Setting.java</p>
<p>QWERT键盘按键声：<br>frameworks/base/media/java/android/media/AudioService.java<br>修改 SOUND_EFFECT_FILES 可自定义QWERT键盘点击时的声音<br>private static final String SOUND_EFFECTS_PATH = “/media/audio/ui/“;<br>private static final String[] SOUND_EFFECT_FILES = new String[] {<br>“Effect_Tick.ogg”,<br>“KeypressStandard.ogg”,<br>“KeypressSpacebar.ogg”,<br>“KeypressDelete.ogg”,<br>“KeypressReturn.ogg”<br>};<br>注意：音频文件必须在/media/audio/ui/目录之下。</p>
<p>系统电量低时的通知：<br>frameworks/base/services/java/com/android/server/status/StatusBarPolicy.java<br>showLowBatteryWarning()</p>
<p><del>end</del></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/06/02/改变Android系统默认铃声/" class="archive-article-date">
  	<time datetime="2010-06-02T12:19:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-06-02</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-移植Google-Market" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/05/26/移植Google-Market/">移植Google Market</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br> <a href="http://blog.csdn.net/st50886160/archive/2010/02/01/5277982.aspx" target="_blank" rel="external">http://blog.csdn.net/st50886160/archive/2010/02/01/5277982.aspx</a><br><br><br> </p><p>移植Google Apps (Market;GTalk;Google Maps;GMail;Voice Search)的大致步骤如下：</p><p>&#160;</p><p>&#160;</p><p>1.&#160;&#160;通过ADB，从Google定制的手机下载相关的文件(jar/lib库，apk安装文件，xml权限文件等)；</p><p>Market;GTalk;GMail均需要验证Google帐户，Market需要GTalk服务。</p><p><a name="OLE_LINK4">&#160;</a></p><p>com.google.android.gtalkservice.jar&#160;&#160;&#160;&#160;（GTalk服务,market必需）</p><p><a name="OLE_LINK5"></a><a name="OLE_LINK1">com.google.android.maps.jar</a>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;（google map服务）</p><p><a name="OLE_LINK6">com.google.android.gtalkservice.xml</a>&#160;&#160;&#160;&#160;（Gtalk授权文件）</p><p><a name="OLE_LINK2">com.google.android.maps.xml&#160;</a>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;（google map&#160;授权文件）</p><p>Vending.apk&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;（google market&#160;程序）</p><p><a name="OLE_LINK3">SdkSetup.apk&#160;</a>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(进入界面程序，必需，安装后首页会出现屏幕已锁定，按MEUN解锁)</p><p><a name="OLE_LINK9">setupwizard.apk&#160;</a>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(设置向导程序，必需)</p><p>GoogleApps.apk&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;（google一系列应用所必需的）</p><p>&#160;</p><p>注：com.google.android.maps.jar&#160;，com.google.android.maps.xml&#160;对market而言不是必需，但最好一起装了。</p><p>&#160;</p><p>2.&#160;先将com.google.android.gtalkservice.jar，com.google.android.maps.jar&#160;&#160;放入framework&#160;内，</p><p>再将com.google.android.gtalkservice.xml&#160;，com.google.android.maps.xml&#160;放入&#160;etcpermissions&#160;内</p><p>然后adb&#160;push&#160;&#160;SdkSetup.apk&#160;，&#160;setupwizard.apk&#160;，<a name="OLE_LINK10">GoogleApps.apk</a>&#160;,&#160;<a name="OLE_LINK7">gtalkservice.apk</a>&#160;, Vending.apk&#160;&#160;</p><p>&#160;</p><p>&#160;</p><p>注：安装成功后，文件显示图片为1，2，3，4&#160;&#160;（Vending.apk, gtalkservice.apk,&#160;必须装在&#160;systemapp下面，&#160;装在<a name="OLE_LINK8">&#160;dataapp</a>下是没有用的，程序会一直报错无法打开,&#160;如果装在了dataapp下，那说明程序其实没装上去。）</p><p>注：如果market图标出现在界面上，点击出现“应用程序错误”，那说明缺文件或者APK不兼容，如果不报错，点击出现闪一下但什么也没有的情况，那说明缺setupwizard.apk</p><p>&#160;</p><p>参考文档：</p><p><a href="http://blog.csdn.net/netpirate/archive/2009/12/20/5037914.aspx" target="_blank" rel="external">http://blog.csdn.net/netpirate/archive/2009/12/20/5037914.aspx</a></p><p><a href="http://blog.csdn.net/linux_lyb/archive/2009/09/17/4564018.aspx" target="_blank" rel="external">http://blog.csdn.net/linux_lyb/archive/2009/09/17/4564018.aspx</a></p><p><a href="http://www.johandekoning.nl/index.php/2009/07/12/building-android-1-5-google-apps-and-audio-files/" target="_blank" rel="external">http://www.johandekoning.nl/index.php/2009/07/12/building-android-1-5-google-apps-and-audio-files/</a></p><p></p><p>&#160;</p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/05/26/移植Google-Market/" class="archive-article-date">
  	<time datetime="2010-05-26T12:02:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-05-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Java-I-O" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/05/12/Java-I-O/">Java I/O</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p></p><p>更多参考《Java in a nutshell》</p><p>～～</p><p>&nbsp;<a href="http://download.oracle.com/javase/6/docs/api/java/nio/%20/package-frame.html" target="_blank" rel="external">java.nio.charset</a>&nbsp;字符集包，<a href="http://download.oracle.com/javase/6/docs/api/java/nio/ /CharsetEncoder.html" target="_blank" rel="external">CharsetEncoder</a>和<a href="http://download.oracle.com/javase/6/docs/api/java/nio/ /CharsetDecoder.html" target="_blank" rel="external">CharsetDecoder</a>允许对编码和解码过程进行精细的控制</p><p></p><p></p>String input = &quot;你123好&quot;;<br>Charset charset = Charset.forName(&quot;ISO-8859-1&quot;);<br>CharsetEncoder encoder = charset.newEncoder();<br>encoder.onUnmappableCharacter(CodingErrorAction.IGNORE);<br>CharsetDecoder decoder = charset.newDecoder();<br>CharBuffer buffer = CharBuffer.allocate(32);<br>buffer.put(input);<br>buffer.flip();<br>try {<br>&nbsp;&nbsp;&nbsp; ByteBuffer byteBuffer = encoder.encode(buffer);<br>&nbsp;&nbsp;&nbsp; CharBuffer cbuf = decoder.decode(byteBuffer);<br>&nbsp;&nbsp;&nbsp; System.out.println(cbuf);&nbsp; //输出123<br>} catch (CharacterCodingException e) {<br>&nbsp;&nbsp;&nbsp; e.printStackTrace();<br>} &nbsp;<br>&nbsp;<p></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>Channel之间transfer数据</p><p>&nbsp;&nbsp;&nbsp; public static String readFile(File file) throws IOException {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileInputStream fis = new FileInputStream(file);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileChannel channel = fis.getChannel();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByteArrayOutputStream os = new ByteArrayOutputStream(0x10000);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WritableByteChannel wchannel = Channels.newChannel(os);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.transferTo(0, file.length(), wchannel);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.close();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wchannel.close();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return os.toString();<br>&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp; public static void writeFile(File file, final String content) throws IOException {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!file.exists())<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file.createNewFile();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileOutputStream fos = new FileOutputStream(file);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileChannel channel = fos.getChannel();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ByteArrayInputStream is = new ByteArrayInputStream(content.getBytes());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReadableByteChannel rchannel = Channels.newChannel(is);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.transferFrom(rchannel, 0,&nbsp;content.getBytes().length);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel.close();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rchannel.close();<br>&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;</p><p>&nbsp;</p><p>NIO &nbsp;ByteBuffer</p><p>将数据读入缓冲区之前，需要调用clear方法；将缓冲区中的数据输出之前，需要调用flip方法。</p><p></p>ByteBuffer buffer = ByteBuffer.allocate(32);<br>CharBuffer charBuffer = buffer.asCharBuffer();<br>String content = charBuffer.put(&quot;Hello &quot;).put(&quot;World&quot;).flip().toString();<br>System.out.println(content); &nbsp;<br><br><p>&nbsp;</p><p>&nbsp;</p><p></p><p>将Stream转换成byte[]</p>private byte[] saveStream(InputStream input) throws IOException {<br>&nbsp;&nbsp;&nbsp; ByteBuffer buffer = ByteBuffer.allocate(1024);<br>&nbsp;&nbsp;&nbsp; ReadableByteChannel readChannel = Channels.newChannel(input);<br>&nbsp;&nbsp;&nbsp; ByteArrayOutputStream output = new ByteArrayOutputStream(32 * 1024);<br>&nbsp;&nbsp;&nbsp; WritableByteChannel writeChannel = Channels.newChannel(output);<br>&nbsp;&nbsp;&nbsp; while ((readChannel.read(buffer)) &gt; 0 || buffer.position() != 0) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buffer.flip();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writeChannel.write(buffer);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; buffer.compact();<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; return output.toByteArray();<br><p>}&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>如果一个流支持标记的话（通过markSupported方法判断），就可以在流开始的地方通过mark方法添加一个标记，当完成一次对流的使用之后，通过reset方法就可以把流的读取位置重置到上次标记的位置，即流开始的地方。如此反复，就可以复用这个输入流。大部分输入流的实现是不支持标记的。可以通过BufferedInputStream进行包装来支持标记。</p><p></p>private InputStream prepareStream(InputStream ins) {<br>&nbsp;&nbsp;&nbsp; BufferedInputStream buffered = new BufferedInputStream(ins);<br>&nbsp;&nbsp;&nbsp; buffered.mark(Integer.MAX_VALUE);<br>&nbsp;&nbsp;&nbsp; return buffered;<br>}<br><br>private void resetStream(InputStream ins) throws IOException {<br>&nbsp;&nbsp;&nbsp; ins.reset();<br>&nbsp;&nbsp;&nbsp; ins.mark(Integer.MAX_VALUE);<br>}&nbsp;<br><p>&nbsp;</p><p></p><p>&nbsp;</p>Interrupt a thread while doing block I/O operation:<br>try {<br>    new InputStreamReader(<br>           Channels.newInputStream(<br>                   (new FileInputStream(FileDescriptor.in)).getChannel()))); <br>catch (…) {<br>}<br>以特定字符编码从文件中读取一行：<br><br>    File file = new File(&quot;test&quot;);<br>    FileInputStream is = new FileInputStream(file);<br>    BufferedReader reader = new BufferedReader(new InputStreamReader(is, &quot;gbk&quot;));<br>    String str;<br>    while((str = reader.readLine()) != null) {<br>         System.out.println(str);<br>    }<br>BufferedInputStream：<br><br>    File file = new File(&quot;moandroid.txt&quot;);<br>    InputStream is = new BufferedInputStream(new FileInputStream(file));<br>    long length = file.length();<br>    if(length&gt;Integer.MAX_VALUE)<br>    {<br>        System.out.println(“source file is too large”);<br>        return ;<br>    }<br>    byte[] bytes = new byte[(int)length];<br>    int offset = 0,numRead = 0;<br>    while( offset&lt;bytes.length &amp;&amp; (numRead = is.read(bytes,offset,bytes.length-offset))&gt;= 0)<br>        offset += numRead;<br>    if(offset&lt;bytes.length)<br>        throw new IOException(“Could not completely read file”+file.getName());<br>    is.close();<br><br>DataInputStream：<br><br>    File file = new File(&quot;moandroid.txt&quot;);<br>    is = new DataInputStream(new FileInputStream(file));<br>    int intData = is.readInt();<br>    boolean boolData = is.readBoolean();<br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/05/12/Java-I-O/" class="archive-article-date">
  	<time datetime="2010-05-12T08:33:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-05-12</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android-message-loop-for-an-thread" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/04/30/Android-message-loop-for-an-thread/">Android : message loop for an thread</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br>message loop for an  thread<br><br>This is a typical example of the implementation of a Looper thread,  using the separation of <code></code> and <code></code> to create an  initial Handler to communicate with the Looper.    <br><br>&#160; class LooperThread extends Thread {<br>&#160; &#160; &#160; public Handler mHandler;<br>&#160; &#160; &#160; <br>&#160; &#160; &#160; public void run() {<br>&#160; &#160; &#160; &#160; &#160; Looper.prepare();<br>&#160; &#160; &#160; &#160; &#160; <br>&#160; &#160; &#160; &#160; &#160; mHandler = new Handler() {<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; public void handleMessage(Message msg) {<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; // process incoming messages here<br>&#160; &#160; &#160; &#160; &#160; &#160; &#160; }<br>&#160; &#160; &#160; &#160; &#160; };<br>&#160; &#160; &#160; &#160; &#160; <br>&#160; &#160; &#160; &#160; &#160; Looper.loop();<br>&#160; &#160; &#160; }<br>&#160; }<br>——————————————————————————————<br>public class Looper {<br><br>    // sThreadLocal.get() will return null unless you’ve called prepare().<br>    private static final ThreadLocal sThreadLocal = new ThreadLocal();<br><br>    final MessageQueue mQueue;<br><br>    /<strong> Initialize the current thread as a looper.<br>     <em> This gives you a chance to create handlers that then reference<br>     </em> this looper, before actually starting the loop. Be sure to call<br>     <em> {@link #loop()} after calling this method, and end it by calling<br>     </em> {@link #quit()}.<br>     */<br>    public static final void prepare() {<br>        if (sThreadLocal.get() != null) {<br>            throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);<br>        }<br>        sThreadLocal.set(new Looper());<br>    }<br>    private Looper() {<br>        mQueue = new MessageQueue();<br>        mRun = true;<br>        mThread = Thread.currentThread();<br>    }<br>    public static final void loop() {<br>        Looper me = myLooper();<br>        MessageQueue queue = me.mQueue;<br>        while (true) {<br>            Message msg = queue.next(); // might block<br>            //if (!me.mRun) {<br>            //    break;<br>            //}<br>            if (msg != null) {<br>                if (msg.target == null) {<br>                    // No target is a magic identifier for the quit message.<br>                    return;<br>                }<br>                if (me.mLogging!= null) me.mLogging.println(<br>                        &quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot; + msg.target + &quot; &quot;<br>                        + msg.callback + &quot;: &quot; + msg.what<br>                        );<br>                msg.target.dispatchMessage(msg);      //msg.target鏄痗lass Handler绫诲瀷<br>                if (me.mLogging!= null) me.mLogging.println(<br>                        &quot;&lt;&lt;&lt;&lt;&lt; Finished to    &quot; + msg.target + &quot; &quot;<br>                        + msg.callback);<br>                msg.recycle();<br>            }<br>        }<br>    }<br>    /</strong><br>     <em> Return the Looper object associated with the current thread.  Returns<br>     </em> null if the calling thread is not associated with a Looper.<br>     */<br>    public static final Looper myLooper() {<br>        return (Looper)sThreadLocal.get();<br>    }<br><br>    ……<br>}<br><br><br><br>public class Handler {<br>    …<br>    public Handler() {<br>        …<br>        if (FIND_POTENTIAL_LEAKS) {<br>            final Class&lt;? extends Handler&gt; klass = getClass();<br>            if ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;<br>                    (klass.getModifiers() &amp; Modifier.STATIC) == 0) {<br>                Log.w(TAG, &quot;The following Handler class should be static or leaks might occur: &quot; +<br>                    klass.getCanonicalName());<br>            }<br>        }<br><br>        mLooper = Looper.myLooper();<br>        if (mLooper == null) {<br>            throw new RuntimeException(<br>                &quot;Can’t create handler inside thread that has not called Looper.prepare()&quot;);<br>        }<br>        mQueue = mLooper.mQueue;<br>        mCallback = null;<br>    }<br><br>    public interface Callback {<br>        public boolean handleMessage(Message msg);<br>    }<br><br>    public void handleMessage(Message msg) {<br>    }<br> <br>    public void dispatchMessage(Message msg) {<br>        if (msg.callback != null) {<br>            handleCallback(msg);<br>        } else {<br>            if (mCallback != null) {<br>                if (mCallback.handleMessage(msg)) {<br>                    return;<br>                }<br>            }<br>            handleMessage(msg);<br>        }<br>    }<br><br>    final MessageQueue mQueue;<br>    final Looper mLooper;<br>    final Callback mCallback;<br><br>}<br><br><br><br><br><br><del>end</del> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/04/30/Android-message-loop-for-an-thread/" class="archive-article-date">
  	<time datetime="2010-04-30T09:09:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-04-30</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-jni-Java下调用native-C函数（实现自己的JNI-OnLoad函数）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/04/21/jni-Java下调用native-C函数（实现自己的JNI-OnLoad函数）/">jni -- Java下调用native C函数（实现自己的JNI_OnLoad函数）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><br><strong>$ cd test_jni<br>$ cat com/jfo/check.java</strong><br>package com.jfo;<br>public class check {<br>&#160;&#160;&#160; public static native String hello();<br>static {<br>try {<br>System.loadLibrary(&quot;test&quot;);<br>} catch (UnsatisfiedLinkError ule) {<br>System.err.println(&quot;WARNING: Could not load library!&quot;);<br>}<br>}<br>public static void main(String[] args) {<br>String s = new check().hello();<br>System.out.println(s);<br>}<br>}<br><br><strong>$ javac com/jfo/check.java<br>$ javah -jni com.jfo.check&#160;&#160;&#160; // this will generate &quot;com_jfo_check.h&quot; header file.<br>$ ls</strong><br>com&#160; com_jfo_check.h&#160; jni<br><br>// 对com_jfo_check.h 修改，主要是对函数名字改回原来的名称，去除了package+classname前缀<br><strong>$ cat com_jfo_check.h</strong><br>/<em> DO NOT EDIT THIS FILE - it is machine generated </em>/<br>#include &lt;jni.h&gt;<br>/<em> Header for class com_jfo_check </em>/<br><br>#ifndef _Included_com_jfo_check<br>#define _Included_com_jfo_check<br>#ifdef <strong>cplusplus<br>extern &quot;C&quot; {<br>#endif<br>/<em><br></em> Class:&#160;&#160;&#160;&#160; com_jfo_check<br><em> Method:&#160;&#160;&#160; hello<br></em> Signature: ()Ljava/lang/String;<br><em>/<br>JNIEXPORT jstring JNICALL hello(JNIEnv </em>, jclass);<br><br>#ifdef </strong>cplusplus<br>}<br>#endif<br>#endif<br><br><br><strong>$ mv com_jfo_check.h&#160; jni/<br>$ cat jni/test.c<br></strong>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &quot;com_jfo_check.h&quot;<br><br>JNIEXPORT jstring JNICALL hello(JNIEnv <em>env, jclass clazz)<br>{<br>printf(&quot;hello in cpp.n&quot;);<br>return (</em>env)-&gt;NewStringUTF(env, &quot;hello world returned.&quot;);<br>}<br><br><strong>$ cat jni/jni_reg.c</strong><br>#include &lt;string.h&gt;<br>#include &lt;stdio.h&gt;<br>#include &lt;jni.h&gt;<br>#include &lt;assert.h&gt;<br>#include &quot;com_jfo_check.h&quot;<br><br>#define JNIREG_CLASS &quot;com/jfo/check&quot;<br><br>/<strong><br><em> Table of methods associated with a single class.<br></em>/<br>static JNINativeMethod gMethods[] = {<br>&#160;&#160;&#160; { &quot;hello&quot;, &quot;()Ljava/lang/String;&quot;, (void<em>)hello },<br>};<br><br>/</em><br><em> Register several native methods for one class.<br></em>/<br>static int registerNativeMethods(JNIEnv<em> env, const char</em> className,<br>&#160;&#160;&#160; &#160;&#160;&#160; JNINativeMethod<em> gMethods, int numMethods)<br>{<br>jclass clazz;<br><br>clazz = (</em>env)-&gt;FindClass(env, className);<br>if (clazz == NULL) {<br>return JNI_FALSE;<br>}<br>if ((<em>env)-&gt;RegisterNatives(env, clazz, gMethods, numMethods) &lt; 0) {<br>return JNI_FALSE;<br>}<br><br>return JNI_TRUE;<br>}<br><br><br>/</em><br><em> Register native methods for all classes we know about.<br></em>/<br>static int registerNatives(JNIEnv<em> env)<br>{<br>if (!registerNativeMethods(env,<br>JNIREG_CLASS,<br>gMethods, sizeof(gMethods) / sizeof(gMethods[0])))<br>return JNI_FALSE;<br><br>return JNI_TRUE;<br>}<br><br>/</em><br><em> Set some test stuff up.<br></em><br><em> Returns the JNI version on success, -1 on failure.<br></em>/<br>JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM<em> vm, void</em> reserved)<br>{<br>JNIEnv<em> env = NULL;<br>jint result = -1;<br><br>if ((</em>vm)-&gt;GetEnv(vm, (void</strong>) &amp;env, JNI_VERSION_1_4) != JNI_OK) {<br>return -1;<br>}<br>assert(env != NULL);<br><br>if (!registerNatives(env)) {<br>return -1;<br>}<br>/<em> success – return valid version number </em>/<br>result = JNI_VERSION_1_4;<br><br>return result;<br>}<br><br><strong>$ cd jni<br>$ gcc -I $JAVA_HOME/include -I $JAVA_HOME/include/linux -c test.c<br></strong><strong> $ gcc -I $JAVA_HOME/include -I $JAVA_HOME/include/linux -c jni_reg.c<br></strong><strong>$ gcc -nostdlib -Wl,-soname,libtest.so -Wl,-shared test.o jni_reg.o&#160; -o libtest.so<br></strong><br><strong>$ cd&#160; ../<br>$ java -Djava.library.path=jni com/jfo/check</strong><br>hello in cpp.<br>hello world returned.<br><br><br><br><br><br><br><del>end</del> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/04/21/jni-Java下调用native-C函数（实现自己的JNI-OnLoad函数）/" class="archive-article-date">
  	<time datetime="2010-04-21T09:35:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-04-21</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Makefile-include-derective" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/04/20/Makefile-include-derective/">Makefile : include derective</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <del>~~<br><br>Make的第一遍会收集所有需要make的目标，<br>当以下Makefile中include的文件不存在时，则直接跳过；<br>收集完目标后，进行make动作，更新目标，在更新过程中产生了被include的文件depend，<br>但此时depend的内容不会被放入make的目标，可以理解为第一遍收集已经完毕。<br>只有当再次运行make时，depend的内容才会起作用。<br><br><strong></strong><strong>$ touch a.c<br>$ touch a.h&#160;&#160;&#160; &#160; &#160;&#160; // now a.h is newer than a.c<br>$ ls<br></strong>a.c&#160; a.h&#160; Makefile<br><br>$ cat Makefile<br>all: dep<br>@echo ‘all:dep’<br><br>.PHONY : dep<br>dep : a.c<br>echo -e &quot;a.c:a.hnt @echo ttt&quot; &gt; depend<br><br>ifneq ($(wildcard depend),)<br>include depend<br>endif<br><br>$ make&#160; –debug<br>…<br>Reading makefiles…<br>Updating goal targets….<br>File <code>all&#39; does not exist.&lt;br /&gt;File</code>dep’ does not exist.<br>Must remake target <code>dep&#39;.&lt;br /&gt;echo -e &amp;quot;a.c:a.hnt @echo ttt&amp;quot; &amp;gt; depend&lt;br /&gt;Successfully remade target file</code>dep’.<br>Must remake target <code>all&#39;.&lt;br /&gt;all:dep&lt;br /&gt;Successfully remade target file</code>all’.<br><br>$ make<strong>&#160; –debug</strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // make second time<br><strong>Reading makefiles…<br>Updating goal targets….<br>File <code>all&#39; does not exist.&lt;br /&gt;File</code>dep’ does not exist.<br>Prerequisite <code>a.h&#39; is newer than target</code>a.c’.<br>Must remake target <code>a.c&#39;.&lt;br /&gt;ttt&lt;br /&gt;Successfully remade target file</code>a.c’.<br>Must remake target <code>dep&#39;.&lt;br /&gt;echo -e &amp;quot;a.c:a.hnt @echo ttt&amp;quot; &amp;gt; depend&lt;br /&gt;Successfully remade target file</code>dep’.<br>Must remake target <code>all&#39;.&lt;br /&gt;all:dep&lt;br /&gt;Successfully remade target file</code>all’.<br><br>$ cat depend<br>a.c:a.h<br>@echo ttt<br><br></strong><br><br><br></del>end~~ </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/04/20/Makefile-include-derective/" class="archive-article-date">
  	<time datetime="2010-04-20T14:32:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-04-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-jni-Java下调用native-C函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/04/20/jni-Java下调用native-C函数/">jni -- Java下调用native C函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><br><strong>$ cd test_jni<br>$ cat com/jfo/check.java</strong><br>package com.jfo;<br>public class check {<br>&#160;&#160;&#160; public native String hello();<br>static {<br>System.loadLibrary(&quot;test&quot;);<br>}<br>public static void main(String[] args) {<br>String s = new check().hello();<br>System.out.println(s);<br>}<br>}<br><br><strong>$ javac com/jfo/check.java<br>$ javah -jni com.jfo.check&#160;&#160;&#160; // this will generate &quot;com_jfo_check.h&quot; header file.<br>$ ls</strong><br>com&#160; com_jfo_check.h&#160; jni<br><br><strong>$ cat com_jfo_check.h</strong><br>/<em> DO NOT EDIT THIS FILE - it is machine generated </em>/<br>#include &lt;jni.h&gt;<br>/<em> Header for class com_jfo_check </em>/<br><br>#ifndef _Included_com_jfo_check<br>#define _Included_com_jfo_check<br>#ifdef <strong>cplusplus<br>extern &quot;C&quot; {<br>#endif<br>/<em><br></em> Class:&#160;&#160;&#160;&#160; com_jfo_check<br><em> Method:&#160;&#160;&#160; hello<br></em> Signature: ()Ljava/lang/String;<br><em>/<br>JNIEXPORT jstring JNICALL Java_com_jfo_check_hello<br>(JNIEnv </em>, jobject);<br><br>#ifdef </strong>cplusplus<br>}<br>#endif<br>#endif<br><br><strong>$ mv com_jfo_check.h&#160; jni/<br>$ cat jni/test.c<br></strong>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &quot;com_jfo_check.h&quot;<br><br>JNIEXPORT jstring JNICALL Java_com_jfo_check_hello(JNIEnv <em>env, jobject o)<br>{<br>printf(&quot;hello in cpp.n&quot;);<br>return (</em>env)-&gt;NewStringUTF(env, &quot;hello world returned.&quot;);<br>}<br><br><strong>$ cd jni<br>$ gcc -I $JAVA_HOME/include -I $JAVA_HOME/include/linux -c test.c<br>$ gcc -nostdlib -Wl,-soname,libtest.so -Wl,-shared test.o&#160; -o libtest.so<br></strong><br><strong>$ cd&#160; ../<br>$ java -Djava.library.path=jni com/jfo/check</strong><br>hello in cpp.<br>hello world returned.<br><br>这种方式要求：C函数名于Java中的package+classname一致，如Java_com_jfo_check_hello<br><br>为了保持函数名称的不变，如hello，可以用另一种方式调用native C函数，参见这里。<br><br><del>end</del> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/04/20/jni-Java下调用native-C函数/" class="archive-article-date">
  	<time datetime="2010-04-20T06:13:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-04-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/21/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/23/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>