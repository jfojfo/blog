<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/37/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-New-Words" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/16/New-Words/">New Words</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> New Words <br><br><br>=============================================<br>ditch [dit&#643;]<br>摆脱, 抛弃<br>She got bored with her boyfriend and ditched  him.<br>她对男友感到厌烦, 于是甩掉了他。<br><br>=============================================<br>prestigious [pre&#712;sti:d&#658;&#601;s, -&#712;st&#618;d&#658;&#601;s]a prestigious professor at a prestigious university. <br>享有声望的大学里的有名望的教授。<br><br>=============================================<br>elucidate [&#618;&#712;lu:s&#618;&#716;de&#618;t]<br>Please elucidate the reasons for your decision.<br>请把你作出决定的理由解释清楚<br><br>=============================================<br>erect [i&#712;rekt]<br>adj. 竖立的, 直立的, 挺立的<br>vt. 1 使直立; 竖起 2 〈正〉建立<br><br>They <a target="_blank" href="http://www.iciba.com/erected/">erected</a> a telephone pole .他们竖起一根电线杆子。<br><br>=============================================<br>ignite [iɡ&#712;nait] 点燃、引发<br>                        Petrol  ignites very easily.                                                 汽油很容易着火。            =============================================<br>gorgeous 绚丽的<br>sunflower 向日葵<br>twinkle 闪烁，闪耀<br><br>=============================================<br>tranquillity<br>n.f.  平静,安稳,安静,安宁; n. 平静<br>=============================================<br>assorted<br><em>[&#1241;’s&#594;:tid]<br>a. 各种各样的, 分类的<br>=============================================<br>laudable<br></em>[‘l&#594;:d&#1241;bl]<br>a. 值得赞赏的, 值得佩服的<br>========================================================================================================<br>carve out&#160;&#160;     <br>雕刻出… <br>The statue was carved out of marble. <br>这尊像是大理石雕成的。 <br>用辛勤的劳动创造出… <br>He carved out a name for himself in the engineering business. <br>在土木工程业方面, 他孜孜以求为自己赢得了声誉。 <br>========================================================================================================<br>seeing eye dog<br>导盲犬 <br>========================================================================================================<br>fluctuate&#160;&#160;       <br>[&#712;fl&#652;ktjueit]<br>vi. <br>波动, 涨落, 起伏 <br>The price of vegetables fluctuates seasonally. <br>蔬菜的价格随季节变动。 <br>========================================================================================================<br>wax and wane&#160;&#160;        <br>(月的)盈亏圆缺;〈喻〉盛衰 <br>========================================================================================================<br>We think that doing something that produces results immediately trumps doing something that doesn’t manifest anything instantaneously.<br>========================================================================================================<br>meditate on  <br>[&#712;mediteit]<br>v. <br>沉思 <br>========================================================================================================<br>minutiae&#160;&#160;           <br>[mai&#712;nju:&#643;ii:]<br>n. <br>微小的细节, 细枝末节 <br>========================================================================================================<br>take the plunge&#160;&#160;            <br>v. <br>冒险尝试 <br>========================================================================================================<br>on the side&#160;&#160;            <br>〈非正〉作为兼职〔副业〕 <br>He is a mechanic who buys and sells cars on the side. <br>他是一个兼营买卖汽车的技工。 <br>暗地里, 秘密地 <br>She’s married but she has a lover on the side. <br>她虽然已婚, 但暗地里还有一个情人。 <br>========================================================================================================<br>footwork&#160;&#160;            <br>[&#712;futw&#601;:k]<br>n. <br>步法,要跑腿的工作 <br>========================================================================================================<br>boil down to&#160;&#160;            <br>(使)煮浓成; 浓缩成 <br>A solution of sugar boils down to a syrup. <br>糖水煮浓而成糖浆。 <br>浓缩, 摘要 <br>The teacher asked students to boil the text down to a few sentences. <br>老师要学生们把课文浓缩成几句话。 <br>归结为… <br>It all boils down to one thing— human nature. <br>所有这些都可归结为一点——人的天性。 <br>========================================================================================================<br>driving force&#160;&#160;            <br>驱[传,主]动力 <br>========================================================================================================<br>rain cats and dogs&#160;&#160;             <br>下倾盆大雨 <br>========================================================================================================<br>commit to&#160;&#160;               <br>把…送交, 托付给… <br>I commit this evil book to the flames. <br>我把这本坏书付之一炬。 <br>对…作出承诺, 承担义务, 担负责任; 使(自己)致力于… <br>I must go. I have committed myself to the club tonight and the members are expecting me. <br>我得走了, 我已经答应今晚去俱乐部, 会员们正等着我呢。 <br>把…固定在, 保留在…之上〔之中〕 <br>The actor committed the part to memory. <br>那个演员把角色牢牢记住。 <br>========================================================================================================<br>grit one’s teeth&#160;&#160;               <br>咬紧牙关 <br>The young policeman gritted his teeth and walked slowly towards the armed criminal. <br>年轻警官强忍住怒火, 朝武装歹徒慢慢走过去。<br>========================================================================================================<br>engage in&#160;&#160;               <br>参加; 从事; 忙于 <br>I have no time to engage in the debate. <br>我没时间参加辩论。 <br>========================================================================================================<br>daunt<br>[d&#596;:nt]<br>vt. <br>使(某人)气馁, 威吓 <br>Danger did not daunt the hero. <br>危险并没有吓倒这位英雄。<br>========================================================================================================<br>vigilant<br>[&#712;vid&#658;il&#601;nt]<br>adj. <br>警惕的; 警戒的; 警觉的 <br>He has to learn how to remain vigilant through these long nights. <br>他得学会如何在这漫长的黑夜里保持警觉。 <br>========================================================================================================<br>crave<br>[kreiv]<br>vt. &amp; vi.<br>渴望, 热望<br><br>Many young children crave attention.<br><br>许多小孩子渴望得到关心。<br>vt.<br>恳求; 请求<br><br>May I crave your attention?<br><br>我可以请你注意一下吗？<br><br>========================================================================================================<br>fit in<br>有地方容纳<br><br>All of us couldn’t fit in there.<br><br>那里挤不下我们所有的人。<br>有时间从事(某事); 有时间接待(某人)<br><br>Dr. White says he can fit in only two more patients this morning.<br><br>怀特大夫说今天上午他只能看两个病人。<br>相处融洽, 合得来<br><br>Mary joined a painting group but didn’t seem to fit in, so she left.<br><br>玛丽参加了一个绘画组, 但是似乎和那些人合不来, 所以她又退了出来。<br>========================================================================================================<br>obsess<br>[&#601;b&#712;ses]<br>vt.<br>时刻困扰; 缠住<br><br>The fear of death obsessed him throughout his old life.<br><br>他晚年一直受着死亡恐惧的困扰。<br>========================================================================================================<br>haunt<br>[h&#596;:nt]<br>vt.<br>经常出没于<br><br>He haunted textile mills, and learned all he could.<br><br>他常到纺织厂去, 尽可能多学点东西。<br>缠绕, 萦绕<br><br>Memories of her childhood haunted her.<br><br>童年时代的记忆经常在她脑中萦绕。<br>n.<br>某人常去的地方<br><br>The area was a haunt of criminals.<br><br>这个地区是罪犯经常出没的地方。<br>========================================================================================================<br>whittle<br>[&#712;hwitl]<br>vt.<br><br>切, 削(木头); 使逐渐变小<br><br>He is whittling down the branch with a knife to make a handle for his hoe.<br><br>他在用刀削树枝做一把锄头柄。<br>He who trims himself to suit everyone will soon whittle himself away.<br>========================================================================================================<br>out of proportion<br><br>不相称; 不成比例<br><br>I like the general style of the building, but the chimneys are out of proportion—they’re too big.<br><br>我喜欢这栋房子的总构型, 可是烟囱太大, 不成比例。<br>========================================================================================================<br>screw up<br><br>拧紧<br><br>Can you screw up this handle for me?<br><br>你能帮我把这个把手拧紧吗?<br><br>扭歪(脸)<br><br>He screwed up his face at the nasty smell.<br><br>闻到这令人作呕的气味, 他皱眉蹙额。<br><br>〈非正〉把…搞糟<br><br>It was such a simple plan; how could you have screwed it up?<br><br>这是个很简单的计划, 你怎么会把它弄得一团糟呢?<br>========================================================================================================<br>flavor of the month：短暂的时髦<br>========================================================================================================<br>in perspective：正确地、适当地&#160;&#160;&#160;&#160;&#160;&#160;&#160;                 look at things in perspective<br>========================================================================================================<br>taint<br>[teint]<br>n.<br>变质或污染的迹象<br>丑陋或腐败的迹象<br>vt.<br>使变质; 使污染<br>败坏; 玷污; 损害(某人的)名誉<br><br>His political reputation is tainted by the matter.<br><br>这件事玷污了他的政治声誉。<br>========================================================================================================<br>anxious<br>[&#712;&#230;&#331;k&#643;&#601;s]<br>adj.<br>焦急的, 忧虑的, 担心的<br><br>anxiety<br>[&#230;n&#712;zai&#601;ti]<br>n.<br>焦虑, 担心, 不安<br><br>There’s a lot of anxiety among the staff about possible job losses.<br><br>工作人员都很忧虑, 担心可能失业。<br>========================================================================================================<br>spin<br>[spin]<br>vt. &amp; vi.<br><br>使…旋转<br><br>She got up and spun a little turn.<br><br>她站起来转了一小圈。<br>vt.<br><br>杜撰<br><br>The explorer spun many fantastic tales about his adventures in the primeval forests.<br><br>那探险家杜撰了许多他在原始森林里历险的离奇故事。<br>========================================================================================================<br>build on<br>在原有的建筑物上增建<br><br>He planned to build on a shed.<br><br>他打算加盖一间库房。<br>以…为基础<br><br>He drew the conclusion by building on his own investigation.<br><br>他根据自己的调查研究作出结论。<br>依赖, 一心指望<br><br>You can build on that man’s honesty.<br><br>你可以信赖那个人的诚实。<br>========================================================================================================<br>affirmation<br>[&#601;f&#601;:&#712;mei&#643;&#601;n]<br>n.<br>断言,主张,肯定<br>========================================================================================================<br>inroad<br>[&#712;inr&#601;ud]<br>n.<br>进展<br><br>We have made inroads into our painting job; we finished the kitchen already.<br><br>我们的粉刷工作有进展了, 已经把厨房刷好了。<br>========================================================================================================<br>crystallize<br>[&#712;krist&#601;laiz]<br>vt. &amp; vi.<br>使结晶<br><br>Cold rain crystallized into snow.<br><br>雨水在低温情况下结晶变成雪。<br>计划成型, 具体化<br><br>After weeks of work, our plan for a vacation trip crystallized.<br><br>经过几周的工作, 我们的度假计划终于成型了。<br>========================================================================================================<br>acutely<br>adv.<br>尖锐地,剧烈地<br><br>chronically<br>adv.<br>慢性地,习惯性地,长期地<br>========================================================================================================<br>intimate<br>[&#712;intimit]<br>adj.<br>亲密的, 密切的; 有性关系的(尤指婚外的)<br><br>He is my intimate friend.<br><br>他是我的密友。<br>私人的, 个人的<br><br>I can’t tell them my intimate thoughts.<br><br>我不能告诉他们我内心深处的想法。<br>详尽的, 精通的<br><br>This is an intimate knowledge of African religions.<br><br>这是一本关于非洲宗教的详尽知识的书。<br>n.<br>至交, 密友<br><br>He is my intimate.<br><br>他是我的至交。<br><br>[&#712;intimeit]<br>vt.<br>示意, 暗示<br><br>He intimated his wishes with a slight nod of his head.<br><br>他微微点头示意。<br>========================================================================================================<br>uplift<br>[&#652;p&#712;lift]<br>vt.<br><br>提高, 振奋<br><br>A good vacation uplifted him.<br><br>愉快的假期使他振作起来。<br>n.<br><br>振作; 振奋; 提高<br><br>His encouragement gave me a hot sense of uplift.<br><br>他的鼓励激发了我的上进心。<br>========================================================================================================<br><br><br><br><br><br><br># end </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/16/New-Words/" class="archive-article-date">
  	<time datetime="2008-07-16T05:12:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-16</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/English/">English</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】7-Steps-to-Positive-Self-Talk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/16/【zz】7-Steps-to-Positive-Self-Talk/">【zz】7 Steps to Positive Self Talk</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a target="_blank" href="http://www.pickthebrain.com/blog/7-steps-to-positive-self-talk/#more-608">http://www.pickthebrain.com/blog/7-steps-to-positive-self-talk/#more-608</a><br><br>7 Steps to Positive Self Talk</p><p>Most of us are in constant mental chatter. We talk to ourselves all day long and, unfortunately, this self talk is frequently negative. Often it is tainted with guilt about our past or anxiety about our future. This negativity can destroy any seed of hope that we may otherwise have in striving for our dreams.</p><p>Our actions are inspired by our thoughts. If we can change the way we think, we can begin to change the actions we take. It is human nature to seek personal growth; whether financially, emotionally, physically or spiritually. Practicing positive self talk can help us set in motion actions that will bring us greater rewards.</p><p>The following are seven steps to positive self talk. By following these steps you will begin to rid your inner conversations of negativity and instead have empowering thoughts.<br><br><strong>1. Eliminate Internal Negative Chatter</strong></p><p>The first step is one of awareness. It will be hard to make a change to positive thinking without being acutely intimate with the thoughts that run through your mind. Recently, I was amazed to discover deep buried emotions from negative thoughts that I had for fewer than 10 minutes. Without awareness, I would have carried the hurt and anger inside. Awareness helped me to bring them out to the open for me to deal with.</p><p>Undoubtedly it will not be easy to make a switch if you have a long history or negative self talk. Your talk became negative over the years due to various factors. For instance, if your first grade teacher repeatedly told you that you were &ldquo;stupid&rdquo;, you might believe it to be truly the case. You would find that your inner chatter would often be filled with talk of &ldquo;I am so slow&rdquo; and &ldquo;it is so hard to learn&rdquo;. If you constantly tell yourself such negative stories, your actions are going to reflect your low self esteem. It will be difficult to get very far if you are always putting yourself down.</p><p>A common negative talk involves telling yourself &ldquo;I can&rsquo;t&rdquo;. When you say to yourself &ldquo;I can&rsquo;t&rdquo; or &ldquo;it is too difficult&rdquo;, you are creating a resistance. Having such a mental block will prevent you from achieving a task you could otherwise succeed at.</p><p>Anytime you catch yourself saying &ldquo;I can&rsquo;t…&rdquo;, turn around and challenge your own claim with, &ldquo;Why can&rsquo;t I?&rdquo; Research shows that most geniuses became the people they are also because of the hard work they put in. So if you would like to be successful, you need to start saying &ldquo;I can&rdquo; a lot more.</p><p>A great method that I have also found useful is to say &ldquo;Cancel Cancel&rdquo; each time I find myself saying something negative, whether in the mind or verbally. The method works if you sincerely have the intent of becoming a positive thinker.</p><p><strong>2. Positive Affirmations</strong></p><p>Affirmations are positive statements of a desired outcome or goal. They are usually short, believable and focused. By repeating them over and over again, you build inroads into your subconscious mind, opening up the possibility of a new state of thoughts.</p><p>An important step when repeating affirmations is that you need to read your affirmations aloud with feeling. The mere reading of the words bears no consequence unless you put some emotions behind them. Of significant fact is that your subconscious mind takes any orders given in complete faith and after repeated self talk. So the daily practice of repeating affirmations is important.</p><p>Initially you may be skepticism toward the statement of your positive affirmation. However, if you follow this simple set of instructions your skepticism will soon give way to a new set of beliefs and then crystallized into absolute faith.</p><p><strong>3. Positive Scripts</strong></p><p>One thing that you may observe is on how easy it is for your mind to build negative thought upon negative thought. The chatter not only does not stop but it spins a drama that traps and limits you.</p><p>From now on, regularly do this exercise instead. Spin an uplifting story that runs like a movie script. Some visualization will be helpful. You build on a story with a positive outline. The longer you can tell this story to yourself the better. It is also best if you can make this story one about having all your goals achieved. When you do this, you start to internalize your goals and dreams, as if they are something that you have already achieved.</p><p> </p><p> </p><p><strong>4. Replace Negative Influences with Positive Ones</strong></p><p>It is important that you identify external negative factors in your life which may be holding your thoughts hostage. For instance, your mental state can become toxic by being around friends who are negative. If you are not vigilant enough, you will start to adopt their thoughts as your own. Hence, be alert to what your negative influences are. If they come from certain friends, limit your exposure to them as much as you can. Refrain from discussing your plans with people who will be unsupportive of your dreams and goals.</p><p>Instead surround yourself with thoughts and actions from people who will empower you.<br>From being uninspired and de-motivated, you will begin to feel uplifted and driven to greater self growth. The positive energy that they vibrate will start affecting the self talk that you engage in as well.</p><p><strong>5. Present Tense Messages</strong></p><p>You may find yourself daunted by the many things you need to do in order to reach your goals. It just seems overwhelming to become the success that you secretly desire for. Your mind gets caught up in an endless stream of worry.</p><p>What may be helpful is to concentrate on steps you can take in the present. If you find yourself becoming stuck, stop and say, &ldquo;What can I do right now?&rdquo; Change your internal talk from a future anxiety ridden one to one that is about the more manageable present. You cannot control what will happen in the future but you can take the necessary steps now that will build a better tomorrow. Taking the necessary steps require you to focus your thoughts and inner talk on Now.</p><p><strong>6. Confront Fears</strong></p><p>Fear is often what holds you back from your success. You are scared of taking chances because you fear losing the security that you enjoy now. You try to convince yourself that you are happy in your current state when in fact, you are not. Your self talk may sound positive in your attempt to lie to yourself. But somehow, there is an inner knowing that you are short changing yourself.</p><p>Ask yourself what you are afraid of. What can be the worst that can happen? Take a step-by-step approach in breaking down your fears and see if there is any way round to looking at things more positively. When you confront your fears, you will often realize that the worst case scenario is not as bad as you think. In fact, the benefits of change are worth the risk. Your inner talk begins to change at this point.</p><p><strong>7. Focus on Enjoyable Moments</strong></p><p>It is much easier to have a positive attitude if you focus on the enjoyable moments in life rather than the difficult ones. While there will inevitably be challenges, you need to remember that life consists of ups and downs and the good times are forged through the bad.</p><p>So choose to fill your mind with positive images and thoughts. Make it a conscious habit. Simply bring your mind back every time it goes astray in its thoughts. For a start, if you can be grateful for what you have presently, your self talk will also change to be in alignment with one of joy. A state of gratitude does wonders to your psyche.</p><p><strong>Conclusion</strong></p><p>Replacing self talk from a negative to a more positive one is not going to happen overnight. If your mind has ingrained habits of thinking negatively, it will take some work and time. However, if you find yourself often struggling, unable to achieve your goals and talking yourself down, then you should grit your teeth and commit to the process of change.</p><p>By following the above tips to positive self talk, you will experience an improvement in the quality of your life. The rewards are plentiful with greater happiness, peace and joy. Best of all, you feel empowered. With the change in energy, you are more likely to reach your highest potential and achieve success.</p><p> </p><p> </p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/16/【zz】7-Steps-to-Positive-Self-Talk/" class="archive-article-date">
  	<time datetime="2008-07-16T05:06:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-16</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/English/">English</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】Why-Is-It-So-Hard-to-Be-Yourself" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/14/【zz】Why-Is-It-So-Hard-to-Be-Yourself/">【zz】Why Is It So Hard to Be Yourself?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a target="_blank" href="http://www.pickthebrain.com/blog/why-is-it-so-hard-to-be-yourself/">http://www.pickthebrain.com/blog/why-is-it-so-hard-to-be-yourself/</a><em><br></em></p><p><em>&ldquo;He who trims himself to suit everyone will soon whittle himself away.&rdquo;</em>  ~ Raymond Hull</p><p>&lsquo;Be yourself!&rsquo; This is a common piece of advice, often given before an interview or a date or some other occasion when we need to impress. Sounds like a strange piece of advice, though. How could you <em>not </em>be yourself?</p><p>Strange as it seems, we have been conditioned all our lives to behave according to other people&rsquo;s expectations, to dance to their tune, to let them pull our stings. The truth is that most of us &ndash; unless we have really thought about it and made an effort to change &ndash; are puppets, controlled by the world around us. We crave approval. We need to fit in. In many ways, this is just a characteristic of being human &ndash; we are social animals and need to fit into the group to survive. But this natural and healthy tendency has taken over our lives to such an extent that we are often paralyzed by a fear of the outside world and obsessed by how others see us.</p><p>But what would things look like if you could really &lsquo;be yourself&rsquo;?</p><p><strong>Don&rsquo;t give away your power</strong></p><p><em>&ldquo;The King is angry. See, he gnaws his lip.&rdquo;</em> ~ Shakespeare, Richard III</p><p>It is impossible to really be yourself when you are worried about how other people perceive you. We all care (at least a little bit) what other people think &ndash; we have been raised to believe that the approval of others is important. And in some ways it is &ndash; other people do have power over us. But the truth is that it doesn&rsquo;t matter as much as you think; usually it doesn&rsquo;t matter at all. Sometimes you&rsquo;ll be flavor of the month; other times you might be public enemy number one. But you cannot control what other people think of you, so why even try?</p><p>Let them think what they will. To give the opinions and thoughts of others so much importance is to make your own life a misery. When you stop giving your power away to other people like this, your life will be so much lighter and easier. To genuinely not care what others think is an amazing and enlightening experience. Try it.</p><p><strong>Live with integrity</strong></p><p><em>&ldquo;The great majority of us are required to live a life of constant duplicity. Your health is bound to be affected if, day after day, you say the opposite of what you feel, if you grovel before what you dislike, and rejoice at what brings you nothing but misfortune.&rdquo; ~ Boris Pasternak</em></p><p>Living with integrity means being an open, honest person. It means saying what you think &ndash; not in an arrogant, conceited way, which is usually a sign of an inferiority complex(自卑感,自卑情结) &ndash; but because you shouldn&rsquo;t hide what you believe. If you are not true to yourself &ndash; if you are dishonest, if you hide part of yourself, either as a defense mechanism or to get a promotion or make money, you will create what I have heard called an &lsquo;inner darkness,&rsquo; and this will haunt you.</p><p>In <a href="http://www.amazon.com/gp/product/0743269519?ie=UTF8&amp;tag=iwillchanyour-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0743269519" target="_blank">The 7 Habits of Highly Effective People</a><img height="1" width="1" src="http://www.assoc-amazon.com/e/ir?t=iwillchanyour-20&amp;l=as2&amp;o=1&amp;a=0743269519">, one of the most widely read and influential self-improvement books of all time, Steven Covey writes that truly successful people operate from a principle-centered paradigm, steering their lives by means of a clear compass of integrity. You might be able to succeed in some senses by being dishonest and duplicitous, but in the end you will be unable to face yourself, and if you cannot look in the mirror with a clear conscience, how can you be yourself?</p><p><strong>Don&rsquo;t take yourself so seriously</strong></p><p><em>&ldquo;When you can laugh at yourself, you are free.&rdquo;</em> ~ Ted Loder</p><p>Will the world stop turning if you screw up? Believe it or not, the world got along fine without you for millions of years, and will do so long after you&rsquo;re gone. So keep things in perspective. Will any of this matter in a year, ten year, 100 years? In many ways, the world is a ridiculous place, full of crazy things that make no sense at all. You can&rsquo;t make sense of it all however hard you try. It is what it is, and so are you, with all your contradictions and faults and failings. Remember the old saying: &lsquo;laugh and the world laughs with you.&rsquo; So relax, lighten up; don&rsquo;t get things out of proportion.</p><p><strong>Don&rsquo;t worry: accept things as they are</strong></p><p><em>&ldquo;The secret of health for both mind and body is not to mourn for the past, worry about the future, or anticipate troubles, but to live in the present moment wisely and earnestly.&rdquo;</em> ~ Buddha</p><p>We have a tendency to think we are in control. But the truth is that there are surprisingly few things we can influence directly. I read somewhere recently that life is not about avoiding the storm but about learning to dance in the rain, and I think this is a wonderful truth. We spend so much time trying to change our world, but in reality we can only change ourselves. If the rain is coming, it will come; if the sun is setting, it will set. Accept these many, many things which are outside our control and, whatever comes along, learn not only to live with it, but to embrace it, to love it &ndash; to live any other way is madness.</p><p><strong>Do what you love</strong></p><p><em>&ldquo;The future belongs to those who believe in the beauty of their dreams.&rdquo;</em><strong> </strong>~ Eleanor Roosevelt</p><p>Finally, and perhaps most importantly, don&rsquo;t let other people tell you what to do and how to live. In the end, you are responsible for your experience of life, and if you don&rsquo;t follow your dreams, you only have yourself to blame. &lsquo;You&rsquo;re a long time dead&rsquo; as the saying goes, so don&rsquo;t waste time with worry or regret . Don&rsquo;t be a puppet &ndash; don&rsquo;t let the world around you pull your strings. You cannot control it, so don&rsquo;t let it control you either. If you are true to yourself and live with integrity, honesty and without fear, then you will, perhaps, begin to see the answer to that most perplexing of questions: <em>&ldquo;Who am I?&rdquo;</em></p><p><em>This guest article was written by Michael Miles. Michael writes about using your mind as nature intended at his blog, <a href="http://effortlessabundance.com/" target="_blank">Effortless Abundance</a>. If you enjoyed this article, you may like to <a href="http://feeds.feedburner.com/effortlessabundance/eitD" target="_blank">subscribe to his RSS feed</a>.</em></p><p><em>Image by <a href="http://www.flickr.com/photos/zarajay/2307649188/" target="_blank">*Zara</a>.</em></p><p>Originally posted at <a href="http://www.pickthebrain.com/blog" target="_blank">PickTheBrain</a> a weblog dedicated to <a href="http://www.pickthebrain.com/" target="_blank">self improvement</a> and <a href="http://www.pickthebrain.com/blog/21-proven-motivation-tactics/" target="_blank">motivation</a>.</p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/14/【zz】Why-Is-It-So-Hard-to-Be-Yourself/" class="archive-article-date">
  	<time datetime="2008-07-14T10:49:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-14</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/English/">English</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Google-Protocol-Buffers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/14/Google-Protocol-Buffers/">Google Protocol Buffers</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><a href="http://code.google.com/apis/protocolbuffers/docs/cpptutorial.html" target="_blank">Protocol Buffer Basics: C++</a>another useful google project<br><br><br><br><br><br><br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/14/Google-Protocol-Buffers/" class="archive-article-date">
  	<time datetime="2008-07-14T08:31:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-14</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Google/">Google</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-python-function-reference" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/14/python-function-reference/">python function reference</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p></p><p>=================================================================</p><p><strong>字典中的 get 函数</strong>&nbsp;<br>我们经常需要在字典中初始化数据：&nbsp;<br>以下是不好的实现方法：&nbsp;</p><p></p><p>navs = {}</p><p>for (portfolio, equity, position) in data:</p><p>&nbsp; &nbsp; if portfolio not in navs:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; navs[portfolio] = 0</p><p>&nbsp; &nbsp; navs[portfolio] += position <em> prices[equity]</em></p><p>使用dict.get(key, default) 删除 if 判断代码：&nbsp;</p><p></p><p>navs = {}</p><p>for (portfolio, equity, position) in data:</p><p>&nbsp; &nbsp; navs[portfolio] = (navs.get(portfolio, 0)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+ position  prices[equity])</p><p>=================================================================</p><p><strong>字典中的 setdefault 函数 (1)</strong>&nbsp;<br>当我们要初始化一个可变字典的值。每个字典的值将是一个列表。下面是不好的做法：&nbsp;<br>初始化可变字典的值：&nbsp;</p>equities = {}<p></p><p></p><p>for (portfolio, equity) in data:</p><p>&nbsp; &nbsp; if portfolio in equities:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; equities[portfolio].append(equity)</p><p>&nbsp; &nbsp; else:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; equities[portfolio] = [equity]</p>通过 dict.setdefault(key, default) 使这段代码工作的更好:&nbsp;<br><p>equities = {}</p><p>for (portfolio, equity) in data:</p><p>&nbsp; &nbsp; equities.setdefault(portfolio, []).append(equity)</p>dict.setdefault（）等同于“ get, or set &amp; get“ 或&quot;如果没有，就设置&quot;;&nbsp; 如果你的字典Key是复杂的计算或long类型，使用 setdefault 是特别有效的。&nbsp;<p></p><p>=================================================================</p><a href="http://docs.python.org/library/pdb.html" target="_blank">debug</a><br><br>&gt;&gt;&gt; import pdb<br>&gt;&gt;&gt; import mymodule<br>&gt;&gt;&gt; pdb.run(‘mymodule.test()’)<br><br>Cmdline:<br>python -m pdb myscript.py<br><br>In *.py src file:<br>import pdb<br>pdb.set_trace()<br><br>=================================================================<br>&gt;&gt;&gt; import dis<br>&gt;&gt;&gt; f = open(‘test.py’).read()<br>&gt;&gt;&gt; co = compile(f, &quot;test.py&quot;, &quot;exec&quot;)<br>&gt;&gt;&gt; dis.dis(co)&nbsp;&nbsp;&nbsp;    #反汇编<br>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    0 LOAD_CONST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    0 (None)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    3 IMPORT_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    0 (gtk)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    6 STORE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    0 (gtk)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    9 LOAD_CONST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    0 (None)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ……<br>=================================================================<br>&gt;&gt;&gt; import math<br>&gt;&gt;&gt; exec &quot;f=math.log(100,10)&quot;<br>&gt;&gt;&gt; print f<br>2.0<br>=================================================================<br>&gt;&gt;&gt; import sys<br>&gt;&gt;&gt; sys._getframe().f_globals.get(&quot;<strong>name</strong>&quot;, &quot;&lt;string&gt;&quot;)<br>‘<strong>main</strong>‘<br>=================================================================<br>load_module(‘os’, &quot;O_EXCL O_CREAT O_RDWR&quot;.split())<br>def load_module(module_name, symbols):<br>&nbsp;&nbsp;&nbsp;        module = <strong>import</strong>(module_name)<br>&nbsp;&nbsp;&nbsp;        for symbol in symbols:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        globals()[symbol] = getattr(module, symbol)<br>=================================================================<br><a target="_blank" href="http://pleac.sourceforge.net/pleac_python/datesandtimes.html">http://pleac.sourceforge.net/pleac_python/datesandtimes.html</a><br>date &amp; time<br><br>&gt;&gt;&gt; import time<br>&gt;&gt;&gt; time.time()<br>1231913155.263829<br>&gt;&gt;&gt; time.gmtime(time.time())<br>(2009, 1, 14, 6, 5, 48, 2, 14, 0)<br>&gt;&gt;&gt; time.asctime(time.gmtime(time.time()))<br>‘Wed Jan 14 06:05:09 2009’<br>&gt;&gt;&gt; time.ctime(time.time())<br>‘Wed Jan 14 14:08:49 2009’<br>&gt;&gt;&gt; time.ctime()<br>‘Wed Jan 14 14:07:31 2009’<br>&gt;&gt;&gt; time.sleep(3)&nbsp;&nbsp;&nbsp;      # sleep 3 seconds<br><br>=================================================================<br>&gt;&gt;&gt; import math<br>&gt;&gt;&gt; math.sin(math.pi/2)<br>1.0<br>=================================================================<br>&gt;&gt;&gt; import random&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           # use help(random) to see the (large) list of funcs <br>&gt;&gt;&gt; random.randint(1,100)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          # in range [1, 100]<br>93<br>&gt;&gt;&gt; mylist<br>[1, 2, 100, 444, 200]<br>&gt;&gt;&gt; random.choice(mylist)<br>200<br>&gt;&gt;&gt; random.randrange(1, 100, 2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          # range(start, stop[, step])<br>79<br>&gt;&gt;&gt; mylist<br>[1, 2, 3, 4, 5, 5, 6, 6, 7, 8, 9, 10, 10]<br>&gt;&gt;&gt; random.sample(mylist,4)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          # Chooses k unique random elements<br>[6, 5, 7, 2]<br>&gt;&gt;&gt; random.shuffle(mylist)<br>&gt;&gt;&gt; mylist<br>[6, 10, 3, 8, 2, 7, 5, 1, 6, 5, 9, 4, 10]<br>&gt;&gt;&gt; random.gauss(100, 10)<br>103.22331244557154<br>=================================================================<br>&gt;&gt;&gt; for i in range(1,10,2): print i<strong>,</strong><br>1 3 5 7 9<br>&gt;&gt;&gt; for i in range(1,10,2): print i<br>1<br>3<br>5<br>7<br>9<br>=================================================================<br>&gt;&gt;&gt; a<br>[1, 2, 3]<br>&gt;&gt;&gt; b<br>[‘j’, ‘f’, ‘o’]<br>&gt;&gt;&gt; zip(a,b)<br>[(1, ‘j’), (2, ‘f’), (3, ‘o’)]<br>cuts = [8, 14, 20, 26, 30]<br>pieces = [ theline[i:j] for i, j in zip([0]+cuts, cuts+[None]) ]<br>=================================================================<br>&gt;&gt;&gt; import struct<br>&gt;&gt;&gt; str<br>‘123451231234567887654321’<br>&gt;&gt;&gt; len(str)<br>24<br>&gt;&gt;&gt; fmt<br>‘5s 3x 8s 8s’<br>&gt;&gt;&gt; struct.calcsize(fmt)<br>24<br>&gt;&gt;&gt; struct.unpack(fmt, str)<br>(‘12345’, ‘12345678’, ‘87654321’)<br>=================================================================<br>&gt;&gt;&gt;quest = raw<em>input(&quot;What is your quest? &quot;)<br>What is your quest? To seek the holy grail.<br>&gt;&gt;&gt;quest<br>‘To seek the holy grail.’<br>=================================================================<br>&gt;&gt;&gt; import itertools<br>&gt;&gt;&gt; L = [1,2,3,4]<br>&gt;&gt;&gt; for item in itertools.ifilter(L.</em> <em>contains</em> _, [1,3]):<br>&gt;&gt;&gt; &nbsp;&nbsp;&nbsp;                 print &quot;yes&quot;, item<br>yes 1<br>yes 3<br>=================================================================<br>import codecs<br># Open a UTF-8 file in read mode<br>infile = codecs.open(&quot;infile.txt&quot;, &quot;r&quot;, &quot;utf-8&quot;)<br># Read its contents as one large Unicode string.<br>text = infile.read()<br># Close the file.<br>infile.close()<br>=================================================================<br>&gt;&gt;&gt; u’你好’.encode(‘gb2312’)<br>‘xc4xe3xbaxc3’<br>&gt;&gt;&gt; ‘你好’.decode(‘gb2312’).encode(‘utf8’)<br>‘xe4xbdxa0xe5xa5xbd’<br>try:<br>    unicode(value, &quot;ascii&quot;)<br>except UnicodeError:<br>    value = unicode(value, &quot;utf-8&quot;)<br>else:<br>    # value was valid ASCII data<br>    pass=================================================================<br>&gt;&gt;&gt; str<br>‘jfo’<br>&gt;&gt;&gt; print map(ord, str)<br>[106, 102, 111]<br><br>&gt;&gt;&gt; r<br>[‘j’, ‘f’, ‘o’]<br>&gt;&gt;&gt; import operator<br>&gt;&gt;&gt; lstr=reduce(operator.add, r, &quot;+&quot;)<br>&gt;&gt;&gt; lstr<br>‘+jfo’<br>=================================================================<br>&gt;&gt;&gt; print ‘|’, ‘hej’.ljust(20), ‘|’, ‘hej’.rjust(20), ‘|’, ‘hej’.center(20), ‘|’<br><strong>| hej&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    hej |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    hej&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    |</strong><br>&gt;&gt;&gt; print ‘hej’.center(20, ‘+’) <strong><br>++++++++hej+++++++++</strong><br>=================================================================<br>&gt;&gt;&gt; import time<br>&gt;&gt;&gt; print time.strftime(‘%Y-%m-%d-%S’)<br>2008-12-15-00<br> =================================================================<br>调用glibc中的<strong> prctl</strong>函数，改变当前进程的进程名<br>import dl<br>libc = dl.open(‘/lib/libc.so.6′)<br>libc.call(‘prctl’, 15, ‘ubuntu-tweak’, 0, 0, 0)<br>=================================================================<br><code>&gt;&gt;&gt; print ord(‘a’)<br>97<br>&gt;&gt;&gt; print chr(97)<br>a</code><code><br>&gt;&gt;&gt; print ord(u’u2020’)<br>8224<br>&gt;&gt;&gt; print repr(unichr(8224))<br>u’u2020’<br></code>&gt;&gt;&gt; ‘abcdefg’.replace(‘abc’, ‘jfo’)<br>&quot;jfodefg&quot;<br>&gt;&gt;&gt; import string<br>&gt;&gt;&gt; table = string.maketrans(string.ascii_lowercase, string.ascii_lowercase[2:]+string.ascii_lowercase[:2])<br>### translate(s,table [,deletions]) -&gt; string<br>&gt;&gt;&gt; string.translate(&quot;abc&quot;, table)<br>‘cde’<br>&gt;&gt;&gt; string.translate(&quot;abcde&quot;, table, &quot;ac&quot;)<br>‘dfg’<br>=================================================================<br>&gt;&gt;&gt; string.zfill(&quot;abc&quot;,8)<br>‘00000abc’<br>=================================================================<br>lstrip、rstrip、strip<br>&gt;&gt;&gt; x = ‘xyxxyy hejyx  yyx’<br>&gt;&gt;&gt; print ‘|’+x.strip(‘xy’)+’|’<br>| hejyx  |<br>=================================================================<br>&gt;&gt;&gt; print ‘one tWo thrEe’.capitalize( ) <strong><br>One two three</strong> <br>&gt;&gt;&gt; print ‘one tWo thrEe’.title( ) <strong><br>One Two Three</strong><br>=================================================================<br>pprint.pprint : pretty print<br><p>&gt;&gt;&gt; pprint.pprint(stuff)</p>[&lt;Recursion on list with id=869440&gt;,’’,’/usr/local/lib/python1.5’,’/usr/local/lib/python1.5/test’,’/usr/local/lib/python1.5/sunos5’,’/usr/local/lib/python1.5/sharedmodules’,=================================================================<br><br><br><br><br><br><br><br>Debug-mode variables<p>Setting these variables only has an effect in a debug build of Python, that is, if Python was configured with the <em>–with-pydebug</em> build option.</p><dl><dt> PYTHONTHREADDEBUG</dt><dd><p>If set, Python will print threading debug info.</p><p>Changed in version 2.6:Previously, this variable was called THREADDEBUG.</p></dd></dl> <dl><dt> PYTHONDUMPREFS</dt><dd>If set, Python will dump objects and reference counts still alive after shutting down the interpreter.</dd></dl> <dl><dt> PYTHONMALLOCSTATS</dt><dd>If set, Python will print memory allocation statistics every time a new object arena is created, and on shutdown.</dd></dl><br><br><br><br><br><br><br><br><del>continue</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/14/python-function-reference/" class="archive-article-date">
  	<time datetime="2008-07-14T08:28:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-14</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-OpenVPN虚拟网络拓扑剖析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/07/OpenVPN虚拟网络拓扑剖析/">OpenVPN虚拟网络拓扑剖析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>OpenVPN虚拟网络拓扑剖析</p>
<p>By jfo，</p>
<p>&nbsp;</p>
<p>转载请注明出处<a href="http://blog.pickbox.me/2008/07/07/openvpn%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%89%96%E6%9E%90/">http://blog.pickbox.me/2008/07/07/openvpn%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%89%96%E6%9E%90/</a></p>
<p>&nbsp;</p>
<p>OpenVPN-</p>
<p>server/client配置模型</p>
<p>sample-config-files：<a href="http://openvpn.net/index.php/documentation/howto.html#examples" target="_blank" rel="external">http://openvpn.net/index.php/documentation/howto.html#examples</a></p>
<p>Ø      点对点VPN tunnel网络拓扑</p>
<p><strong>server .0 255.255.255.0</strong></p>
<p>一旦client连接上，tun设备相当于虚拟出一个网关</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/7321c913da721e35dd5401a9.jpg"></p>
<p>服务器端（Linux）的路由如下：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/c4633887b878223cc65cc3ab.jpg"></p>
<p>所有VPN .0/24子网段都经由10.10.10.2处理，网关10.10.10.2可以判断目标地址，查找内部记录的信息，将数据包发送给正确的客户端。</p>
<p>客户端（Windows）的路由如下：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/3605d3437266c60573f05db0.jpg"></p>
<p>所有VPN .0/24子网段都经由10.10.10.5处理，网关10.10.10.5可以将数据包通过隧道发送出去。</p>
<p>当一个用户程序，如FTP，向.1发出连接请求时，这个数据包进入到内核，查找路由表，发现需要经过10.10.10.5这个网关从10.10.10.6（即和虚拟网关相连的网络出口，类似普通网卡接口）发送出去，而网关10.10.10.5其实是OpenVPN底层驱动虚拟出来的，于是数据包从底层被发送到OpenVPN用户程序，OpenVPN可以进行VPN虚拟IP封装、记录真实IP等工作。然后OpenVPN修改数据包的src IP和dest IP为底层网络的真实IP，发送到另一端的OpenVPN服务端或客户端。</p>
<p>另一端接收到数据包后，由内核交给上层OpenVPN应用程序，OpenVPN可以对这个数据包作任何操作了（数据包格式OpenVPN自己是知道的），比如从中提取出VPN虚拟IP，甚至发送方的真实IP，这些信息和后面将提到的multiple machines on the server side以及multiple machines on the client side都有关系。</p>
<p>不论是发送还是接收，虚拟网关（.2和10.10.10.5）都记录下VPN虚拟IP和真实IP:PORT的对应关系。</p>
<p>整个过程用户看上去就像是经过了一个隧道，其中的细节全部被隐蔽了。但值得强调的是，最终数据仍然是以真实IP在网络上跑的，这也符合一般设计逻辑。</p>
<p>Ø      multiple machines on the server side</p>
<p>ref for detail：</p>
<p>在sample-config-files中有如下一段配置：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/6fb395ddfe6bba225982ddb2.jpg"></p>
<p>描述的情形如下图所示（稍作修改，192.168.<em>.</em>网段替换成了.*网段）：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/f44160d9ebe3403a11df9bb3.jpg"></p>
<p>push “route .0 255.255.255.0” 的作用是将route命令push到连接进来的client，设置client的路由，实际上也可以在连接后手工设置。</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/55f4014f91c5e020afc3abb9.jpg"></p>
<p>客户端将所有.*的请求全部经过虚拟网关.5（即VPN隧道）发送到VPN服务器。</p>
<p>服务器端只要允许了<a href="http://openvpn.net/faq.html#ip-forward" target="_blank" rel="external">IP</a> 和 <a href="http://openvpn.net/faq.html#firewall" target="_blank" rel="external">TUN/TAP</a> forwarding，就可以将数据包转发给正确的机器。</p>
<p>从这一点可以看出，OpenVPN所做的工作只不过是建立通讯隧道、封装一些新的信息到数据包，以及还原数据包和提取真实目标地址信息。也就是说服务器端默认就会转发数据包的，而不需要OpenVPN另外单独做路由判断或是发送目标地址过滤等操作，这些都是底层原有的机制（如iptables，routing tables）完成的。这也说明了为什么即使在服务器的配置文件中不添加push “route .0 255.255.255.0”这一行，只要client端手工添加了这一路由项，都可以成功发送至服务器端内网的任何一台机器。</p>
<p>文档中特别强调了一句：“Remember that these private subnets will also need to know to route the OpenVPN client address pool (.0/255.255.255.0) back to the OpenVPN server.”</p>
<p>这句话是说，服务器背后的内网在回复VPN客户端时，要知道将.0/24这个OpenVPN虚拟IP的路由回OpenVPN server上，这在OpenVPN服务器与网关不是同一台机器时尤为重要。这句话暴露出这样一个信息：数据包是以OpenVPN虚拟IP在server私网跑的！</p>
<p>为了进一步验证这一发现，我们先在客户端用FTP连接服务器内网的一台FTP服务器（.241），然后在服务器端运行如下命令（conntract记录了网络当前数据包的各种信息），从结果可以看到，src=10.10.10.6，确实验证了这一点。</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/c4633887b813223cc65cc38e.jpg"></p>
<p>这说明OpenVPN服务端收到数据包后，会从中抽取出VPN虚拟IP（前面我们说过，OpenVPN会封装进一些附加信息，虚拟IP就是其中之一），然后用它替换数据包的src address，最后转发出去。</p>
<p>再次回到文档中的那句话，当OpenVPN服务器与网关不是同一台机器，我的实验环境就是这样，而你又不是网络管理员，无法更改网关的设置时，那么只能说抱歉了，通过设置push “route .0 255.255.255.0”的方法，你仍然不能访问到服务器端内网，你的FTP客户端将不断显示“延迟30秒尝试重新连接”！因为回应数据包无法从内网发送出去。</p>
<p>如果你有足够的怀疑精神，也许你会问，如果是这样，网关肯定不会将你的OpenVPN连接请求转发到内网自己的OpenVPN服务器（通常情况都会这样），那么从一开始网关就会拒绝我的OpenVPN连接，更不会有后面的通过“sudo cat /proc/net/nf_conntrack”验证数据包了！你说的一点也没错，然而事实是我确实成功的验证了src=.6，这说明OpenVPN连接确实成功建立，那么网关被我设置过？可我又没有配置网关的特权，也不要怀疑我和网管是好朋友，那么只能说明我通过某种非常规途径建立了OpenVPN连接！推断完全正确，事实正是如此。详情请参考<a href="http://blog.chinaunix.net/u/10449/showart.php?id=688463" target="_blank" rel="external">http://blog.chinaunix.net/u/10449/showart.php?id=688463</a>，介绍的是如何穿越NAT对外提供服务。</p>
<p>之所以提这一小插曲，是因为当我们处于迷惑不解的状态时，例如调试一个内核的bug，搞到晕头转向，也找不出丝毫的蛛丝马迹，这时人们最容易草木皆兵，到处怀疑可能出错的地方，就算我们平时会拍着胸脯说绝对不会有问题的地方，也难逃被怀疑的厄运。这时最重要的是正确的推断，根据眼前可以确认的事实，一步一步追根朔源，找到矛盾的源头，而不是怀疑自己眼前看到的事实，花费大量精力在很可能正确的地方挑错。相信你曾有过这样的经历：明明在街上看到某位朋友，可是回头问时却被否认，于是你开始怀疑自己确实是看错了人。</p>
<p>言归正传，总结一下，当multiple machines on the server side时，客户端从外网通过VPN隧道访问内网机器，在内网使用的是VPN虚拟IP！并且push “route .0 255.255.255.0”不会对服务器端有任何特殊设置，它仅仅指导客户端添加一项路由。</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/23c4544e051cc61fb3de058f.jpg"></p>
<p>另外可以试着将VPN虚拟地址指定成.0/24网段，这时不向网关添加任何路由信息，会不会成功？</p>
<p>&nbsp;</p>
<p>Ø      multiple machines on the client side</p>
<p>ref for detail：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/5d5c7ed9e05516ff39012f88.jpg"></p>
<p>描述的情形如下图所示（稍作修改，192.168.40.<em>网段替换成了192.168.1.</em>网段）：</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/42a15e60bbee49c98db10d89.jpg"></p>
<p>route 192.168.1.0 255.255.255.0的作用是在server端添加路由项。实际上也可以手工添加。</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/c4633887b817223cc65cc38a.jpg"></p>
<p>server在接收到目标地址为192.168.1.0/24的数据包时，根据路由项将数据包从内核传递给OpenVPN应用程序，OpenVPN再根据iroute 192.168.1.0 255.255.255.0查找出192.168.1.0对应着哪个客户端子网，选择正确的VPN隧道，将数据包从OpenVPN server发送出去。iroute不能手工添加的，它被OpenVPN内部使用。How-to文档中有这么一段描述：“<strong>route</strong> controls the routing from the kernel to the OpenVPN server (via the TUN interface) while <strong>iroute</strong> controls the routing from the OpenVPN server to the remote clients. Both are necessary.”</p>
<p>最后一步，也是经常被忘记的一步，是向server端的网关添加一项路由，将所有目标地址为192.168.1.0/24的数据包转发到OpenVPN服务器。（The last step, and one that is often forgotten, is to add a route to the server’s LAN gateway which directs 192.168.4.0/24 to the OpenVPN server box）</p>
<p>这一步又向我们暗示了一个信息：client端的任何一台机器访问server端内网机器时，在server端内网显示的是客户端LAN的真实IP！</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/add3f9f2e5598405b07ec58b.jpg"></p>
<p>client-to-client</p>
<p>push “route 192.168.1.0 255.255.255.0”</p>
<p>另一台client2连接server后，它的route table将显示192.168.1.0的路由项</p>
<p><img class="blogimg" alt="" src="http://img.pickbox.me/wp-content/uploads/pic/e305087b17416ce20ad18794.jpg"></p>
<p>Ø      其他说明</p>
<h1 id="EXAMPLE-Suppose-you-want-to-give"><a href="#EXAMPLE-Suppose-you-want-to-give" class="headerlink" title="EXAMPLE: Suppose you want to give"></a>EXAMPLE: Suppose you want to give</h1><h1 id="Thelonious-a-fixed-VPN-IP-address-of-1"><a href="#Thelonious-a-fixed-VPN-IP-address-of-1" class="headerlink" title="Thelonious a fixed VPN IP address of .1."></a>Thelonious a fixed VPN IP address of .1.</h1><h1 id="First-uncomment-out-these-lines"><a href="#First-uncomment-out-these-lines" class="headerlink" title="First uncomment out these lines:"></a>First uncomment out these lines:</h1><p>;client-config-dir ccd</p>
<p>;route .0 255.255.255.252</p>
<h1 id="Then-add-this-line-to-ccd-Thelonious"><a href="#Then-add-this-line-to-ccd-Thelonious" class="headerlink" title="Then add this line to ccd/Thelonious:"></a>Then add this line to ccd/Thelonious:</h1><h1 id="ifconfig-push-1-10-9-0-2"><a href="#ifconfig-push-1-10-9-0-2" class="headerlink" title="ifconfig-push .1 10.9.0.2"></a>ifconfig-push .1 10.9.0.2</h1><p>将ifconfig push到客户端配置，由于server .0 255.255.255.0，默认只会对10.8.0.0/24路由，因此需要添加route 10.9.0.0 255.255.255.252，对10.9.0.0/30路由</p>
<p>push “redirect-gateway def1”</p>
<p>push “dhcp-option DNS .1”</p>
<p>push “dhcp-option WINS .1”</p>
<p>将客户端默认网关配置成服务器端。并设置DNS server和WINS server为.1</p>
<p>OpenVPN server端必须配置如下：</p>
<p>iptables -t nat -A POSTROUTING -s .0/24 -o eth0 -j MASQUERADE</p>
<p>Ø      最终的全景图</p>
<p>OpenVPN仅仅建立隧道，并封装一些必要的信息，例如VPN虚拟地址和客户真实地址，其他的所有网络扩展，例如访问server端内网、访问client端内网，都是利用基本路由，以及iptables规则实现的。</p>
<p>也就是说一旦OpenVPN的基本配置完成后（唯一例外的是iroute这一配置项），完全可以自行手工设置路由以及iptables规则，来实现对网络的扩充，了解这一点对配置安全网络尤为重要，不要指望只要在server端不写类似”route .0 255.255.255.0”的语句就可以阻止客户端访问服务器内网，你必须从iptables规则链中确认客户端访问会被过滤掉。了解这一点也会帮助你构建基本网络，在路由器和交换机的重重封锁下，可以通过建立一条VPN隧道打通两个子网之间的网络通路，然后考虑如何通过添加路由和设置iptables规则，实现扩充VPN隧道功能的目标。</p>
<hr>
<p>&nbsp;</p>
<p>#end</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/07/OpenVPN虚拟网络拓扑剖析/" class="archive-article-date">
  	<time datetime="2008-07-07T15:13:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-07</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Network/">Network</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Linux网络工具：IPTABLES-～-ip-route-～-tcpdump-～-netstat-～-and-so-on" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/06/Linux网络工具：IPTABLES-～-ip-route-～-tcpdump-～-netstat-～-and-so-on/">Linux网络工具：IPTABLES ～ ip/route ～ tcpdump ～ netstat ～ and so on ...</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> ~~ my <del><br><br>snort<br><br><a target="_blank" href="http://man.chinaunix.net/network/snort/Snortman.htm">Snort 用户手册</a><br><br>-c config-file<br>Use the rules located in file config-file.<br>-C&#160;&#160;&#160;&#160;      Print the character data from the packet payload only (no  hex).<br>-d&#160;&#160;&#160;&#160;      Dump  the application layer data when displaying packets in ver‐<br>bose or packet logging mode.<br>-e&#160;&#160;&#160;&#160;      Display/log the link layer packet headers.<br>-i interface<br>Sniff packets on interface.<br>-n packet-count<br>Process packet-count packets and exit.<br>-X&#160;&#160;&#160;&#160;      Dump the raw packet data starting at the link layer.  This<br>switch overrides the ‘-d’ switch.<br>-v&#160;&#160;&#160;&#160;      Be verbose.  Prints packets out to the console.<br>-l log-dir<br>Set  the  output  logging directory to log-dir.  All plain<br>-b&#160;&#160;&#160;&#160;      Log packets in a tcpdump(1) formatted file. （binary mode）<br>-r tcpdump-file<br>Read the tcpdump-formatted file tcpdump-file.<br>-K logging-mode<br>Select a packet logging mode.  The default is pcap.&#160;&#160;      log‐<br>ging-mode.&#160;&#160;      Valid  logging modes include pcap, ascii, and<br>none.  Pcap logs packets through  the  pcap  library  into<br>pcap  (tcpdump)  format.&#160;&#160;      Ascii  logs  packets in the old<br>&quot;directories and files&quot; format with  packet  printouts  in<br>each file.  None Turns off packet logging.<br>-h home-net<br>Set the &quot;home network&quot; to home-net.  The format of this address  variable  is  a  network<br>prefix plus a CIDR block, such as 192.168.1.0/24.  Once this variable is set, all decoded<br>packet logging will be done relative to the home network address space.  This  is  useful<br>because  of  the  way  that Snort formats its ASCII log data.  With this value set to the<br>local network, all decoded output will be logged into decode directories with the address<br>of the foreign computer as the directory name, which is very useful during traffic analy‐<br>sis.<br><br><br><br>eg:<br><br>sudo snort -de -K ascii -l ./log/ -h 10.214.9.0/24<br><br>sudo snort -dvr packet.log icmp&#160;&#160;&#160;      从日志文件中提取ICMP包<br><br><br>snort使用一种简单、轻量级的规则描述语言，灵活而强大，参考其他文章。<br><br><br></del> my <del><br><br>lsof<br><br>lsof abc.txt 显示开启文件abc.txt的进程<br>lsof -i :22 知道22端口现在运行什么程序<br>lsof -c proc_name 显示进程proc_name现在打开的文件<br>lsof -p 12 看进程号为12的进程打开了哪些文件<br>lsof -g gid 显示归属gid的进程情况<br>lsof +d /usr/local/ 显示目录下被进程开启的文件<br>lsof +D /usr/local/ 同上，但是会搜索目录下的目录，时间较长<br>lsof -d 4 显示使用fd为4的进程<br>lsof -r [t] 控制lsof不断重复执行，缺省是15s刷新<br>lsof -s 列出打开文件的大小，如果没有大小，则留下空白<br>lsof -u username 以UID，列出打开的文件<br><br>语法: lsof -i[46] [protocol][@hostname|hostaddr][:service|port]<br>46 –&gt; IPv4 or IPv6<br>protocol –&gt; TCP or UDP<br>hostname –&gt; Internet host name<br>hostaddr –&gt; IPv4位置<br>service –&gt; /etc/service中的 service name (可以不止一个)<br>port –&gt; 端口号(可以不止一个)<br>例子: TCP:25 - TCP and port 25<br>@1.2.3.4 - Internet IPv4 host address 1.2.3.4<br>tcp@ohaha.ks.edu.tw:ftp - TCP protocol hosthaha.ks.edu.tw service name:ftp<br>lsof -n 不将IP转换为hostname，预设是不加上-n参数<br>例子: lsof -i tcp@ohaha.ks.edu.tw:ftp -n<br><br></del> my <del><br><br>netstat<br><br> -t、-u、-w 和-x 分别表示TCP、UDP、RAW和UNIX套接字连接<br>-i 显示网络接口 <br>-p, –programs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;         display PID/Program name for sockets<br>-c, –continuous&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;         continuous listing<br>-e, –extend&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;         display other/more information<br>eg:<br>tcpdump -ta<br> 显示活动或被动以及等待接入的tcp套接字<br><br><br></del> my <del><br><br>tcpdump<br>-e &#160;&#160;             显示mac物理地址<br>-S&#160;&#160; 显示绝对ACK序列号，不加-S默认会输出相对于初始序列号的相对偏移量<br><br>eg: tcpdump dst net not 192.168.123.0/24<br>tcpdump dst net not 192.168.123.0/24 and dst port not ( www or 25 or 110 or 5000 or domain ) and src port ! ( 4011 or 4010 or 4009 )<br>tcpdump ether src 00:50:04:BA:9B<br><br>ip icmp arp rarp 和 tcp、udp、icmp这些选项等都要放到第一个参数的位置，用来过滤数据报的类型<br>tcpdump udp and src host 192.168.0.1<br><br><br></del> my <del><br><br>iptables<br><br><strong>eg:<br>在10.214.9.191机器上nat映射 bbs 服务和 FTP 服务<br><br>iptables -t nat -A PREROUTING -p tcp -d 10.214.9.191 –dport 8823 -j DNAT –to 10.13.21.88:23<br>iptables -t nat -A POSTROUTING -p tcp -d 10.13.21.88 –dport 23 -j SNAT –to 10.214.9.191<br><br>＃注意：要成功映射FTP服务，需要加载ip_nat_ftp和ip_conntrack_ftp内核模块<br>＃modprobe ip_nat_ftp<br>iptables -t nat -A PREROUTING -p tcp -d 10.214.9.191 –dport 8821 -j DNAT –to 10.214.9.113:21<br>iptables -t nat -A POSTROUTING -p tcp -d 10.214.9.113 –dport 21 -j SNAT –to 10.214.9.191</strong><br><br><strong>iptables -nvL</strong>&#160;&#160;&#160;       list all rules<br><br>other ref:<br>实例：<a target="_blank" href="http://blog.csdn.net/yeqihong/archive/2007/02/06/1503596.aspx">http://blog.csdn.net/yeqihong/archive/2007/02/06/1503596.aspx</a><br><a href="http://blog.csdn.net/Lamour/archive/2007/05/31/1632464.aspx" target="_blank">http://blog.csdn.net/Lamour/archive/2007/05/31/1632464.aspx</a><br><br><br></del> my  <del><br><br>ip/route<br><br># 以下两个等价<br>ip route add 10.0.0.0/8 dev eth0<br>route add -net 10.0.0.0 netmask 255.0.0.0 dev eth0<br><br># 以下两个等价<br>ip route add 10.0.0.0/8 via $gateway<br>route add -net 10.0.0.0 netmask 255.0.0.0 gw $gateway<br><br># 以下是否重复$gateway 和 dev eth0&#160;&#160;               ???<br>ip route add 10.0.0.0/8 via $gateway dev eth0<br>route add -net 10.0.0.0 netmask 255.0.0.0 gw $gateway dev eth0<br><br>route -n  的输出标志位：<br><li>U (route is up)：該路由已經啟動了；</li><li>H (target is a host)：目標是一個主機( IP )，例如上面範例中的 140.116.141.253 那一個；</li><li>G (use gateway)：用來作為 gateway 的設定；</li><li>R (reinstate route for dynamic routing)：使用動態路由時，恢復路由資訊的旗標；</li><li>D (dynamically installed by daemon or redirect)：已經由服務或轉 port 功能設定為 動態路由；</li><li>M (modified from routing daemon or redirect)：路由已經被修改了；</li><li>!&#160;&#160;             (reject route)：這個路由將不會被接受(用來抵擋不安全的網域！)</li><br><br><br></del> my  <del><br><br><br> <strong><br></strong><br><br><br><br><br><br><br><br><br></del>continue~~ </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/06/Linux网络工具：IPTABLES-～-ip-route-～-tcpdump-～-netstat-～-and-so-on/" class="archive-article-date">
  	<time datetime="2008-07-05T16:54:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-06</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Network/">Network</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【OpenVPN】配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/03/【OpenVPN】配置/">【OpenVPN】配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p><a target="_blank" href="http://openvpn.net/index.php/documentation/howto.html#examples">http://openvpn.net/index.php/documentation/howto.html#examples</a></p><p>openvpn   –config server.ovpn   –lport 1194<br>openvpn   –config client.ovpn   –remote 10.10.10.22 1194   –lport 7890</p><p> </p><hr><a name="scope" title="scope"></a>Expanding the scope of the VPN to include additional machines on either the client or server subnet.Including multiple machines on the server side when using a routed VPN (dev tun)<p>Once the VPN is operational in a point-to-point capacity between client and server, it may be desirable to expand the scope of the VPN so that clients can reach multiple machines on the server network, rather than only the server machine itself.</p><p>For the purpose of this example, we will assume that the server-side LAN uses a subnet of <strong>10.66.0.0/24</strong> and the VPN IP address pool uses <strong>10.8.0.0/24</strong> as cited in the <strong>server</strong> directive in the OpenVPN server configuration file.</p><p>First, you must <em>advertise</em> the <strong>10.66.0.0/24</strong> subnet to VPN clients as being accessible through the VPN. This can easily be done with the following server-side config file directive:</p><blockquote><strong>push &quot;route 10.66.0.0 255.255.255.0&quot;</strong></blockquote><p>Next, you must set up a route on the server-side LAN gateway to route the VPN client subnet (<strong>10.8.0.0/24</strong>) to the OpenVPN server (this is only necessary if the OpenVPN server and the LAN gateway are different machines).</p><p>Make sure that you’ve enabled <a href="http://openvpn.net/faq.html#ip-forward" target="_blank" rel="external">IP</a> and <a href="http://openvpn.net/faq.html#firewall" target="_blank" rel="external">TUN/TAP</a> forwarding on the OpenVPN server machine.</p><p> </p>Including multiple machines on the client side when using a routed VPN (dev tun)<p>In a typical road-warrior or remote access scenario, the client machine connects to the VPN as a single machine. But suppose the client machine is a gateway for a local LAN (such as a home office), and you would like each machine on the client LAN to be able to route through the VPN.</p><p>For this example, we will assume that the client LAN is using the <strong>192.168.4.0/24</strong> subnet, and that the VPN client is using a certificate with a common name of <strong>client2</strong>. Our goal is to set up the VPN so that any machine on the client LAN can communicate with any machine on the server LAN through the VPN.</p><p>Before setup, there are some basic prerequisites which must be followed:</p><ul> <li>The client LAN subnet (192.168.4.0/24 in our example) must not be exported to the VPN by the server or any other client sites which are using the same subnet. Every subnet which is joined to the VPN via routing must be unique.</li> <li>The client must have a unique Common Name in its certificate (&quot;client2&quot; in our example), and the <strong>duplicate-cn</strong> flag must not be used in the OpenVPN server configuration file.</li></ul><p>First, make sure that <a href="http://openvpn.net/faq.html#ip-forward" target="_blank" rel="external">IP</a> and <a href="http://openvpn.net/faq.html#firewall" target="_blank" rel="external">TUN/TAP</a> forwarding is enabled on the client machine.</p>Enabling TCP/IP Forwarding                        1.            Use Registry Editor (Regedt32.exe) to view the following registry key:             HKEY_LOCAL_MACHINESYSTEMCurrentControlSetServicesTcpipParameters                                         2.            Set the following registry value:             Value Name: IPEnableRouter<br>            Value type: REG_DWORD<br>            Value Data: 1             <strong>NOTE</strong>: A value of 1 enables TCP/IP forwarding for all network connections installed and used by this computer.             <p>Next, we will deal with the necessary configuration changes on the server side. If the server configuration file does not currently reference a client configuration directory, add one now:</p><blockquote><strong>client-config-dir ccd</strong></blockquote><p>In the above directive, <strong>ccd</strong> should be the name of a directory which has been pre-created in the default directory where the OpenVPN server daemon runs. On Linux this tends to be <strong>/etc/openvpn</strong> and on Windows it is usually <strong>Program FilesOpenVPNconfig</strong>. When a new client connects to the OpenVPN server, the daemon will check this directory for a file which matches the common name of the connecting client. If a matching file is found, it will be read and processed for additional configuration file directives to be applied to the named client.</p><p>The next step is to create a file called <strong>client2</strong> in the <strong>ccd</strong> directory.  This file should contain the line:</p><blockquote><strong>iroute 192.168.4.0 255.255.255.0</strong></blockquote><p>This will tell the OpenVPN server that the 192.168.4.0/24 subnet should be routed to <strong>client2</strong>.</p><p>Next, add the following line to the main server config file (not the <strong>ccd/client2</strong> file):</p><blockquote><strong>route 192.168.4.0 255.255.255.0</strong></blockquote><p>Why the redundant <strong>route</strong> and <strong>iroute</strong> statements, you might ask? The reason is that <strong>route</strong> controls the routing from the kernel to the OpenVPN server (via the TUN interface) while <strong>iroute</strong> controls the routing from the OpenVPN server to the remote clients.  Both are necessary.</p><p>Next, ask yourself if you would like to allow network traffic between client2’s subnet (192.168.4.0/24) and other clients of the OpenVPN server. If so, add the following to the server config file.</p><blockquote><strong>client-to-client<br>push &quot;route 192.168.4.0 255.255.255.0&quot;</strong></blockquote><p>This will cause the OpenVPN server to <em>advertise</em> client2’s subnet to other connecting clients.</p><p>The last step, and one that is often forgotten, is to add a route to the server’s LAN gateway which directs 192.168.4.0/24 to the OpenVPN server box (you won’t need this if the OpenVPN server box <em>is</em> the gateway for the server LAN). Suppose you were missing this step and you tried to ping a machine (not the OpenVPN server itself) on the server LAN from 192.168.4.8? The outgoing ping would probably reach the machine, but then it wouldn’t know how to route the ping reply, because it would have no idea how to reach 192.168.4.0/24. The rule of thumb to use is that when routing entire LANs through the VPN (when the VPN server is not the same machine as the LAN gateway), make sure that the gateway for the LAN routes all VPN subnets to the VPN server machine.</p><p>Similarly, if the client machine running OpenVPN is not also the gateway for the client LAN, then the gateway for the client LAN must have a route which directs all subnets which should be reachable through the VPN to the OpenVPN client machine.</p><p> </p><br><br><hr>Pushing DHCP options to clients<p>The OpenVPN server can push DHCP options such as DNS and WINS server addresses to clients (some <a href="http://openvpn.net/faq.html#dhcpcaveats" target="_blank" rel="external">caveats</a> to be aware of). Windows clients can accept pushed DHCP options natively, while non-Windows clients can accept them by using a client-side <strong>up</strong> script which parses the <strong>foreign<em>option</em><em>n</em></strong> environmental variable list. See the <a href="http://openvpn.net/man.html" target="_blank" rel="external">man page</a> or <a href="http://openvpn.net/mail.html" target="_blank" rel="external">openvpn-users mailing list archive</a> for non-Windows <strong>foreign<em>option</em><em>n</em></strong> documentation and script examples.</p><p>For example, suppose you would like connecting clients to use an internal DNS server at 10.66.0.4 or 10.66.0.5 and a WINS server at 10.66.0.8. Add this to the OpenVPN server configuration:</p><blockquote><strong>push &quot;dhcp-option DNS 10.66.0.4&quot;<br>push &quot;dhcp-option DNS 10.66.0.5&quot;<br>push &quot;dhcp-option WINS 10.66.0.8&quot;</strong></blockquote><p>To test this feature on Windows, run the following from a command prompt window after the machine has connected to an OpenVPN server:</p><blockquote><strong>ipconfig /all</strong></blockquote><p>The entry for the TAP-Win32 adapter should show the DHCP options which were pushed by the server.</p><br><br><hr><a name="redirect" title="redirect"></a>Routing all client traffic (including web-traffic) through the VPNOverview<p>By default, when an OpenVPN client is active, only network traffic to and from the OpenVPN server site will pass over the VPN. General web browsing, for example, will be accomplished with direct connections that bypass the VPN.</p><p>In certain cases this behavior might not be desirable – you might want a VPN client to tunnel all network traffic through the VPN, including general internet web browsing. While this type of VPN configuration will exact a performance penalty on the client, it gives the VPN administrator more control over security policies when a client is simultaneously connected to both the public internet and the VPN at the same time.</p>Implementation<p>Add the following directive to the server configuration file:</p><blockquote><strong>push &quot;redirect-gateway def1&quot;</strong></blockquote><p>If your VPN setup is over a wireless network, where all clients and the server are on the same wireless subnet, add the <strong>local</strong> flag:</p><blockquote><strong>push &quot;redirect-gateway local def1&quot;</strong></blockquote><p>Pushing the <strong>redirect-gateway</strong> option to clients will cause all IP network traffic originating on client machines to pass through the OpenVPN server. The server will need to be configured to deal with this traffic somehow, such as by NATing it to the internet, or routing it through the server site’s HTTP proxy.</p><p>On Linux, you could use a command such as this to NAT the VPN client traffic to the internet:</p><blockquote><strong>iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE</strong></blockquote><p>This command assumes that the VPN subnet is <strong>10.8.0.0/24</strong> (taken from the <strong>server</strong> directive in the OpenVPN server configuration) and that the local ethernet interface is <strong>eth0</strong>.</p><p>When <strong>redirect-gateway</strong> is used, OpenVPN clients will route DNS queries through the VPN, and the VPN server will need handle them. This can be accomplished by pushing a DNS server address to connecting clients which will replace their normal DNS server settings during the time that the VPN is active. For example:</p><blockquote><strong>push &quot;dhcp-option DNS 10.8.0.1&quot;</strong></blockquote><p>will configure Windows clients (or non-Windows clients with some extra server-side scripting) to use 10.8.0.1 as their DNS server. Any address which is reachable from clients may be used as the DNS server address.</p>Caveats<p>Redirecting all network traffic through the VPN is not entirely a problem-free proposition. Here are some typical gotchas to be aware of:</p><ul> <li>Many OpenVPN client machines connecting to the internet will periodically interact with a DHCP server to renew their IP address leases. The <strong>redirect-gateway</strong> option might prevent the client from reaching the local DHCP server (because DHCP messages would be routed over the VPN), causing it to lose its IP address lease.</li> <li><a href="http://openvpn.net/faq.html#dhcpcaveats" target="_blank" rel="external">Issues exist</a> with respect to pushing DNS addresses to Windows clients.</li> <li>Web browsing performance on the client will be noticably slower.</li></ul><p>For more information on the mechanics of the <strong>redirect-gateway</strong> directive, see the <a href="http://openvpn.net/man.html" target="_blank" rel="external">manual page</a>.</p><p> </p><hr><br><br>                                    Setting up your own Certificate Authority (CA) and generating certificates and keys for an OpenVPN server and multiple clients            Overview            <p>The first step in building an OpenVPN 2.0 configuration is to establish a PKI (public key infrastructure).  The PKI consists of:</p> <ul> <li>a separate certificate (also known as a public key) and private key for the server and each client, and</li> <li>a master Certificate Authority (CA) certificate and key which is used to sign each of the server and client certificates.</li> </ul> <p>OpenVPN supports bidirectional authentication based on certificates, meaning that the client must authenticate the server certificate and the server must authenticate the client certificate before mutual trust is established.</p> <p>Both server and client will authenticate the other by first verifying that the presented certificate was signed by the master certificate authority (CA), and then by testing information in the now-authenticated certificate header, such as the certificate common name or certificate type (client or server).</p> <p>This security model has a number of desirable features from the VPN perspective:</p> <ul> <li>The server only needs its own certificate/key – it doesn’t need to know the individual certificates of every client which might possibly connect to it.</li> <li>The server will only accept clients whose certificates were signed by the master CA certificate (which we will generate below). And because the server can perform this signature verification without needing access to the CA private key itself, it is possible for the CA key (the most sensitive key in the entire PKI) to reside on a completely different machine, even one without a network connection.</li> <li>If a private key is compromised, it can be disabled by adding its certificate to a CRL (certificate revocation list). The CRL allows compromised certificates to be selectively rejected without requiring that the entire PKI be rebuilt.</li> <li>The server can enforce client-specific access rights based on embedded certificate fields, such as the Common Name.</li> </ul>            Generate the master Certificate Authority (CA) certificate &amp; key            <p>In this section we will generate a master CA certificate/key, a server certificate/key, and certificates/keys for 3 separate clients.</p> <p>For PKI management, we will use a set of scripts bundled with OpenVPN.</p> <p>If you are using Linux, BSD, or a unix-like OS, open a shell and cd to the <strong>easy-rsa</strong> subdirectory of the OpenVPN distribution. If you installed OpenVPN from an RPM file, the easy-rsa directory can usually be found in <strong>/usr/share/doc/packages/openvpn</strong> or <strong>/usr/share/doc/openvpn-2.0</strong> (it’s best to copy this directory to another location such as <strong>/etc/openvpn</strong>, before any edits, so that future OpenVPN package upgrades won’t overwrite your modifications). If you installed from a .tar.gz file, the easy-rsa directory will be in the top level directory of the expanded source tree.</p> <p>If you are using Windows, open up a Command Prompt window and cd to <strong>Program FilesOpenVPNeasy-rsa</strong>. Run the following batch file to copy configuration files into place (this will overwrite any preexisting vars.bat and openssl.cnf files):</p> <blockquote> <strong>init-config</strong> </blockquote> <p>Now edit the <strong>vars</strong> file (called <strong>vars.bat</strong> on Windows) and set the KEY_COUNTRY, KEY_PROVINCE, KEY_CITY, KEY_ORG, and KEY_EMAIL parameters. Don’t leave any of these parameters blank.</p> <p>Next, initialize the PKI.  On Linux/BSD/Unix:</p> <blockquote> <strong>. ./vars<br>./clean-all<br>./build-ca<br></strong> </blockquote> <p>On Windows:</p> <blockquote> <strong>vars<br>clean-all<br>build-ca<br></strong> </blockquote> <p>The final command (<strong>build-ca</strong>) will build the certificate authority (CA) certificate and key by invoking the interactive <strong>openssl</strong> command:</p> <blockquote>ai:easy-rsa # ./build-ca<br>Generating a 1024 bit RSA private key<br>…………++++++<br>………..++++++<br>writing new private key to ‘ca.key’<br>—–<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter ‘.’, the field will be left blank.<br>—–<br>Country Name (2 letter code) [KG]:<br>State or Province Name (full name) [NA]:<br>Locality Name (eg, city) [BISHKEK]:<br>Organization Name (eg, company) [OpenVPN-TEST]:<br>Organizational Unit Name (eg, section) []:<br>Common Name (eg, your name or your server’s hostname) []:OpenVPN-CA<br>Email Address [me@myhost.mydomain]:</blockquote> <p>Note that in the above sequence, most queried parameters were defaulted to the values set in the <strong>vars</strong> or <strong>vars.bat</strong> files.  The only parameter which must be explicitly entered is the <strong>Common Name</strong>.  In the example above, I used &quot;OpenVPN-CA&quot;.</p>            Generate certificate &amp; key for server            <p>Next, we will generate a certificate and private key for the server.  On Linux/BSD/Unix:</p> <blockquote> <strong>./build-key-server server</strong> </blockquote> <p>On Windows:</p> <blockquote> <strong>build-key-server server</strong> </blockquote> <p>As in the previous step, most parameters can be defaulted. When the <strong>Common Name</strong> is queried, enter &quot;server&quot;. Two other queries require positive responses, &quot;Sign the certificate? [y/n]&quot; and &quot;1 out of 1 certificate requests certified, commit? [y/n]&quot;.</p>            Generate certificates &amp; keys for 3 clients            <p>Generating client certificates is very similar to the previous step.  On Linux/BSD/Unix:</p> <blockquote> <strong>./build-key client1<br>./build-key client2<br>./build-key client3</strong> </blockquote> <p>On Windows:</p> <blockquote> <strong>build-key client1<br>build-key client2<br>build-key client3</strong> </blockquote> <p>If you would like to password-protect your client keys, substitute the <strong>build-key-pass</strong> script.</p> <p>Remember that for each client, make sure to type the appropriate <strong>Common Name</strong> when prompted, i.e. &quot;client1&quot;, &quot;client2&quot;, or &quot;client3&quot;.  Always use a unique common name for each client.</p>            Generate Diffie Hellman parameters            <p><a href="http://www.rsasecurity.com/rsalabs/node.asp?id=2248" target="_blank" rel="external"> Diffie Hellman</a> parameters must be generated for the OpenVPN server.  On Linux/BSD/Unix:</p> <blockquote> <strong>./build-dh</strong> </blockquote> <p>On Windows:</p> <blockquote> <strong>build-dh</strong> </blockquote> <p>Output:</p> <blockquote>ai:easy-rsa # ./build-dh<br>Generating DH parameters, 1024 bit long safe prime, generator 2<br>This is going to take a long time<br>……………..+…………………………………….<br>……………….+………….+……………..+………<br>………………………………..</blockquote>Key Files<p>Now we will find our newly-generated keys and certificates in the <strong>keys</strong> subdirectory.  Here is an explanation of the relevant files:</p> <strong>Filename</strong> <strong>Needed By</strong> <strong>Purpose</strong> <strong>Secret</strong>                            ca.crt            server + all clients            Root CA certificate            NO                            ca.key            key signing machine only            Root CA key            YES                            dh{n}.pem            server only            Diffie Hellman parameters            NO                            server.crt            server only            Server Certificate            NO                            server.key            server only            Server Key            YES                            client1.crt            client1 only            Client1 Certificate            NO                            client1.key            client1 only            Client1 Key            YES                            client2.crt            client2 only            Client2 Certificate            NO                            client2.key            client2 only            Client2 Key            YES                            client3.crt            client3 only            Client3 Certificate            NO                            client3.key            client3 only            Client3 Key            YES            <p>The final step in the key generation process is to copy all files to the machines which need them, taking care to copy secret files over a secure channel.</p><p>Now wait, you may say.  Shouldn’t it be possible to set up the PKI without a pre-existing secure channel?</p><p> </p><p>The answer is ostensibly yes. In the example above, for the sake of brevity, we generated all private keys in the same place. With a bit more effort, we could have done this differently. For example, instead of generating the client certificate and keys on the server, we could have had the client generate its own private key locally, and then submit a Certificate Signing Request (CSR) to the key-signing machine. In turn, the key-signing machine could have processed the CSR and returned a signed certificate to the client. This could have been done without ever requiring that a secret <strong>.key</strong> file leave the hard drive of the machine on which it was generated.</p><p> </p><br><hr><a title="control" name="control"></a>Controlling a running OpenVPN processRunning on Linux/BSD/Unix<p>OpenVPN accepts several signals:</p><ul> <li><strong>SIGUSR1</strong> – Conditional restart, designed to restart without root privileges</li> <li><strong>SIGHUP</strong> – Hard restart</li> <li><strong>SIGUSR2</strong> – Output connection statistics to log file or syslog</li> <li><strong>SIGTERM</strong>, <strong>SIGINT</strong> – Exit</li></ul><p>Use the <strong>writepid</strong> directive to write the OpenVPN daemon’s PID to a file, so that you know where to send the signal (if you are starting openvpn with an <strong>initscript</strong>, the script may already be passing a <strong>–writepid</strong> directive on the <strong>openvpn</strong> command line).</p>Running in a Windows command prompt window<p>On Windows, you can start OpenVPN by right clicking on an OpenVPN configuration file (<strong>.ovpn</strong> file) and selecting &quot;Start OpenVPN on this config file&quot;.</p><p>Once running in this fashion, several keyboard commands are available:</p><ul> <li><strong>F1</strong> – Conditional restart (doesn’t close/reopen TAP adapter)</li> <li><strong>F2</strong> – Show connection statistics</li> <li><strong>F3</strong> – Hard restart</li> <li><strong>F4</strong> – Exit</li></ul>Status File<p>The default <a href="http://openvpn.net/howto.html#server" target="_blank" rel="external">server.conf</a> file has a line</p><blockquote><strong>status openvpn-status.log</strong></blockquote><p>which will output a list of current client connections to the file <strong>openvpn-status.log</strong> once per minute.</p>Using the management interface<p>The <a href="http://openvpn.net/management.html" target="_blank" rel="external">OpenVPN management interface</a> allows a great deal of control over a running OpenVPN process. You can use the management interface directly, by telneting to the management interface port, or indirectly by using an <a href="http://openvpn.net/gui.html" target="_blank" rel="external">OpenVPN GUI</a> which itself connects to the management interface.</p><p>To enable the management interface on either an OpenVPN server or client, add this to the configuration file:</p><blockquote><strong>management localhost 7505</strong></blockquote><p>This tells OpenVPN to listen on TCP port 7505 for management interface clients (port 7505 is an arbitrary choice – you can use any free port).</p>Once OpenVPN is running, you can connect to the management interface using a <strong>telnet</strong> client.  For example:        <blockquote>ai:~ # telnet localhost 7505<br>Trying 127.0.0.1…<br>Connected to localhost.<br>Escape character is ‘^]’.<br>&gt;INFO:OpenVPN Management Interface Version 1 – type ‘help’ for more info<br>help<br>Management Interface for OpenVPN 2.0_rc14 i686-suse-linux [SSL] [LZO] [EPOLL] built on Feb 15 2005<br>Commands:<br>echo [on|off] [N|all]  : Like log, but only show messages in echo buffer.<br>exit|quit              : Close management session.<br>help                   : Print this message.<br>hold [on|off|release]  : Set/show hold flag to on/off state, or<br>                         release current hold and start tunnel.<br>kill cn                : Kill the client instance(s) having common name cn.<br>kill IP:port           : Kill the client instance connecting from IP:port.<br>log [on|off] [N|all]   : Turn on/off realtime log display<br>                         + show last N lines or ‘all’ for entire history.<br>mute [n]               : Set log mute level to n, or show level if n is absent.<br>net                    : (Windows only) Show network info and routing table.<br>password type p        : Enter password p for a queried OpenVPN password.<br>signal s               : Send signal s to daemon,<br>                         s = SIGHUP|SIGTERM|SIGUSR1|SIGUSR2.<br>state [on|off] [N|all] : Like log, but show state history.<br>status [n]             : Show current daemon status info using format #n.<br>test n                 : Produce n lines of output for testing/debugging.<br>username type u        : Enter username u for a queried OpenVPN username.<br>verb [n]               : Set log verbosity level to n, or show if n is absent.<br>version                : Show current version number.<br>END<br>exit<br>Connection closed by foreign host.<br>ai:~ #</blockquote> <strong><br></strong> <hr><br><br><br><br>#end<br><br><br><blockquote> </blockquote> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/07/03/【OpenVPN】配置/" class="archive-article-date">
  	<time datetime="2008-07-03T12:08:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-07-03</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Network/">Network</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】开发Windows-NT的后台服务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/06/30/【zz】开发Windows-NT的后台服务/">【zz】开发Windows NT的后台服务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 开发Windows NT的后台服务<br><br>摘　要：利用一组WIN32 API函数将自主开发的服务器程序扩展为 NT的 一项后台服务，让NT把其当作系统服务自动加载，从而扩充NT服务器的后台功能，并结合一 个实例说明开发中应做的工作。<br>关键词：Windows NT　后台服务　服务控制管理器<br><br>在WINDOWS NT服务器中，NT的一些后台系统服务随着NT的启动而自动加载， 不需用户人工 干预，这种方式不仅简化了服务器启动过程，同时也使一些重要服务的启动更加安全可靠。 而且，在服务器启动以后，用户也可以利用控制面板中服务控制面板应用程序灵活地设置这 些后台服务的启动属性，方便了用户对NT后台服务的管理。笔者在开发基于NT服务器的应用 程 序时，发现利用一组WIN32 API 函数完全可以将自己开发的服务器程序扩展为NT的一项后台 服务，让NT把其当作系统服务自动加载，从而扩充NT服务器的后台服务功能。下面结合一个 实例，概述开发NT后台服务应用程序的方法和步骤。<br><br>1　自定义后台服务注册<br>在NT操作系统中，所有的后台服务全都由服务控制管理器进行统一管理，这些后台服务的状 态数据都保存在服务控制管理器数据库中。所以要想创建一个新的后台服务，在应用程序的 主模块里应首先调用函数OpenSCManager打开该数据库，再调用函数CreateService在此数据 库中创建1个新的服务线程对象，并将该线程对象启动属性设置为随系统启动自动加载，这 样NT在重新启动时该线程就会由NT自动启动。完成这一步，仅仅实现了后台服务线程对象的 注册，还没有建立与服务控制管理器的联结。<br><br>//在服务控制管理器数据库中注册后台服务线程<br>void CmdRegisterService()<br>{<br>SCHANDLE　　schService;<br>SCHANDLE　　schSCManager;<br>TCHAR szPath［512］;<br>//获得后台服务进程执行路径<br>if(GetModuleFileName(NULL,szPath,512)==0)<br>{tprintf(TEXT(&ldquo;Unable to install %s - %s＼n&quot;)，<br>TEXT(&ldquo;Service Example&quot;), GetLastErrorText(szErr, 256));<br>return;<br>}<br>//打开服务控制管理器数据库<br>schSCManager=OpenSCManager(<br>NULL,　　　//本地机器<br>NULL,　　　//默认数据库<br>SCMANAGERALLACCESS //访问权限<br>);<br>//在此数据库中创建后台服务线程对象<br>if(schSCManager)<br>{　schService=CreateService(<br>schSCManager,　//服务控制管理器数据库<br>TEXT(&ldquo;ServiceExample&quot;),　//后台服务名称<br>TEXT(&ldquo;Service Example&quot;),//在服务控制面板中显示的//服务名称<br>SERVICEALLACCESS,　//访问权限<br>SERVICEWIN32OWNPROCESS,　//服务类型<br>SERVICEAUTOSTART,　//启动类型，随系统自动//加载<br>SERVICEERRORNORMAL,<br>szPath,<br>NULL,<br>NULL,<br>TEXT(&ldquo;&quot;),<br>NULL,　　//本地系统帐号<br>NULL);// 没有口令<br>//在这里可以创建多个后台服务线程对象，完成不同的<br>//后台任务<br>if(schService)<br>{tprintf(TEXT(&ldquo;%s installed.＼n&quot;),TEXT(&ldquo;Service Example&quot;)); <br>CloseServiceHandle(schService);<br>}<br>else<br>{tprintf(TEXT(&ldquo;CreateService failed-%s＼n&quot;),<br>GetLastErrorText(szErr, 256))；<br>}<br>CloseServiceHandle(schSCManager)；<br>}<br>else<br>tprintf(TEXT(&ldquo;OpenSCManager failed - %s＼n&quot;),<br>GetLastErrorText(szErr,256))；<br>}<br><br>2　定义后台服务线程入口点ServiceMain<br>在此之前应该首先定义服务线程入口表(SERVICETABLEENTRY)，它记录 了服务器应用程序 要执行的所有后台服务的入口点(在1个服务器应用程序中可同时加载多个后台服务线程)。 每一个后台服务线程都有自己的ServiceMain执行入口点。当服务控制管理器接收到启动后 台服务的命令后，它会首先将启动命令发送到服务控制分配器中，然后，服务控制分配器就 会按照服务线程入口表定义的对应关系启动1个新线程去执行指定的后台服务。在Servic eMain中应当调用RegisterServiceCtrlHandler先注册1个服务控制函数Handler，它负责接 收和处理服务控制管理器发出的命令，并通过调用SetServiceStatus重新设置后台服务状态 ，将被启动的后台服务状态信息回送到服务控制管理器中。这些操作主要是在后台服务线程 启动之前完成一些必要的初始化工作。ServiceMain及Handler是占位符，在程序中可以用不 同的名称定义自己的后台服务线程入口函数和服务控制处理函数。<br><br>//定义后台服务线程入口表<br>SERVICETABLEENTRY MyServiceTable［］=<br>{<br>{<br>TEXT(&ldquo;ServiceExample&quot;),//后台服务线程的名称<br>(LPSERVICEMAINFUNCTION)MyServiceMain//后台服//务线程入口点<br>},<br>{NULL, NULL }　　　//标志表的结束<br>};<br>//服务线程入口函数<br>void WINAPI MyServiceMain(DWORD dwArgc, LPTSTR <em>lpszArgv)<br>{<br>//注册服务控制处理函数<br>sshStatusHandle=RegisterServiceCtrlHandler(TEXT(&ldquo;ServiceExample&quot;), Servi ceControlHandler);<br>if(!sshStatusHandle)<br>goto cleanup;<br>//服务类型<br>ssStatus.dwServiceType=SERVICEWIN32OWNPROCESS; <br>//指定的出错代码<br>ssStatus.dwServiceSpecificExitCode=0;<br>//启动自己定义的后台服务<br>ServiceStart();<br>cleanup:<br>if(sshStatusHandle)<br>(VOID)ReportStatusToSCMgr(<br>SERVICESTOPPED,dwErr,0);<br>return;<br>}<br><br>//服务控制处理函数:负责接收和处理服务控制管理器发出的<br>//命令<br>VOID WINAPI ServiceControlHandler(DWORD dwCtrlCode)<br>{<br>switch(dwCtrlCode)<br>{<br>//停止服务之前，应首先向服务控制管理器回送状态信息<br>case SERVICECONTROLSTOP:<br>ReportStatusToSCMgr(SERVICESTOPPENDING,NOE RROR, 0);<br>ServiceStop();<br>return;<br>//更新服务状态<br>case SERVICECONTROLINTERROGATE:<br>break;<br>default:<br>break;<br>}<br>//向服务控制面板管理器回送状态信息<br>ReportStatusToSCMgr(ssStatus.dwCurrentState, NOERROR, 0); <br>}<br><br>//设置当前服务状态并将状态信息回送到服务控制管理器<br>BOOL ReportStatusToSCMgr(DWORD dwCurrentState,DWORD<br>dwWin32ExitCode,WORD dwWaitHint)<br>{<br>static DWORD dwCheckPoint=1;<br>BOOL fResult=TRUE;<br>if(dwCurrentState==SERVICESTARTPENDING)<br>ssStatus.dwControlsAccepted=0;<br>else<br>ssStatus.dwControlsAccepted=SERVICEACCEPTSTOP;<br>//设置状态信息<br>ssStatus.dwCurrentState=dwCurrentState;<br>ssStatus.dwWin32ExitCode=dwWin32ExitCode;<br>ssStatus.dwWaitHint=dwWaitHint;<br>if((dwCurrentState==SERVICERUNNING )‖<br>(dwCurrentState==SERVICESTOPPED))<br>ssStatus.dwCheckPoint=0;<br>else<br>ssStatus.dwCheckPoint=dwCheckPoint++;<br>//将状态信息回送到服务控制管理器<br>if(!(fResult=SetServiceStatus(sshStatusHandle,&amp;ssStatus))){<br>AddToMessageLog(TEXT(&ldquo;SetServiceStatus&quot;));//向NT事//件管理器报告出错消息<br>}<br>return fResult;<br>}<br><br>3　建立应用程序主线程与服务控制管理器的连接<br>在创建了服务器应用程序的所有服务线程对象后，当NT重新启动加载该服务器进程或者从服 务控制面板中手工启动该服务进程时, 服务器应用程序主线程就会调用函数StartServiceCt rlDispatcher建立服务进程主线程与服务控制管理器的连接，使得主线程扮演起服务控制分 配器的角色，只有当所有的服务线程终止后，该主线程才会完成任务并返回。利用上述过程 建立起来的连接，服务控制管理器会将服务控制面板中用户对服务进程的控制命令(Start、 Terminate等)发送到主线程中,交给服务控制分配器处理。<br><br>//服务进程入口<br>voidCRTAPI1 main(int argc, char **argv)<br>{<br>if((argc&gt;1)&amp;&amp;((</em>argv［1］==&lsquo;-&rsquo;)‖(*argv［1］==&lsquo;/&rsquo;)) )<br>{<br>if(stricmp(&ldquo;register&quot;, argv［1］+1)==0)<br>CmdRegisterService(); //注册后台服务线程对象<br>else<br>goto dispatch;<br>exit(0);<br>}<br>dispatch:<br>//启动服务控制分配器，建立主线程与服务控制面板的<br>//连接<br>if(StartServiceCtrlDispatcher(MyServiceTable))<br>AddToMessageLog(TEXT (&ldquo;StartServiceCtrlDispatcher success.&quot;));<br>}<br><br>4　定义自己的后台服务实现主模块<br>该模块放在服务线程入口点ServiceMain中，在服务线程初始化完毕以后，就可以启动自己 定义的后台服务。　　<br><br>void ServiceStart()<br>{<br>//向服务控制管理器报告服务正在启动<br>if(!ReportStatusToSCMgr(<br>SERVICESTARTPENDING,　//service state<br>NOERROR,<br>dwWaitHint))<br>return;<br>//下面是线程的初始化代码(注意:初始化代码执行时间<br>//不应超过设定的nWaitHi nt，否则服务控制管理器会认<br>//为服务线程已经没有响应<br>//向服务控制管理器报告服务已经启动<br>if(!ReportStatusToSCMgr(<br>SERVICERUNNING,　　//service state<br>NOERROR,　　　//exit code<br>0))　　　　//wait hint<br>return;<br>//开始执行服务<br>}<br>//停止后台服务线程<br>void ServiceStop()<br>{<br>//添加结束服务线程代码<br>}<br><br>在该示例中，后台服务线程在服务器上创建1个网络套接字，并在6002端口监听TCP/IP客 户 的连接请求。如果与新的客户建立连接后，首先向其发送欢迎消息，接下来，只要每收到客 户发送过来的消息，就会向其回送1个确认信息，直到连接断开以后重新进入监听状态。感 兴趣的读者可以将本程序在VC5.0中编译成可执行文件(在AppWizard中选择Win32 Console A pplication,工程名为ntservice)，然后在WINDOWS NT SERVER4.0的控制台中输入&ldquo;ntservi ce -register&rdquo;，再重新启动服务器，打开控制面板中的服务管理器，就可以看到Service Example已启动。如果要测试服务例程的响应功能，可以自己编写1个TCP/IP客户程序，并连 接 到该服务器的端口6002。本程序在VC5.0中编译连接，在中文WINDOWS NT SERVER4.0中调试 通过。 </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/06/30/【zz】开发Windows-NT的后台服务/" class="archive-article-date">
  	<time datetime="2008-06-30T14:22:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-06-30</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Windows/">Windows</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】python脚本作为Windows服务启动" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/06/30/【zz】python脚本作为Windows服务启动/">【zz】python脚本作为Windows服务启动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 如果我们想让系统启动的时候就执行某个程序，windows系统和unix系统是不一样的，对于unix只需要将要执行的命令放到 rc.local中，系统重新启动的时候就可以加载了。windows就麻烦多了，如果你将程序放到启动组中，只有输入了密码后，程序才被执行，如果想在 系统一启动的时候就执行程序，必须使用nt服务。 <br>python下如何使用nt服务，其实很简单。 <br>下载python的win32支持。我使用的是：pywin32-202.win32-py2.3.exe安装好后就可以来写我们的服务了。 <br>我们先来建立一个空的服务，建立test1.py这个文件，并写入如下代码: <br><br># -<em>- coding: cp936 -</em>- <br>import win32serviceutil <br>import win32service <br>import win32event <br><br>class test1(win32serviceutil.ServiceFramework): <br>&nbsp;&nbsp;&nbsp;&nbsp;   _svc<em>name</em> = &quot;test_python&quot; <br>&nbsp;&nbsp;&nbsp;&nbsp;   _svc_display<em>name</em> = &quot;test_python&quot; <br>&nbsp;&nbsp;&nbsp;&nbsp;   def <strong>init</strong>(self, args): <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   win32serviceutil.ServiceFramework.<strong>init</strong>(self, args) <br><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   self.hWaitStop = win32event.CreateEvent(None, 0, 0, None) <br><br>&nbsp;&nbsp;&nbsp;&nbsp;   def SvcStop(self): <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   # 先告诉SCM停止这个过程 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   # 设置事件 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   win32event.SetEvent(self.hWaitStop) <br><br>&nbsp;&nbsp;&nbsp;&nbsp;   def SvcDoRun(self): <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   # 等待服务被停止 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   win32event.WaitForSingleObject(self.hWaitStop, win32event.INFINITE) <br><br>if <strong>name</strong>==’<strong>main</strong>‘: <br>&nbsp;&nbsp;&nbsp;&nbsp;   win32serviceutil.HandleCommandLine(test1)<br><br>这里注意，如果你需要更改文件名，比如将win32serviceutil.HandleCommandLine(test1)中的test1更改为你的文件名，同时class也需要和你的文件名一致，否则会出现服务不能启动的问题。 <br>在命令窗口执行，test1.py可以看到帮助提示 <br><br>C:&gt;test1.py <br>Usage: ‘test1.py [options] install|update|remove|start […]|stop|restart […]| <br>debug […]’ <br>Options for ‘install’ and ‘update’ commands only: <br>–username domainusername : The Username the service is to run under <br>–password password : The password for the username <br>–startup [manual|auto|disabled] : How the service starts, default = manual <br>–interactive : Allow the service to interact with the desktop. （for my auto_desktop.py, this option is needed）<br><br>C:&gt;<br><br>安装我们的服务 <br><br>[code:1:05b7353f1c]C:&gt;test1.py install <br>Installing service test_python to Python class C:test1.test1 <br>Service installed <br><br>C:&gt;<br><br>我们就可以用命令或者在控制面板-》管理工具-》服务中管理我们的服务了。在服务里面可以看到test_python这个服务，虽然这个服务什么都不做，但能启动和停止他。<br><br><br>————————————————————————————————————————————————————————<a href="http://lgj573.javaeye.com/blog/181483" target="_blank" rel="external">关于如何注册Windows2000服务</a>想让一个程序在启动系统的时候自动运行，你有什么好办法？添加到启动组？那如果别人删除掉就不管用了。如果你使用了Windows NT/2000/XP，就可以试试把这个程序添加为一个服务，这样只有拥有权限的人才可以更改服务，只要你设置好权限，就不用担心会被别人删除了。 <br><br>要把应用程序添加为服务，你需要两个小软件：Instsrv.exe和Srvany.exe。 Instsrv.exe可以给系统安装和删除服务，Srvany.exe可以让程序以服务的方式运行。这两个软件都包含在 Windows NT Resource Kit里，如果你没有，也可以点击这里下载。 <br><br>把这两个程序保存在一个方便的位置，例如C盘根目录下。我们举例来说明，把OE作为一个服务添加进Windows XP Professional操作系统中，并把这个服务命名为&ldquo;Mail&rdquo;。在运行中输入&ldquo;CMD&rdquo;，回车，打开命令行窗口，在提示符后面直接输入：&ldquo;c: instsrv.exe Mail c:srvany.exe&rdquo;然后回车，其中的&ldquo;c:instsrv.exe&rdquo;和&ldquo;c:srvany.exe&rdquo;表示这两个程序保存的位置，而Mail 则是你想添加的服务名称。 <br><br>运行Regedit打开注册表编辑器，在HKEY_LOCAL_MACHINESYSTEMCurrentControlSet Services 下，找到刚才添加的Mail，点击右键，新建一个键，命名为&ldquo;Parameters&rdquo;，点击新建的Parameters，并再次新建一个名称为 &ldquo;Application&rdquo;的子键，数据类型为&ldquo;REG_SZ&rdquo;，数值为希望作为服务运行的程序的所在位置，如果你的Windows系统安装在C盘下，那 么OE的程序位置就是C:Program FilesOutlook Expressmsimn.exe ，把这个路径添入数值中。到现在，这个服务已经成功的添加并且设置好了。如果你希望做的更加专业，可以在Mail服务下建立一个名为 Description的子键，数据类型同样为REG_SZ，数值可以写一些你对这个服务的描述，这个我们在后面可以看到。 <br><br><br>接下来需要对服务做一些额外的设置，在运行中输入 &ldquo;Services.msc&rdquo;并回车，在列表中找到我们刚添加的Mail服务，双击打开，来做详细的设置。在&ldquo;General&rdquo;选项卡上，我们需要设置这 个服务的运行方式，在图二中可以看见，作为一个服务，有&ldquo;自动（Automatic）&rdquo;，&ldquo;手动（Manual）&rdquo;和&ldquo;禁止（Disabled）&rdquo;三种启 动类型，按照需要，我们一般设置成自动就可以了。而在&ldquo;Logon&rdquo;选项卡下可以设置以什么身份运行这个服务，一般可以不用理会，按照默认的设置。 &ldquo;Recovery&rdquo;选项卡下则是进行恢复设置的，你可以指定，在服务第一次，第二次和第三次出错之后分别采取什么措施。&ldquo;Dependencies&rdquo;则 显示了服务之间的依存关系，可以让你察看这个服务的运行依赖哪些其它服务，以及还有什么服务依赖于这个服务。这后面几个对我们一般用户没有什么意义。经过 这些设置，你的服务已经完全可以正常工作了。 <br><br><br>注销一下看看。为了让你看清除，我们先打开OE，这时在任务管理器里，有两个msimn进程，用户名为&ldquo;.com.cn&rdquo;的是我们打开的OE，而用户名为&ldquo;SYSTEM&rdquo;的就是我们添加的服务。 <br><br><br>如果你玩够了，不想再运行这个服务，可以直接禁止它在启动的时候运行，或者使用Instsrv.exe程序删除。方法是在命令行下输入&ldquo;c: instsrv.exe Mail remove&rdquo;，然后回车就可以了。需要注意的是Instsrv.exe这个程序也可以删除某些系统服务，所以使用的时候一定要小心，对于系统服务，安全 起见千万不要删除，哪怕你觉得它对你没有用。 </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/06/30/【zz】python脚本作为Windows服务启动/" class="archive-article-date">
  	<time datetime="2008-06-30T08:17:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-06-30</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/36/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/38/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>