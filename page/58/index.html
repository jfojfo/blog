<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/58/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Xen" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/20/Xen/">Xen</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p><strong>Contents:</strong></p><ol> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-c2e380b1891ea9b5ad6ae74c3da16aae402f678c" target="_blank" rel="external">About Xen</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-8f30d1c9dd2870e82077ec8a3bd395e91c7ed4f0" target="_blank" rel="external">Quick Start</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-88a9bc51813ab1a28d30d8c6606d709d25db40d7" target="_blank" rel="external">System Requirements</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-b4375a31f90c223ec05cbdb89be530b77f93e7e1" target="_blank" rel="external">Conventions</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-61bb05b28fcee61f150ed5206df689a50741b9b7" target="_blank" rel="external">Installing the Xen Software</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-1fb9fb08d8caf55a529686c4772556d8cfd54d29" target="_blank" rel="external">Enabling Xen</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-51f62872ad12e009d630c64a56c3507d2a336c53" target="_blank" rel="external">Creating A Guest System</a> <ol> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-2b1a8982b989e3dc1e1a71b6c592099c1ed874c5" target="_blank" rel="external">Building a Fedora Guest System</a> <ol> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-4b06eebfd9ee7d882cc9888d5dab3fbbbd0144b4" target="_blank" rel="external">Graphical Mode Installation via VNC</a></li> </ol> </li> </ol> </li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-4ee5719b32b170df9f00cfa804a324e0360be656" target="_blank" rel="external">After Installation</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-95c4431f2e78b53eaab6bb7c3dd3e656bf5975db" target="_blank" rel="external">Automatically Loading Domains On Startup</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-4cb7dfdf86fdd745929d19efe3a1dbcc577d3007" target="_blank" rel="external">Troubleshooting</a> <ol> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-254c160282e5807792c9c50010f969d3d4c1ac8d" target="_blank" rel="external">Serial Console</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-1898c4d2e381f0407801069a6dcd61647d1c643c" target="_blank" rel="external">Accessing data on a guest disk image</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-e6fe55bf1ede75cc2952b93e5c9a937e3c5efb9c" target="_blank" rel="external">Hints</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-bb06dde0043d315645ae5fdcf7b954ded0f0ebe8" target="_blank" rel="external">Installation of guest FC5 freezes</a></li> </ol> </li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-cdfc9e05690d2b036b31cd2c71e057c038d9d2f4" target="_blank" rel="external">Getting Help</a></li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#head-b513e201cc453dbb2d2c5a8062ab3ee5e70dd0fb" target="_blank" rel="external">Footnotes</a></li></ol>About Xen<p>Xen is an open source virtual machine system.  More information on Xen itself can be found at <a href="http://wiki.xensource.com/xenwiki/" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> http://wiki.xensource.com/xenwiki/</a> and the Fedora <a href="http://fedoraproject.org/wiki/Tools/Xen" target="_blank" rel="external"> Xen</a> page.</p><p>Fedora is following the 3.0.x Xen line. Xen 3.0.0 was released in December of 2005 and is incompatible with guests using the previous Xen 2.0.x releases.</p>Quick Start<p>Setting up Xen and guests should be significantly more straight-forward with Fedora Core 5 than it previously was with Fedora Core 4. Here’s a run-through of what is required to configure a system as a Xen host as well as setting up Xen guests.</p>System Requirements<ul> <li> <p>Your system must use GRUB, the default boot loader for Fedora<sup><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fndef-5a7dbf8ecda9b54bdbda63305d0519b240bdf662-0" target="_blank" rel="external">1</a></sup></p> </li> <li> <p>Sufficient storage space for the guest operating systems. A minimal command-line Fedora system requires around 600MB of storage, a standard desktop Fedora system requires around 3GB.</p> </li> <li> <p>Generally speaking, you will want to have 256 megs of RAM per guest that you wish to install. This is largely due to memory requirements for the installation and will hopefully be less by the time FC5 is released.</p> </li> <li> <p>Support is present for both x86 and x86_64 systems</p> </li></ul>Conventions<p>Commands which require root privileges are prefixed with the character ‘#’. To become root, issue the command ‘su’ as a normal user and supply the root password. Alternatively, use another system such as ‘sudo’ if you have it setup.</p>Installing the Xen Software<p>When doing a fresh install of Fedora Core 5, you can specify that Xen should be installed by adding ‘xen0’ to your kernel command line. This will ensure that the Xen kernel and userspace support packages are installed.</p><p>If you already have a Fedora Core 5 system installed, you can install the Xen kernel by running the following command:</p><ul> <li>    # yum install kernel-xen0    </li></ul><p>This installs the required packages and their dependencies.  ‘kernel-xen0’ contains the Xen-enabled host system kernel (<tt>domain 0</tt>) as well as the hypervisor. Also, the ‘xen’ package will be installed, which contains the user-space tools for interacting with the hypervisor.</p><p>Once this is done, you should have an entry set up in the file <tt>/boot/grub/grub.conf</tt> for booting the <tt>xen0</tt> kernel. The <tt>xen0</tt> kernel is <strong>not</strong> set as the default boot option.</p><p>To set GRUB to boot with <tt>xen0</tt> by default, edit <tt>/boot/grub/grub.conf</tt> and set the default to the xen0 kernel:<sup><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fndef-ae1d60e9de2d3310eed00e0b05d89b820bb2b30e-1" target="_blank" rel="external">2</a></sup></p><ul> <li>    default=0    <ul> <li> <p><img width="15" height="15" src="http://fedoraproject.org/wikidata/kindofblue/img/alert.png" alt="/!"> If the graphical boot screen or X-Windows fails on the next bootup, you may need to disable the graphical boot (<tt>rhgb</tt>) and switch to using runlevel 3 (command-line only mode).</p> </li> </ul> </li></ul><p>This is an example <tt>/boot/grub/grub.conf</tt>, with the <tt>3</tt> option to start the host system on runlevel 3:</p><ul> <li>    default=0<br>timeout=5<br>splashimage=(hd0,0)/grub/splash.xpm.gz<br>hiddenmenu<br>title Fedora Core (2.6.15-1.29_FC5hypervisor)<br>        root (hd0,0)<br>        kernel /xen.gz-2.6.15-1.29_FC5<br>        module /vmlinuz-2.6.15-1.29_FC5xen0 ro root=/dev/VolGroup01/LogVol00 3<br>        module /initrd-2.6.15-1.29_FC5xen0.img    </li></ul><p>The Xen facilities in Fedora Core uses VNC to provide a graphical interface that may be accessed from remote systems, as well as the host. Install the <tt>vnc</tt> package on those systems that will be used to manage Xen:</p><ul> <li>    # yum install vnc    </li></ul><p>This provides the <tt>vncviewer</tt> client.</p>Enabling Xen<p>Once you’ve rebooted with the <tt>xen-hypervisor</tt> GRUB option, you should be running with a Xen-enabled kernel <sup><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fndef-1abea3ac1e03414f68897d71bbd715d800d43e76-2" target="_blank" rel="external">3</a></sup>.  Also, the Xen service should already be running.   To check that Xen is running successfully, enter the following command:</p><ul> <li>    # /usr/sbin/xm list    </li></ul><p>You should see Domain-0 (the Xen-enabled host) running.</p><ul> <li> <p><img width="15" height="15" src="http://fedoraproject.org/wikidata/kindofblue/img/alert.png" alt="/!"> Note that for the default setup, networking for guest OS’s is bridged. This means that they will get an IP address on the same network as your host, thus, if you have a DHCP server providing addresses, you will need to ensure that it is configured to give addresses to your guests. You can change to another networking type by editing <tt>/etc/xen/xend-config.sxp</tt></p> </li></ul>Creating A Guest System<p>These instructions set up a simple Fedora installation as a Xen guest system.</p>Building a Fedora Guest System<p>With Fedora Core 5, installation of Xen guests using anaconda is supported, although with a few known bugs. The xen package includes a script for starting guest installs. You can run it with</p><ul> <li>    # /usr/sbin/xenguest-install.py    </li></ul><p>You will then be prompted to answer a few questions regarding the virtual machine you are trying to create. This information can all be passed as command line options; run with an argument of <tt>–help</tt> for more details.  In particular, kickstart options can be passed with <tt>-x ks=options</tt>.</p><ol> <li> <p>What is the name of your virtual machine? This is the label used for display in the various xm commands as well as being used as the name of the domain config file in <tt>/etc/xen</tt></p> </li> <li> <p>How much RAM should be allocated (in megabytes)? This is the amount of RAM to be allocated for the guest instance in megabytes (eg, 256). Note that installation with less than 256 megabytes is not recommended (or likely to work with test2).</p> </li> <li> <p>What would you like to use as the disk (path)? The local path and file name of the file to serve as the disk image for the guest (eg, /home/joe/xenbox1). This will be exported as a full disk to your guest.</p> </li> <li> <p>How large would you like the disk to be (in gigabytes)? The size of the virtual disk for your guest if the file specified above does not already exist. The amount to specify depends on what you intend to install. 4.0 gigabytes is a reasonable guess for a &quot;default&quot; install</p> </li> <li> <p>What is the install location? This is the path to a Fedora Core 5 installation tree in the format used by anaconda. NFS, FTP, and HTTP locations are all supported. Examples include:</p> <ul> <li> <p>nfs:my.nfs.server.com:/path/to/test2/tree/</p> </li> <li> <p><a href="http://my.http.server.com/path/to/tree/" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> http://my.http.server.com/path/to/tree/</a></p> </li> <li> <p></p> </li> </ul> </li></ol><p>If you get an error at this point saying ‘The privileged domain did not balloon!’, you may need to resize one or more of your existing VMs’ memory limits in order to free up RAM for the new guest VM. For instance, to resize dom0 to use only 256 megs of RAM, you could run:</p><ul> <li>    xm mem-set 0 256    </li></ul><p>Once you’ve shrunk your existing domains, you should be able to re-try the xenguest-instally.py script.</p><p>After this, the install kernel and initrd will be grabbed from your install tree and the installer will start.</p><ul> <li> <p>Once the questions are answered, you should be prompted with the standard anaconda text screen to choose the installation language and then keyboard.</p> </li> <li> <p>Configure TCP/IP as you normally would for a system.</p> </li> <li> <p>You are now about to install the guest. You can proceed with either a text mode or graphical mode via VNC.</p> </li></ul>Graphical Mode Installation via VNC<ul> <li> <p>Select Start VNC</p> </li> <li> <p>Now provide a password for a secure VNC connection or No Password for an open connection</p> </li> <li> <p>The VNC server information will be presented. Connect with your choice of VNC client (either running on the local machine or another system).</p> </li> <li> <p>VNC will display a standard Fedora graphical installation screen. Proceed with the installation of your xen guest.</p> </li> <li> <p>Notes</p> <ul> <li> <p>The xvda device is the file identified during the install-script.py process. It appears to the guest as an entire disk, not just as a partition; you can partition it or carve it up with LVM just like a normal disk. The first time you use it, you will need to partition and format it during the install process.</p> </li> </ul> </li></ul>After Installation<p>Once the installer exits, you’ll want to power your guest OS on with the following command.</p><ul> <li>    # /usr/sbin/xm create -c foo    <p> </p> </li></ul><p>foo is the name you gave for your guest. The -c will attach a xen console to your vm. A variety of other commands are available via xm including</p><ul> <li>    # /usr/sbin/xm help    </li></ul><p>for a list of commands that can be run</p><ul> <li>    # /usr/sbin/xm top    </li></ul><p>for a display showing what your virtual machines are doing similar to that provided by top.</p><ul> <li>    # /usr/sbin/xm shutdown foo    </li></ul><p>to nicely shut down a guest OS where foo  is the name of your guest.</p><ul> <li>    # /usr/sbin/xm save foo /root/foo.restore    </li></ul><p>to save the state of the guest ‘foo’ to the file <tt>/root/foo.restore</tt></p><ul> <li>    # /usr/sbin/xm restore /root/foo.restore    </li></ul><p>to restore the above saved guest.</p>Automatically Loading Domains On Startup<p>If you want your domains to automatically start when rebooting the system make sure that you enable the <tt>xendomains</tt> service, and place the Xen configuration file for the domains in the <tt>/etc/xen/auto/</tt> directory.</p><p>To enable the <tt>xendomains</tt> service:</p><ul> <li>    # /sbin/chkconfig –level 345 xendomains on<br># /sbin/service xendomains start    </li></ul><p>Note that the /etc/init.d/xendomains script is broken with respect to its use of the LSB init functions. This is arguably due to a bug in Fedora’s LSB support, and has been filed in Fedora’s bugzilla as <a href="https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=171052" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> bug 171052</a> and <a href="https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=171056" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> bug 171056</a>.  The latter bug includes a modified version of the /etc/init.d/xendomains script as an attachment which you can use instead.</p>Troubleshooting<p>If you’re running into issues with your Xen installation there are two log files on the host system to help you out. The file <tt>/var/log/xend.log</tt> holds the same information as you receive when running ‘<tt>xm log</tt>‘, and contains basic information. Unfortunately these log messages are often very short and contain little useful information. The following is the output of trying to create a domain running the kernel for NetBSD/xen.</p><ul> <li>    [2005-06-27 02:23:02 xend] ERROR (SrvBase:163) op=create: Error creating domain:(0, ‘Error’)<br>Traceback (most recent call last):<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/server/SrvBase.py&quot;, line 107, in _perform<br>    val = op_method(op, req)<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/server/SrvDomainDir.py&quot;, line 71, in op_create<br>    raise XendError(&quot;Error creating domain: &quot; + str(ex))<br>XendError: Error creating domain: (0, ‘Error’)    </li></ul><p>The second file, <tt>/var/log/xend-debug.log</tt> usually contains much more detailed information. Trying to start the NetBSD/xen kernel will result in the following log output:</p><ul> <li>    ERROR: Will only load images built for Xen v3.0<br>ERROR: Actually saw: ‘GUEST_OS=netbsd,GUEST_VER=2.0,XEN_VER=2.0,LOADER=generic,BSD_SYMTAB’<br>ERROR: Error constructing guest OS    </li></ul><p>If you are reporting errors or need help with your Xen setup you should always include both the <tt>xend.log</tt> and <tt>xend-debug.log</tt> messages that you receive.</p>Serial Console<p>For more difficult problems, serial console can be very helpful. If the Xen kernel itself has died and the hypervisor has generated an error, there is no way to record the error persistently on the local host. Serial console lets you capture it on a remote host.</p><p>You need to set up the Xen host for serial console output, and set up a remote host to capture it. For the console output, you need to set appropriate options in /etc/grub.conf, for example:</p><ul> <li>    title Fedora Core (2.6.16-1.2080_FC5xen0)<br>        root (hd0,2)<br>        kernel /xen.gz-2.6.16-1.2080_FC5 com1=38400,8n1 sync_console<br>        module /vmlinuz-2.6.16-1.2080_FC5xen0 ro root=LABEL=/ rhgb quiet console=ttyS0 console=tty pnpacpi=off<br>        module /initrd-2.6.16-1.2080_FC5xen0.img    </li></ul><p>for a 38400-bps serial console on com1 (ie. /dev/ttyS0 on Linux.) The &quot;sync_console&quot; works around a problem that can cause hangs with asynchronous hypervisor console output, and the &quot;pnpacpi=off&quot; works around a problem that breaks input on serial console. &quot;console=ttyS0 console=tty&quot; means that kernel errors get logged both on the normal VGA console and on serial console. Once that is done, you can install and set up ttywatch (from fedora-extras) to capture the information on a remote host connected by a standard null-modem cable.</p>Accessing data on a guest disk image<p>There are two tools which can help greatly in accessing data within a guest disk image: <em>lomount</em> and <em>kpartx</em>. Remember never to do this while the guest is up and running, as you could corrupt the filesystem if you try to access it from the guest and dom0 at the same time!</p><p><em> <strong>lomount</strong></em></p><ul> <li>    # lomount -t ext3 -diskimage /xen/images/fc5-file.img -partition 1 /mnt/boot    </li></ul><p>lomount only works with small disk images and cannot deal with LVM volumes, so for more complex cases, kpartx (from the <em>device-mapper-multipath</em> RPM) is preferred:</p><p> <strong>kpartx</strong></p><ul> <li>    # yum install device-mapper-multipath<br># kpartx -av /dev/xen/guest1<br>add map guest1p1 : 0 208782 linear /dev/xen/guest1 63<br>add map guest1p2 : 0 16563015 linear /dev/xen/guest1 208845    </li></ul><p>Note that this only works for block devices, not for images installed on regular files. To use file images, you’ll need to set up a loopback device for the file first:</p><ul> <li>    # losetup -f<br>/dev/loop0<br># losetup /dev/loop0 /xen/images/fc5-file.img<br># kpartx -av /dev/loop0<br>add map loop0p1 : 0 208782 linear /dev/loop0 63<br>add map loop0p2 : 0 12370050 linear /dev/loop0 208845    </li></ul><p>In this case we have added an image formatted as a default Fedora install, so it has two partitions: one /boot, and one LVM volume containing everything else. They are accessible under /dev/mapper:</p><ul> <li>    # ls -l /dev/mapper/ | grep guest1<br>brw-rw—- 1 root disk 253,  6 Jun  6 10:32 xen-guest1<br>brw-rw—- 1 root disk 253, 14 Jun  6 11:13 guest1p1<br>brw-rw—- 1 root disk 253, 15 Jun  6 11:13 guest1p2<br># mount /dev/mapper/guest1p1 /mnt/boot/    </li></ul><p>To access LVM volumes on the second partition, we’ll need to rescan LVM with &quot;vgscan&quot; and activate the volume group on that partition (named &quot;<a href="http://fedoraproject.org/wiki/VolGroup00" target="_blank" rel="external">VolGroup00</a>&quot; by default) with &quot;vgchange -ay&quot;:</p><ul> <li>    # kpartx -a /dev/xen/guest1<br># vgscan<br>  Reading all physical volumes.  This may take a while…<br>  Found volume group &quot;VolGroup00&quot; using metadata type lvm2<br># vgchange -ay VolGroup00<br>  2 logical volume(s) in volume group &quot;VolGroup00&quot; now active<br># lvs<br>  LV        VG         Attr   LSize   Origin Snap%  Move Log Copy%<br>  LogVol00  VolGroup00 -wi-a-   5.06G<br>  LogVol01  VolGroup00 -wi-a- 800.00M<br># mount /dev/VolGroup00/LogVol00 /mnt/<br>…<br># umount /mnt<br># vgchange -an VolGroup00<br># kpartx -d /dev/xen/guest1    <p><img width="15" height="15" src="http://fedoraproject.org/wikidata/kindofblue/img/alert.png" alt="/!"> Note: <strong>always</strong> remember to deactivate the logical volumes with &quot;vgchange -an&quot;, remove the partitions with &quot;kpartx -d&quot;, and (if appropriate) delete the loop device with &quot;losetup -d&quot; after you are finished. There are two reasons: first of all, the default volume group name for a FC install is always the same, so if you end up activating two disk images at the same time you’ll end up with two separate LVM volume groups with the same name. LVM will cope as best it can, but you won’t be able to distinguish between these two groups on the command line.</p> <p>And secondly, if you don’t deactivate it, then if the guest is started up again, you might end up with the LVM being active in both the guest and the dom0 at the same time, and this may lead to VG or filesystem corruption.</p> </li></ul>Hints<p>Q: I am trying to start the xend service and nothing happens, then when I do a `xm list1 I get the following:</p><ul> <li>    Error: Error connecting to xend: Connection refused.  Is xend running?    </li></ul><p>Alternatively, I run <tt>xend start</tt> manually and get the following error:</p><ul> <li>    ERROR: Could not obtain handle on privileged command interface (2 = No such file or directory)<br>Traceback (most recent call last):<br>  File &quot;/usr/sbin/xend&quot;, line 33, in ?<br>    from xen.xend.server import SrvDaemon<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/server/SrvDaemon.py&quot;, line 21, in ?<br>    import relocate<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/server/relocate.py&quot;, line 26, in ?<br>    from xen.xend import XendDomain<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/XendDomain.py&quot;, line 33, in ?<br>    import XendDomainInfo<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/XendDomainInfo.py&quot;, line 37, in ?<br>    import image<br>  File &quot;/usr/lib/python2.4/site-packages/xen/xend/image.py&quot;, line 30, in ?<br>    xc = xen.lowlevel.xc.xc()<br>RuntimeError: (2, ‘No such file or directory’)    </li></ul><p>A: You have rebooted your host into a kernel that is not a xen-hypervisor kernel.  Yes I did this myself in testing <img width="15" height="15" src="http://fedoraproject.org/wikidata/kindofblue/img/smile.png" alt=":)"></p><p>You either need to select the xen-hypervisor kernel at boot time or set the xen-hypervisor kernel as default in your grub.conf file.</p>Installation of guest FC5 freezes<p>If your installation of FC5 appears to start normally, but after a long wait it seems to go nowhere, you may need to update your installation tree’s <tt>images/xen/vmlinuz</tt> and <tt>images/xen/initrd.img</tt>.</p><p>In this example, the most current kernel is 2.6.16-1.2133 and the original kernel version in the FC5 install tree <tt>images/xen</tt> directory is 2.6.15-1.2054. You may have to adjust these accordingly. Make sure your ‘xen0’ kernel matches your ‘xenU’ kernel version. This worked for the i686 architecture, there is no reason why it shouldn’t work for x86_64 as well just by replacing i686 with x86_64 in the example commands. I’ll get arround to testing this soon.</p><p>Install the package ‘kernel-xenU’:</p><ul> <li>    #yum install kernel-xenU    </li></ul><p>If necessary, update your ‘xen0’ kernel:</p><ul> <li>    #yum update kernel-xen0    </li></ul><p>Before starting the guest installation, reboot to your updated xen0 kernel.</p><p>Go to the top level of the FC5 installation tree and change directory to <tt>images/xen</tt>:</p><ul> <li>    #cd images/xen    </li></ul><p>Move (do not delete) the old <tt>vmlinuz</tt> and <tt>initrd.img</tt> out of the way:</p><ul> <li>    #mkdir old<br>#mv initrd.img old<br>#mv vmlinuz old    </li></ul><p>Updating <tt>vmlinuz</tt>:</p><p>Simply copy the new <tt>vmlinuz</tt> from <tt>/boot</tt>:</p><ul> <li>    #cp /boot/vmlinuz-2.6.16-1.2133_FC5xenU vmlinuz    </li></ul><p>Updating <tt>initrd.img</tt>:</p><p>Generate modules.dep for the new ‘xenU’ kernel:</p><ul> <li>    #depmod -a 2.6.16-1.2133_FC5xenU    </li></ul><p>Make a temporary working directory and change to it:</p><ul> <li>    #mkdir tmp<br>#cd tmp    </li></ul><p>Extract the contetns of the old <tt>initrd.img</tt>:</p><ul> <li>    #gzip -cd ../old/initrd.img|cpio -imd –quiet    </li></ul><p>Go to the <tt>modules</tt> directory:</p><ul> <li>    #cd modules    </li></ul><p>Copy the new versions of <tt>modules.alias</tt> and <tt>modules.dep</tt>:</p><ul> <li>    #rm -f modules.alias modules.dep<br>#find /lib/modules/2.6.16-1.2133_FC5xenU/ -name modules.alias -exec cp {} . ;<br>#find /lib/modules/2.6.16-1.2133_FC5xenU/ -name modules.dep -exec cp {} . ;    </li></ul><p>Extract the contents of <tt>modules.cgz</tt>:</p><ul> <li>    #gzip -cd modules.cgz | cpio -imd –quiet    </li></ul><p>Create a directory tree for the new modules:</p><ul> <li>    #mkdir -p 2.6.16-1.2133_FC5xenU/i686/    </li></ul><p>Find the same modules from the new kerenl and copy them in directory created in previous step:</p><ul> <li>    #for i in 2.6.15-1.2054_FC5xenU/i686/* ; do<br>#find /lib/modules/2.6.16-1.2133_FC5xenU/ -name $(basename $i) -exec cp {} 2.6.16-1.2133_FC5xenU/i686/ ;<br>#done    </li></ul><p>Remove the old <tt>modules.cgz</tt>:</p><ul> <li>    #rm -f modules.cgz    </li></ul><p>Repakage modules.cgz with the new modules:</p><ul> <li>    #find 2.6.16-1.2133_FC5xenU | cpio –quiet -o -H crc | gzip -9 -n &gt; modules.cgz    </li></ul><p>Remove the temporary modules directories:</p><ul> <li>    #rm -fr 2.6.16-1.2133_FC5xenU 2.6.15-1.2054_FC5xenU    </li></ul><p>Back to the top level of the extracted <tt>old/initrd.img</tt>:</p><ul> <li>    #cd ..    </li></ul><p>Repackage ‘initrd.img’:</p><ul> <li>    #find . | cpio –quiet -c -o | gzip -9 -n &gt; ../initrd.img    </li></ul><p>Back to <tt>images/xen</tt>:</p><ul> <li>    #cd ..    </li></ul><p>Cleanup by removing the <tt>tmp</tt> directory created above:</p><ul> <li>    #rm -fr tmp    </li></ul><p>You can now follow the guest installation procedure described above with the updated <tt>vmlinuz</tt> and <tt>initrd.img</tt> in your FC5 installation tree.</p>Getting Help<p>If the Troubleshooting section above does not help you to solve your problem, check the <a href="https://bugzilla.redhat.com/" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> Red Hat Bugzilla</a> for existing bug reports on Xen in FC5. The product is &quot;Fedora Core&quot;, and the component is &quot;kernel&quot; for bugs related to the xen0 kernel and &quot;xen&quot; for bugs related to the tools. These reports contain useful advice from fellow xen testers and often describe work-arounds.</p><p>For general Xen issues and useful information check the Xen project <a href="http://www.cl.cam.ac.uk/Research/SRG/netos/xen/documentation.html" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> documentation</a>, and  <a href="http://lists.xensource.com/" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> mailing list archives</a>.</p><p>Finally, discussion on Fedora Xen support issues occur on the <a href="http://www.redhat.com/mailman/listinfo/fedora-xen" target="_blank" rel="external"><img width="11" height="11" src="http://fedoraproject.org/wikidata/kindofblue/img/moin-www.png" alt="[WWW]"> Fedora Xen mailing list</a></p>Footnotes<ul> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fnref-5a7dbf8ecda9b54bdbda63305d0519b240bdf662-0" target="_blank" rel="external">1</a>This is required because you actually boot the Xen hypervisor and it then starts the Linux kernel. It does this using the MultiBoot standard.</li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fnref-ae1d60e9de2d3310eed00e0b05d89b820bb2b30e-1" target="_blank" rel="external">2</a> <p>Note that you can change so that future kernel-xen0 packages are the default kernel by editing <tt>/etc/sysconfig/kernel</tt></p> </li> <li><a href="http://fedoraproject.org/wiki/FedoraXenQuickstartFC5#fnref-1abea3ac1e03414f68897d71bbd715d800d43e76-2" target="_blank" rel="external">3</a> <p>To check that you are running a <tt>xen0</tt> kernel use ‘<tt>uname -r</tt>‘ - the name of the kernel should contain <tt>xen0</tt></p> </li></ul> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/20/Xen/" class="archive-article-date">
  	<time datetime="2006-12-20T07:49:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-用ALSA驱动声卡流程详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/20/用ALSA驱动声卡流程详解/">用ALSA驱动声卡流程详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p><strong>作者：</strong>北南南北<br><strong>来自：</strong>LinuxSir.Org<br><strong>提要：</strong>目前大多数发行版都已经支持主流声卡，声卡的驱动无非是用ALSA；本文主要讲述声卡驱动的流程；目的是帮助遇到声卡的驱动问题的弟兄来弄清楚解决问题的流程；只要流程明白了，解决问题是没有太大的困难；</p><p><strong><br>一、什么是ALSA ；<br></strong></p><p>Advanced Linux Sound Architecture 的简称为 ALSA ，译成中文的意思是 Linux 高级声音体系（这是我直译的，可能译的不对）；一谈到体系就有点范围就太大了，所以ALSA不仅仅是包括对声卡的支持和驱动；</p><p>ALSA具有如下特征：</p>1、对所有音频接口的高效支持，从普通用户的声卡到专业级别多路音频设备；<br>2、声卡驱动完全模块化设计；<br>3、SMP and thread-safe design.<br>4、开发库（alsa-lib） 为程序设计提供了简单、方便，并且拥有有高级的效果和功能；<br>5、支持旧版本的OSS API 结口，能为大多数的OSS应用程序提供兼容；<p>OSS是一个商业性的驱动，OSS有一个简装本的代码已经移入内核和ALSA，其中alsa-oss就是；OSS公司据说目前已经并不存在了；我们没有必要用OSS 公司提供的商业版本；用ALSA和OSS简装版足够；</p><p><strong><br>二、关于硬件驱动驱动的必备基础 ；<br></strong></p><p><strong><br>0、查看声卡是不是已经能发声了；<br></strong></p><p>如果能发声，我们没有必要折腾了；呵。。。。</p><code>[root@localhost ~]# cat /usr/share/sounds/phone.wav &gt; /dev/audio<br>[root@localhost ~]# cat /usr/share/sounds/phone.wav &gt; /dev/dsp</code><p>也就是说找一个wav文件，然后用 cat file.wav &gt; /dev/audio</p><p><strong><br>1、如何查看硬件芯片；<br></strong></p><p>在Linux操作系统中，所有的硬件都是以芯片组来区分的，品牌并不是最重要的；<strong>硬件最重要的标识是芯片组</strong>；所以您在讨论区求助的时候，只说硬件品牌，而不提供芯片组，大家是帮助不了您的，切记；</p><p>我们查看硬件的芯片组是的命令是 lspci -v  或者是dmesg，由于dmesg输出的信息不太多，不够直观；所以经常用的还是lspci -v ；也可以用lshal 获取；最方便的还是lspci -v；初学者还是用 lspci -v 更好一点；</p><code>[root@localhost beinan]# lspci -v</code><p>我们运行lspci -v 后，如果查看声卡芯片组，发会现有类似下面的一段；</p><code>[root@localhost beinan]# lspci -v <br> Multimedia audio controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M)<br>AC’97 Audio Controller (rev 03)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 、<br> Subsystem: Hewlett-Packard Company: Unknown device 3080<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags: bus master, medium devsel, latency 0, IRQ 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I/O ports at 1c00 [size=256]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I/O ports at 18c0 [size=64]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Memory at e0100c00 (32-bit, non-prefetchable) [size=512]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Memory at e0100800 (32-bit, non-prefetchable) [size=256]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Capabilities: [50] Power Management version 2</code><p><strong><br>2、系统内核版本；<br></strong></p><code>[root@localhost beinan]# uname -r -m -p -i<br>2.6.11-1.1369_FC4 i686 i686 i386</code><p>上面的表示的是系统的内核版本，处理器架构等；</p><p><strong>提示：</strong>如果您自己编译内核，还要安装kernel-devel （或 kernel-source）， 这个是在系统光盘或者映像文件中有带；如果您想自己用 kernel.org 下载内核，自己编译，然后再来驱动声卡，也可以到 kernel.org 上下载最新的内核源码；</p><p>一般情况下，如果系统默认的内核不能驱动声卡，大多得更换内核，我们建议您先从发行版所提供的升级包来升级内核及源码；比如Fedora 的扩展项目软件包更新速度极快，我们能通过apt和yum进行kernel的升级；在启用新内核时，我们不建议您删除老内核；因为现在Fedora / Redhat 引入apt和yum 更新工具，系统的完整性极为重要；如果系统被破坏，用更新工具变得极为困难；</p><p>比如Fedora 的apt和yum升级源升级的内核也解决不了您的问题，我们可能需要自己通过 kernel.org 下载内核来编译；但也不能删除以前的内核包及源码包；一是为了安全，毕竟我们自己编译内核不是百分之百的成功；另外系统自带的内核及源码包被系统很多软件 依赖；apt和yum 每次更新软件包的时候都要检查系统的完整性；</p><p>对于有些发行版，可以直接从从 kernel.org 下载最新的内核；如果从系统提供的内核源码（kernel-devel或kernel-source）编译，可能解决不了您的问题；</p><p><strong><br>3、modprobe.conf的内容；<br></strong></p><p>在Fedora Core 4.0 中，内核模块的添加或定义别名是在 /etc/modprobe.conf 文件；在其它版本可能是 modules.conf ；如果您的系统中存在modprobe.conf ，我们就以这个文件为准；不同发行版有不同的定义文件，比如 slackware 是定义在/etc/modules.conf 中，但也要在 /etc/rc.d/rc.modules 打开相关驱动模块；</p><p>modprobe.conf 或者module.conf就是对系统已经加载的模块进行相应的配置，比如设置别名等；这些一般都是自通过工具自动生成的，我们也可以通过查看硬件的文档 和站点，也可以自己添加。为什么这样添加，而不是那样的呢？我也不懂了，因为人家文档那样说的，我不会开发，如果懂的开发的，可能会明白；请理解理解我；</p><p>比如我用的是855的主板，系统驱动用的是 snd-intel8x0，在/etc/modprobe.conf的配置是如下的内容； 下面这段内容是通过 alsaconf 配置工具自动生成的；</p><code>alias snd-card-0 snd-intel8x0<br>options snd-card-0 index=0<br>options snd-intel8x0 index=0<br>remove snd-intel8x0 { /usr/sbin/alsactl store 0 &gt;/dev/null 2&gt;&amp;1 || : ; }; /sbin/modprobe -r –ignore-remove snd-intel8x0</code><br><strong><br>4、lsmod 查看已经加载的内核模块；<br></strong><p>如果一个设备在内核的编译中是以模块方式加载的，主要是通过lsmod 来查看；</p><code>[root@localhost beinan]# lsmod</code><p>可能初学Linux的弟兄会问，内核的module存放在哪里，我们能不能自己来手工加载模块；内核的模块放在  /lib/modules/内核的版本/kernel/ ，比如在Fedora 4.0 中，我们可以看到如下的：</p><code>[root@localhost beinan]# ls /lib/modules/2.6.11-1.1369_FC4/kernel/<br>arch/    crypto/  drivers/ fs/      lib/     net/     sound/</code><br>其中，sound 就是声卡模块存放目录，大多数的硬件驱动放在 drivers目录，fs 是文件系统模块的目录；net是与网络有关的存放目录，比如一些网络协议支持的模块、防火墙支持的模块等；arch 是cpu方面 … …<p>如果我们想自己加载模块，就到这些目录中查看相应模块的信息，然后用 modprobe 来加载；</p><code>[root@localhost beinan]# modinfo snd-intel8x0</code><p>查看一个模块的信息，我们用 modinfo 来查看，所要查看的模块不要带 .ko 或者.o 之类的；比如查看到类似下面的信息；</p><p>description:    Intel 82801AA,82901AB,i810,i820,i830,i840,i845,MX440; SiS 7012; Ali 5455</p><p>通过这个我们足可以知道这是Intel 集成声卡，通过lspci -v 得到的声卡信息，感觉他们很相近；所以就能尝试用这个模块来驱动；</p><code>[root@localhost beinan]# modprobe snd-intel8x0</code><p>用 modprobe 加载了模块，然后我们通过 lsmod 就能看到了；对于声卡模块是这么加载的，其它设备的驱动模块也是如此；</p><p>注意：这些只是教您一点基础知识，遇到什么问题，知道怎么去查看解决；如果您在论坛求助的时候，是必须把 lsmod 输入内容以及 /etc/modprobe.conf 或 modules.conf 的内容帖出来。这样能节省很多时间，否则大家不会明白问题出在哪里；</p><p><strong><br>二、针对自己系统的声卡不发声，我是否有必要来升级内核解决；<br></strong></p><p>可能存在这样的情况，比如有时我在Mandriva Linux时，声卡是有声音的，但安装好Fedora 系统后却没有声音了；所以我们有必要弄清楚如下的几个问题；可能声卡已经驱动起来了，只是我们不太了解系统的原因所致；下面我们以Fedora 为例；</p><p><strong><br>1、声卡是不是被系统识别支持了；<br></strong></p><p>我们可以用Fedora 提供的配置工具 system-config-soundcard 来测试；</p><code>[beinan@localhost ~]# system-config-soundcard</code><p>通过测试，如果能听到声音，证明声卡已经驱动好了；如果听不到声音，但反应在也不迟钝，不是打开 system-config-soundcard ，按测试播放声音时会出现假死的情况；可能是声量没有打开；</p><p><strong><br>2、是否把声卡的音量打开了，比如PCM 和MASTER等；<br></strong></p><p>我们可以用下面几个工具；</p><code>[beinan@localhost ~]# gnome-volume-control<br>[beinan@localhost ~]# kmix<br>[beinan@localhost ~]# alsamixer<br>[beinan@localhost ~]# aumix</code><p>上面的四个工具，可以尝试一下，有时这几个工具存在BUG的事；所以我们还要引入一个工具 aumix ，目前已经被Fedora 删除了；我们自己安装上就行了；</p><p><strong>请参考：</strong> <a href="http://fedora.linuxsir.org/main/?q=node/65" target="_blank" rel="external">《声卡工具 aumix》</a></p><p><strong><br>3、我的声卡是测试时是有声音的，但我为什么不能播放CD和听mp3呢？<br></strong></p><p>自从Redhat 8.0以后，也就是说 Redhat 9.0 ，Fedora 1.0，Fedora 2.0，Fedora 3.0 ，Fedora 4.0的媒体播放软件不再对mp3提供支持；究其原因是版权方面的原因；但这不是意味着我们不能在Fedora 系统中让播放软件支持 mp3；我们可以安装mp3支持补丁或者下载全新的播放器；而这一切都离不开在线安装工具 apt或yum ；</p><p><strong>请参考：</strong><br><a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external">《Fedora / Redhat 软件包管理指南》</a><br><a href="http://fedora.linuxsir.org/main/?q=node/27" target="_blank" rel="external">《Fedora 4.0 播放机支持mp3、wma的解决办法》</a></p><p>至于CD为什么不能播放的问题，在论坛上已经说过多次了；首先要保证CDROM的音频线和主板相连接；有的弟兄会问，Windows为什么就能直接 播放，我也没有把CDROM的音频线接在主板上；我答复您的是：咱们得转换观念，咱们是在用Linux，而不是Windows；</p><p><strong><br>3、查看声卡是否有模块冲突；<br></strong></p><p>比如Intel 主板集成了猫和声卡、网卡等，这时可能猫的蜂鸣器会被系统识别为声卡，所以要通过 lsmod 来查看，是否有 snd-intel8x0m；如果有则要处理一下；把在/lib/modules/内核的版本/kernel/sound/pci 中或 /lib/modules/内核的版本/kernel/drviers/sound/pci中的 snd-intel8x0m.ko改名为 snd-intel8x0m.koBAK ；</p><p>还有类似的主板，比如 VIA 主板集成了声卡和猫的， 如果声卡不发声，大多也与这有关，比如内核模块有snd-via82xx.ko 和snd-via82xx-modem.ko，可能系统会把 snd-via82xx-modem.ko模块当成是声卡的驱动。如果您出现这样的情况，也要改名；</p><p><strong><br>4、通过 alsaconf 来配置声卡；<br></strong></p><p>一般的情况下，系统在安装的时候，会自动把声卡配好；如果能识别的，就基本没有问题了；但如果出现识别了，但还是不发声；或者识别成猫的蜂鸣器；所 以我们除了要把前面所说的猫的蜂鸣器模块改名后，还要重新运行一下声卡配置工具 alsaconf ；可能我们还需要前面的一点知识，比如 modprobe 、lsmod等；有必要的时候还要启新启动机器；</p><p>如果我没有alsaconf 这个命令怎么办？</p><p> </p><code>[root@localhost beinan]# /usr/sbin/alsaconf</code><p>比如在Fedora Core 4.0 中，可能您不能发现这个命令；您采取的办法只能是重新编译 alsa-utils ；但也要保守编译；不能把alsa相关的包全都删除，只能是选择对应版本来编译；现在的Fedora 通过yum和apt升级，如果系统所依赖的包出被移除，比较重要的，alsa 就是其中的一个；会导致一些程序不能用；因为有版本对应关系；我们不能把系统整体的依赖关系打破；当然无关紧要的，比如这个软件包是依赖于其它包，而这个 包不为其它包提供依赖的包，这样的包是可以移除的；</p><p>自己编译alsa-utils 的办法是：</p><p>首先，确认系统alsa软件包的版本；</p><code>[root@localhost alsa]# rpm -qa |grep alsa<br>alsa-utils-1.0.9rf-2.FC4<br>alsa-lib-1.0.9rf-2.FC4<br>alsa-tools-1.0.9-1.fc4</code><p>我们要到 alsa-project.org 中下载 1.0.9的源码包；主要下载alsa-lib-1.0.9 和 alsa-utils-1.0.9a；不要卸载原来的RPM包；先安装 alsa-lib-1.0.9，然后再安装alsa-utils-1.0.9a ；编译方法无非是 tar zxvf file.tar.gz 或者 tar jxvf file.tar.bz2 ，然后是进入相应的解压目录 ./configure;make;make install ;</p><p>当然您要有安装开发工具、开发库等；如果不能进行源码包安装alsa等，所以我们要补装系统所缺少的软件；请参考 <a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external">《Fedora / Redhat 软件包管理指南》</a></p><p>这样我们就有 alsaconf 工具可用了；这样编译 alsa也不会对系统造成破坏；</p><p><strong><br>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>中场休息：我已经精疲力尽，上面所提到的我都尝试了，但还是不能驱动声卡；我该怎么办？<br>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br></strong><br>如果上面的的内容您都明白了，那我得为您祝贺，说明您对硬件的驱动方法已经有所了解了；虽然声卡的问题还是没有解决，但您把基本的必备知识掌握，解决声卡的发声还不是什么难事；</p><p>您看到这里已经是很疲惫，呵，我写到这里也有点累；但为了初学者在Linux能听到音乐，我还得接着努力，直到把您的问题解决为止；</p><p><strong><br>三、安装新版本的ALSA；<br></strong></p><p><strong><br>1、对ALSA软件包的说明；<br></strong><br>通过上面的一系列工程，可能您发现还不能解决您的问题，这时我们有必要升级ALSA；至于是否升级内核，我们还得等完成这步，看是否有必要；比如在 Fedora 4.0 中，我们通过 rpm -qa |grep alsa 查询时会发现没有 alsa-driver 这个包，这是怎么回事？</p><code>[root@localhost alsa]# rpm -qa |grep alsa<br>alsa-utils-1.0.9rf-2.FC4<br>alsa-lib-1.0.9rf-2.FC4</code><p>现就ALSA 相关的软件包做一说明（在alsa-project.org 上有列出）；</p><p><strong>alsa-lib</strong>  是alsa-driver 或者alsa其它包的时候，必须先安装这个包；<br><strong>alsa-driver</strong> 是音频设备的驱动；一般内核都集成在里面，大多是以模块的方式，安装在了 /lib/modules/内核的版本/kernel/sound 或 /lib/modules/内核的版本/kernel/drviers/sound/  中了；每个版本的内核都是如此；<strong>这也是我们没有在 Fedora Core 4.0 中没有发现 alsa-driver的原因</strong> ；如果我们自己编译升级 alsa，其中 alsa-driver 也是被安装在 /lib/modules/内核的版本/kernel/sound 中或 /lib/modules/内核的版本/kernel/drviers/sound 中 ；明白了吧；</p><p><strong>alsa-utils</strong> 这个包主要是一些声卡配置工具，比如 alsaconf 、 alsamixer等；<br><strong>alsa-oss </strong> 这个包和alsa-driver 一样，也没有以独立的包出现在 Fedora Core 4.0 中，原因和alsa-driver 一样，是集成在内核了，这个包极有必要的；如果我们升级ALSA的话，有些声卡用ALSA是驱动不起来的，是必须用alsa-oss才行；alsa- oss 包括了oss驱动库；alsa-oss，我们自己安装一般是默认放在了 /usr目录中；<br><strong>alsa-tools</strong> 这个是额外的工具包，不是必须的；是针对一些特别的声卡的工具或者解码器之类，您可以根据自己的声卡来安装；不安装也是可以的；</p><p>其它的包就不说了，到 alsa-project.org 上去看吧；比较重要的就是 alsa-lib 、alsa-driver、alsa-utils 、alsa-oss ；</p><p><strong><br>2、ALSA的编译安装的前期准备；<br></strong></p><p>编译安装ALSA，我们需要什么环境，就如同我们在Windows中打开一个file.doc文档一样，是需要先把Word安装上一样；Linux 也是如此，我们必須先把软件包编译所需要的工具安装上；另外还要安装kerenel-devel或者其它一些支持的库，如果您没有安装这些，编译无法进 行；这样开发工具都在系统安装盘中；如果您不知道如何安装，对于Fedora /Redhat 请参见 <a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external">《Fedora / Redhat 软件包管理指南》</a></p><p>您也要在线升级内核及内核的源码包，以Fedora 4.0为例，必须保证kernel 和kernel-devel 包是同一个版本；可能您看到好多kernel的包，还有什么smp之类的；如果您只是单处理器的，就不要用smp的；看图作业（点击看大图，升级内核时， 请选择图中标记的颜色对应的内核和源码升级，也就是说版本要对应）</p><p><a href="http://img.pickbox.me/wp-content/uploads/pic/other_site/fedora_linuxsir_kernel000linuxsir.orgbest.jpg" target="_blank" rel="external"><img height="200" src="http://img.pickbox.me/wp-content/uploads/pic/other_site/fedora_linuxsir_kernel000linuxsir.orgbest.jpg"></a></p><p><strong>重要：</strong>通过在线升级内核可能会解决您的声卡所存在的问题，要试着用前面所说的来尝试解决；您还可以通在在线升级alsa-lib ；alsa-tools ;alsa-utils 等包；</p><p>如果通过在线升级内核及alsa-lib;alsa-utils;alsa-tools 等能解决您的问题，请不必看以下的内容；</p><p>为什么说，通过在线长级内核能解决呢？因为通过内核的升级,内核包内置的alsa-driver 可能也得到了升级，如果打包的人升级了alsa-driver的话；如果是不能解决，说明alsa-driver 还是老版本；起重要作用的是alsa-driver ； 如果在线升级的过程中，alsa-lib没有新版本，肯定新内核中的alsa-driver 也没有更新，因为他们是配套的；明白了吧；</p><p><strong><br>判断是否有必要重编内核：<br></strong></p><code>[root@localhost beinan]# modinfo soundcore<br>filename:       /lib/modules/2.6.11-1.1369_FC4/kernel/soundBAK/soundcore.ko<br>description:    Core sound module<br>author:         Alan Cox<br>license:        GPL<br>alias:          char-major-14-*<br>vermagic:       2.6.11-1.1369_FC4 686 REGPARM 4KSTACKS gcc-4.0<br>depends:<br>srcversion:     E11490DC3F523551C4C2A6D</code><p>如果出现上面类似的信息，则不必编译内核；</p><p><strong>误区之一：</strong>看到论坛的好多弟兄，总认为只要在线升级了 alsa-lib 和alsa-utils 或 alsa-tools 就能解决声卡不发声的问题；其实不是这样的；因为起关健作用的是内核，而内核中的声卡驱动也是来自alsa-driver ；所以我们要尝试升级 alsa-driver 才能解决问题，只升级alsa-lib和alsa-utils 有何用？声卡的驱动并没有更新；有时升级alsa-lib 和alsa-utils 或许也能让声卡发声；只能说明是alsa-lib或alsa-utils存在了问题才导致声卡不发声；</p><p><strong>误区之二：</strong>也有弟兄认为驱动声卡是一定要重新从 kernel.org 下载内核，然后自己编译内核来解决声卡的问题；通过kernel.org 下载的内核，是能解决您的问题；但kernel.org 的内核集成声卡驱动也是来自于 alsa-project.org ；如果我们为了解决声卡驱动，没有在尝试用 alsa-driver 新版本的情况下，是没有必要重新编译内核的；</p><p><strong>正确观点：</strong>只要内核中的soundcore 是以模块的形式编译的，并且通过modinfo soundcore查看版本信息输出，我们就没有太大必要重编内核；因为系统几乎对所有的声卡及设备都有编译进去；所以我们先不要重编内核；除非做了升级 alsa-driver后，还是不能解决问题，这时才能重编译核；alsa-driver 是和内核配置文件相关联的；也就是说，alsa-driver 是根据内核的配置文件来进行判断，对哪些声卡应该支持等；如果内核的配置文件没有配置对您的声卡进行支持；这时才需要我们来配置内核；另外内核中对声卡的 支持的驱动也是来自于 alsa-driver ；</p><p><strong><br>3、尝试编译安装ALSA ；<br></strong></p><p>比如我下载了alsa 1.0.10rc1 版本，要下载配套的，比如 alsa-driver、alsa-lib、alsa-oss、alsa-utils 要下载同一系列的版本；我们先要安装alsa-lib；然后再安装其它的包；</p><p><strong>警告：</strong>在编译alsa所有包的时候，对于Fedora Core ，请不要卸载系统自带的alsa-lib 及alsa-utils 等；这样能欺骗系统，说明系统完整的；alsa是基础包之一，不是随便可以卸载的，因为有很多的包依赖这几个旧的包；比如xmms，如果您把alsa- lib系统自带的包卸掉了，xmms就不能用 alsa驱动，只能用oss驱动了，除非您在升级alsa-lib后重新编译xmms；另外最严重的后果，如果卸掉了这几个包，会破坏系统整体的依赖关 系，yum和apt升级系统将无关正常运行；</p><code>[root@localhost alsa]# tar jxvf alsa-lib-1.0.10rc1.tar.bz2<br>[root@localhost alsa]# cd alsa-lib-1.0.10rc1<br>[root@localhost alsa-lib-1.0.10rc1]# ./configure ;make ;make install<br>[root@localhost alsa]# tar jxvf alsa-utils-1.0.10rc1.tar.bz2<br>[root@localhost alsa]# cd alsa-utils-1.0.10rc1<br>[root@localhost alsa-utils-1.0.10rc1]# ./configure ;make ;make install<br>[root@localhost alsa]# tar jxvf alsa-driver-1.0.10rc1.tar.bz2<br>[root@localhost alsa]# cd alsa-driver-1.0.10rc1<br>[root@localhost alsa-driver-1.0.10rc1]# ./configure ;make ;make install<br>[root@localhost alsa]# tar zxvf alsa-oss-1.0.10rc1.tar.bz2<br>[root@localhost alsa]# cd alsa-oss-1.0.10rc1<br>[root@localhost alsa-oss-1.0.10rc1]# ./configure ;make;make install</code><p><strong>提示：</strong>其中alsa-driver 可以定义声卡来编译，这个对于老手还比较适用，如果您还不太会查看alsa的文档的话，就直接用通用的./configure;make;make install 来安装；这样所有的声卡都安装进去了；</p><p><strong><br>4、尝试通过用新的ALSA驱动来配置声卡 ；<br></strong></p><p>在这个时候，我们才用到前面讲的基础知识；呵。。。。。书到用时方恨少；不学习怎么也不行；<br><strong><br>1）通过alsaconf 来配置声卡；<br></strong><br>我们要通过alsaconf 来配置，看能否找到声卡；在运行alsaconf的时候，对于FC4请修改/etc/modprobe.conf  对其它的版本按前面的说，可能是 /etc/modules.conf ，把所有关于声卡的项目前面加#注掉，或者删除；</p><p>在选行alsaconf时，我们有必要运行一下如下的两个命令；目的是更新文件的索引数据库；</p><code>[root@localhost beinan]# rpm -rebuilddb 这个是针对RPM包的系统的；<br>[root@localhost beinan]# updatedb</code><br>然后再来运行alsaconf<br><code>[root@localhost beinan]# /usr/sbin/alsaconf</code><p>我们用过alsaconf后，要查看 /etc/modprobe.conf 或/etc/modules.conf ；还要lsmod ，看声卡模块有没有加载进来。如果没有加载进来，我们还要会用 modprobe 加载模块，前面有说，请回头看看；</p><p>如果运行 alsaconf 后，配置文件 /etc/modprobe.conf 并没有发生变化，没有发现声卡的配置内容；您要到 alsa-project.org 上查看相应的信息，只看关于 /etc/modprobe.conf 的内容就行；比如他在上面说的是modules.conf 的，您可以直接写到 modprobe.conf （如果是Fedora 的话），各个系统的配置文件都差不多，如果不是modprobe.conf就是modules.conf ；</p><p><strong>请参见：</strong><a href="http://www.alsa-project.org/alsa-doc/index.php?vendor=All#matrix" target="_blank">ALSA 声卡支持列表和文档</a></p><p>请根据文档所说的来加载模块和配置 modprobe.conf或 modules.conf ；<br><strong><br>2） 调节音量；<br></strong></p><p>我们可能已经把声卡驱动起来了，但没有声音，所要一定要打开音量；调节工具：kmix 、aumix 、alsamixer及system-config-soundcard等工具；<br><strong><br>3）值得注意是的，如果您播放mp3时，要注意以下系统；<br></strong><br>自从Redhat 8.0以后，也就是说 Redhat 9.0 ，Fedora 1.0，Fedora 2.0，Fedora 3.0 ，Fedora 4.0的媒体播放软件不再对mp3提供支持；究其原因是版权方面的原因；但这不是意味着我们不能在Fedora 系统中让播放软件支持 mp3；我们可以安装mp3支持补丁或者下载全新的播放器；而这一切都离不开在线安装工具 apt或yum ；</p><p><strong>请参考：</strong><br><a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external">《Fedora / Redhat 软件包管理指南》</a><br><a href="http://fedora.linuxsir.org/main/?q=node/27" target="_blank" rel="external">《Fedora 4.0 播放机支持mp3、wma的解决办法》</a></p><p><strong>提示：</strong>测试。。。。能成功吗？ 不成功接着看下面。。。。。。:(</p><p><strong><br>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>下半场：前半场下来，您还是不能解决声卡，只能用最后一招；重新编译内核~<br>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br></strong></p><p><strong><br>四、重新编译内核；<br></strong></p><p><strong><br>1、为什么要编译内核？<br></strong></p><p>因为您的声卡没有被当前所用的内核版本配置进去，所以我们要新编译内核；</p><p><strong><br>2、我不会编内核怎么办？；<br></strong></p><p>可能新手弟兄会说，我不会编内核怎么办？答曰：不会编内核，就得学习，谁也不是天生就会的；学习改变命运，不是吗？其实编译内核目前看来是极为简单 的事，只是我们第一次接触到Linux，太习惯Windows的点鼠标，不太习惯Linux的命令行操作罢了。只要努力，没有什么做不成的；你看北南这水 平都会写教程 。呵。。。坐在电脑前大侠如果认为北南写的这篇文章或许对你有所帮助的话，那您也能行；加油~~~~</p><p><strong><br>3、内核的选择；<br></strong></p><p>一般的情况下选择发行版所提供的内核升级包及源码包要好；您可以通过 apt+synaptic 来选择装，但不要把老内核删除，系统的完整性是很重要的；一般的情况下如果通过新内核的在线升级能解决问题的，我们也没有必要编译了；我们前面已经说过 了；如果不能用新的内核来驱动，我们可以在新的内核的基础上进行编译，当然我们必须要下载kernel-devel 或者 kernel-source 包；</p><p>为什么要选择系统提供的内核及源码升级包呢？</p><p>一是主要是为了方便，对于大多数的选项，我们按默认就好了，我们只是针对比较重要的地方改一改；比如对于Fedora Core 4.0 ，目前在线升级源有很多版本可下载使用；我们要把同一版本的内核包及源码包都要安装；<br>二是如果我们用新编的内核启动不了系统，可以用老内核来引导，这是为了系统的安全。对新手和老手都是适用的；</p><p>当然您也能从 kernel.org 上下载最新最稳定的内核；目前最新版本是 2.6.13 ；kernel.org 下载的内核包含的声卡驱动也是来自 alsa-driver ；</p><p><strong><br>4、编译内核参考文档；<br></strong></p><p><a href="http://fedora.linuxsir.org/main/?q=node/66" target="_blank" rel="external">《编译内核操作流程 ──为新手指南》</a></p><p>根据<a href="http://fedora.linuxsir.org/main/?q=node/66" target="_blank" rel="external">《编译内核操作流程 ──为新手指南》</a> 中所说的，有针对性的来解决问题；编译好内核后，用alsaconf 来配置声卡；或者重新编译 alsa-lib 、alsa-oss、alsa-utils 等；经过我的测试，一般的情况下重新编译过内核后，用 alsaconf 配置一下就能用了；</p><p><strong><br>后记：<br></strong><br>至此，关于声卡的问题就算解决流程就算完工了；如果您认为我的这篇文档写的还不够详细，或者不能解决您的问题；问题无非是两种，一是您的声卡没有被 ALSA所支持，请查相应的列表；二是如果ALSA已经支持了您的声卡，您看了我的文档还是不能解决您的问题（看与不看只是一个假设，就看我的文档值不值 得您一看了）；</p><p>对于第二种情况无非又是有两种原因，一是北南写的文档不行，您看不懂；二是您可能是真的初学者，可能需要更多的尝试和努力；</p><p>如果还是解决不了,或行您静下心仔细看一下本文档所提到的流程，或许能找到一点对您有所启示的内容；最好是… …</p><p>再解决不了怎么办呢，如果您和北南在同一个城市的话，把机器抱到我这里，我感觉差不多能解决吧；哈哈。。。。。。。。。</p><p><strong><br>附录：<br></strong></p><p>1、<a href="http://fedora.linuxsir.org/main/?q=node/66" target="_blank" rel="external">《编译内核操作流程 ──为新手指南》</a><br>2、<a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external">《Fedora / Redhat 软件包管理指南》</a><br>3、<a href="http://fedora.linuxsir.org/main/?q=node/27" target="_blank" rel="external">《Fedora 4.0 播放机支持mp3、wma的解决办法》</a><br>4、<a href="http://www.alsa-project.org/alsa-doc/index.php?vendor=All#matrix" target="_blank">ALSA  声卡支持列表和文档</a><br>5、<a href="http://www.alsa-project.org/" target="_blank"> http://www.alsa-project.org</a><br>6、<a href="http://www.kernel.org/" target="_blank"> http://www.kernel.org </a></p>                        附件            大小                            <a href="http://img.pickbox.me/wp-content/uploads/pic/other_site/fedora_linuxsir_kernel000linuxsir.orgbest.jpg" target="_blank" rel="external">kernel000linuxsir.orgbest.jpg</a>            94.52 KB <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/20/用ALSA驱动声卡流程详解/" class="archive-article-date">
  	<time datetime="2006-12-20T06:46:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Linux-module-init-tools模块管理概述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/20/Linux-module-init-tools模块管理概述/">Linux module-init-tools模块管理概述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p><strong>作者：</strong>北南南北<br><strong>来自：</strong>LinuxSir.Org<br><strong>摘要：</strong>本文讲述与内核操作有关的基础知识；比如编译内核，装载、移除内核模块，查看模块信息等；本文涉及相关的命令有modprobe、insmod、depmod、rmmod、modinfo等；</p><p><strong><br>++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>正文<br>++++++++++++++++++++++++++++++++++++++++++++++++++++++<br></strong></p><p><strong><br>一、什么是内核；<br></strong></p><p>内核官方：<a href="http://www.kernel.org" target="_blank" rel="external">http://www.kernel.org</a><br>内核洋文用 kernel，我刚才翻了一下词典，kernel 中文意思是内核、核心、中心、精髓的意思；也是果仁、果核的意思。从字面理解，kernel 是一事物的中心，植物的果实最重要的也是果仁和果核；:) 由此我们可以推断内核是操作系统的中心。</p><p>我们知道Linus Torvalds 开发了Linux ，其实他开发的就是内核，按内核官方主页的理解，这个内核就是Linux ；其它的扩展和应用都是围绕内核而展开的。所有Linux应用程序都会和内核发生直接或者间接的接触；比如硬件需要内核支持，网络的通信也需要内核支持； 文件系统更需要内核支持… …</p><p>直言我的能力的不行，如果您想了解和学习解操作系统，我写的教程只是初级应用，理论性的东西不是一言两语能说的清楚的，更不是应用者能说的清楚的。</p><p><strong><br>二、为什么需要编译内核和管理内核<br></strong></p><p>硬件是需要内核支持才行，有些硬件的支持没有被编入内核，这也需要我们重编内核；内核的包含的不仅仅是设备的驱动，还有其它的内容，比如网络协议的 支持，防火墙的支持… … 比如iptables的实现，有些功能是需要内核支持的，如果内核与iptables相关的内容没有被编入，iptables 相关的功能就无法实现；</p><p><strong><br>三、内核编译方法<br></strong></p><p><strong>请参考：</strong><a href="http://fedora.linuxsir.org/main/?q=node/66" target="_blank" rel="external">《编译内核操作流程 ──为新手指南》</a></p><p><strong><br>四、管理内核模块的相关命令<br></strong></p><p><strong><br>1、lsmod  列加以挂载的内核模块；<br></strong></p><p>lsmod 是列出目前系统中已加载的模块的名称及大小等；另外我们还可以查看 /proc/modules ，我们一样可以知道系统已经加载的模块；</p><code>[root@localhost beinan]# lsmod</code><br><strong><br>2、modinfo  查看模块信息；<br></strong><p>modinfo 可以查看模块的信息，通过查看模块信息来判定这个模块的用途；</p><code>[root@localhost beinan]# moinfo  模块名</code><p>举例：</p><code>[root@localhost beinan]# modinfo ne2k-pci<br>filename:       /lib/modules/2.6.11-1.1369_FC4/kernel/drivers/net/ne2k-pci.ko<br>author:         Donald Becker / Paul Gortmaker<br>description:    PCI NE2000 clone driver<br>license:        GPL<br>parmtype:       debug:int<br>parmtype:       options:array of int<br>parmtype:       full_duplex:array of int<br>parm:           debug:debug level (1-2)<br>parm:           options:Bit 5: full duplex<br>parm:           full_duplex:full duplex setting(s) (1)<br>vermagic:       2.6.11-1.1369_FC4 686 REGPARM 4KSTACKS gcc-4.0<br>depends:        8390<br>alias:          pci:v000010ECd00008029sv<em>sd</em>bc<em>sc</em>i<em><br>alias:          pci:v00001050d00000940sv</em>sd<em>bc</em>sc<em>i</em><br>alias:          pci:v000011F6d00001401sv<em>sd</em>bc<em>sc</em>i<em><br>alias:          pci:v00008E2Ed00003000sv</em>sd<em>bc</em>sc<em>i</em><br>alias:          pci:v00004A14d00005000sv<em>sd</em>bc<em>sc</em>i<em><br>alias:          pci:v00001106d00000926sv</em>sd<em>bc</em>sc<em>i</em><br>alias:          pci:v000010BDd00000E34sv<em>sd</em>bc<em>sc</em>i<em><br>alias:          pci:v00001050d00005A5Asv</em>sd<em>bc</em>sc<em>i</em><br>alias:          pci:v000012C3d00000058sv<em>sd</em>bc<em>sc</em>i<em><br>alias:          pci:v000012C3d00005598sv</em>sd<em>bc</em>sc<em>i</em><br>alias:          pci:v00008C4Ad00001980sv<em>sd</em>bc<em>sc</em>i<em><br>srcversion:     6ACE95F441CD26DF9DC31C2</em></code><br>上面的例子是我们查看 ne2k-pci 这个模块的信息，通过查看，我们知道ne2k-pci 模块是8029网卡（PCI NE2000 clone driver）的驱动；模块是位于 /lib/modules/2.6.11-1.1369_FC4/kernel/drivers/net/ 中ne2k-pci.ko<p>我们现在常用的网卡也有8139的，8139网卡所用的驱动是 8139too ；查查看？</p><code>[root@localhost beinan]# modinfo 8139too</code><p>我们再查查vfat 和ntfs 的模块信息；</p><code>[root@localhost beinan]# modinfo vfat<br>[root@localhost beinan]# modinfo ntfs</code><p>自己尝试一下；</p><p><strong>注意：</strong> 模块名是不能带有后缀的，我们通过modprobe -l 所看到的模块，都是带有.ko 或.o后缀；</p><p><strong><br>3、modprobe 挂载新模块以及新模块相依赖的模块<br></strong></p><p>modprobe 我们常用的功能就是挂载模块，在挂载某个内核模块的同时，这个模块所依赖的模块也被同时挂载；当然modprobe 也有列出内核所有模块，还有移除模块的功能；下在我们举个例子说一说咱们常用的功能和参数；</p><code>modprobe [-v] [-V] [-C config-file] [-n] [-i] [-q] [-o &lt;modname&gt;] &lt;modname&gt; [parameters…]<br>modprobe -r [-n] [-i] [-v] &lt;modulename&gt; …<br>modprobe -l -t &lt;dirname&gt; [ -a &lt;modulename&gt; …]</code><p>上面是modprobe 的用法，具体更为详细的帮助，我们可以查看 man modprobe ；</p><code>[root@localhost beinan]# modprobe -c</code><p>modprobe -c 可以查看modules 的配置文件，比如模块的别名是什么等；</p><code>[root@localhost beinan]# modprobe -l</code><p>modprobe -l 是列出内核中所有的模块，包括已挂载和未挂载的；通过modprobe -l ，我们能查看到我们所需要的模块，然后根据我们的需要来挂载；其实modprobe -l 读取的模块列表就位于 /lib/modules/‘uname -r’ 目录中；其中uname -r 是内核的版本；</p><code>[root@localhost beinan]# uname -r<br>2.6.11-1.1369_FC4<br>[root@localhost beinan]# ls /lib/modules/2.6.11-1.1369_FC4/</code><p>通过上面的命令，自己试试看？</p><code>[root@localhost beinan]# modprobe   模块名   注：挂载一个模块；</code><p>举例：</p><code>[root@localhost beinan]# modprobe ne2k-pci  注：挂载 ne2k-pci 模块；<br>[root@localhost beinan]# modprobe vfat  注：挂载vfat 模块<br>[root@localhost beinan]# modprobe ntfs   注：挂载ntfs 模块<br>[root@localhost beinan]# lsmod    注：列出已挂载模块， 我们会看到ne2k-pci ，vfat ，ntfs的模块 ；</code><p><strong>注意：</strong> 模块名是不能带有后缀的，我们通过modprobe -l 所看到的模块，都是带有.ko 或.o后缀；</p><code>[root@localhost beinan]# modprobe -r  模块名   注：移除已加载的模块，和rmmod 功能相同；</code><p><strong>注意：</strong> 模块名是不能带有后缀的，我们通过modprobe -l 所看到的模块，都是带有.ko 或.o后缀；</p><code>[root@localhost beinan]# modprobe -r  模块名</code><p>举例：</p><code>[root@localhost beinan]# modprobe  -r ne2k-pci</code><p>就说这么多吧，更为详细的还是用 man modprobe 来查看和尝试；</p><p><strong><br>4、rmmod  移除已挂载模块；<br></strong></p><p>命令格式：</p><code>rmmod  模块名</code><p><strong>注意：</strong> 模块名是不能带有后缀的，我们通过modprobe -l 所看到的模块，都是带有.ko 或.o后缀；</p><p>举例：</p><code>[root@localhost beinan]# rmmod  vfat  注：移除已挂载的模块vfat</code><p><strong><br>5、depmod 创建模块依赖关系的列表<br></strong></p><p>这个模块管理工具是创建模块依赖关系的列表，有几个参数我们注意一下就行了，目前的的Linux 发行版所用的内核是2.6x版本，是自动解决依赖关系，所以这个命令知道就行了；模块之前也有依赖关系，比如我们想驱动USB 移动硬盘，目前有两种驱动，一种是udev ，在内核中有，但目前不太稳定；另一种办法是用usb-storage驱动，而usb-storage 依赖的模块是scsi 模块，所以我们要用usb-storage 的模块，也得把scsi 编译安装；</p><p>再举个例子：sata的硬盘，在Linux中的设备表示的是/dev/sd ，比如 /dev/sda，/dev/sdb 等… 系统要驱动 sata硬盘，则需要把sata在内核中选中，或编译成模块，或内置于内核之中，在此同时，还需要在内核中选中ide ，scsi 的支持等；<br>depmod 工具的洋文原意：depmod &mdash; program to generate modules.dep and map files.（我译的：为modules.dep 文件或映射文件创建依赖关系）</p><code>[root@localhost beinan]# depmod  -a    注：为所有列在/etc/modprobe.conf 或/etc/modules.conf  中的所有模块创建依赖关系，并且写入到modules.dep文件；<br>[root@localhost beinan]# depmod -e     注：列出已挂载但不可用的模块；<br>[root@localhost beinan]# depmod  -n    注：列出所有模块的依赖关系，但仅仅是输出出来 （Write the dependency file on stdout only）</code><p>注：modules.dep 位于 /lib/modules/内核版本 目录</p><p>比如 Fedora Core 4.0 中，系统默认的内核：</p><code>[root@localhost beinan]# ls /lib/modules/2.6.11-1.1369_FC4/modules.dep<br>/lib/modules/2.6.11-1.1369_FC4/modules.dep</code><p><strong><br>6、insmod 挂载模块；<br></strong></p><p>insmod 这个工具，和modprobe 有点类似，但功能上没有modprobe 强，modprobe 在挂载模块是不用指定模块文件的路径，也不用带文件的后缀.o 或.ko ；而insmod 需要的是模块的所在目录的绝对路径，并且一定要带有模块文件名后缀的(modulefile.o 或modulesfile.ko ）；</p><p>对于这个工具，我们只是介绍一下， 并不推荐使用。因为模块有依赖关系，对于新手来说，可能不知道这个模块依赖和哪个模块依赖；</p><p>举例：</p><code>[root@localhost beinan]# insmod /lib/modules/2.6.11-1.1369_FC4/kernel/drivers/net/tg3.ko</code><p>我们要到 /lib/modules/内核版本 uname -r 的命令输出/kernel/drivers 中找相对应的模块才行，要有绝对路径，而且必须要用到文件名的全称，不能把文件名的后缀省略；</p><p><strong><br>五、与内核模块加载相关的配置文件；<br></strong></p><p><strong><br>1、模块的配置文件 modules.conf 或 modprobe.conf<br></strong></p><p>内核模块的开机自动挂载模块一般是位于一个配置文件，一般的Linux发行版本都有 /etc/modules.conf 或 /etc/modprobe.conf 。比如Fedora Core 4.0 内核模块开机自动加载文件是 /etc/modprobe.conf ；在这个文件中，一般是写入模块的加载命令或模块的别名的定义等；比如我们在modules.conf 中可能会发行类似的一行 ；</p><code>alias eth0 8139too</code><br>而8029的网卡应该是<br><code>alias eth0 ne2k-pci</code><p>这样系统启动的时候，首先会modprobe 8139too ，然后再为8139too 指定别名为 eth0，然后我们在登录的时候，用 ifconfig 就会查看到网卡的IP 等情况，当然您得为网卡设置IP 才行；</p><p>一般的情况下，modproe.conf 或modules.conf的内容 是我们用相应的硬件配置工具而生成的；如果您的硬件驱动是没有被内核支持，您自己到硬件的厂商下载而来的驱动。一般的情况下都有安装和帮助文件。他们的驱 动在配置时，他会写入硬件的支持到modules.conf 或modprobe.conf 文件中。</p><p>再比如我们的声卡在modules.conf 或modprobe.conf 中也有相应的内容，这是由alsaconf 配置工具生成的，明白了吧；同理网卡在modprobe.conf 或modules.conf中的内容也是由网卡的配置工具而来的。</p><p>有些硬件是以内核模块的方式驱动的，模块一旦加载上就能用，也没有什么配置工具，比如vfat 和ntfs 的支持；如果是硬件驱动不以模块的方式支持，而是直接编入内核，也不会用在modprobe.conf 或 modules.conf 中加入什么内容；</p><p>如果您有些模块不能开机加载，您想让一些模块加机自动加载，就可以把<strong>modprobe 模块</strong> 直接写入配置文件；</p><p><strong><br>2、内核模块其它配置文件<br></strong></p><p>内核模块的其它配置文件还是需要了解的，比如<strong> /lib/modules/内核版本</strong>目录下的几个文件；了解一下就行；比如：</p><code>[root@localhost beinan]# uname -r<br>2.6.11-1.1369_FC4<br>[root@localhost beinan]# ls /lib/modules/2.6.11-1.1369_FC4/<br>build   misc           modules.ccwmap  modules.ieee1394map  modules.isapnpmap  modules.symbols  source<br>kernel  modules.alias  modules.dep     modules.inputmap     modules.pcimap     modules.usbmap</code><p><strong><br>六、硬件驱动在系统中的目录；<br></strong></p><p><strong><br>硬件驱动在内核中以模块支持的目录；<br></strong></p><p>硬件驱动是必须由内核支持的，无论是我们自己安装驱动，还是内核自带的驱动都是如此。<strong>硬件驱动如果是以内核模块支持的</strong>，驱动目录位于： /lib/modules/内核版本/kernel/目录 或 /lib/modules/内核版本/kernel/drivers 目录中；</p><code>[root@localhost beinan]# uname -r<br>2.6.11-1.1369_FC4<br>[root@localhost beinan]# ls /lib/modules/2.6.11-1.1369_FC4/kernel<br>arch  crypto  drivers  fs  lib  net  sound</code><p><strong>注：</strong>只有驱动在内核中以模块的方法支持，驱动才位于 /lib/modules/相应的目录；如果是直接置入内核的，不会出现在/lib/modules驱动相关的目录；</p><p><strong><br>七、自己编译驱动的办法；<br></strong></p><p>如果是硬件厂商或者开源社区提供的驱动（没有集成在内核源码中的），编译驱动过程一般是./configure ;make;make install ，有时程序不提供./configure ，我们可以make或make install ，或者执行make;make install ；如果不能make install ，则需要我们自己复制.o或者.ko文件到 /lib/modules/内核版本/kernel/目录 或 /lib/modules/内核版本/kernel/drivers 目录中相应的驱动目录；</p><p>这个还是自己尝试吧，说也说不清楚，遇到问题后就知道怎么弄了；具体的还是驱动的REAME和INSTALL为准；</p><p>现在大多驱动都是在编译安装时，都自动复制.o或.ko 文件到内核模块目录，大多不用我们自己动手复制过去。如果您尝试编译安装声卡驱动 alsa-drivers 就会明白我所说的意思；</p><p><strong><br>如果是我们通过重编内核来解决驱动问题，可以查看/usr/src/目录中的内核源码目录中的 Documentation 的REAME ；所有的帮助文件都在那里；<br></strong></p><p><strong><br>后记：<br></strong></p><p>内核编译对新手来说是有点困难，我写过类似的文档也有好多篇，但是不是新手弟兄从中能学到点什么，我不太知道；毕竟我写的文档在内核文件告诉一些基本的流程和注意的事项；内核的配置只有多实践才能学会，在配置内核时，要多看看帮助；</p><p>内核模块管理方面我在本文中已经写了一些，大体上就这些，如果想要知道更为详细的，只能是自己看man 和–help了，我写文档也无非是查看这些东西，然后实践再写给大家；我能写出来，我想您的能力并不一定比我差，应该超出我才对；</p><p><strong><br>相关文档：<br></strong></p><p>1、<a href="http://fedora.linuxsir.org/main/?q=node/66" target="_blank" rel="external">《编译内核操作流程 ──为新手指南》</a><br>2、<a href="http://fedora.linuxsir.org/main/?q=node/88" target="_blank" rel="external">《内核管理概述》</a><br>3、<a href="http://fedora.linuxsir.org/main/?q=node/67" target="_blank" rel="external">《用ALSA驱动声卡流程详解》</a><br>4、<a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external"> 《Fedora / Redhat 软件包管理指南》</a><br>5、<a href="http://kernel.org/" target="_blank">内核主站：http://kernel.org</a></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/20/Linux-module-init-tools模块管理概述/" class="archive-article-date">
  	<time datetime="2006-12-20T06:37:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-编译内核操作流程-──为新手指南" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/20/编译内核操作流程-──为新手指南/">编译内核操作流程 ──为新手指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 编译内核操作流程 ──为新手指南</p><p><strong>作者：</strong>北南南北<br><strong>来自：</strong>LinuxSir.Org<br><strong>提要：</strong> 编译内核主要是通过内核实现某些功能，比如iptables 需要内支持；所有的硬件的支持也是通过内核实现的；本文只是简单的给初学者讲一下编译内核的流程；</p><p><strong><br>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>正文<br>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br></strong></p><p><strong><br>一、为什么要编译内核；<br></strong></p><p>有时我们为了实现某些功能，比如对iptables的防火墙有些需要内核支持；还有实现一些硬件的支持等，这时我们需要重编内核；</p><p><strong><br>二、内核源码版本的选择；<br></strong></p><p>如果发行版本提供内核源码，最好还是用发行版本提供的；比如Fedora 4.0 提供了很多版本的内核源码；我们安装好后，他自带的配置文件大多能满足我们的需要，对于新手来说，根据自带的内核的配置文件.config ，我们也能学到一点如何配置内核。也没有什么难的，熟能生巧罢了；</p><p>如果从 kernel.org 下载最新稳定版本的内核也是可以的；</p><p><strong><br>三、内核源码安装或解压；<br></strong></p><p>对于Fedora Core 4.0 来说，内核源码是放在 /usr/src/kernels 目录中；如果通过在线升级内核，也是放在这个目录中；如果您的系统中的 /usr/src/kernels/ 中没有内容，说明您没有安装内核的源码包 kernel-devel 软件包；</p><p>您可以通过软件包管理器来补装 ，请参考 <a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external"> 《Fedora / Redhat 软件包管理指南》</a></p><p>如果您用Fedora Core 4.0 ，我建议您在保留老内核的基础上，在线下载最新版本的内核 kerenl-devel 和对应版本的 kernel 或者从 kernel.org 下载，有时可能新的kerenl 已经解决了您所面对的问题，这时就没有必要编译内核了；</p><p>如果您是通过在线安装的内核源码包 ，比如通过 apt+synaptic 或者yum 安装的，内核源码会被放到/usr/src/kernel 下的目录中，您要进入相对应的目录进行编译；</p><p>在线更新软件包，请参考 <a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external"> 《Fedora / Redhat 软件包管理指南》</a>，推荐 apt+synaptic 工具；</p><p>如果您是是下载kernel 和kernel-devel 的rpm 包，可以通过来安装；</p><code>[root@localhost beinan]# rpm -ivh kernel<em>.rpm</em></code><p>如果您是从kernel.org 下载的类似 linux-2.6.13.tar.bz2 或者 linux-2.6.13.tar.gz的，您要把下载下来的文件移到 /usr/src 目录中解压； 然后进入解压的目录中进行配置和编译；</p><code>[root@localhost beinan]# mv linux-2.6.13.tar.bz2<br>[root@localhost beinan]# cd /usr/src/<br>[root@localhost src]# tar jxvf linux-2.6.12.3.tar.bz2</code><p><strong>提示：</strong>本文以linux-2.6.12.3为例，其实通过发行版的升级版的 kernel-devel 和从kernel.org 下载下来的差不多，大同小异；不同的是通过在线升级的rpm格式的内核源码包，有配置文件.config 可以参考；安装到的目的地是/usr/src/kernel 对FC 4.0来说；如果您要高编译和配置内核，</p><p><strong><br>四、内核的配置；<br></strong></p><p><strong><br>1、进入目录执行 make mrproper ，对于从 kernel.org 下载而来的tar.bz格式的源码包；<br></strong></p><code>[root@localhost src]# cd linux-2.6.12.3/<br>[root@localhost linux-2.6.12.3]#<br>[root@localhost src]# cd linux-2.6.12.3/<br>[root@localhost linux-2.6.12.3]# make mrproper<br>[root@localhost linux-2.6.12.3]# make menuconfig</code><p>对于Fedora Core 4.0 ，如果您是通过在线安装的 kernel和kernel-devel 新版本的包，比如是2.6.12-1.1398_FC4-i686，你可以直进入 /usr/src/kernel/相应的目录中直接执行 make menuconfig ；利用发行版本提供的 .config 来配置，这样方便点。不要make mrproper ，否则.config 就没有了；这也是为什么要用发行版本提供的内核源码升级包的原因；</p><p>其它配置和安装大同小异；模仿总可以吧；</p><p><strong><br>2.简要的配置内核；<br></strong></p><p>进入配置内核的配置模式后，我们可能一无所知，看下面；</p><p>内核配置有两种方法，一种是直接置入内核  ；另一种是编成模块 M ；两种方法各有优点；直接编入内核的，比如设备的启动，不再需要加载模块的这一过程了；而编译成模块，则需要加载设备的内核支持的模块；但直接把所有的东 西都编入内核也不是可行的，内核体积会变大，系统负载也会过重。我们编内核时最好把极为重要的编入内核；其它的如果您不明白的，最好用默认。</p><p><strong><br>1）移动键盘上下左右键，按Enter 进入一个目录。把指针移动到Exit就退出当前目录到上级目录；</strong></p><p><strong>2）针对自己机器存在的问题进行修改，比如大内存的支持；<br></strong><br>选择自己机器的CPU；</p><p>移动键盘到 Processor type and features —&gt; ，然后按ENTER进入；<br>找到   Processor family (Pentium-Pro)  —&gt; 按ENTER进入；</p><p>进入后我们发现有好多CPU的型号可选；一般的情况下要根据<br>bash-3.00# cat /proc/cpuinfo 输出的信息来选，比如我们的是Celeron （P4）一代的，应该选如下的，当然默认的 486也是可以正常运行的，既然我们重编一次内核，就得选中对应型号的，也许性能有所提高呢；</p><code>Processor family (Pentium-4/Celeron(P4-based)/Pentium-4 M/Xeon)</code><br>对大内存支持；如果内存是1G或者1G以上，但小于4G的，就要选4G支持；如果超过4G的，要选64G的支持；<code>High Memory Support (4GB) —&gt;<br>(X) 4GB<br>( ) 64GB</code><p>还有比如声卡等硬件，需要我们一步一步的查看；如果有不明之处，就要按 [shift]+？的组合键来查看说明。一般的情况下，2.6.x的内核会根据机器的情况自动配出一个文件，只需要我们来查看一下，把重要的地方改改就行了；</p><p>再举个例子：比如我现在所用的声卡是intel ac97的，我应该怎么配置呢？</p><p>首先要知道自己的声卡的芯片组，我们要通过lspci -v 来查看；</p><code>[root@localhost beinan]#lspci -v</code><br>只查看声卡的，应该用如下的方法：<br><code>[root@localhost beinan]# lspci -v |grep audio<br>00:1f.5 Multimedia audio controller: Intel Corp. 82801DB (ICH4) AC’97 Audio Controller (rev 03)</code><p>通过上面的输出，我们知道这台机器用的是intel AC97声卡；所以我们要特别注意AC97的配置；</p><code>找到 Device Drivers —&gt; Sound —&gt;<br>&lt;M&gt; Sound card support 声卡的支持，这个是一定要选中的吧；<br>&lt;M&gt; Advanced Linux Sound Architecture 对声卡支持的ALSA驱动的支持；<br>下面有OSS驱动，只是一部份。如果想用OSS的驱动更全的，可以去买；其它的就看如下的选吧；<br>&lt;M&gt; Sequencer support<br>&lt;M&gt; Sequencer dummy client<br>&lt;M&gt; OSS Mixer API<br>&lt;M&gt; OSS PCM (digital audio) API[<em>] OSS Sequencer API<br>&lt;M&gt; RTC Timer support[</em>] Verbose printk<br>[ ] Debug</code><p>大多是默认的就好，如果您不知道是做什么用的，或者怎么用；</p><p>然后我们再向下看有</p><code>Generic devices —&gt; 进入里面<br>&lt;M&gt; Dummy (/dev/null) soundcard<br>&lt;M&gt; Virtual MIDI soundcard<br>&lt;M&gt; MOTU MidiTimePiece AV multiport MIDI<br>&lt;M&gt; UART16550 serial MIDI driver<br>&lt;M&gt; Generic MPU-401 UART driver<br>ISA devices —&gt; 如果您用ISA声卡就在这里面选；<br>PCI devices —&gt; 如果您用PCI声卡，就在这里面选，集成声卡也在这里；<br>USB devices —&gt; 这是USB声卡内核支持选项；我有一个这样的声卡，但没有试过；<br>PCMCIA devices —&gt; 这是PCMCIA声卡的选项，我还没有看过这样的声卡呢；如果您有，就在这里面动动手吧。</code><br>因为我用的是Intel 集成的声卡，所以要在PCI中选择，我们在 中可以看到有两个与INTEL有关的；<br><code>&lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller 这个才是Intel AC97声卡的；<br>&lt; &gt; Intel/SiS/nVidia/AMD MC97 Modem (EXPERIMENTAL) 这个是机器集成的INTEL猫的蜂鸣器的；</code><br>因为我发现如果把猫的蜂鸣器的驱动也选上，可能造成两个冲突。所以只能选上面的那个；<p>我们再回到 Open Sound System —&gt; 中看看，与我用的声卡是不是有关的？</p><code>&lt;M&gt; Open Sound System (DEPRECATED)<br>&lt;M&gt; Intel ICH (i8xx) audio support<br>&lt;M&gt; OSS sound modules<br>&lt;M&gt; Loopback MIDI device support<br>&lt;M&gt; Microsoft Sound System support</code><br>我们也可以看到Open Sound System中也有好多的声卡驱动，大家根据前面的lspci -v 来选择吧。<p><strong><br>3）对于操作系统所采用的文件系统的支持要编入内核，最好不要编成模块；（重要）<br></strong></p><p>比如我的Fedora core 4.0 所采用的文件系统用的是ext3 ，所以我要把它直接编入内核；好处是不受模块丢失或者损坏而不能启动系统；而有时您把系统所采用的文件系统编译成模块，出现VFS错误，也有这方面的事， 可能是您没有把ext3加入到相应的加载模块的配置文件中，所以我们为了减少麻烦，把风险降到最低，还是要直接置入内模的好；</p><code>File systems —&gt;<br>&lt;<em>&gt; Ext3 journalling file system support<br>[</em>] Ext3 extended attributes<br>[<em>] Ext3 POSIX Access Control Lists<br>[</em>] Ext3 Security Labels</code><br>如果您还有其它的硬盘分区要读取，比如是reiserfs、ext2、fat、fat32、ntfs等，这样的可以编成模块来支持；<p>再举一例：如果您的的操作系统用的是reiserfs的文件系统，当然就要把reiserfs的直接编入内核，其它的可以编成模块来支持了；</p><p><strong><br>4）对于硬盘及RAID的支持，要直接编入内核；<br></strong><br>比如ATA、SATA、SCSI及RAID的支持直接内核支持；有时编完内核后，启动时不能识别硬盘和RAID，大多事情出在这里；Slackware中 在这方面有的是模块支持，我们可以把它由模块M改成内核*来支持； 如果您不明白，就按默认进行；SATA的硬盘的支持除了选中SATA的支持、IDE设备的支持以外，还要选中SCSI的支持；<br><strong><br>5）对于咱们所没有的设备，可以在内核中不选，熟能生巧罢了；<br></strong><br>比如我没有ISDN设备 ，所以就把ISDN去掉；</p><code>ISDN subsystem —&gt;<br>&lt; &gt; Linux telephony support</code><p>如果您没有1394的设备 ，当然可以把1394的支持也去掉；等等。。。。。。。</p><p>如果您有USB的设备，要把USB方面好好看看；比如大家常用的移动硬盘；USB猫等，还有扫描仪等；</p><p>内核配置就说这么多吧，太多了，我也说不清楚，水平有限啊；</p><p>配置好后先要保存</p><p>Save Configuration to an Alternate File</p><p>出来一个</p><p>Enter a filename to which this configuration ，should be saved as an alternate. Leave blank to abort.<br>.config</p><p>按回车就行了，这样就保存住了；</p><p>然后退出 Exit  ，这时也会出现保存 ；</p><p>如果你想把.config保存起来，可以再复制一份到安全一点的目录，以备后用；<br><strong><br>五、编译内核；<br></strong></p><code>[root@localhost linux-2.6.12.3]# make<br>[root@localhost linux-2.6.12.3]# make modules_install</code><p>这样就编译好了，并把模块也安装在了 /lib/modules目录中了，请看：</p><code>[root@localhost linux-2.6.12.3]# ls /lib/modules/<br>2.6.11-1.1369_FC4   2.6.12.3</code><p><strong><br>六、安装内核及配置grub或lilo ；<br></strong><br><strong><br>1、复制bzImage等相关文件，并创建initrd文件；<br></strong></p><code>[root@localhost linux-2.6.12.3]# cp arch/i386/boot/bzImage /boot/vmlinuz-2.6.12.3<br>[root@localhost linux-2.6.12.3]# cp System.map /boot/System.map-2.6.12.3<br>[root@localhost linux-2.6.12.3]# cd /boot<br>[root@localhost linux-2.6.12.3]# /sbin/mkinitrd initrd-2.6.12.3.img   2.6.12.3</code><p>我们把 编译出来的bzImage，拷入到/boot目录，拷贝成 vmlinuz-2.6.12.3；<br>并且用 mkinitrd 来创建imitrd-xxx.img 文件，其中xxx为内核的版本号，是通过 查看 /lib/modules来版本来对应的，我们是编译出来的是 2.6.12.3，所以就运行上面的命令创建，创建的出来的是initrd-2.6.12.3.img ；不创建这个文件，有时是启动不起来的，比如提示VFS错误等；</p><p><strong><br>2、查看系统引导管理器grub或者lilo的配置文件。<br></strong></p><p>如果想要让新内核能让系统引导管理器grub和lilo的菜单上能看得到，必须改 grub.conf或者lilo.conf，但我们必须保留老内核的在grub和lilo的启动菜单，毕竟我们编内核不能百分百的成功，对不对？？安全第一吧；</p><p>我只说grub的，我没有lilo，也不会用。所以咱们还是GRUB吧，FC 4 系统引导管理器是 GRUB，所以我们谈谈GRUB的设置；</p><p>查看 /etc/grub.conf；</p><p>比如我的grub.conf的内容是这样的；</p><code># grub.conf generated by anaconda<br>#<br># Note that you do not have to rerun grub after making changes to this file<br># NOTICE:  You do not have a /boot partition.  This means that<br>#          all kernel and initrd paths are relative to /, eg.<br>#          root (hd0,7)<br>#          kernel /boot/vmlinuz-version ro root=/dev/hda8<br>#          initrd /boot/initrd-version.img<br>#boot=/dev/hda<br>default=0<br>timeout=5<br>#splashimage=(hd0,7)/boot/grub/splash.xpm.gz<br>#hiddenmenu<br>title Fedora Core (2.6.11-1.1369_FC4)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root (hd0,7)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kernel /boot/vmlinuz-2.6.11-1.1369_FC4 ro root=LABEL=/ rhgb quiet<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; initrd /boot/initrd-2.6.11-1.1369_FC4.img<br>title WinXP<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rootnoverify (hd0,0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chainloader +1</code><p>我们要把老内核的启动保留下来，以防不测，我们只加入新的内核的启动；所以我加上这样一段；</p><code>title Fedora Core (2.6.12.3)<br>root (hd0,7)<br>kernel /boot/vmlinuz-2.6.12.3 ro root=LABEL=/ rhgb quiet<br>initrd /boot/initrd-2.6.12.3.img</code><p>咱们再来看一下改过后的配置文件；</p><code># grub.conf generated by anaconda<br>#<br># Note that you do not have to rerun grub after making changes to this file<br># NOTICE:  You do not have a /boot partition.  This means that<br>#          all kernel and initrd paths are relative to /, eg.<br>#          root (hd0,7)<br>#          kernel /boot/vmlinuz-version ro root=/dev/hda8<br>#          initrd /boot/initrd-version.img<br>#boot=/dev/hda<br>default=0<br>timeout=5<br>#splashimage=(hd0,7)/boot/grub/splash.xpm.gz<br>#hiddenmenu<br>title Fedora Core (2.6.12.3)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root (hd0,7)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kernel /boot/vmlinuz-2.6.12.3 ro root=LABEL=/ rhgb quiet<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; initrd /boot/initrd-2.6.12.3.img <br>title Fedora Core (2.6.11-1.1369_FC4)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root (hd0,7)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kernel /boot/vmlinuz-2.6.11-1.1369_FC4 ro root=LABEL=/ rhgb quiet<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; initrd /boot/initrd-2.6.11-1.1369_FC4.img<br>title WinXP<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rootnoverify (hd0,0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chainloader +1</code><p>然后重新启动机器，如果出现VFS错误，可能就是我写重要的那个地方出了错误；</p><p><strong>注意：</strong>如果重新启用内核后，原来安装的显示卡驱动，比如 NVIDIA和ATI的驱动还要重新安装；</p><p><strong>后记：</strong></p><p>为写声卡及其其它硬件设备的安装教程做准备，重写此文档；并更正一些错误；</p><p><strong>附录：</strong></p><p>1、<a href="http://fedora.linuxsir.org/main/?q=node/88" target="_blank" rel="external">《内核管理概述》</a><br>2、<a href="http://fedora.linuxsir.org/main/?q=node/63" target="_blank" rel="external"> 《Fedora / Redhat 软件包管理指南》</a><br>3、<a href="http://kernel.org/" target="_blank">内核主站：http://kernel.org</a></p>By beinan at 2005/09/03 - 16:46 | <a href="http://fedora.linuxsir.org/main/?q=taxonomy/term/18" target="_blank" rel="external">Fedora</a> | <a href="http://fedora.linuxsir.org/main/?q=taxonomy/term/17" target="_blank" rel="external">Redhat</a> | <a href="http://fedora.linuxsir.org/main/?q=taxonomy/term/2" target="_blank" rel="external">基础入门</a> | <a href="http://fedora.linuxsir.org/main/?q=comment/reply/66#comment" title="共享你有关本文的思想和意见." target="_blank" rel="external">参与评论</a> | 13549 阅读<br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/20/编译内核操作流程-──为新手指南/" class="archive-article-date">
  	<time datetime="2006-12-20T06:26:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-20</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-lxr-Linux-Cross-Reference" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/19/lxr-Linux-Cross-Reference/">lxr: Linux Cross-Reference</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> lxr: Linux Cross-Reference <br><br>0.31 (stable) for Debian <br>最近看源码，找到这个工具，不知道对大家是否有用。<br><br>本文与README.Debian稍有出入<br><br>安装perl<br>安装Web服务器(apache2)<br>安装glimpse(可选)<br><br>安装目录为<br>/var/lib/lxr<br><br>1)  建立目录<br><br>- 源码目录<br><br>以2.6.15版本为例<br>假设源码放在/usr/src/linux-2.6.15中，可以用<br># cd /var/lib/lxr/source/ <br># ln /usr/src/linux-2.6.15 -s linux-2.6.15<br>当然也可以直接将源码放到此目录中。建立其它版本的源码目录，例<br>source<br>|– linux-0.11<br>|– linux-1.0 <br>|– linux-2.2.25<br>|– linux-2.4.27<br>`– linux-2.6.15 <br><br>创建文件versions，写入版本的列表<br>代码:linux-0.11<br>linux-1.0<br>linux-2.2.25<br>linux-2.4.27<br>linux-2.6.15创建文件defversion，写入显示的默认版本<br>linux-2.6.15<br><br>- 索引目录<br>建立这个目录是为了方便管理文件<br># mkdir /var/lib/lxr/databases<br># cd /var/lib/lxr/databases<br># mkdir linux-0.11<br>…<br><br>2)  配置Web服务器<br><br>以apache2为例<br><br>创建文件 /etc/apache2/site-available/lxr 写入：<br>PHP 代码:<code> </code><code> # Linux Cross Reference Stuff <br># 以<a href="http://hostname/lxr" target="_blank" rel="external">http://hostname/lxr</a> 建立访问 <br># 允许/var/lib/lxr能被用户访问 <br><br>Alias /lxr /var/lib/lxr <br>&lt;Directory /var/lib/lxr&gt; <br>&nbsp;&nbsp;Options All <br>&nbsp;&nbsp; AllowOverride All <br>&lt;/Directory&gt;  <br> </code># ln /etc/apache2/site-available/lxr -s /etc/apache2/site-enable/lxr<br><br>创建文件 /var/lib/lxr/http/.htaccess 写入：<br>PHP 代码:<code> </code><code> &lt;Files ~ (search|source|ident|diff|find)$&gt; <br>SetHandler cgi-script <br>&lt;/Files&gt;  <br> </code>3) 配置LXR <br><br>修改配置文件 /var/lib/lxr/http/lxr.conf:   <br>PHP 代码:<code> </code><code> # Configuration file. <br><br># Define typed variable &quot;v&quot;, read valueset from file. <br># 版本列表的位置  <br>variable: v, Version, [/var/lib/lxr/source/versions], [/var/lib/lxr/source/defversion] <br><br># Define typed variable &quot;a&quot;.&nbsp;&nbsp; First value is default. <br># 显示源码的架构版本 <br>variable: a, Architecture, (i386, alpha, m68k, mips, ppc, sparc, sparc64) <br><br># Define the base url for the LXR files. <br># 服务器的地址，地址最后必须包括 &quot; / &quot; <br>baseurl:<a href="http://localhost/lxr/&nbsp;&nbsp;&amp;nbsp" target="_blank" rel="external">http://localhost/lxr/&nbsp;&nbsp;&amp;nbsp</a>;  <br><br># These are the templates for the HTML heading, directory listing and <br># footer, respectively. <br># 显示网页的格式 <br>htmlhead: /var/lib/lxr/http/template-head <br>htmltail: /var/lib/lxr/http/template-tail <br>htmldir:&nbsp;&nbsp; /var/lib/lxr/http/template-dir <br><br># The source is here. <br># 源码目录位置 <br>sourceroot: /var/lib/lxr/source/$v/ <br># 显示源码的名称 <br>srcrootname: $v <br><br># &quot;#include &lt;foo.h&gt;&quot; is mapped to this directory (in the LXR source <br># tree) <br>incprefix: /include <br><br># The database files go here. <br># 放置lxr数据库索引文件的目录 <br>dbdir: /var/lib/lxr/databases/$v/ <br><br># Glimpse can be found here. <br># glimpse安装位置 <br>glimpsebin: /usr/bin/glimpse <br><br># The power of regexps.&nbsp;&nbsp; This is pretty Linux-specific, but quite <br># useful.&nbsp;&nbsp; Tinker with it and see what it does.&nbsp;&nbsp; (How’s that for <br># documentation?) <br>map: /include/asm[^/]<em>/ /include/asm-$a/ <br>map: /arch/[^/]+/ /arch/$a/  <br> </em></code><br>4) 生成数据文件<br><br># cd /var/lib/lxr/source<br>生成lxr的数据库文件<br># /var/lib/lxr/bin/genxref linux-2.6.15<br># mv fileidx ../databases/linux-2.6.15/<br># mv xref ../databases/linux-2.6.15/<br><br>生成glimpse数据库（参考glimpse –help生成其它数据）<br># glimpseindex -H . linux-2.6.15<br># mv .g ../databases/linux-2.6.15<br>允许数据文件可访问<br># chmod +r ../databases/linux-2.6.15/<em><br># chmod +r ../databases/linux-2.6.15/.g</em><br><br>5) 使用<br><br>重启Web服务器，访问<br><a href="http://localhost/lxr/http/blurb.html" target="_blank">http://localhost/lxr/http/blurb.html</a><br><br><em>** 如果出现错误<br><br>－ 确保Web访问权限正确；<br>－ 能执行Perl脚本；<br>－ 查看error.log。<br><br>如果用diff markup出错，对diff打补丁<br>// diff.path<br>PHP 代码:<code> </code><code> — diff.old&nbsp;&nbsp;&nbsp;&nbsp; 1998-05-14 20:01:45.000000000 +0800 <br>+++ diff&nbsp;&nbsp;&nbsp;&nbsp; 2006-03-13 22:00:39.000000000 +0800 <br><br>@@ -130,7 +130,7 @@ <br><br>&nbsp;&nbsp;&nbsp;&nbsp; } <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br>-&nbsp;&nbsp;&nbsp;&nbsp;close(&lt;DIFF&gt;); <br>+&nbsp;&nbsp;&nbsp;&nbsp;close(DIFF); <br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;&lt;h1&gt;Diff markup&lt;/h1&gt;n&quot;,  <br> </code><br>———————————————<br>0.94-cvs for Debian<br><br>版本特性：<br>－ 使用数据库而不再使用数据文件，更新索引时只检查修改过的文件，<br>而不用重新建立全部索引；<br>－ 目标支持多种编程语言而不只是C，ASM；<br>－ 支持CVS<br>－ 支持swish-e索引<br><br>因为此版本用到数据库，如果是从网站上下载的lxr安装文件，要注意的是<br>mysql 5.0中 ‘release’为保留字，lxr建立的表中恰好有它，如果不改<br>代码的话，运行会出错；如果不会改代码，最好就用mysql4或postgres。<br><br># apt-get install lxr-cvs<br><br>- 安装mod_perl<br>libapahce2-mod-perl<br>- 安装数据库<br>mysql, postgresql<br>- 安装perl－数据库接口<br>libdbd-mysql-perl (mysql), libdbd-pg-perl (postgre)<br><br><br>1) 建立目录<br><br>- 源码目录<br>方法同上<br>这个版本的目录可放在任意位置（stable版的好像也可以）<br>所以我放在/usr/src中的目录就不改动了<br><br>- 索引目录<br>存放用glimpse或swish生成的索引文件<br># cd /var/lib/lxr-cvs<br># mkdir databases(存放glimpse生成的索引)<br># mkdir index(存放swish生成的索引)<br><br>2) 建立数据库<br>MySQL:<br># mysql -u root<br>执行<br>==&gt; . /usr/share/doc/lxr-cvs/examples/initdb-mysql<br><br>Postgresql:<br># su postgres<br>创建用户 lxr<br>$ createuser lxr  <br>创建数据库<br>$ createdb -U lxr lxr<br>建立数据库<br>$ psql -U lxr lxr<br>执行<br>==&gt; i /usr/share/doc/lxr-cvs/examples/initdb-postgres<br><br><br>3) 配置Web服务器<br><br>创建文件 /etc/apache2/site-available/lxr-cvs 写入：<br>PHP 代码:<code> </code><code> Alias /lxr /var/lib/lxr-cvs <br>&lt;Directory /var/lib/lxr-cvs&gt; <br>&nbsp;&nbsp;AllowOverride All <br>&lt;/Directory&gt;  <br> </code>如果不用mod_perl，将Alias 改为 ScriptAlias<br><br># ln /etc/apache2/site-available/lxr-cvs -s /etc/apache2/site-enable/lxr-cvs<br><br># cp /usr/share/doc/lxr/cvs/examples/htaccess /var/lib/lxr-cvs/lxr/.htaccess<br>如果不用mod_perl<br># cp /usr/share/doc/lxr/cvs/examples/htaccess_cgi /var/lib/lxr-cvs/lxr/.htaccess<br><br>htaccess_cgi<br>PHP 代码:<code> </code><code> Options Indexes ExecCGI FollowSymlinks <br><br>order deny,allow <br><br>&lt;Files lxr.conf&gt; <br>deny from all <br>&lt;/Files&gt; <br><br>&lt;Files lib&gt; <br>deny from all <br>&lt;/Files&gt; <br><br>&lt;Files ~ (find|search|source|ident|diff|cgi-bin)$&gt; <br>SetHandler cgi-script <br>ForceType text/html <br>&lt;/Files&gt;  <br> </code><br>htaccess<br>PHP 代码:<code> </code><code> Options Indexes ExecCGI FollowSymlinks <br><br>order deny,allow <br><br>&lt;Files ~ (find|search|source|ident|diff|cgi-bin)$&gt; <br>SetHandler perl-script <br># Apache 2 <br>PerlHandler ModPerl::Registry <br># Apache 1.3: uncomment next line and comment the previous line <br>#PerlHandler Apache::Registry <br>PerlSetEnv PERL5LIB lib <br>ForceType text/html <br>PerlSendHeader On <br>&lt;/Files&gt;  <br> </code><br>4) 修改 lxr 配置文件. (/etc/lxr-cvs/lxr.conf)<br>PHP 代码:<code> </code><code> 服务器的地址要标明，因为这个版本是根据地址来生成访问页面的。 <br>&nbsp;&nbsp;’baseurl’ =&gt; ‘<a href="http://hostname/lxr" target="_blank" rel="external">http://hostname/lxr</a>‘, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果不加上别名，会用不了localhost来访问 <br>&nbsp;&nbsp;’baseurl_aliases’ =&gt; [ ‘<a href="http://localhost/lxr" target="_blank" rel="external">http://localhost/lxr</a>‘ ], <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据数据库类型来选择perl接口&nbsp;&nbsp;  <br>&nbsp;&nbsp;# For mysql, the format is dbi:mysql:dbname=&lt;name&gt; <br>&nbsp;&nbsp; # for Postgres, it is dbi:Pg:dbname=&lt;name&gt; <br>&nbsp;&nbsp; # for Oracle, it is dbi:Oracle:host=localhost;sid=DEVMMS;port=1521 <br>&nbsp;&nbsp;&nbsp;&nbsp;’dbname’ =&gt; ‘dbi:Pg:dbname=lxr’, (postgres) <br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;源码目录 <br>&nbsp;&nbsp;&nbsp;&nbsp;’sourceroot’ =&gt; ‘/usr/src’, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;显示名称 <br>&nbsp;&nbsp;&nbsp;&nbsp;’sourcerootname’ =&gt; ‘LXR $v’, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数据库用户和密码 <br>&nbsp;&nbsp;&nbsp;&nbsp;’dbpass’&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; ‘foo’, <br>&nbsp;&nbsp;&nbsp;&nbsp;’dbuser’&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; ‘lxr’, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用glimpse索引 <br>&nbsp;&nbsp;&nbsp;&nbsp;’glimpsedir’ =&gt; ‘/var/lib/lxr-cvs/databases’, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用swish-e索引 <br>&nbsp;&nbsp;&nbsp;&nbsp;’swishdir’ =&gt; ‘/var/lib/lxr-cvs/index/‘,  <br> </code>5) 建立交叉索引<br><br># genxref –url=<a href="http://hostname/lxr" target="_blank" rel="external">http://hostname/lxr</a> –allversions (全部)<br>或  <br># genxref –url=<a href="http://hostname/lxr" target="_blank" rel="external">http://hostname/lxr</a> –version=linux-2.X.Y<br>这个时间会很久，大概一个2.X的要2～3小时吧<br><br>在浏览器中 <a href="http://localhost/lxr/source" target="_blank">http://localhost/lxr/source</a><br><br>如果查看少于两个字符或名称含有’-‘的目录无法打开<br>对Common.pm打补丁(/usr/share/perl5/LXR/)<br>PHP 代码:<code> </code><code> — Common.pm.old&nbsp;&nbsp;&nbsp;&nbsp; 2005-05-05 07:19:33.000000000 +0800 <br>+++ Common.pm&nbsp;&nbsp;&nbsp;&nbsp; 2006-03-13 22:12:11.000000000 +0800 <br><br>@@ -539,9 +539,9 @@ <br>&nbsp;&nbsp;&nbsp;&nbsp;  <br>&nbsp;&nbsp;&nbsp;&nbsp; if(defined $path) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# First suppress anything after a dodgy character <br>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s!(^[w_+-,.%^/]+).</code></em>!$1!; <br>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s!(^[w_+-,.%^/]+).*!$1!; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Clean out /../ <br>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while ($path =~ m!/../!) { <br>+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while ($path =~ m!/../!) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path = s!/../!/!g; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br>&nbsp;&nbsp;&nbsp;&nbsp; }  <br> <br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/19/lxr-Linux-Cross-Reference/" class="archive-article-date">
  	<time datetime="2006-12-19T02:15:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-19</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-lxr源代码索引" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/18/lxr源代码索引/">lxr源代码索引</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 我们在阅读linux源代码时都有这样的体会:核心的组织相对松散，<br><br>在看一个文件时往往要牵涉到其他的头文件、源代码文件。如此来回<br><br>跳转寻找变量、常量、函数的定义十分不方便，这样折腾几次，便使<br><br>读代码的心情降到了低点。<br><br><br><br>   lxr(linux cross reference)就是一个解决这个问题的工具：他对<br><br>你指定的源代码文件建立索引数据库，利用perl脚本CGI动态生成包含<br><br>源码的web页面，你可以用任何一种浏览器查阅。在此web页中，所有<br><br>的变量、常量、函数都以超连接的形式给出，十分方便查阅。比如你<br><br>在阅读/usr/src/linux/net/socket.c的源代码，发现函数<br><br>get_empty_inode不知道是如何以及在哪里定义的，这时候你只要点击<br><br>get_empty_inode,lxr将返回此函数的定义、实现以及各次引用是在什<br><br>么文件的哪一行，注意，这些信息也是超连接，点击将直接跳转到相应<br><br>的文件相应的行。另外lxr还提供标识符搜索、文件搜索，结合程序<br><br>glimpse还可以提供对所有的源码文件进行全文检索，甚至包括注释！<br><br><br><br>   下面将结合实例介绍一下lxr和glimpse的基本安装和使用，由于<br><br>glimpse比较简单，就从它开始：<br><br><br><br>   首先访问站点： <a href="http://glimpse.cs.arizona.edu/" target="_blank" rel="external"><br>target=&quot;_blank&quot;&gt;http://glimpse.cs.arizona.edu/</a> 得到glimpse<br><br>的源码,比如我得到的是glimpse-4.12.5.tar.gz . 用root登录，在<br><br>任一目录下用tar zxvf glimpse-4.12.5.tar.gz解开压缩包，在当前<br><br>目录下出现新目录glimpse-4.12.5 .进入该目录，执行make即可。进<br><br>入bin目录，将文件glimpse和glimpseindex拷贝到/bin或/usr/bin下<br><br>即可。如果单独使用glimpse，那么只要简单的执行glimpseindex foo<br><br>即可，其中foo是你想要索引的目录，比如说是/usr/src/linux .glimpseindex<br><br>的执行结果是在你的起始目录下产生若干.glimpse<em>的索引文件。然后<br><br>你只要执行glimpse yourstring即可查找/usr/src/linux下所有包含<br><br>字符串yourstring的文件。<br><br><br><br>   对于lxr，你可以访问lxr.linux.no得到它的源代码解包后，遵循如下步骤：<br><br><br><br> /</em>下面的文字来源于lxr的帮助文档以及本人的安装体会<em>/<br><br><br><br>   1)修改Makefile中的变量PERLBIN和INSTALLPREFIX,使它们分别为<br><br>perl程序的位置和你想lxr安装的位置.在我的机器上，PERLBIN的值为<br><br>/usr/bin/perl  .至于INSTALLPREFIX，有如下原则，lxr的安装路径<br><br>必须是web服务器能有权限访问。因此它的值简单一点可取<br><br>/home/httpd/html/lxr (对于Apache web server)。<br><br><br><br>   2)执行 make install<br><br><br><br>   3)修改$INSTALLPREFIX/http/lxr.conf :<br><br>       baseurl : <a href="http://yourip/lxr/http/" target="_blank" rel="external"><br>target=&quot;_blank&quot;&gt;http://yourIP/lxr/http/</a> <br>       htmlhead: /home/httpd/html/lxr/http/template-head<br><br>       htmltail: /home/httpd/html/lxr/http/template-tail<br><br>       htmldir:  /home/httpd/html/lxr/http/template-dir<br><br>       sourceroot : /usr/src/linux    # 假如对linux核心代码索引<br><br>       dbdir : /home/httpd/html/lxr/dbdir/  #dbdirk可任意起名，且位置任意<br><br>       glimpsebin: /usr/bin/glimpse   #可执行程序glimpse的位置<br><br><br><br>   4)在$INSTALLPREFIX/http/下增加一个文件.htaccess  内容：<br><br>       &lt;Files ~ (source|search|ident|diff|find)$&gt; **</em><br><br>       SetHandler cgi-script<br><br>       &lt;/Files&gt;<br><br>     上面这个文件保证Apache server将几个perl文件作为cgi-script.<br><br><br><br>   5)按照lxr.conf中的设置建立dbdir ,按照上例,建立目录<br><br>      /home/httpd/html/lxr/dbdir<br><br>     进入这个目录执行$INSTALLPREFIX/bin/genxref yourdir<br><br>     其中yourdir是源码目录，比如/usr/src/linux<br><br>     如果要结合glimpse，则执行glimpseindex -H . yourdir<br><br><br><br>   6)修改 /etc/httpd/conf/access.conf ,加入 <br><br>     &lt;Directory /home/httpd/html/lxr/http&gt;<br><br>      Options All<br><br>      AllowOverride All<br><br>      order allow,deny<br><br>      allow from all<br><br>     &lt;/Directory&gt; <br><br> <br><br>   7)进入/etc/rc.d/init.d/  执行 <br><br>     killall httpd <br><br>     ./httpd start<br><br>     进入X ，用浏览器 <a href="http://yourip/lxr/http/blurb.html" target="_blank" rel="external"><br>target=&quot;_blank&quot;&gt;http://yourIP/lxr/http/blurb.html</a> <br>     大功告成 ，这下你可以舒心的读源码了。<br><br><br><br>   注意：以上只是lxr和glimpse的基本用法，进一步的说明可以<br><br>         参考连机文档。如有问题请与 <a><br>href=&quot;mailto:sea_cloud@263.net&quot;&gt;sea_cloud@263.net</a> 联系。 </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/18/lxr源代码索引/" class="archive-article-date">
  	<time datetime="2006-12-18T14:03:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-18</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-交叉索引工具lxr-0-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/18/交叉索引工具lxr-0-3/">交叉索引工具lxr-0.3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 安装用于内核与源码的交叉索引工具lxr-0.3<br><br><br><br>1.wget <a><br>href=&quot;<a href="http://prdownloads.sourceforge.net/lxr/lxr-0.3.tar.gz，目前最新版为0.91，0.3为其" target="_blank" rel="external">http://prdownloads.sourceforge.net/lxr/lxr-0.3.tar.gz，目前最新版为0.91，0.3为其</a><br>稳定版&quot;<br>target=&quot;_blank&quot;&gt;<a href="http://prdownloads.sourceforge.net/lxr/lxr-0.3.tar.gz，目前最新版为0.9" target="_blank" rel="external">http://prdownloads.sourceforge.net/lxr/lxr-0.3.tar.gz，目前最新版为0.9</a><br>1，0.3为其稳定版</a> <br><br><br>2. tar zxvf lxr-0.3.tar.gz后 cd lxr-0.3/;make;<br><br><br><br>3. vi Makefile<br><br>修改INSTALLPREFIX=/var/www/lxr(通过浏览器访问的目录)<br><br><br><br>4. make install将lxr的相关文件复制到$INSTALLPREFIX指定的目录下<br><br><br><br>5. 安装apache，建立用户及用户组apache,然后更改配置文件httpd.conf<br><br>或其它(与apache版本有关)<br><br> User = apache<br><br> Group = apache <br><br> DocumentRoot=/var/www/lxr/http<br><br> 在DirectoryIndex 中加入blurb.html，类似于DirectoryIndex index.html index.htm<br>blurb.html<br><br><br><br>编辑 /etc/httpd/conf/access.conf ,加入<br><br>&lt;Directory /var/www/lxr/http&gt;<br><br>Options All<br><br>AllowOverride All<br><br>order allow,deny<br><br>allow from all<br><br>&lt;/Directory&gt;<br><br><br><br>6.编辑/var/www/lxr/http/lxr.conf文件<br><br>更改如下:<br><br>variable: v, Version, [/var/www/lxr/source/versions]<br><br>baseurl:<a href="http://192.168.0.1/" target="_blank" rel="external">http://192.168.0.1/</a><br><br>sourceroot: /var/www/lxr/source/$v/<br><br>srcrootname: Linux<br><br><br><br>incprefix:/var/www/lxr/source/$v/include/linux/ 需要包含的头文件所在目录<br><br>dbdir:/var/www/lxr/dbindex/$v/   存放交叉索引数据库的目录<br><br>map: /var/www/lxr/source/$v/include/asm[^/]*/ /var/www/lxr/source/$v/include/asm-$a/<br><br>map: /var/www/lxr/source/$v/arch/[^/]+/ /var/www/lxr/source/$v/arch/$a/<br><br><br><br>7.mkdir -p /var/www/lxr/dbindex/;chown -R apache.apache /var/www/lxr/dbindex/<br><br><br><br>8.为linux-2.2.20内核建立lxr交叉索引<br><br> wget  <br> cd /var/www/lxr/source/;<br><br> tar zxvf linux-2.2.20.tar.gz;<br><br> mv linux 2.2.20;<br><br> cd 2.2.20;<br><br> ../../bin/genxref (建议安装perl-5.0) <br><br>       chow -R .apache.apache ../source/<br><br>       mv fileidx ../../dbindex/2.2.20/<br><br>       mv xref ../../dbindex/2.2.20/<br><br><br><br>9. cd http/; vi .htaccess;编辑以下内容<br><br>&lt;Files ~ (search|source|ident|diff|find)$&gt;<br><br>SetHandler cgi-script<br><br>&lt;/Files&gt;<br><br><br><br>10.修改blurb.html中的超连接如下<br><br>&lt;a HREF=&quot;/source/&quot;&gt; <br><br>&lt;i&gt;Browse the code&lt;/i&gt;&lt;/a&gt;<br><br><br><br>修改template-tail与template-head文件修改blurb.html的超连接为&lt;a<br>href=&quot;/blurb.html&quot;&gt;<br><br> <br><br>11.打开mozilla浏览 192.168.0.1<br><br><br><br>12.如何建立多个内核版本的源码交叉索引？<br><br>编辑lxr.conf文件中指定获得Version的文件/var/www/lxr/source/versions<br><br>按照7的步骤建立linux-2.0.39;linux-2.4.18两个版本的源码索引，然后<br><br>cat /var/www/lxr/source/versions;<br><br>2..2.20<br><br>2.0.39<br><br>2.4.18 </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/18/交叉索引工具lxr-0-3/" class="archive-article-date">
  	<time datetime="2006-12-18T12:19:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-18</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-rpm-etc-apt-sources-list" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/09/rpm-etc-apt-sources-list/">rpm /etc/apt/sources.list</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="List-of-available-apt-repositories-available-from-ayo-freshrpms-net-This-file-should-contain-an-uncommented-default-suitable-for-your-system-See-http-ayo-freshrpms-net-for-a-list-of-other-repositories-and-mirrors-Id-这是I386的apt-sources-lst-；如果您用-Fedora-core-3-0-4-0-的x86-64的版本，就把i386改为-x86-64-；-请根据您所用的版本来删除您不用的源；当然您也可以增加新的源；只要有就能加上；-Fedora-core-4-0rpm-http-rpm-livna-org-fedora-4-i386-lvnrpm-http-ayo-freshrpms-net-fedora-linux-4-i386-core-extras-updates-freshrpmsrpm-src-http-rpm-livna-org-fedora-4-i386-lvn-Fedora-core-3-0-rpm-http-rpm-livna-org-fedora-3-i386-lvn-rpm-http-ayo-freshrpms-net-fedora-linux-3-i386-core-extras-updates-freshrpms-rpm-src-http-rpm-livna-org-fedora-3-i386-lvn-Fedora-Linux-2-rpm-http-ayo-freshrpms-net-fedora-linux-2-i386-core-updates-freshrpms-rpm-http-ayo-freshrpms-net-fedora-linux-2-i386-tupdates-rpm-src-http-ayo-freshrpms-net-fedora-linux-2-i386-core-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-fedora-linux-2-i386-tupdates-Fedora-Linux-1-rpm-http-ayo-freshrpms-net-fedora-linux-1-i386-core-updates-freshrpms-rpm-http-ayo-freshrpms-net-fedora-linux-1-i386-tupdates-rpm-src-http-ayo-freshrpms-net-fedora-linux-1-i386-core-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-fedora-linux-1-i386-tupdates-Fedora-Linux-Development-rpm-http-ayo-freshrpms-net-fedora-linux-development-i386-core-rpm-src-http-ayo-freshrpms-net-fedora-linux-development-i386-core-Red-Hat-Linux-9-rpm-http-ayo-freshrpms-net-redhat-9-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-9-i386-os-updates-freshrpms-Red-Hat-Linux-8-0-rpm-http-ayo-freshrpms-net-redhat-8-0-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-8-0-i386-os-updates-freshrpms-Red-Hat-Linux-7-3-rpm-http-ayo-freshrpms-net-redhat-7-3-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-3-i386-os-updates-freshrpms-Red-Hat-Linux-7-2-rpm-http-ayo-freshrpms-net-redhat-7-2-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-2-i386-os-updates-freshrpms-Red-Hat-Linux-7-1-rpm-http-ayo-freshrpms-net-redhat-7-1-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-7-1-i386-powertools-dma-rpm-src-http-ayo-freshrpms-net-redhat-7-1-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-1-i386-powertools-dma-Red-Hat-Linux-7-0-rpm-http-ayo-freshrpms-net-redhat-7-0-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-7-0-i386-powertools-dma-rpm-src-http-ayo-freshrpms-net-redhat-7-0-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-0-i386-powertools-dma-Red-Hat-Linux-6-2-rpm-http-ayo-freshrpms-net-redhat-6-2-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-6-2-i386-powertools-rpm-src-http-ayo-freshrpms-net-redhat-6-2-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-6-2-i386-powertools"><a href="#List-of-available-apt-repositories-available-from-ayo-freshrpms-net-This-file-should-contain-an-uncommented-default-suitable-for-your-system-See-http-ayo-freshrpms-net-for-a-list-of-other-repositories-and-mirrors-Id-这是I386的apt-sources-lst-；如果您用-Fedora-core-3-0-4-0-的x86-64的版本，就把i386改为-x86-64-；-请根据您所用的版本来删除您不用的源；当然您也可以增加新的源；只要有就能加上；-Fedora-core-4-0rpm-http-rpm-livna-org-fedora-4-i386-lvnrpm-http-ayo-freshrpms-net-fedora-linux-4-i386-core-extras-updates-freshrpmsrpm-src-http-rpm-livna-org-fedora-4-i386-lvn-Fedora-core-3-0-rpm-http-rpm-livna-org-fedora-3-i386-lvn-rpm-http-ayo-freshrpms-net-fedora-linux-3-i386-core-extras-updates-freshrpms-rpm-src-http-rpm-livna-org-fedora-3-i386-lvn-Fedora-Linux-2-rpm-http-ayo-freshrpms-net-fedora-linux-2-i386-core-updates-freshrpms-rpm-http-ayo-freshrpms-net-fedora-linux-2-i386-tupdates-rpm-src-http-ayo-freshrpms-net-fedora-linux-2-i386-core-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-fedora-linux-2-i386-tupdates-Fedora-Linux-1-rpm-http-ayo-freshrpms-net-fedora-linux-1-i386-core-updates-freshrpms-rpm-http-ayo-freshrpms-net-fedora-linux-1-i386-tupdates-rpm-src-http-ayo-freshrpms-net-fedora-linux-1-i386-core-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-fedora-linux-1-i386-tupdates-Fedora-Linux-Development-rpm-http-ayo-freshrpms-net-fedora-linux-development-i386-core-rpm-src-http-ayo-freshrpms-net-fedora-linux-development-i386-core-Red-Hat-Linux-9-rpm-http-ayo-freshrpms-net-redhat-9-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-9-i386-os-updates-freshrpms-Red-Hat-Linux-8-0-rpm-http-ayo-freshrpms-net-redhat-8-0-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-8-0-i386-os-updates-freshrpms-Red-Hat-Linux-7-3-rpm-http-ayo-freshrpms-net-redhat-7-3-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-3-i386-os-updates-freshrpms-Red-Hat-Linux-7-2-rpm-http-ayo-freshrpms-net-redhat-7-2-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-2-i386-os-updates-freshrpms-Red-Hat-Linux-7-1-rpm-http-ayo-freshrpms-net-redhat-7-1-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-7-1-i386-powertools-dma-rpm-src-http-ayo-freshrpms-net-redhat-7-1-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-1-i386-powertools-dma-Red-Hat-Linux-7-0-rpm-http-ayo-freshrpms-net-redhat-7-0-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-7-0-i386-powertools-dma-rpm-src-http-ayo-freshrpms-net-redhat-7-0-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-7-0-i386-powertools-dma-Red-Hat-Linux-6-2-rpm-http-ayo-freshrpms-net-redhat-6-2-i386-os-updates-freshrpms-rpm-http-ayo-freshrpms-net-redhat-6-2-i386-powertools-rpm-src-http-ayo-freshrpms-net-redhat-6-2-i386-os-updates-freshrpms-rpm-src-http-ayo-freshrpms-net-redhat-6-2-i386-powertools" class="headerlink" title="List of available apt repositories available from ayo.freshrpms.net.# This file should contain an uncommented default suitable for your system.## See http://ayo.freshrpms.net/ for a list of other repositories and mirrors.## $Id$#这是I386的apt sources.lst ；如果您用 Fedora core 3.0 4.0 的x86_64的版本，就把i386改为 x86_64 ；#请根据您所用的版本来删除您不用的源；当然您也可以增加新的源；只要有就能加上；#Fedora core 4.0rpm http://rpm.livna.org/ fedora/4/i386 lvnrpm http://ayo.freshrpms.net/ fedora/linux/4/i386 core extras updates freshrpmsrpm-src http://rpm.livna.org/ fedora/4/i386 lvn#Fedora core 3.0#rpm http://rpm.livna.org/ fedora/3/i386 lvn#rpm http://ayo.freshrpms.net/ fedora/linux/3/i386 core extras updates freshrpms#rpm-src http://rpm.livna.org/ fedora/3/i386 lvn# Fedora Linux 2#rpm http://ayo.freshrpms.net fedora/linux/2/i386 core updates freshrpms#rpm http://ayo.freshrpms.net fedora/linux/2/i386 tupdates#rpm-src http://ayo.freshrpms.net fedora/linux/2/i386 core updates freshrpms#rpm-src http://ayo.freshrpms.net fedora/linux/2/i386 tupdates# Fedora Linux 1#rpm http://ayo.freshrpms.net fedora/linux/1/i386 core updates freshrpms#rpm http://ayo.freshrpms.net fedora/linux/1/i386 tupdates#rpm-src http://ayo.freshrpms.net fedora/linux/1/i386 core updates freshrpms#rpm-src http://ayo.freshrpms.net fedora/linux/1/i386 tupdates# Fedora Linux Development#rpm http://ayo.freshrpms.net fedora/linux/development/i386 core#rpm-src http://ayo.freshrpms.net fedora/linux/development/i386 core# Red Hat Linux 9#rpm http://ayo.freshrpms.net redhat/9/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/9/i386 os updates freshrpms# Red Hat Linux 8.0#rpm http://ayo.freshrpms.net redhat/8.0/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/8.0/i386 os updates freshrpms# Red Hat Linux 7.3#rpm http://ayo.freshrpms.net redhat/7.3/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/7.3/i386 os updates freshrpms# Red Hat Linux 7.2#rpm http://ayo.freshrpms.net redhat/7.2/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/7.2/i386 os updates freshrpms# Red Hat Linux 7.1#rpm http://ayo.freshrpms.net redhat/7.1/i386 os updates freshrpms#rpm http://ayo.freshrpms.net redhat/7.1/i386 powertools dma#rpm-src http://ayo.freshrpms.net redhat/7.1/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/7.1/i386 powertools dma# Red Hat Linux 7.0#rpm http://ayo.freshrpms.net redhat/7.0/i386 os updates freshrpms#rpm http://ayo.freshrpms.net redhat/7.0/i386 powertools dma#rpm-src http://ayo.freshrpms.net redhat/7.0/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/7.0/i386 powertools dma# Red Hat Linux 6.2#rpm http://ayo.freshrpms.net redhat/6.2/i386 os updates freshrpms#rpm http://ayo.freshrpms.net redhat/6.2/i386 powertools#rpm-src http://ayo.freshrpms.net redhat/6.2/i386 os updates freshrpms#rpm-src http://ayo.freshrpms.net redhat/6.2/i386 powertools"></a>List of available apt repositories available from ayo.freshrpms.net.<br># This file should contain an uncommented default suitable for your system.<br>#<br># See <a href="http://ayo.freshrpms.net/" target="_blank" rel="external">http://ayo.freshrpms.net/</a> for a list of other repositories and mirrors.<br>#<br># $Id$<br>#这是I386的apt sources.lst ；如果您用 Fedora core 3.0 4.0 的x86_64的版本，就把i386改为 x86_64 ；<br>#请根据您所用的版本来删除您不用的源；当然您也可以增加新的源；只要有就能加上；<br><br>#Fedora core 4.0<br>rpm <a href="http://rpm.livna.org/" target="_blank" rel="external">http://rpm.livna.org/</a> fedora/4/i386 lvn<br>rpm <a href="http://ayo.freshrpms.net/" target="_blank" rel="external">http://ayo.freshrpms.net/</a> fedora/linux/4/i386 core extras updates freshrpms<br>rpm-src <a href="http://rpm.livna.org/" target="_blank" rel="external">http://rpm.livna.org/</a> fedora/4/i386 lvn<br><br>#Fedora core 3.0<br><br>#rpm <a href="http://rpm.livna.org/" target="_blank" rel="external">http://rpm.livna.org/</a> fedora/3/i386 lvn<br>#rpm <a href="http://ayo.freshrpms.net/" target="_blank" rel="external">http://ayo.freshrpms.net/</a> fedora/linux/3/i386 core extras updates freshrpms<br>#rpm-src <a href="http://rpm.livna.org/" target="_blank" rel="external">http://rpm.livna.org/</a> fedora/3/i386 lvn<br># Fedora Linux 2<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/2/i386 core updates freshrpms<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/2/i386 tupdates<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/2/i386 core updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/2/i386 tupdates<br><br># Fedora Linux 1<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/1/i386 core updates freshrpms<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/1/i386 tupdates<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/1/i386 core updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/1/i386 tupdates<br><br># Fedora Linux Development<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/development/i386 core<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> fedora/linux/development/i386 core<br><br># Red Hat Linux 9<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/9/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/9/i386 os updates freshrpms<br><br># Red Hat Linux 8.0<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/8.0/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/8.0/i386 os updates freshrpms<br><br># Red Hat Linux 7.3<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.3/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.3/i386 os updates freshrpms<br><br># Red Hat Linux 7.2<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.2/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.2/i386 os updates freshrpms<br><br># Red Hat Linux 7.1<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.1/i386 os updates freshrpms<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.1/i386 powertools dma<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.1/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.1/i386 powertools dma<br><br># Red Hat Linux 7.0<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.0/i386 os updates freshrpms<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.0/i386 powertools dma<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.0/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/7.0/i386 powertools dma<br><br># Red Hat Linux 6.2<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/6.2/i386 os updates freshrpms<br>#rpm <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/6.2/i386 powertools<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/6.2/i386 os updates freshrpms<br>#rpm-src <a href="http://ayo.freshrpms.net" target="_blank" rel="external">http://ayo.freshrpms.net</a> redhat/6.2/i386 powertools</h1>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/09/rpm-etc-apt-sources-list/" class="archive-article-date">
  	<time datetime="2006-12-09T11:02:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-09</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-AptRpm-Repositories" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/08/AptRpm-Repositories/">AptRpm/Repositories</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="https://moin.conectiva.com.br/FrontPage" target="_blank" rel="external"><img src="https://moin.conectiva.com.br/img/cnc.png" alt="CncMoin"></a> <a title="Click here to do a full-text search for this title" href="https://moin.conectiva.com.br/AptRpm/Repositories?action=fullsearch&amp;value=%2FRepositories&amp;literal=1&amp;case=1&amp;context=40" target="_blank" rel="external">AptRpm/Repositories</a> <a href="https://moin.conectiva.com.br/UserPreferences" target="_blank" rel="external">UserPreferences</a><br> <a href="https://moin.conectiva.com.br/HelpContents" target="_blank" title="HelpContents"><img width="12" height="11" src="https://moin.conectiva.com.br/img/moin-help.gif" alt="HelpContents"></a> <a href="https://moin.conectiva.com.br/FindPage?value=AptRpm/Repositories" title="FindPage" target="_blank" rel="external"><img width="12" height="12" src="https://moin.conectiva.com.br/img/moin-search.gif" alt="FindPage"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=diff" title="Diffs" target="_blank" rel="external"><img width="15" height="11" src="https://moin.conectiva.com.br/img/moin-diff.gif" alt="Diffs"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=info" title="Info" target="_blank" rel="external"><img width="12" height="11" src="https://moin.conectiva.com.br/img/moin-info.gif" alt="Info"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=edit" title="Edit" target="_blank" rel="external"><img width="12" height="12" src="https://moin.conectiva.com.br/img/moin-edit.gif" alt="Edit"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=subscribe" title="Subscribe" target="_blank" rel="external"><img width="14" height="10" src="https://moin.conectiva.com.br/img/moin-email-x.gif" alt="Subscribe"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=format&amp;mimetype=text/xml" title="XML" target="_blank" rel="external"><img width="20" height="13" src="https://moin.conectiva.com.br/img/moin-xml.gif" alt="XML"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories?action=print" title="Print" target="_blank" rel="external"><img width="16" height="14" src="https://moin.conectiva.com.br/img/moin-print.gif" alt="Print"></a> <a href="https://moin.conectiva.com.br/AptRpm/Repositories" title="View" target="_blank" rel="external"><img width="12" height="13" src="https://moin.conectiva.com.br/img/moin-show.gif" alt="View"></a> <a title="Up" href="https://moin.conectiva.com.br/AptRpm" target="_blank" rel="external"><img width="15" height="13" src="https://moin.conectiva.com.br/img/moin-parent.gif" alt="Up"></a> <strong>CncMoin</strong> <a href="https://moin.conectiva.com.br/FrontPage" target="_blank" rel="external">FrontPage</a> <a href="https://moin.conectiva.com.br/RecentChanges" target="_blank" rel="external">RecentChanges</a> <a href="https://moin.conectiva.com.br/SiteNavigation" target="_blank" rel="external">SiteNavigation</a> <a target="_blank" href="https://moin.conectiva.com.br/HelpContents">HelpContents</a> <a target="_blank" href="https://moin.conectiva.com.br/ComoTerConta">ComoTerConta</a> <hr></p><p><a name="head-f5cbdf6bfb51439be085b5c6b7460a7c91eabc3c"></a></p> 1. Contents<ol> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-f5cbdf6bfb51439be085b5c6b7460a7c91eabc3c" target="_blank" rel="external">Contents</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-90a4ed390c9319181f5a3c311d2abea30aa0bb2c" target="_blank" rel="external">Simple repository setup</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-eb6e1ae8a937018364e97b42ad7f1e7b0e7d23a7" target="_blank" rel="external">Including a source repository</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-e79af7d629aaa32610cb3cb3108216202d5fed28" target="_blank" rel="external">Using a flat structure</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-6ac8e021e675bf5ce887390347fcbee74682cef9" target="_blank" rel="external">Using multiple components</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-71a0f145cc80829d26bd7bbd15fa9e63f7c138be" target="_blank" rel="external">Specifying components</a></li> <li><a href="https://moin.conectiva.com.br/AptRpm/Repositories#head-559e2776d963a6bc1f2066c32dccb5ad54214ad7" target="_blank" rel="external">Meta-components</a></li></ol><p><a name="head-90a4ed390c9319181f5a3c311d2abea30aa0bb2c"></a></p> 2. Simple repository setupHere is a simple example showing how easy it is to create a basic repository for APT-RPM:[niemeyer@ibook /pub]% find /pub <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir /pub/conectiva <br>Creating base directory… done <br>Components: general <br>Processing pkglists… general [done] <br>Processing srclists… [done] <br>Creating component releases… general [done] <br>Creating global release file… [done] <br>Appending MD5Sum… general [done] <br>All your base are belong to us!!! <br> <br>[niemeyer@ibook /pub]% find /pub                 <br>/pub <br>/pub/conectiva <br>/pub/conectiva/base <br>/pub/conectiva/base/pkglist.general <br>/pub/conectiva/base/pkglist.general.bz2 <br>/pub/conectiva/base/release.general <br>/pub/conectiva/base/release <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm<p>Done! This repository is ready to be accessed by APT-RPM.</p><p>To make APT-RPM notice the new created repository, just append the following line in <tt>/etc/apt/sources.list</tt>:</p>rpm file:/pub conectiva general<p><a name="head-eb6e1ae8a937018364e97b42ad7f1e7b0e7d23a7"></a></p> 3. Including a source repositoryThere’s no special setup to include a sources repository either. Here is another example including it:[niemeyer@ibook /pub]% find /pub <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/SRPMS.general <br>/pub/SRPMS.general/dummy-1.0-1cl.src.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir /pub/conectiva <br>Creating base directory… done <br>Components: general <br>Processing pkglists… general [done] <br>Processing srclists… general [done] <br>Creating component releases… general [done] <br>Creating global release file… [done] <br>Appending MD5Sum… general [done] <br>All your base are belong to us!!! <br> <br>[niemeyer@ibook /pub]% find /pub                 <br>/pub <br>/pub/conectiva <br>/pub/conectiva/base <br>/pub/conectiva/base/pkglist.general <br>/pub/conectiva/base/pkglist.general.bz2 <br>/pub/conectiva/base/srclist.general <br>/pub/conectiva/base/srclist.general.bz2 <br>/pub/conectiva/base/release.general <br>/pub/conectiva/base/release <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/SRPMS.general <br>/pub/SRPMS.general/dummy-1.0-1cl.src.rpm<p>To make APT-RPM notice the new created repository, including the sources, just append the following lines in <tt>/etc/apt/sources.list</tt>:</p>rpm file:/pub conectiva general <br>rpm-src file:/pub conectiva general<p><a name="head-e79af7d629aaa32610cb3cb3108216202d5fed28"></a></p> 4. Using a flat structureNotice that in the example above, the <tt>SRPMS.general</tt> directory is outside of the conectiva/ directory. This used to be the most common form to setup an <tt>RPM</tt> package structure, but sometimes this structure may be incovenient. To use <tt>SRPMS</tt> in the same directory level, just use the <tt>–flat</tt> option. Here’s another example:[niemeyer@ibook /pub]% find /pub <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/SRPMS.general <br>/pub/conectiva/SRPMS.general/dummy-1.0-1cl.src.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir –flat /pub/conectiva <br>Creating base directory… done <br>Components: general <br>Processing pkglists… general [done] <br>Processing srclists… general [done] <br>Creating component releases… general [done] <br>Creating global release file… [done] <br>Appending MD5Sum… general [done] <br>All your base are belong to us!!! <br> <br>[niemeyer@ibook /pub]% find /pub                        <br>/pub <br>/pub/conectiva <br>/pub/conectiva/base <br>/pub/conectiva/base/pkglist.general <br>/pub/conectiva/base/pkglist.general.bz2 <br>/pub/conectiva/base/srclist.general <br>/pub/conectiva/base/srclist.general.bz2 <br>/pub/conectiva/base/release.general <br>/pub/conectiva/base/release <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/SRPMS.general <br>/pub/conectiva/SRPMS.general/dummy-1.0-1cl.src.rpm<p>From a user point of view, there’s no difference if your repository is flat or not. That is, to make APT-RPM notice the new created repository, you’d append the same lines in <tt>/etc/apt/sources.list</tt>:</p>rpm file:/pub conectiva general <br>rpm-src file:/pub conectiva general<p><a name="head-6ac8e021e675bf5ce887390347fcbee74682cef9"></a></p> 5. Using multiple componentsFor now, all examples were using a single general component. We can have as many components as necessary in a single repository. For example:[niemeyer@ibook /pub]% find /pub                            <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/RPMS.misc <br>/pub/conectiva/RPMS.misc/foobar-1.0-1cl.noarch.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir /pub/conectiva <br>Creating base directory… done <br>Components: general misc <br>Processing pkglists… general misc [done] <br>Processing srclists… [done] <br>Creating component releases… general misc [done] <br>Creating global release file… [done] <br>Appending MD5Sum… general misc [done] <br>All your base are belong to us!!! <br> <br>[niemeyer@ibook /pub]% find /pub                 <br>/pub <br>/pub/conectiva <br>/pub/conectiva/base <br>/pub/conectiva/base/pkglist.general <br>/pub/conectiva/base/pkglist.general.bz2 <br>/pub/conectiva/base/pkglist.misc <br>/pub/conectiva/base/pkglist.misc.bz2 <br>/pub/conectiva/base/release.general <br>/pub/conectiva/base/release.misc <br>/pub/conectiva/base/release <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/RPMS.misc <br>/pub/conectiva/RPMS.misc/foobar-1.0-1cl.noarch.rpm<p>To make APT-RPM notice the new created repository, just append the following line in <tt>/etc/apt/sources.list</tt>:</p>rpm file:/pub conectiva general misc<p><a name="head-71a0f145cc80829d26bd7bbd15fa9e63f7c138be"></a></p> 6. Specifying componentsIn all examples above genbasedir was finding the components by itself. If necessary, you may select which components to build. For example:[niemeyer@ibook /pub]% find /pub                            <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/RPMS.misc <br>/pub/conectiva/RPMS.misc/foobar-1.0-1cl.noarch.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir /pub/conectiva general <br>Components: general <br>Processing pkglists… general [done] <br>Processing srclists… [done] <br>Creating component releases… [done] <br>Updating global release file… [done] <br>Appending MD5Sum… general [done] <br>All your base are belong to us!!!<p>Notice that when you do that, the release file inside the base directory will contain information only about that single component. If you’re updating just some components of a big repository, you’ll probably want to use <tt>–partial</tt> as well, like this:</p>[niemeyer@ibook /pub]% genbasedir –partial /pub/conectiva general <br>Components: general <br>Processing pkglists… general [done] <br>Processing srclists… [done] <br>Creating component releases… [done] <br>Partially updating global release file… [done] <br>Appending MD5Sum… general [done] <br>All your base are belong to us!!!<p><a name="head-559e2776d963a6bc1f2066c32dccb5ad54214ad7"></a></p> 7. Meta-componentsSince version 0.5.5cnc4, APT-RPM supports the concept of meta-components A meta-component may use information contained in one or more components, while using a different name. In the example below, we create a meta-component named all:[niemeyer@ibook /pub]% find /pub <br>/pub <br>/pub/conectiva <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/RPMS.misc <br>/pub/conectiva/RPMS.misc/foobar-1.0-1cl.noarch.rpm <br> <br>[niemeyer@ibook /pub]% genbasedir –meta=all /pub/conectiva         <br>Components: general misc <br>Processing pkglists… general misc [done] <br>Processing srclists… [done] <br>Creating component releases… all [done] <br>Updating global release file… [done] <br>Appending MD5Sum… all [done] <br>All your base are belong to us!!! <br> <br>[niemeyer@ibook /pub]% find /pub                            <br>/pub <br>/pub/conectiva <br>/pub/conectiva/base <br>/pub/conectiva/base/pkglist.all <br>/pub/conectiva/base/pkglist.all.bz2 <br>/pub/conectiva/base/release.all <br>/pub/conectiva/base/release <br>/pub/conectiva/RPMS.general <br>/pub/conectiva/RPMS.general/dummy-1.0-1cl.noarch.rpm <br>/pub/conectiva/RPMS.misc <br>/pub/conectiva/RPMS.misc/foobar-1.0-1cl.noarch.rpm<p>From a user point of view, there’s no difference between a meta-component and a normal component. To make APT-RPM notice the new created repository, just append the following line in <tt>/etc/apt/sources.list</tt>:</p>rpm file:/pub conectiva all<a name="bottom"></a> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/08/AptRpm-Repositories/" class="archive-article-date">
  	<time datetime="2006-12-07T16:12:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-08</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-添加gcc默认include搜索路径-不使用-I选项" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2006/12/05/添加gcc默认include搜索路径-不使用-I选项/">添加gcc默认include搜索路径, 不使用-I选项</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 利用系统的环境变量。<br>对于头文件的搜索路径:<br><br>C_INCLUDE_PATH=&lt;your <u><strong>include</strong></u><strong> path&gt;;<br>export C_INCLUDE_PATH<br><br>对于库文件的搜索路径:<br><br>LIBRARY_PATH=&lt;your lib path&gt;;<br>export LIBRARY_PATH<br><br>对于链接程序ld使用的库文件搜索路径：<br><br>LD_LIBRARY_PATH=&lt;your ldlib path&gt;;<br>export LD_LIBRARY_PATH<br><br><br></strong><strong>man gcc</strong><strong><br></strong> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2006/12/05/添加gcc默认include搜索路径-不使用-I选项/" class="archive-article-date">
  	<time datetime="2006-12-05T05:32:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2006-12-05</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/57/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="page-number" href="/page/57/">57</a><span class="page-number current">58</span><a class="page-number" href="/page/59/">59</a><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/59/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>