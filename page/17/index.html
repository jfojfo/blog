<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/17/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Preference小结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/22/Preference小结/">Preference小结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>&nbsp;</p><p><strong>1.framework/base/core/java/android/preference/Preference.java</strong><br>从代码可以看到，对于某个Preference被click后，会先检查该preference的mOnClickListener是否为空，<br>如果不为空，则调用并返回。<br>否则，调用该preference所在的PreferenceManager.OnPreferenceTreeClickListener，<br>(Called when a preference in the tree rooted at this PreferenceScreen has been clicked.)<br>如果还为空，则启动该preference设置的intent activity。<br><br>&nbsp;&nbsp;&nbsp; /<em>*<br>&nbsp;&nbsp;&nbsp;&nbsp; </em> Called when a click should be performed.<br>&nbsp;&nbsp;&nbsp;&nbsp; <em> <br>&nbsp;&nbsp;&nbsp;&nbsp; </em> @param preferenceScreen A {@link PreferenceScreen} whose hierarchy click<br>&nbsp;&nbsp;&nbsp;&nbsp; <em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listener should be called in the proper order (between other<br>&nbsp;&nbsp;&nbsp;&nbsp; </em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; processing). May be null.<br>&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; void performClick(PreferenceScreen preferenceScreen) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!isEnabled()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onClick();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (mOnClickListener != null &amp;&amp; mOnClickListener.onPreferenceClick(this)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PreferenceManager preferenceManager = getPreferenceManager();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (preferenceManager != null) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PreferenceManager.OnPreferenceTreeClickListener listener = preferenceManager<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .getOnPreferenceTreeClickListener();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (preferenceScreen != null &amp;&amp; listener != null<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; listener.onPreferenceTreeClick(preferenceScreen, this)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (mIntent != null) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Context context = getContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.startActivity(mIntent);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp; &nbsp;<br><br><strong>2.performClick()何时被调用？</strong><br>PreferenceScreen中包含一个ListAdapter，所有的Preference都对应该adapter中的一项。<br>该Adapter是一个PreferenceGroupAdapter，当PreferenceScreen中的某项被点击后，<br>onItemClick()被调用，接着调用preference的performClick()。</p><p>&nbsp;</p><p>具体流程如下：</p><p>PreferenceActivity继承自ListActivity，启动时会调用onContentChanged，<br>onContentChanged() &gt; postBindPreference() &gt; mHandler &gt;<br>bindPreference():<br>得到当前的preferenceScreen和当前activity的listview &gt;<br>preferenceScreen.bind(getListView())<br>PreferenceScreen.java:<br>&nbsp;&nbsp;&nbsp; public void bind(ListView listView) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listView.setOnItemClickListener(this);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listView.setAdapter(getRootAdapter());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onAttachedToActivity();<br>&nbsp;&nbsp;&nbsp; }<br>设置了listview的onItemClickListener，<br>&nbsp;&nbsp;&nbsp; public void onItemClick(AdapterView parent, View view, int position, long id) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object item = getRootAdapter().getItem(position);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!(item instanceof Preference)) return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; final Preference preference = (Preference) item; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preference.performClick(this);<br>&nbsp;&nbsp;&nbsp; }<br><br><br><strong>3.onPreferenceChange()何时被调用？</strong><br>在Prefercen子类(如CheckBoxPreference)的onClick()函数中，会调用callChangeListener()，<br>(Preference的onClick()函数注释: Processes a click on the preference. This includes saving the value to the SharedPreferences. <br>However, the overridden method should call callChangeListener(Object) to make sure the client<br>wants to update the preference’s state with the new value.)<br>callChangeListener调用用户自己设置的onChangeListener：<br>&nbsp;&nbsp;&nbsp; protected boolean callChangeListener(Object newValue) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return mOnChangeListener == null ? true : mOnChangeListener.onPreferenceChange(this, newValue);<br>&nbsp;&nbsp;&nbsp; }<br><br>perference还有一个OnPreferenceChangeInternalListener，它是在PreferenceGroupAdapter在<br>flattenPreferenceGroup()时设置的：<br>preference.setOnPreferenceChangeInternalListener(this);<br>当CheckBoxPreference调用setTitle、setSummary、setEnabled等时，会调用notifyChanged()，<br>&nbsp;&nbsp;&nbsp; protected void notifyChanged() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (mListener != null) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mListener.onPreferenceChange(this);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>进而调用PreferenceGroupAdapter的：<br>&nbsp;&nbsp;&nbsp; public void onPreferenceChange(Preference preference) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notifyDataSetChanged();<br>&nbsp;&nbsp;&nbsp; }<br><br><br><br><strong>4.PreferenceCategory实际上就是一个PreferenceGroup，也是一个始终处于disabled状态的Preference。</strong><br>(Used to group Preference objects and provide a disabled title above the group.)<br>它的isEnabled()函数始终返回false：<br>&nbsp;&nbsp;&nbsp; @Override<br>&nbsp;&nbsp;&nbsp; public boolean isEnabled() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>&nbsp;&nbsp;&nbsp; }<br><br></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/22/Preference小结/" class="archive-article-date">
  	<time datetime="2010-12-22T08:27:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-22</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-关于子类无法访问android代码中父类的protected变量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/21/关于子类无法访问android代码中父类的protected变量/">关于子类无法访问android代码中父类的protected变量</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>protected int mScrollX;<br>protected int mScrollY;<br>打开VIEW类可以看到上面这些实例变量，都不能在继承类里用（但是android包里的继承类可以用，比如<br>ScrollView里面到处用到了mScrollX和mScrollY<br>我现在想实现一个类似ScrollView的类，所以继承了VIEW，但是我不能用这些PROTECTED变量<br>WHY???<br><br>Answer:<br>@ViewDebug.ExportedProperty<br>&nbsp; protected int mScrollX;<br>@ViewDebug.ExportedProperty 这个属性的 在SDK中都是看不到的<br>除非你把工程放到源码 不用sdk编译<br></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/21/关于子类无法访问android代码中父类的protected变量/" class="archive-article-date">
  	<time datetime="2010-12-21T13:01:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-21</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-系统弹出菜单的调用层次结构" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/13/系统弹出菜单的调用层次结构/">系统弹出菜单的调用层次结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>从Exception追踪系统弹出菜单的调用关系：<br>&nbsp;E/AndroidRuntime(&nbsp; 456): java.lang.NullPointerException<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.view.menu.IconMenuView.addItemViewWithPos(IconMenuView.java:443)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.view.menu.IconMenuView.updateChildren(IconMenuView.java:506)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.view.menu.IconMenuView.initialize(IconMenuView.java:487)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.view.menu.MenuBuilder$MenuType.getMenuView(MenuBuilder.java:210)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.view.menu.MenuBuilder.getMenuView(MenuBuilder.java:344)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.policy.impl.PhoneWindow.initializePanelContent(PhoneWindow.java:841)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.policy.impl.PhoneWindow.openPanel(PhoneWindow.java:417)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.policy.impl.PhoneWindow.onKeyUpPanel(PhoneWindow.java:604)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.policy.impl.PhoneWindow.onKeyUp(PhoneWindow.java:1320)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.policy.impl.PhoneWindow$DecorView.dispatchKeyEvent(PhoneWindow.java:1649)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.view.ViewRoot.deliverKeyEventToViewHierarchy(ViewRoot.java:2471)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.view.ViewRoot.handleFinishedEvent(ViewRoot.java:2441)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.view.ViewRoot.handleMessage(ViewRoot.java:1735)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.os.Handler.dispatchMessage(Handler.java:99)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.os.Looper.loop(Looper.java:123)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at android.app.ActivityThread.main(ActivityThread.java:4627)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at java.lang.reflect.Method.invokeNative(Native Method)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at java.lang.reflect.Method.invoke(Method.java:521)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)<br>&nbsp;E/AndroidRuntime(&nbsp; 456): &nbsp;&nbsp; &nbsp;at dalvik.system.NativeStart.main(Native Method)<br></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/13/系统弹出菜单的调用层次结构/" class="archive-article-date">
  	<time datetime="2010-12-13T02:29:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-13</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-笑话十则" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/05/笑话十则/">笑话十则</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p> </p><p>1. 一位女性申请职业时，老板问：「你有几个小孩？」 她回答：「五个。」 老板问：「那他们叫甚么名字？」她回答：「晓明、晓明、晓明、晓明、晓明。」 老板问：「都叫晓明，那你要叫他们吃饭时怎么办？」 她说：「那很简单，我只要叫晓明，他们都会来。」老板又问：「但是如果你只要叫某一特定小孩时，怎么办？」 她说：「那更简单，我只要叫他的姓就可以了。」</p><p> </p><p>2. 一个伐木工人去应征工作工头：前面的树林你去试试看……看你一分钟能锯几棵树…… 过了一分钟…… 工头：哇……一分钟20棵……太厉害了……你以前在哪工作的？ 工人：撒哈拉森林…… 工头：没听过ㄝ……我只听过撒哈拉沙漠ㄝ…… 工人：对啊……后来改名字啦！</p><p> </p><p>3.有一天一个女吸毒犯被抓到警局警察看见她的手上有刺青就问她你干嘛把你男朋友的名字刺在手上他叫小良是不是……啊……是不是。快说说……他有没有吸毒阿……快说只见那个女吸毒犯抬起头带着愤怒的眼神对警察说。 这是恨啦…… 这个故事告诉我们……刺青完后，最好不要再长胖了-_-！！</p><p> </p><p>4. 警察：“说，你叫什么？” 犯人：“我叫成龙。” 警察：“你怎么不叫陈真，给我把态度放端正了~好好说你叫什么~？” 犯人：“我叫陈真。”</p><p> </p><p>5. 一位先生发现自己屁股里有蛔虫，于是马上跑看医生，到了医院后。男子：医生！我屁股里有蛔虫了……麻烦帮我看一下医生什么也没说，拿出一罐草莓果酱，舀了一些放进男子的屁股里面，说：你可以走了！明天再来吧！过了一天，重复一样的动作，口味换成花生。 第二天，重复一样的动作，口味换成巧克力。 第三天……医生：让我来看看，突然！一只蛔虫从男子的屁股冒出来说：今天是什么口味的呀？</p><p> </p><p>6.从前有一只爱爬树的猿猴，他喜欢在很高的树上荡来荡去，尤其是一棵长在悬崖边的高高香蕉树，他更是喜欢去那边摘香蕉，每次摘完香蕉，他都会去找他的好朋友猩猩一起吃，因为猩猩它太大只不适合爬树。可是有一天猿猴在摘香蕉时不小心从很高的树上掉下来，从此得了惧高症，猩猩好友为了鼓励他，决定为了猿猴去摘香蕉，希望猿猴吃了，可以找回爬树的感觉。可是猩猩不是很会爬树，所以他找了很多只猩猩朋友，大伙一起合作高高迭起来摘得了香蕉，于是，猿猴在吃了猩猩大伙合作摘得的香蕉，就因此治疗好了他的惧高症，从此猩猩跟猿猴就过着幸福又快乐的日子了。 这故事告诉了我们一个很重要的启示：。 「猩猩之伙，可以疗猿！」</p><p> </p><p>7.有一天，有一个忏悔者来到教堂，他对神父说：[神父，我错了。]神父说：[只要你认错，天主一定会原谅你的。]忏悔者说：[我偷了一个人的脚踏车，而我现在要把它交给你。]神父说：[不！不要给我，把它还给施主。]忏悔者说：[我已经问过他了，可是他不要。]神父说：[那你就收下它吧！]神父下班后，就发现它停在后院的脚踏车不见了！！</p><p> </p><p>8.老李去拜访隔壁新搬来的邻居，邻居说：你好，我姓白。 老李问：白先生，你在哪高就啊！？ 白先生说：我是逻辑学家。老李问：逻辑？？那是什么东西啊！？ 白先生说：其实很简单，你有没有养狗？？ 老李：有啊还是大狼狗勒白先生：你有养狗，那照逻辑，你有狗屋啰！？老李：没错呀白先生：ok，你有狗，又有狗屋，那就有小孩啰！？ 老李：一点也不错！ 白先生又说：你有狗，狗屋，小孩，照逻辑来看你应该结婚啰！？老李：已经结婚好久啰！ 白先生总结说：从以上的观点来看，你应该是个异性恋者。这就是逻辑！ 老李：哦……原来如此，好像满有趣的。过了几天，老李跟住在另一侧的邻居老张聊天。 老李说：对了，刚搬来的那户人家是逻辑学家耶老张问：那是什么职业啊！？老李说：很简单，你有没有养狗啊！？ 老张说：你知道我不养狗的啊！ 老李说：哦，原来你是同性恋！</p><p> </p><p>9一天，一个非常富有的阔少爷在公路上超速，被一个女警察发现。 那位阔少爷很不愿意地把车停了在一边，不耐烦的说：「你知不知道我的爸爸是谁？！」 女警察客气地答道：「对不起，先生，这我可帮不到你，你有没有试一试问问你的母亲？」</p><p> </p><p>10.一个生物系研究生做实验，一次他把一只跳蚤的脚切掉二只，然后对着跳蚤说：「跳！」 跳蚤跳…… 于是他再切断二只，又对着跳蚤说：「跳！」跳蚤依然照跳不误……最后他又再切断二只脚，然后又对跳蚤喊：「跳！」 这时跳蚤再也跳不动了……于是他写下了心得～「跳蚤在切短断六只脚后，就变成聋子了！」</p><p></p><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/05/笑话十则/" class="archive-article-date">
  	<time datetime="2010-12-05T03:01:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-05</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Saying/">Saying</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【★】动态规划例题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/04/【★】动态规划例题/">【★】动态规划例题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p>ref：<a target="_blank" href="http://topcoder.5d6d.com/thread-75-1-1.html">http://topcoder.5d6d.com/thread-75-1-1.html</a></p><br><br><ol><li>USACO<br></li><li>2.2 Subset Sums<br></li><li>题目如下：<br></li><li>对于从1到N的连续整集合合，能划分成两个子集合，且保证每个集合的数字和是相等的。<br></li><li>举个例子，如果N=3，对于{1，2，3}能划分成两个子集合，他们每个的所有数字和是相等的：<br></li><li>and {1,2} <br></li><li>这是唯一一种分发（交换集合位置被认为是同一种划分方案，因此不会增加划分方案总数）<br></li><li>如果N=7，有四种方法能划分集合{1，2，3，4，5，6，7}，每一种分发的子集合各数字和是相等的: <br></li><li>{1,6,7} and {2,3,4,5} {注 1+6+7=2+3+4+5} <br></li><li>{2,5,7} and {1,3,4,6} <br></li><li>{3,4,7} and {1,2,5,6} <br></li><li>{1,2,4,7} and {3,5,6} <br></li><li>给出N，你的程序应该输出划分方案总数，如果不存在这样的划分方案，则输出0。程序不能预存结果直接输出。<br></li><li>PROGRAM NAME: subset<br></li><li>INPUT FORMAT<br></li><li><br></li><li>输入文件只有一行，且只有一个整数N<br></li><li>SAMPLE INPUT (file subset.in)<br></li><li>7<br></li><li>OUTPUT FORMAT<br></li><li>输出划分方案总数，如果不存在则输出0。<br></li><li>SAMPLE OUTPUT (file subset.out)<br></li><li>4 </li></ol><p> </p><ol><li>参考程序如下：<br></li><li><br></li><li>#include &lt;fstream&gt;<br></li><li>using namespace std;<br></li><li>const unsigned int MAX_SUM = 1024;<br></li><li>int n;<br></li><li>unsigned long long int dyn[MAX_SUM];<br></li><li>ifstream fin (&quot;subset.in&quot;);<br></li><li>ofstream fout (&quot;subset.out&quot;);<br></li><li>int main() {<br></li><li>    fin &gt;&gt; n;<br></li><li>    fin.close();<br></li><li>    int s = n<em>(n+1);<br></em></li><li>    if (s % 4) {<br></li><li>  &nbsp;&nbsp;              &nbsp;&nbsp;&nbsp;             fout &lt;&lt; 0 &lt;&lt; endl;<br></li><li>  &nbsp;&nbsp;              &nbsp;&nbsp;&nbsp;             fout.close ();<br></li><li>  &nbsp;&nbsp;              &nbsp;&nbsp;&nbsp;             return ;<br></li><li>    }<br></li><li>    s /= 4;<br></li><li>    int i, j;<br></li><li>    dyn [0] = 1;<br></li><li>    for (i = 1; i &lt;= n; i++)<br></li><li>  &nbsp;&nbsp;              &nbsp;&nbsp;&nbsp;             for (j = s; j &gt;= i; j–) <br></li><li>  &nbsp;&nbsp;              &nbsp;&nbsp;              &nbsp;&nbsp;               dyn[j] += dyn[j-i];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;              //前i个数中能拼凑出和为j的种数：dyn[ j ] = dyn[ j - i ] + dyn[ j ]<br></li><li>    fout &lt;&lt; (dyn[s]/2) &lt;&lt; endl;<br></li><li>    fout.close();<br></li><li>    return 0;<br></li><li>}<br></li></ol><p> </p><p>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</p><p> </p><ol><li>USACO 2.3<br></li><li>Longest Prefix<br></li><li>题目如下：<br></li><li>在生物学中，一些生物的结构是用包含其要素的大写字母序列来表示的。生物学家对于把长的序列分解成较短的（称之为元素的）序列很感兴趣。 <br></li><li>如果一个集合 P 中的元素可以通过串联（允许重复；串联，相当于 Pascal 中的 “+” 运算符）组成一个序列 S，那么我们认为序列 S 可以分解为 P 中的元素。并不是所有的元素都必须出现。举个例子，序列 ABABACABAAB可以分解为下面集合中的元素： <br></li><li>    {A, AB, BA, CA, BBC}<br></li><li>序列 S 的前面 K 个字符称作 S 中长度为 K 的前缀。设计一个程序，输入一个元素集合以及一个大写字母序列，计算这个序列最长的前缀的长度。 <br></li><li>PROGRAM NAME: prefix<br></li><li>INPUT FORMAT<br></li><li>输入数据的开头包括 1..200 个元素（长度为 1..10）组成的集合，用连续的以空格分开的字符串表示。字母全部是大写，数据可能不止一行。元素集合结束的标志是一个只包含一个 “.”的行。集合中的元素没有重复。接着是大写字母序列 S ，长度为 1..200,000 ，用一行或者多行的字符串来表示，每行不超过 76个字符。换行符并不是序列 S 的一部分。<br></li><li>SAMPLE INPUT (file prefix.in) <br></li><li>A AB BA CA BBC<br></li><li>.<br></li><li>ABABACABAABC<br></li><li>OUTPUT FORMAT<br></li><li>只有一行，输出一个整数，表示 S 能够分解成 P 中元素的最长前缀的长度。<br></li><li>SAMPLE OUTPUT (file prefix.out)<br></li><li>11<br></li></ol><p> </p><p>动规的基本思路：定义f[i]，表示到目标字符串的第i个位置，是否还有连续的前缀。有，则把当前的i+length(si[k])记录下来；没有，则继续循环。Si[k]记录集合中的待选字符串。</p><p></p><ol><li>示例程序如下：<br></li><li><br></li><li>#include &lt;stdio.h&gt;<br></li><li>/ maximum number of primitives <em>/<br></em></li><li>#define MAXP 200<br></li><li>/ maximum length of a primitive <em>/<br></em></li><li>#define MAXL 10<br></li><li>char prim[MAXP+1][MAXL+1]; / primitives <em>/<br></em></li><li>int nump;  &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;              / number of primitives <em>/<br></em></li><li>int start[200001];  &nbsp;&nbsp;             &nbsp;&nbsp;              / is this prefix of the sequence expressible? <em>/<br></em></li><li>char data[200000];  &nbsp;&nbsp;             &nbsp;&nbsp;              / the sequence <em>/<br></em></li><li>int ndata;  &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;             &nbsp;&nbsp;&nbsp;            / length of the sequence <em>/<br></em></li><li>int main(int argc, char **argv)<br></li><li>{<br></li><li>&nbsp;&nbsp;            FILE fout, <em>fin;<br></em></li><li>&nbsp;&nbsp;            int best;<br></li><li>&nbsp;&nbsp;            int lv, lv2, lv3;<br></li><li>&nbsp;&nbsp;            if ((fin = fopen(&quot;prim.in&quot;, &quot;r&quot;)) == NULL)<br></li><li>   {<br></li><li>    perror (&quot;fopen fin&quot;);<br></li><li>  &nbsp;&nbsp;              exit(1);<br></li><li>   }<br></li><li>&nbsp;&nbsp;            if ((fout = fopen(&quot;prim.out&quot;, &quot;w&quot;)) == NULL)<br></li><li>   {<br></li><li>    perror (&quot;fopen fout&quot;);<br></li><li>    exit(1);<br></li><li>   }<br></li><li>&nbsp;&nbsp;            / read in primitives <em>/<br></em></li><li>&nbsp;&nbsp;            while (1)<br></li><li>   {<br></li><li>    fscanf (fin, &quot;%s&quot;, prim[nump]);<br></li><li>    if (prim[nump][0] != ‘.’) nump++;<br></li><li>    else break;<br></li><li>   }<br></li><li>&nbsp;&nbsp;            / read in string, one line at a time <em>/<br></em></li><li>&nbsp;&nbsp;            ndata = 0;<br></li><li>&nbsp;&nbsp;            while (fscanf (fin, &quot;%s&quot;, data+ndata) == 1)<br></li><li>    ndata += strlen(data+ndata);<br></li><li>&nbsp;&nbsp;            start[0] = 1;<br></li><li>&nbsp;&nbsp;            best = 0;<br></li><li>&nbsp;&nbsp;            for (lv = 0; lv &lt; ndata; lv++)<br></li><li>    if (start[lv]) <br></li><li>  &nbsp;&nbsp;&nbsp;            { / for each expressible prefix <em>/<br></em></li><li>  &nbsp;&nbsp;              best = lv; / we found a longer expressible prefix! <em>/<br></em></li><li>  &nbsp;&nbsp;              / for each primitive, determine the the sequence starting at<br></li><li>  &nbsp;&nbsp;             &nbsp;&nbsp;              this location matches it <em>/<br></em></li><li>  &nbsp;&nbsp;              for (lv2 = 0; lv2 &lt; nump; lv2++)<br></li><li>  &nbsp;&nbsp;               {<br></li><li>  &nbsp;&nbsp;             &nbsp;&nbsp;&nbsp;            for (lv3 = 0; lv + lv3 &lt; ndata &amp;&nbsp;&nbsp;            prim[lv2][lv3] &amp;&amp;<br></li><li>  &nbsp;&nbsp;&nbsp;            prim[lv2][lv3] == data[lv+lv3]; lv3++)<br></li><li>  &nbsp;&nbsp;             &nbsp;&nbsp;               ;<br></li><li>if (!prim[lv2][lv3])   / it matched! <em>/<br></em></li><li>   start[lv + lv3] = 1; / so the expanded prefix is also expressive <em>/<br></em></li><li>  &nbsp;&nbsp;               }<br></li><li>  &nbsp;&nbsp;&nbsp;            } <br></li><li>&nbsp;&nbsp;            / see if the entire sequence is expressible <em>/<br></em></li><li>&nbsp;&nbsp;            if (start[ndata]) best = ndata; <br></li><li>&nbsp;&nbsp;            fprintf (fout, &quot;%in&quot;, best);<br></li><li>&nbsp;&nbsp;            return 0;<br></li><li>}<br></li><li><br></li></ol><p> </p><p> </p><p>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</p><ol><li>USACO 3.1<br></li><li>Score Inflation<br></li><li>题目如下：<br></li><li>我们试着设计我们的竞赛以便人们能尽可能的多得分,这需要你的帮助。<br></li><li>我们可以从几个种类中选取竞赛的题目,这里的一个&quot;种类&quot;是指一个竞赛题目的集合,解决集合中的题目需要相同多的时间并且能得到相同的分数。<br></li><li>你的任务是写一个程序来告诉USACO的职员,应该从每一个种类中选取多少题目,使得解决题目的总耗时在竞赛规定的时间里并且总分最大。<br></li><li>输入包括竞赛的时间,M(1 &lt;= M &lt;= 10,000)和N,&quot;种类&quot;的数目1 &lt;= N &lt;= 10,000。<br></li><li>后面的每一行将包括两个整数来描述一个&quot;种类&quot;:<br></li><li>第一个整数说明解决这种题目能得的分数(1 &lt;= points &lt;= 10000),第二整数说明解决这种题目所需的时间(1 &lt;= minutes &lt;= 10000)。<br></li><li>你的程序应该确定我们应该从每个&quot;种类&quot;中选多少道题目使得能在竞赛的时间中得到最大的分数。<br></li><li>来自任意的&quot;种类&quot;的题目数目可能任何非负数(0或更多)。<br></li><li>计算可能得到的最大分数。<br></li><li>PROGRAM NAME: inflate<br></li><li>INPUT FORMAT<br></li><li>第 1 行: M, N–竞赛的时间和题目&quot;种类&quot;的数目。&nbsp;&nbsp;<br></li><li>第 2-N+1 行:&nbsp;&nbsp;         两个整数:每个&quot;种类&quot;题目的分数和耗时。 <br></li><li>SAMPLE INPUT (file inflate.in) <br></li><li>300 4<br></li><li>100 60<br></li><li>250 120<br></li><li>120 100<br></li><li>35 20<br></li><li>OUTPUT FORMAT<br></li><li>单独的一行包括那个在给定的限制里可能得到的最大的分数。<br></li><li>SAMPLE OUTPUT (file inflate.out)<br></li><li>605<br></li><li>{从第2个&quot;种类&quot;中选两题，第4个&quot;种类&quot;中选三题}<br></li></ol><p> </p><ol><li><br></li><li>示例程序如下：<br></li><li><br></li><li>#include &lt;fstream.h&gt;<br></li><li>ifstream fin(&quot;inflate.in&quot;);<br></li><li>ofstream fout(&quot;inflate.out&quot;);<br></li><li>const short maxm = 10010;<br></li><li>long best[maxm], m, n;<br></li><li>void<br></li><li>main()<br></li><li>{<br></li><li>    short i, j, len, pts;<br></li><li>    fin &gt;&gt; m &gt;&gt; n;<br></li><li>    for (j = 0; j &lt;= m; j++)<br></li><li>  &nbsp;&nbsp;          &nbsp;&nbsp;&nbsp;         best[j] = 0;<br></li><li>    for (i = 0; i &lt; n; i++) {<br></li><li>  &nbsp;&nbsp;          &nbsp;&nbsp;&nbsp;         fin &gt;&gt; pts &gt;&gt; len;<br></li><li>  &nbsp;&nbsp;          &nbsp;&nbsp;&nbsp;         for (j = len; j &lt;= m; j++)<br></li><li>  &nbsp;&nbsp;          &nbsp;&nbsp;          &nbsp;&nbsp;           if (best[j-len] + pts &gt; best[j])<br></li><li>  &nbsp;&nbsp;          &nbsp;&nbsp;          &nbsp;&nbsp;          &nbsp;&nbsp;            best[j] = best[j-len] + pts;<br></li><li>    }<br></li><li>    fout &lt;&lt; best[m] &lt;&lt; endl; // 由于数组元素不减，末元素最大<br></li><li>}<br></li><li><br></li></ol><p> </p><p> </p><p> </p><p> </p><p> </p><br>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<p><br>A Game<br><br>有如下一个双人游戏:N(2 &lt;= N &lt;= 100)个正整数的序列放在一个游戏平台上，两人轮流从序列的两端取数，取数后该数字被去掉并累加到本玩家的得分中，当数取尽时，游戏结束。以最终得分多者为胜。 <br><br>编一个执行最优策略的程序，最优策略就是使自己能得到在当前情况下最大的可能的总分的策略。你的程序要始终为第二位玩家执行最优策略。<br><br>PROGRAM NAME: game1<br>INPUT FORMAT<br>第一行:&nbsp;&nbsp;        正整数N, 表示序列中正整数的个数。&nbsp;&nbsp;<br>第二行至末尾:   用空格分隔的N个正整数（大小为1-200）。 <br><br>SAMPLE INPUT (file game1.in) <br>6 <br>4 7 2 9<br>5 2<br><br>OUTPUT FORMAT<br><br>只有一行，用空格分隔的两个整数: 依次为玩家一和玩家二最终的得分。 <br><br>SAMPLE OUTPUT (file game1.out)<br>18 11</p><p></p><p> </p><p><strong></strong></p><p><strong>设得到一个子序列Qi,Qi+1,Qi+2,…,Qj-2,Qj-1,Qj;<br>由于后一个人按最佳策略取数,所以他必将取一个最大值f(i+1,j)或f(i,j-1),那么此时取数的人以后取得的数将是sum(i+1,j)-f(i+1,j)或是sum(i,j-1)-f(i,j-1),此时取数的人按最佳策略取数,他会取Qi或者Qj使得sum(i+1,j)-f(i+1,j)+Qi和sum(i,j-1)-f(i,j-1)+Qj二者能有较大值.这样从游戏的结束向游戏的开始推,可以得到总的最优解.</strong></p><p><br><strong></strong></p><p><strong>for i←n-1 downto 1 do<br>  for j←i+1 to n do<br>&nbsp;&nbsp;&nbsp;         begin<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         sum(i,j)←sum(i,j-1)+Qj<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         f[i,j]←max{sum(i+1,j)+Qi-f(i+1,j),sum(i,j-1)+Qj-f(i,j-1)}<br>&nbsp;&nbsp;&nbsp;         end;</strong></p><p></p><p><strong></strong></p>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－<br><p> </p><ol><li>USACO 3.4<br></li><li>Raucous Rockers<br></li><li>题目如下：<br></li><li>你刚刚得到了流行的“破锣摇滚”乐队录制的尚未发表的N(1 &lt;= N &lt;=20)首歌的版权。你打算从中精选一些歌曲，发行M(1 &lt;= M &lt;= 20)张CD。每一张CD最多可以容纳T(1 &lt;= T&lt;= 20)分钟的音乐，一首歌不能分装在两张CD中。 <br></li><li>不巧你是一位古典音乐迷，不懂如何判定这些歌的艺术价值。于是你决定根据以下标准进行选择： <br></li><li>歌曲必须按照创作的时间顺序在CD盘上出现。 <br></li><li>选中的歌曲数目尽可能地多。 <br></li><li>PROGRAM NAME: rockers<br></li><li>INPUT FORMAT<br></li><li>第一行：&nbsp;&nbsp;     三个整数：N, T, M.&nbsp;&nbsp;<br></li><li>第二行：&nbsp;&nbsp;     N个整数，分别表示每首歌的长度，按创作时间顺序排列。&nbsp;&nbsp;<br></li><li>SAMPLE INPUT (file rockers.in)<br></li><li>4 5 2<br></li><li>4 3 4 2<br></li><li>OUTPUT FORMAT<br></li><li>一个整数，表示可以装进M张CD盘的乐曲的最大数目。 <br></li><li>SAMPLE OUTPUT (file rockers.out)<br></li><li>3<br></li></ol><p> </p><p>分析 动态规划</p><p>f[i, j, k]：前i首歌 前j个光盘 在当前时间限制为k时最多能放多少首歌。<br>当k&gt;=a[i]时f[i,j,k]=max(f[i-1,j,k-a[i]] + 1, f[i-1,j,k])；当k&lt;a[i]时f[i,j,k]=max(f[i,j-1,t], f[i-1,j,k])<br>i表示的是第i首歌，j表示的是第j个光盘，k表示的是要用的时间，<br>a[i]是第i首歌的时间，t表示的是光盘的最大空间。<br>其实他就是一个01背包类的问题，只不过我们要考虑一下当前的这个光盘是否可以放，然后在考虑放与不放。</p><p> </p><p> </p>#include&lt;stdlib.h&gt;<br>#include&lt;stdio.h&gt;<br>int main()<br>{<br>&nbsp;&nbsp;&nbsp;      int i1,i2,n,t,m,i,a[22],f[50][50][50]={0};<br>&nbsp;&nbsp;&nbsp;      FILE in;<br>&nbsp;&nbsp;&nbsp;      in=fopen(&quot;input12.txt&quot;,&quot;r&quot;);<br>&nbsp;&nbsp;&nbsp;      fscanf(in,&quot;%d%d%d&quot;,&amp;n,&amp;t,&amp;m);<br>&nbsp;&nbsp;&nbsp;      for(i=1;i&lt;=n;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      fscanf(in,&quot;%d&quot;,&amp;a[i]);<br>&nbsp;&nbsp;&nbsp;      for(i=1;i&lt;=n;i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for(i1=1;i1&lt;=m;i1++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      for(i2=0;i2&lt;=t;i2++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if(i2&gt;=a[i])<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      f[i][i1][i2]=f[i-1][i1][i2];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if(f[i][i1][i2]&lt;f[i-1][i1][i2-a[i]]+1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      f[i][i1][i2]=f[i-1][i1][i2-a[i]]+1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      f[i][i1][i2]=f[i][i1-1][t];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      if(f[i][i1][i2]&lt;f[i-1][i1][i2])<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      f[i][i1][i2]=f[i-1][i1][i2];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      printf(&quot;%d&quot;,f[n][m][t]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;      system(&quot;pause&quot;);<br>}<p> </p><p>－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</p><br><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><br><br><br><br><br><br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/04/【★】动态规划例题/" class="archive-article-date">
  	<time datetime="2010-12-04T15:15:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-04</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【转】上机题-基因串" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/02/【转】上机题-基因串/">【转】上机题 基因串</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p>一道很不错的DP</p><p>要是没提示的话 肯定想不出来的说</p><p>两次DP~</p><p> </p><p>题目：</p><p>                                                                                                题目 - 基因串                                                                                                                 来源            POI                            描述                            基因串是由一串有限长度的基因所组成的，其中每一个基因都可以用26个英文大写字母中的一个来表示，不同的字母表示不同的基因类型。一个单独的基因可以生长成为一对新的基因，而可能成长的规则是通过一个有限的成长规则集所决定的。每一个成长的规则可以用三个大写英文字母A1A2A3来描述，这个规则的意思是基因A1可以成长为一对基因A2A3。 <br>            用大写字母S来表示一类称作超级基因的基因，因为每一个基因串都是由一串超级基因根据给出的规则所成长出来的。 <br>            请写一个程序，读入有限条成长的规则和一些我们想要得到的基因串，然后对于每个基因串，判断它是否可以由一个有限长度的超级基因串成长得出。如果可以，给出可成长为该基因串的最短超级基因串的长度。                                                     关于输入                            第一行为正整数n(n&lt;=50)表示规则的数目。 <br>            接下来n行，每行一个规则。 <br>            最后一行是目标基因串，长度不超过100。                                                     关于输出                            输出最短的超级基因串的长度，如果无法生成，请输出-1                                                     例子输入                                        3<br>BCA<br>ABC<br>SAB<br>BCCA<br>                                        例子输出                                        1                                        提示                            S-&gt;AB-&gt;BCB-&gt;BCCA <br> <br>            此题和石子归并问题类似,可以用f[i][j][C]表示从i到j的子串能否由C推导得出,f[i][j][C]=0表示不能,f[i][j][C]=1表示能,则有: <br>            f[i][j][C]=max{f[i][k][A]<em>f[k+1][j][B]}其中i&lt;=kAB是一条规则. <br>            这样可以计算出每一段能否由一个超级基因S推导得出. <br>            再由一次类似的动态规划过程可以算出每个子串最少由几个S推导得出(比如用g[i][j]表示从i到j的子串至少由几个S推导得出),即得到原问题的解.            </em></p><p>code：</p><p> <code>#include&lt;iostream&gt;using namespace std;struct Rule{ int st; int ed1; int ed2;};Rule rules[100];int f[105][105][30];int g[105][105];int main(){ int n,i,l,st,k,j,c; char tr[4]; char s[200]; scanf(&quot;%d&quot;,&amp;n); gets(tr); for(i=1;i&lt;=n;i++) {  gets(tr);  rules[i].st = tr[0] - ‘A’;  rules[i].ed1 = tr[1] - ‘A’;  rules[i].ed2 = tr[2] - ‘A’; } gets(s); memset(f,0,sizeof(f)); for(i=0;i&lt;strlen(s);i++) {  f[i][i][s[i]-‘A’] = 1; } for(l=2;l&lt;= strlen(s);l++) {  for(st=0 ;st + l &lt;= strlen(s) ;st++)  {   for(i = 1 ; i&lt;=n ; i++)   {    for(k = st ; k&lt; st +l -1;k++ )    {     f[st][st+l-1][rules[i].st] |= ( f[st][k][rules[i].ed1]  f[k+1][st+l-1][rules[i].ed2]);    }   }  } }// for(i = 0 ;i&lt;strlen(s);i++)// {//  for(j=0 ; j&lt; strlen(s);j++)//  {//   for(c = 0 ; c&lt;26;c++)//   {//    if(f[i][j][c]) cout&lt;&lt;&quot;i=&quot;&lt;&lt;i&lt;&lt;&quot; j=&quot;&lt;&lt;j&lt;&lt;&quot; c=&quot;&lt;&lt;char(c+’A’)&lt;&lt;endl;//   }//  }// } for(i = 0 ;i&lt;strlen(s) ;i++)  for(j = 0; j&lt;strlen(s);j++)   g[i][j] = 10000;   for(l=1;l&lt;= strlen(s);l++) {  for(st=0 ;st + l &lt;= strlen(s) ;st++)  {   if(f[st][st+l-1][‘S’-‘A’])   {    g[st][st+l-1] = 1;   }   else   {    for(k = st; k&lt; st + l -1 ; k++)    {     if(g[st][k] + g[k+1][st+l-1] &lt; g[st][st+l-1])  g[st][st+l-1] = g[st][k] + g[k+1][st+l-1];    }   }  } } if(g[0][strlen(s)-1]&gt;=1000) g[0][strlen(s)-1] = -1; printf(&quot;%dn&quot;,g[0][strlen(s)-1]); return 0;}   </code>                                        提示                                        Case 0: Time = 23ms, Memory = 264kB.Case 1: Time = 26ms, Memory = 264kB.Case 2: Time = 22ms, Memory = 264kB.Case 3: Time = 22ms, Memory = 264kB.Case 4: Time = 46ms, Memory = 264kB.Case 5: Time = 29ms, Memory = 264kB.Case 6: Time = 85ms, Memory = 264kB.Case 7: Time = 88ms, Memory = 264kB.Case 8: Time = 176ms, Memory = 1472kB.Case 9: Time = 178ms, Memory = 1472kB.                        </p><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/02/【转】上机题-基因串/" class="archive-article-date">
  	<time datetime="2010-12-02T12:45:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-02</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【转】【★】红黑树（Red-Black-Tree）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/12/01/【转】【★】红黑树（Red-Black-Tree）/">【转】【★】红黑树（Red Black Tree）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> </p><p><a target="_blank" href="http://blog.csdn.net/michaelrun/archive/2010/05/30/5635189.aspx">《算法导论》笔记－－红黑树的删除操作</a></p><p><a href="http://blog.csdn.net/michaelrun/archive/2010/05/30/5635189.aspx" target="_blank" rel="external">http://blog.csdn.net/michaelrun/archive/2010/05/30/5635189.aspx</a></p><p></p><p></p><p>……<br></p><p>分析就只限制在X节点，X的父节点P，X的兄弟节点W，以及W的两个子节点。这些个节点中。</p><p>W以及W的两个子节点C1和C1的一共有五种组合，便有两种情况的处理是一致的，因此调整的过程可以分以下四个情况：</p><p>第一种情况：W是红色节点</p><p><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/eea85143042bdc5d9213c6d3.jpg"></p><p> </p><p>如上图，如果W是红色的，那么B和D节点进行一次左旋，并把D（也就是原来的W）着为黑色，B节点（X的父节点）着为红色。然后让W指向X的新兄弟。这样，就把这种情况转化为了W为黑色的情况来解决。在这个变形中，这五个节点之间保持了红黑性质不变，而X指向的双黑色节点的位置和颜色特性都没有变化。变形后的情况如何解决呢？下面的都是W为黑色的问题，因此下面三种中总有一种会合适。</p><p>PS：有没有其它变形呢？有，比如C和D进行右旋，B节点变为红色，变形后五个节点红黑正确的，但是这五个节点与树的其它部分相接处可能会产生问题，这样要考虑的因素就太多了。</p><p> </p><p>第二种情况：W以及W的两个子节点都是黑色的</p><p> </p><p><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/e1a0eb240042c74d4d088ddd.jpg"></p><p> </p><p>如上图，注意，B即可以是红色也可以是黑色。</p><p>这种情况下，把D节点着成红色。然后把X的一个黑色推到父节点B中去，这时X就指向B节点了。变形前后，这五个节点间的黑高是没有变化的。</p><p>唯一可能产生问题的就是如果B原来是红色，那么B和D两个红色相邻就破坏了第４个性质，这样新X的子树就有问题了。这本来不符合我们向上递归的假设。但正好在这种情况下递归就可以结束了。因为B节点原来是红色，现在双加一层黑色，那么X现在指向的这个节点就是红黑两色的，直接把X（也就是B）着为黑色。问题就已经完整解决了。</p><p>如果B节点现在是双层黑色，那就以B为新的X进行向上的下一次的递归。</p><p> </p><p>第三种情况：W的左子节点是红色的且右子节点是黑色。</p><p> </p><p><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/e305087bbcd415b80bd187de.jpg"></p><p> </p><p>&nbsp;&nbsp;   如上图，B即可以是黑色也可以是红色。</p><p>&nbsp;&nbsp;   把C和D进行一次旋转，改变C和D的颜色变形成新的结构。把问题转化成W的右子节点为红色的情况来解决。注意，原来C是红色的，所以C的子节点一定是黑色的，所以旋转中C节点的一个子树挂到之后着为红色的D节点上不会破坏红黑性质。变形后黑高度不变。</p><p> </p><p>&nbsp;&nbsp;   第四种情况：W的右子节点是红色（左子节点可以是红色或黑色）</p><p> </p><p><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/ca385cdfb76fa55f485403df.jpg"></p><p> </p><p>&nbsp;&nbsp;   如上图，B节点可以是红色或是黑色。</p><p>&nbsp;&nbsp;   将B和D进行一次左旋，并交换两者的颜色。再将E着为黑色。这时，只要将X的一层黑色脱去，整个问题也得到了解决。递归结束。（在代码上，为了标识递归结束，我们把X指向根节点）</p><p> </p><p>&nbsp;&nbsp;   因此，只要按上面四种情况一直递归处理下去，X最终总会指向根结点或一个红色结点，这时我们就可以结束递归并把问题解决了。</p><p>&nbsp;&nbsp;   以上就是红黑色的节点删除过程。</p><p> </p><br><p></p><p></p>—————————————————<p>（下面这篇有些地方有误，谨慎参考之）</p><p><br></p><p>介绍另一种平衡二叉树：红黑树（Red Black Tree），红黑树由Rudolf Bayer于1972年发明，当时被称为平衡二叉B树（symmetric binary B-trees），1978年被Leonidas J. Guibas 和 Robert Sedgewick改成一个比较摩登的名字：红黑树。</p><p>红黑树和之前所讲的AVL树类似，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。自从红黑树出来后，AVL树就被放到了博物馆里，据说是红黑树有更好的效率，更高的统计性能。不过在我了解了红黑树的实现原理后，并不相信这是真的，关于这一点我们会在后面进行讨论。</p><p>红黑树和AVL树的区别在于它使用颜色来标识结点的高度，它所追求的是局部平衡而不是AVL树中的非常严格的平衡。之前我们在讲解AVL树时，已经领教过AVL树的复杂，但AVL树的复杂比起红黑树来说简直是小巫见大巫。红黑树是真正的变态级数据结构。</p><p>首先来一个Silverlight做的红黑树的动画，它有助于帮你理解什么是红黑树。这里需要注意，必须安装Silverlight 2.0 RTW 才能正常运行游戏，下载地址：</p><p><a href="http://www.microsoft.com/silverlight/resources/install.aspx?v=2.0" target="_blank" rel="external">http://www.microsoft.com/silverlight/resources/install.aspx?v=2.0</a></p><p> </p><p>使用注意事项：</p><p>l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       结点只接收整数，如果在添加和删除操作中输入非法字串，则会随机添加或删除一个0~99之间的整数。</p><p>l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       可以不在编辑框中输入数字，直接单击添加和删除按钮进行添加和删除操作。</p><p>l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       可以拖动拖动条控制动画速度。</p>红黑树的平衡<p>红黑树首先是一棵二叉查找树，它每个结点都被标上了颜色（红色或黑色），红黑树满足以下5个性质：</p><p><strong>1、 </strong><strong>每个结点的颜色只能是红色或黑色。</strong></p><p><strong>2、 </strong><strong>根结点是黑色的。</strong></p><p><strong>3、 </strong><strong>每个叶子结点都带有两个空的黑色结点（被称为黑哨兵），如果一个结点n</strong><strong>的只有一个左孩子，那么n</strong><strong>的右孩子是一个黑哨兵；如果结点n</strong><strong>只有一个右孩子，那么n</strong><strong>的左孩子是一个黑哨兵。</strong></p><p><strong>4、 </strong><strong>如果一个结点是红的，则它的两个儿子都是黑的。也就是说在一条路径上不能出现相邻的两个红色结点。</strong></p><p><strong>5、 </strong><strong>对于每个结点来说，从该结点到其子孙叶结点的所有路径上包含相同数目的黑结点。</strong></p><p>红黑树的这5个性质中，第3点是比较难理解的，但它却非常有必要。我们看图1中的左边这张图，如果不使用黑哨兵，它完全满足红黑树性质，结点50到两个叶结点8和叶结点82路径上的黑色结点数都为2个。但如果加入黑哨兵后（如图1右图中的小黑圆点），叶结点的个数变为8个黑哨兵，根结点50到这8个叶结点路径上的黑高度就不一样了，所以它并不是一棵红黑树。</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/ca385cdfb706a55f485403f0.jpg" height="160" width="428"></p><p> </p><p> </p><p>要看真正的红黑树请在以上动画中添加几个结点，看看是否满足以上性质。</p>红黑树的旋转操作<p>红黑树的旋转操作和AVL树一样，分为LL、RR、LR、RL四种旋转类型，差别在于旋转完成后改变的是结点的颜色，而不是平衡因子。旋转动画演示请参考AVL这篇文章中的Flash动画：</p><p><a href="http://www.cnblogs.com/abatei/archive/2008/11/17/1335031.html" target="_blank" rel="external">http://www.cnblogs.com/abatei/archive/2008/11/17/1335031.html</a></p>红黑树上结点的插入<p>在讨论红黑树的插入操作之前必须要明白，任何一个即将插入的新结点的初始颜色都为红色。这一点很容易理解，因为插入黑点会增加某条路径上黑结点的数目，从而导致整棵树黑高度的不平衡。但如果新结点父结点为红色时（如图2所示），将会违返红黑树性质：一条路径上不能出现相邻的两个红色结点。这时就需要通过一系列操作来使红黑树保持平衡。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/b7c40b23e3e33802935807f0.jpg" height="140" width="339"></p><p> </p><p> </p><p>为了清楚地表示插入操作以下在结点中使用“新”字表示一个新插入的结点；使用“父”字表示新插入点的父结点；使用“叔”字表示“父”结点的兄弟结点；使用“祖”字表示“父”结点的父结点。插入操作分为以下几种情况：</p><p><strong>1</strong><strong>、</strong><strong>黑父</strong></p><p>如图3所示，如果新点的父结点为黑色结点，那么插入一个红点将不会影响红黑树的平衡，此时插入操作完成。红黑树比AVL树优秀的地方之一在于黑父的情况比较常见，从而使红黑树需要旋转的几率相对AVL树来说会少一些。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/23c4544ed2efbf45b2de05f0.jpg" height="89" width="191"></p><p> </p><p> </p><p><strong>2</strong><strong>．红父</strong></p><p>如果新点的父结点为红色，这时就需要进行一系列操作以保证整棵树红黑性质。如图3所示，由于父结点为红色，此时可以判定，祖父结点必定为黑色。这时需要根据叔父结点的颜色来决定做什么样的操作。青色结点表示颜色未知。由于有可能需要根结点到新点的路径上进行多次旋转操作，而每次进行不平衡判断的起始点（我们可将其视为新点）都不一样。所以我们在此使用一个蓝色箭头指向这个起始点，并称之为判定点。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/6cc8d309f169f2ced0581bf0.jpg" height="123" width="194"></p><p> </p><p> </p><p><strong>2.1 </strong><strong>红叔</strong></p><p>当叔父结点为红色时，如图4所示，无需进行旋转操作，只要将父和叔结点变为黑色，将祖父结点变为红色即可。但由于祖父结点的父结点有可能为红色，从而违反红黑树性质。此时必须将祖父结点作为新的判定点继续向上进行平衡操作。</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/4d4e9e8295efa2f36d8119f0.jpg" height="123" width="308"></p><p> </p><p> </p><p>需要注意，无论“父”在“叔”的左边还是右边，无论“新”是“父”的左孩子还是右孩子，它们的操作都完全一样。</p><p> </p><p><strong>2.2 </strong><strong>黑叔</strong></p><p>当叔父结点为黑色时，需要进行旋转，以下图示了所有的旋转可能</p><p>情形1：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/2fc8cebf2a36ee4618d81ff0.jpg" height="143" width="403"></p><p> </p><p>情形2：</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/9211820a516fd272b0351df0.jpg" height="155" width="371"></p><p> </p><p>情形3：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/e748be3efb825db6838b13f0.jpg" height="151" width="352"></p><p> </p><p>情形4：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/4fa531face3cc852a9d311f0.jpg" height="150" width="356"></p><p> </p><p>可以观察到，当旋转完成后，新的旋转根全部为黑色，此时不需要再向上回溯进行平衡操作，插入操作完成。需要注意，上面四张图的“叔”、“1”、“2”、“3”结点有可能为黑哨兵结点。</p><p>其实红黑树的插入操作不是很难，甚至比AVL树的插入操作还更简单些。但删除操作就远远比AVL树复杂得多，下面就介绍红黑树的删除操作。</p>红黑树上结点的删除<p>红黑树本身是一棵二叉查找树，它的删除和二叉查找树的删除类似。首先要找到真正的删除点，当被删除结点n存在左右孩子时，真正的删除点应该是n的中序遍在前驱，关于这一点请复习二叉查找树的删除。如图9所示，当删除结点20时，实际被删除的结点应该为18，结点20的数据变为18。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/7c1ba41ee6649353403417f0.jpg" height="152" width="243"></p><p> </p><p> </p><p>所以可以推断出，在进行删除操作时，真正的删除点必定是只有一个孩子或没有孩子的结点。而根据红黑树的性质可以得出以下两个结论：</p><p>1、 <strong>删除操作中真正被删除的必定是只有一个红色孩子或没有孩子的结点</strong>。</p><p>2、 <strong>如果真正的删除点是一个红色结点，那么它必定是一个叶子结点</strong>。</p><p>理解这两点非常重要，如图10所示，除了情况(a)外，其他任一种况结点N都无法满足红黑树性质。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/5643ff1f1183f946314e15f0.jpg" height="168" width="474"></p><p> </p><p> </p><p>在以下讨论中，我们使用蓝色箭头表示真正的删除点，它也是旋转操作过程中的第一个判定点；真正的删除点使用“旧”标注，旧点所在位置将被它的的孩子结点所取代（最多只有一个孩子），我们使用“新”表示旧点的孩子结点。删除操作可分为以下几种情形：</p><p><strong>1</strong><strong>、旧点为红色结点</strong></p><p>若旧点为红色结点，则它必定是叶子结点，直接删除即可。如图11所示</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/bfa4950a62f94b5394ca6bf0.jpg" height="101" width="253"></p><p> </p><p> </p><p><strong>2</strong><strong>、一红一黑</strong></p><p>当旧点为黑色结点，新点为红色结点时，将新点取代旧点位置后，将新点染成黑色即可（如图12所示）。这里需要注意：旧点为红色，新点为黑色的情况不可能存在。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/cede271fc17dbf84a68669f0.jpg" height="132" width="229"></p><p> </p><p> </p><p><strong>3</strong><strong>、双黑</strong></p><p>当旧点和新点都为黑色时（新点为空结点时，亦属于这种情况），情况比较复杂，需要根据旧点兄弟结点的颜色来决定进行什么样的操作。我们使用“兄”来表示旧点的兄弟结点。这里可分为红兄和黑兄两种情况：</p><p><strong>3.1 </strong><strong>红兄</strong></p><p>由于兄弟结点为红色，所以父结点必定为黑色，而旧点被删除后，新点取代了它的位置。下图演示了两种可能的情况：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/72c496eec1a854652cf534f0.jpg" height="246" width="359"></p><p> </p><p> </p><p>红兄的情况需要进行RR或LL型旋转，然后将父结点染成红色，兄结点染成黑色。然后重新以新点为判定点进行平衡操作。我们可以观察到，旋转操作完成后，判定点没有向上回溯，而是降低了一层，此时变成了黑兄的情况。</p><p><strong>3.2 </strong><strong>黑兄</strong></p><p>黑兄的情况最为复杂，需要根据黑兄孩子结点（这里用“侄”表示）和父亲结点的颜色来决定做什么样的操作。</p><p><strong>3.2.1 </strong><strong>黑兄二黑侄红父</strong></p><p>如图14所示，这种情况比较简单，只需将父结点变为黑色，兄结点变为黑色，新结点变为黑色即可，删除操作到此结束。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/6b5ad3c8f131a75b7e3e6ff0.jpg" height="246" width="356"></p><p> </p><p> </p><p><strong>3.2.2 </strong><strong>黑兄二黑侄黑父</strong></p><p>如图15所示，此时将父结点染成新结点的颜色，新结点染成黑色，兄结点染成红色即可。当新结点为红色时，父结点被染成红色，此时需要以父结点为判定点继续向上进行平衡操作。</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/5916cb1727890945c83d6df0.jpg" height="248" width="362"></p><p> </p><p> </p><p><strong>3.2.3 </strong><strong>黑兄红侄</strong></p><p>黑兄红侄有以下四种情形，下面分别进行图示：</p><p>情形1：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/81ae6509938a1e833ac763f0.jpg" height="144" width="394"></p><p> </p><p>情形2：</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/37ad72cf6770f171f9dc61f0.jpg" height="153" width="370"></p><p> </p><p>情形3：</p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/c5579d3da66bbf4cbba167f0.jpg" height="153" width="379"></p><p> </p><p>情形4：</p><p> </p><p><img src="http://img.pickbox.me/wp-content/uploads/pic/064cd300da16a35d738b65f0.jpg" height="151" width="379"></p><p> </p><p> </p><p>由以上图例所示，看完以上四张图的兄弟有可能会有一个疑问，如果情形1和情形2中的两个侄子结点都为红色时，是该进行LL旋转还是进行LR旋转呢？答案是进行LL旋转。情形3和情形4则是优先进行RR旋转的判定。</p><br><br><br><br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/12/01/【转】【★】红黑树（Red-Black-Tree）/" class="archive-article-date">
  	<time datetime="2010-11-30T17:10:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-12-01</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Hibernate-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/11/29/Hibernate-example/">Hibernate example</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> Hibernate是一个不依赖其他平台的轻量级的中间件，现在到处充斥着通过各种工具使用Hibernate进行开发的教程，如 MyEclipse, Ant, Maven等等，但是去掉这些工具，事实上，Hibernate仍然可以使用的。下面的讲解就是使用这种方法，让大家认识Hibernate。需要的软件有：Eclipse + MySQL + Hibernate。<br><br>1. 准备jar包<br>首先作为准备，我们去Hibernate官方网站下载Hibernate jar包。本教程用的是hibernate-distribution-3.3.2.GA-dist， 解压，我们使用的主要有hibernate3.jar 和lib/required里的包，其他的包在需要的时候再进行导入即可。需要特别注意的是，我在这些包里没有找到slf4j-nop-1.5.2.jar这个包，需要自己去下载，不然在使用本教程运行时会抛出找不到一些类的异常。下载的地址可以在baidu或者google里搜索。另外需要数据库驱动程序, 本教程使用的是MySQL数据库,使用的jar包为mysql-connector-java-5.1.0-bin.jar,你可根据自己的mysql版本等信息选择合适的jar包.<br><br>2. 建立工程  <br>为了方便，我们使用Eclipse作为开发平台，注意，这里没有使用其他的插件，从这个意义上来说，还是比较纯粹的，呵呵。本贴原创,转载请注明来自historycreator.com<br><br><br>2.0 在MySQL中建立数据库,名为event.<br>建一表,名为events,包含字段有EVENT_ID,title,EVENT_DATE,类型分别是整型自动增长主键,varchar,timestamp.<br><br>2.1 打开eclipse，建立一个Java Project。导入相关类,包括hibernate3.jar和/lib/required里的所有jar包,加上slf4j-nop-1.5.2.jar和mysql-connector-java-5.1.0-bin.jar.<br><br>2.2 新建一个实体类Event<br>package com.historycreator.hibernate;<br><br>import java.util.Date;<br><br>public class Event {<br>&nbsp;&nbsp;&nbsp;  private Long id;<br><br>&nbsp;&nbsp;&nbsp;  private String title;<br>&nbsp;&nbsp;&nbsp;  private Date date;<br><br>&nbsp;&nbsp;&nbsp;  public Event() {}<br><br>&nbsp;&nbsp;&nbsp;  public Long getId() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return id;<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  private void setId(Long id) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  this.id = id;<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  public Date getDate() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return date;<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  public void setDate(Date date) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  this.date = date;<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  public String getTitle() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return title;<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  public void setTitle(String title) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  this.title = title;<br>&nbsp;&nbsp;&nbsp;  }<br>}<br><br>2.3 在com.historycreator.hibernate下建立配置文件Event.hbm.xml,内容如下<br>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;!DOCTYPE hibernate-mapping PUBLIC<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;<a href="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&quot;&amp;gt" target="_blank" rel="external">http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&quot;&amp;gt</a>;<br><br>&lt;hibernate-mapping package=&quot;com.historycreator.hibernate&quot;&gt;<br><br>&nbsp;&nbsp;&nbsp;  &lt;class name=&quot;Event&quot; table=&quot;EVENTS&quot;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;id name=&quot;id&quot; column=&quot;EVENT_ID&quot;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;generator class=&quot;native&quot; /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/id&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;date&quot; type=&quot;timestamp&quot; column=&quot;EVENT_DATE&quot; /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;title&quot; /&gt;<br>&nbsp;&nbsp;&nbsp;  &lt;/class&gt;<br><br>&lt;/hibernate-mapping&gt;<br><br>2.4 在src文件夹,也就是在com同级目录下,建立配置文件hibernate.cfg.xml,内容如下:<br>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;!DOCTYPE hibernate-configuration PUBLIC<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;<a href="http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&quot;&amp;gt" target="_blank" rel="external">http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&quot;&amp;gt</a>;<br><br>&lt;hibernate-configuration&gt;<br><br>&nbsp;&nbsp;&nbsp;  &lt;session-factory&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– Database connection settings –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;connection.driver_class&quot;&gt;org.gjt.mm.mysql.Driver&lt;/property&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;connection.url&quot;&gt;jdbc:mysql://localhost/event?useUnicode=true&amp;amp;characterEncoding=gbk&lt;/property&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;connection.username&quot;&gt;root&lt;/property&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;connection.password&quot;&gt;test&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– JDBC connection pool (use the built-in) –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;connection.pool_size&quot;&gt;1&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– SQL dialect –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;dialect&quot;&gt;org.hibernate.dialect.MySQL5Dialect&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– Enable Hibernate’s automatic session context management –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;current_session_context_class&quot;&gt;thread&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– Disable the second-level cache  –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;cache.provider_class&quot;&gt;org.hibernate.cache.NoCacheProvider&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– Echo all executed SQL to stdout –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;show_sql&quot;&gt;true&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;!– Drop and re-create the database schema on startup –&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;property name=&quot;hbm2ddl.auto&quot;&gt;update&lt;/property&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;mapping resource=&quot;com/historycreator/hibernate/Event.hbm.xml&quot;/&gt;<br><br>&nbsp;&nbsp;&nbsp;  &lt;/session-factory&gt;<br><br>&lt;/hibernate-configuration&gt;<br><br>2.5 建工厂类HibernateUtil<br>package com.historycreator.hibernate;<br><br>import org.hibernate.SessionFactory;<br>import org.hibernate.cfg.Configuration;<br><br>public class HibernateUtil {<br><br>&nbsp;&nbsp;&nbsp;  private static final SessionFactory sessionFactory = buildSessionFactory();<br><br>&nbsp;&nbsp;&nbsp;  private static SessionFactory buildSessionFactory() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  try {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // Create the SessionFactory from hibernate.cfg.xml<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return new Configuration().configure().buildSessionFactory();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  catch (Throwable ex) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // Make sure you log the exception, as it might be swallowed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  System.err.println(&quot;Initial SessionFactory creation failed.&quot; + ex);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  throw new ExceptionInInitializerError(ex);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  public static SessionFactory getSessionFactory() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return sessionFactory;<br>&nbsp;&nbsp;&nbsp;  }<br><br>}<br><br>2.6  建类EventManager<br>package com.historycreator.hibernate;<br><br>import java.util.Date;<br><br>import org.hibernate.classic.Session;<br><br>public class EventManager {<br><br>&nbsp;&nbsp;&nbsp;  public static void main(String[] args) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  EventManager mgr = new EventManager();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  mgr.createAndStoreEvent(&quot;My Event&quot;, new Date());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  HibernateUtil.getSessionFactory().close();<br>&nbsp;&nbsp;&nbsp;  }<br><br>&nbsp;&nbsp;&nbsp;  private void createAndStoreEvent(String title, Date theDate) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Session session = HibernateUtil.getSessionFactory().getCurrentSession();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  session.beginTransaction();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Event theEvent = new Event();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  theEvent.setTitle(title);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  theEvent.setDate(theDate);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  session.save(theEvent);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  session.getTransaction().commit();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>&nbsp;&nbsp;&nbsp;  }<br><br>}<br><br>运行即可.效果就是往数据库中插入了一条记录.<br><br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/11/29/Hibernate-example/" class="archive-article-date">
  	<time datetime="2010-11-29T06:09:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-11-29</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-系统APN开关的初始状态" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/11/26/系统APN开关的初始状态/">系统APN开关的初始状态</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
         <p>系统APN开关的初始状态：<br><br>1.mobile data enabled<br>frameworks/base/telephony/java/com/android/internal/telephony/gsm/GsmDataConnectionTracker.java<br>初始化时有读取dataEnabledSetting，<br>dataEnabledSetting = IConnectivityManager.Stub.asInterface(ServiceManager.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  getService(Context.CONNECTIVITY_SERVICE)).getMobileDataEnabled();<br>这里会一直调用到<br>frameworks/base/services/java/com/android/server/ConnectivityService.java<br>&nbsp;&nbsp;&nbsp;  public boolean getMobileDataEnabled() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  enforceAccessPermission();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  boolean retVal = Settings.Secure.getInt(mContext.getContentResolver(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Settings.Secure.MOBILE_DATA, 1) == 1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if (DBG) Slog.d(TAG, &quot;getMobileDataEnabled returning &quot; + retVal);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return retVal;<br>&nbsp;&nbsp;&nbsp;  }<br>会从数据库Settings的Secure表中读取mobile_data项的数值，该数据库在初始化时默认没有设置这一项，<br>因此会返回调用时的默认值1，也就是说android系统在代码中写死了，默认mobile_data是enabled的<br><br>2.settings的APN网络开关checkbox<br>packages/apps/Phone/ApnSwitchCheckBoxPreference.java<br>ApnSwitchCheckBoxPreference类初始化时读取初始指：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  boolean apnEnabled = true;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  mResolver = context.getContentResolver();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  try {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  apnEnabled = android.provider.Settings.System.getInt(mResolver, APN_STATE) &gt; 0 ? true : false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(DBG) Log.i(LOG_TAG, &quot;zhangwen: apnEnable=&quot; + apnEnabled);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  } catch (SettingNotFoundException e) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // APN_STATE not found<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(DBG) Log.i(LOG_TAG, &quot;zhangwen: APN setting state not found&quot;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  setChecked(apnEnabled);<br>同样，Settings数据库中的System表中默认没有apn_state的设置，因此会异常，apnEnabled保持声明时的true初始指<br><br>初始化完成后还会调用updateSwitchState()，进行PREFERAPN_URI的query，<br>packages/providers/TelephonyProvider/src/com/android/providers/telephony/TelephonyProvider.java<br>当query URL_PREFERAPN（content://telephony/carriers/preferapn）时，<br>会先从本地的preference “preferred-apn”文件中读取apn_id，然后将该apn_id append到查询的uri后执行数据库查询。<br>该apn_id会有一个大于0的数值，因此会返回enabled状态。<br></p> 
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/11/26/系统APN开关的初始状态/" class="archive-article-date">
  	<time datetime="2010-11-26T07:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-11-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-点击AlertDialog的Positive-Button后的处理流程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2010/11/10/点击AlertDialog的Positive-Button后的处理流程/">点击AlertDialog的Positive Button后的处理流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>android中的AlertDialog创建时，允许指定positive button被点击时调用的onClick()回调函数，<br>如：<br></p><p>new AlertDialog.Builder(this)<br>                .setTitle(&quot;Single choice&quot;)<br>                .setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {<br>                    public void onClick(DialogInterface dialog, int whichButton) {<br><br>                        /<em> User clicked Yes so do some stuff </em>/<br>                    }<br>                })<br>                .setNegativeButton(&quot;cancel&quot;, new DialogInterface.OnClickListener() {<br>                    public void onClick(DialogInterface dialog, int whichButton) {<br><br>                        /<em> User clicked No so do some stuff </em>/<br>                    }<br>                })<br>               .show();</p><br>但是我们在回调函数中并没有将dialog给dismiss()掉，那么为什么dialog会消失？<br>可以想到的一种解释是，在AlertDialog收到onClick事件主动调用用户传入的回调函数，<br>返回后再执行一段dismiss的代码。<br>android的onCreate()、onDestroy()等机制都是这么实现的，因此onClick()当然<br>可以按照同样方法实现。<br><br><br>AlertDialog的具体实现位于深入AlertDialog.java、AlertController.java<br>这两个文件中，从代码可以看出，AlertDialog创建时，<br>设置positive button、negative button、neutral button的<br>onClickListener为mButtonHandler（AlertController.java&gt;setupButtons()），<br><br>因此Button在被点击时，真正执行的并不是用户传入的那个onClickListener！<br><br>mButtonHandler的定义如下：<br><p>View.OnClickListener mButtonHandler = new View.OnClickListener() {<br>        public void onClick(View v) {<br>            Message m = null;<br>            if (v == mButtonPositive &amp;&amp; mButtonPositiveMessage != null) {<br>                m = Message.obtain(mButtonPositiveMessage);<br>            } else if (v == mButtonNegative &amp;&amp; mButtonNegativeMessage != null) {<br>                m = Message.obtain(mButtonNegativeMessage);<br>            } else if (v == mButtonNeutral &amp;&amp; mButtonNeutralMessage != null) {<br>                m = Message.obtain(mButtonNeutralMessage);<br>            }<br>            if (m != null) {<br>                m.sendToTarget();<br>            }<br><br>            // Post a message so we dismiss after the above handlers are executed<br>            mHandler.obtainMessage(ButtonHandler.MSG_DISMISS_DIALOG, mDialogInterface)<br>                    .sendToTarget();<br>        }<br>    };</p>可以看到，首先发送了mButtonPositiveMessage消息给Handler，<br>然后又向Handler发送了一个MSG_DISMISS_DIALOG的请求。<br><br>Handler的处理如下：<br><p>private static final class ButtonHandler extends Handler {<br>        // Button clicks have Message.what as the BUTTON{1,2,3} constant<br>        private static final int MSG_DISMISS_DIALOG = 1;<br> <br>        private WeakReference&lt;DialogInterface&gt; mDialog;<br><br>        public ButtonHandler(DialogInterface dialog) {<br>            mDialog = new WeakReference&lt;DialogInterface&gt;(dialog);<br>        }<br><br>        @Override<br>        public void handleMessage(Message msg) {<br>            switch (msg.what) {<br> <br>                case DialogInterface.BUTTON_POSITIVE:<br>                case DialogInterface.BUTTON_NEGATIVE:<br>                case DialogInterface.BUTTON_NEUTRAL:<br>                    ((DialogInterface.OnClickListener) msg.obj).onClick(mDialog.get(), msg.what);<br>                    break;<br> <br>                case MSG_DISMISS_DIALOG:<br>                    ((DialogInterface) msg.obj).dismiss();<br>            }<br>        }<br>    }</p>对于MSG_DISMISS_DIALOG消息，则调用dismiss()，dialog被移出。<br>而对于DialogInterface.BUTTON_POSITIVE消息，则从msg中取出obj，<br>该msg对应于mButtonHandler中的mButtonPositiveMessage，<br>mButtonPositiveMessage是在setButton()时被赋值的：<br>mHandler.obtainMessage(whichButton, listener);<br><br>可以看到，用户传入的onClick listener被包装进了message中，在handler处理时，<br>又从message中取出来调用。<br><br>整个流程至此完全清晰。<br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/11/10/点击AlertDialog的Positive-Button后的处理流程/" class="archive-article-date">
  	<time datetime="2010-11-10T13:37:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-11-10</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Android/">Android</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/16/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/18/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>