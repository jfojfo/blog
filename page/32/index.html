<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/32/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Arch" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/11/02/Arch/">Arch</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><a target="_blank" href="http://www.archlinux.org.cn/main/">Arch linux</a><br><br>配置 arch linux<br><a target="_blank" href="http://www.archlinux.org.cn/main/node/80"> http://www.archlinux.org.cn/main/node/80</a><br><br><a href="http://wiki.archlinux.org/index.php/%E5%AE%89%E8%A3%85%E5%AE%8C%E5%90%8E%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank">安装完后的小技巧 (简体中文)</a><br><br><a href="http://wiki.archlinux.org/index.php/%E6%96%B0%E6%89%8B%E6%8C%87%E5%8D%97_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank">新手指南 (简体中文)</a><br><br><a href="http://linuxtoy.org/archives/the-perfect-linux-desktop-arch-linux-2007-08-2-1.html" target="_blank">打造完美的 Linux 桌面 &mdash; Arch Linux 2007.08-2 (1)</a> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/11/02/Arch/" class="archive-article-date">
  	<time datetime="2008-11-02T15:09:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-11-02</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-使用uvesafb为console设置高分辨率" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/29/使用uvesafb为console设置高分辨率/">使用uvesafb为console设置高分辨率</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>内核要支持uvesafb模块，并且安装v86d<br><br>参考：<a href="http://dev.gentoo.org/~spock/projects/uvesafb/" target="_blank">http://dev.gentoo.org/~spock/projects/uvesafb/</a><br><br>这里的配置不需要initramfs支持<br><br>然后创建文件 /etc/modprobe.d/uvesafb，内容为： options uvesafb mode_option=1280x800-32 mtrr=3 scroll=ywrap<br><br>在/etc/modprobe.d/blacklist-framebuffer中加入一行： blacklist uvesafb<br><br>确保/etc/modules中有 uvesafb 和 fbcon （各占一行）<br><br>参考：<a href="http://coolwanglu.blogspot.com/2008/10/ubuntu-810-uvesafb.html" target="_blank">http://coolwanglu.blogspot.com/2008/10/ubuntu-810-uvesafb.html</a><br><br><br><br><br><br><del>end</del><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/29/使用uvesafb为console设置高分辨率/" class="archive-article-date">
  	<time datetime="2008-10-29T14:23:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-29</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】共享库函数地址解析实例（GOT、PLT）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/29/【zz】共享库函数地址解析实例（GOT、PLT）/">【zz】共享库函数地址解析实例（GOT、PLT）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><a href="http://blog.csdn.net/absurd/archive/2008/10/28/3169860.aspx" target="_blank">http://blog.csdn.net/absurd/archive/2008/10/28/3169860.aspx</a><br></p><p>我们知道函数名就是一个内存地址，这个地址指向函数的入口。调用函数就是压入参数，保存返回地址，然后跳转到函数名指向的代码。问题是，如果函数在共享库中，共享库加载的地址本身就不确定，函数地址也就不确定了，那如何调用共享库中的函数呢？这就是本文要回答的。</p><p>我们先来看一小段代码(test.c)：</p>#include &lt;stdio.h&gt;<br><br><strong>void</strong> hello_world(<strong>void</strong>)<br>{<br>    printf(&quot;Hello world!n&quot;);<br><br> <strong>return</strong>;<br>}<br><br><strong>int</strong> main(<strong>int</strong> argc, <strong>char</strong><em> argv[])<br>{<br>    hello_world();<br><br> <strong>return</strong> 0;<br>}<p>编译并反汇编：</p><p>gcc -g test.c -o test<br>objdump -S test</p><strong>void</strong> hello_world(<strong>void</strong>)<br>{<br> 80483b4:       55                      push   %ebp<br> 80483b5:       89 e5                   mov    %esp,%ebp<br> 80483b7:       83 ec 08                sub    $0x8,%esp<br>        printf(&quot;Hello world!n&quot;);<br> 80483ba:       c7 04 24 b4 84 04 08    movl   $0x80484b4,(%esp)<br> 80483c1:       e8 2a ff ff ff          call   80482f0 &lt;puts@plt&gt;<br><br> <strong>return</strong>;<br>}<br> 80483c6:       c9                      leave<br> 80483c7:       c3                      ret<br><br>080483c8 &lt;main&gt;:<br><br><strong>int</strong> main(<strong>int</strong> argc, <strong>char</strong></em> argv[])<br>{<br> 80483c8:       8d 4c 24 04             lea    0x4(%esp),%ecx<br> 80483cc:       83 e4 f0                and    $0xfffffff0,%esp<br> 80483cf:       ff 71 fc                pushl  -0x4(%ecx)<br> 80483d2:       55                      push   %ebp<br> 80483d3:       89 e5                   mov    %esp,%ebp<br> 80483d5:       51                      push   %ecx<br> 80483d6:       83 ec 04                sub    $0x4,%esp<br>        hello_world();<br> 80483d9:       e8 d6 ff ff ff          call   80483b4 &lt;hello_world&gt;<br><br> <strong>return</strong> 0;<br> 80483de:       b8 00 00 00 00          mov    $0x0,%eax<br>}<p>调用hello_world时，汇编代码对应于call   80483b4 &lt;hello_world&gt;，这是个绝对地址。hello_world是在可执行文件中，可执行文件是加载到一个固定地址的，因此hello_world的地址是确定的。</p><p>调用printf时，汇编代码对应于call   80482f0 &lt;puts@plt&gt;，这是个绝对地址。但函数名却是puts@plt，这是怎么回事呢？puts@plt显然是编译器加的一个中间函数，我们看一下这个函数对应的汇编代码：</p>080482f0 &lt;puts@plt&gt;:<br> 80482f0:   ff 25 2c 96 04 08       jmp    <em>0x804962c<br> 80482f6:   68 10 00 00 00          push   $0x10<br> 80482fb:   e9 c0 ff ff ff          jmp     &lt;_init+0x30&gt;<p>现在我们用调试器分析一下：</p><p>gdb test</p><p>(gdb) b main<br>Breakpoint 1 at 0×80483d9: file test.c, line 12.<br>(gdb) r<br>Starting program: /root/test/plt/test</p><p>Breakpoint 1, main () at test.c:12<br>12 hello_world();</p><p>puts@plt先跳到</p></em>0×804962c，我们看看<em>0×804962c里有什么？<br>(gdb) x 0×804962c<br>0×804962c &lt;_GLOBAL_OFFSET<em>TABLE</em>+20&gt;:   0×080482f6<p></p><p></p></em>0×804962c等于0×080482f6，这正是puts@plt中的第二行汇编代码的地址。也就是说puts@plt整个函数会顺序执行，直到跳转到0×80482c0.<p></p><p>再来看看0×80482c0处有什么，通过汇编可以看到：<br>ff 25 20 96 04 08 jmp    <em>0×8049620</em></p><p>又跳到了0×8049620，转的弯真多，没关系，我们再看<em>0×8049620：<br>(gdb) x 0×8049620<br>0×8049620 &lt;_GLOBAL_OFFSET<em>TABLE</em>+8&gt;:    0×009ce4c0<br>(gdb) x /wa 0×009ce4c0<br>0×9ce4c0 &lt;_dl_runtime_resolve&gt;: 0×8b525150</em></p><p>原来转来转去就是为了调用函数_dl_runtime_resolve， _dl_runtime_resolve的功能就是找到要调用函数(puts)的地址。</p><p>为什么不直接调用_dl_runtime_resolve，而要转这么多圈子呢？</p><p>先执行完这个函数hello_world：<br>(gdb) n</p><p>再回头来看看puts@plt的第一行代码：</p><p>80482f0:   ff 25 2c 96 04 08 jmp    0×804962c</p><p>(gdb) x 0×804962c<br>0×804962c &lt;_GLOBAL_OFFSET<em>TABLE</em>+20&gt;:   0xa39a60 &lt;puts&gt;<br>对比前面的:<br>(gdb) x 0×804962c<br>0×804962c &lt;_GLOBAL_OFFSET<em>TABLE</em>+20&gt;:   0×080482f6</p><p>也就是说第一次执行时，通过_dl_runtime_resolve解析到函数地址，并保存puts的地址到0×804962c里，以后执行时就直接调用了。</p><br><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/29/【zz】共享库函数地址解析实例（GOT、PLT）/" class="archive-article-date">
  	<time datetime="2008-10-29T09:14:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-29</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】Android-is-now-available-as-open-source" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/29/【zz】Android-is-now-available-as-open-source/">【zz】Android is now available as open source</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>介绍得很有水平啊，特别是对开发人员，很有吸引力<br><br><a target="_blank" href="http://source.android.com/posts/opensource">http://source.android.com/posts/opensource</a><br><br>Today is a big day for Android, the Open Handset Alliance, and the open-source community.  All of the work that we’ve poured into the mobile platform is now officially available, for free, as the Android Open Source Project.<br><br>You’ll be hearing a lot about Android devices.  We’ve all put a lot of effort into the first Android device, and I’m really happy with the way it turned out.  But one device is just the beginning.<br><br>Android is not a single piece of hardware; it’s a complete, end-to-end software platform that can be adapted to work on any number of hardware configurations.  Everything is there, from the bootloader all the way up to the applications.  And with an Android device already on the market, it has proven that it has what it takes to truly compete in the mobile arena.<br><br>Even if you’re not planning to ship a mobile device any time soon, Android has a lot to offer.  Interested in working on a speech-recognition library?  Looking to do some research on virtual machines?  Need an out-of-the-box embedded Linux solution?  All of these pieces are available, right now, as part of the Android Open Source Project, along with graphics libraries, media codecs, and some of the best development tools I’ve ever worked with.<br><br>Have a great idea for a new feature?  Add it!  As an open source project, the best part is that anyone can contribute to Android and influence its direction.  And if the platform becomes as ubiquitous as I hope it will, you may end up influencing the future of mobile devices as a whole.<br><br>This is an exciting time for Android, and we’re just getting started.  It takes a lot of work to keep up with the changes in the mobile industry.  But we want to do more than just keep up;  we want to lead the way, to try things out, to add the new features that everyone else is scrambling to keep up with.  But we can’t do it without your help.<br><br>What will you do with Android? </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/29/【zz】Android-is-now-available-as-open-source/" class="archive-article-date">
  	<time datetime="2008-10-29T08:59:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-29</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Google/">Google</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-使用Pidgin登录校内通" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/28/使用Pidgin登录校内通/">使用Pidgin登录校内通</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 由于校内通使用的是开放协议，在Pidgin中可以通过XMPP协议登录，登录方法如下：<br>打开Pidgin，在&ldquo;帐户&rdquo;中点击&ldquo;Manage Accounts (或者用快捷键 Ctrl + A),点击&ldquo;添加&rdquo;，<br>协议 选择 XMPP<br>用户名 是你打开小内网主页时 <a href="http://xiaonei.com/getuser.do?id=*********" target="_blank" rel="external">http://xiaonei.com/getuser.do?id=*********</a> id后面的那一串类似于QQ号的数字<br>域名 www.xiaonei.com<br><br>点击&ldquo;高级选项&rdquo;<br>连接服务器 talk.xiaonei.com<br><br>其他选项不用改，保存登录即可，第一次登录时有个证书验证，点击&ldquo;接受&rdquo;即可。 </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/28/使用Pidgin登录校内通/" class="archive-article-date">
  	<time datetime="2008-10-28T01:35:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-28</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Mount-VMware-Disk-Images-under-Linux-using-vmware-mount-vmware-loop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/27/Mount-VMware-Disk-Images-under-Linux-using-vmware-mount-vmware-loop/">Mount VMware Disk Images under Linux, using vmware-mount/vmware-loop</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <del>my</del><br><br>1.下载Linux版的vmware，我们需要用到tar包里的bin/vmware-loop和bin/vmware-mount.pl<br>jfo@jfo-laptop:~$ tar xvf VMware.Workstation.v5.5.1.19175.Linux.tar.gz  ./vmware-distrib/bin<br><br><br>2.假设Windows下的虚拟机位于&quot;/host/Virtual OS/Redhat9/&quot;目录下，其Disk文件为Red Hat Linux.vmdk（Windows下和Linux下Disk文件通用），虚拟机配置文件为Red Hat Linux.vmx，需要建立一个指向这个配置文件的连接：<br>jfo@jfo-laptop:~$ sudo ln -sv &quot;/host/Virtual OS/Redhat9/Red Hat Linux.vmx&quot; /etc/vmware/config<br><br><br>3.添加一行内容：<br>jfo@jfo-laptop:~$ echo ‘loop.fullpath=&quot;/home/jfo/vmware-distrib/bin/vmware-loop&quot;’ &gt;&gt; /etc/vmware/config<br><br><br>4.运行vmware-mount.pl<br><br>jfo@jfo-laptop:~/vmware-distrib/bin$ ./vmware-loop -p &quot;/host/Virtual OS/Redhat9/Red Hat Linux.vmdk&quot;<br><br>——————————————————————-<br>Virtual Hard Disk to Network Block Device mapper<br>Version: Releasebuild-19175<br>Copyright 1998-2003 VMware, Inc.  All rights reserved.<br>——————————————————————-<br><br>Nr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Size Type Id Sytem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>– ———- ———- —- – ————————<br> 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  63&nbsp;&nbsp;&nbsp;&nbsp;  208782 BIOS 83 Linux<br> 2&nbsp;&nbsp;&nbsp;&nbsp;  208845&nbsp;&nbsp;  15518790 BIOS 83 Linux<br> 3&nbsp;&nbsp;  15727635&nbsp;&nbsp;&nbsp;  1044225 BIOS 82 Linux swap<br><br>jfo@jfo-laptop:~$ sudo ~/vmware-distrib/bin/vmware-mount.pl &quot;/host/Virtual OS/Redhat9/Red Hat Linux.vmdk&quot; 2 ~/test/<br><br>vmware-mount.pl脚本实际上在/dev/目录下创建Network Block Device：<br>/dev/nb0: block special (43/0)<br>/dev/nbd0:  block special (43/0)<br>/dev/nbd1:  block special (43/1)<br><br><br>5.现在~/test/目录下就是VMware Disk Images的内容了<br><br><br>6.直接使用vmware-loop<br>vmware-mount.pl只是对vmware-loop做了一个wrap，当然也可以直接用vmware-loop<br>jfo@jfo-laptop:~$ sudo ~/vmware-distrib/bin/vmware-loop &quot;/host/Virtual OS/Redhat9/Red Hat Linux.vmdk&quot; 2 /dev/nbd3<br>jfo@jfo-laptop:~$ sudo mount /dev/nbd3 ~/test<br><br><br><br><del>my</del><br><br><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#what" target="_blank">http://www.vmware.com/support/reference/linux/loopback_linux.html#what</a><br><a href="http://legroom.net/2007/08/05/how-mount-vmware-disk-images-under-linux" target="_blank">http://legroom.net/2007/08/05/how-mount-vmware-disk-images-under-linux</a><br><br>Accessing    Virtual Hard Disks Outside of VMware Workstation for Linux       <ol> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#overview" target="_blank" rel="external">Overview</a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#what" target="_blank" rel="external">What is <tt>vmware-mount.pl</tt>?</a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#reqs" target="_blank" rel="external">Requirements to run <tt>vmware-mount</tt></a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#howto" target="_blank" rel="external">How to use <tt>vmware-mount</tt></a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#note" target="_blank" rel="external">Notes for advanced users</a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#trouble" target="_blank" rel="external">Troubleshooting</a></li> <li><a href="http://www.vmware.com/download/downloadaddons.html" target="_blank" rel="external">Download    </a></li> <li><a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#problems" target="_blank" rel="external">Known Problems</a></li></ol></p><p><br><a name="overview"></a> <strong>Overview</strong></p><p>The easiest way to read or write files on a hard disk of a virtual machine    is to start VMware Workstation, boot the virtual machine, then use a floppy disk drive    or the network file system protocols (NFS, SMB/CIFS, etc.) to exchange data    via your physical machine.</p><p>Sometimes, the amount of data you want to transfer is too large for a    floppy, you don’t have the appropriate driver to run the network inside the    virtual machine, or you cannot run a virtual machine because your license    has expired  For these reasons, you need a way to access the hard    disk of the virtual machine directly from the host operating system,    without having to run VMware Workstation.</p><p>When the hard disk of the virtual machine is a raw device or a raw disk    (see <a href="http://www.vmware.com/support/reference/linux/osonpartition_linux.html" target="_blank" rel="external">Installing    an Operating System onto a Raw Partition from a Virtual Machine</a> or <a href="http://www.vmware.com/support/reference/linux/rawdevices_linux.html" target="_blank" rel="external">Configuring    Dual/Multiboot Systems to Run With VMware Workstation</a>), the problem is already    solved: you can access the partition the same way you would access any other    partition by first mounting it to a directory, then browsing the directory.</p><p>But when the hard disk of the virtual machine is a virtual disk (which    is just a file when seen from your host operating system), you need the    help of a program called <tt>vmware-mount.pl</tt>.  This document describes    how to use this program.</p><p><a name="what"></a> <strong>What is <tt>vmware-mount</tt>?</strong></p><p><tt>vmware-mount</tt> is a program that runs on the host operating system.    It makes a virtual disk file appear as a hard disk to the operating system.</p><p><a name="reqs"></a> <strong>Requirements to run <tt>vmware-mount</tt></strong></p><p><tt>vmware-mount</tt> requires a Linux kernel version 2.1.101 or higher    (including the stable 2.2.x series) because this version introduced the    concept of network block devices, which is heavily used by    <tt>vmware-mount</tt>.  <tt>vmware-mount</tt> is available as an add-on to    VMware Workstation for Linux for both evaluation users and licensed customers. To    install <tt>vmware-mount</tt>:</p><ol> <li><a href="http://www.vmware.com/download/downloadaddons.html" target="_blank" rel="external">Download the file</a></li> <li>Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <tt>su [ROOT PASSWORD]</tt></li> <li>Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <tt>tar zxvf    vmware-mount-addonXXX.tar.gz</tt></li> <li>Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <tt>cd vmware-mount-addonXXX</tt></li> <li>Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <tt>./addon-install.pl</tt></li></ol><p><a name="howto"></a> <strong>How to Use <tt>vmware-mount.pl</tt></strong></p><p>Say, for example, that your virtual hard disk file is    <tt>~/vmware/vhd.dsk</tt>. Follow these steps:</p><ol> <li>Become root:<br>    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    <tt>su</tt> <p> </p> </li> <li>Determine the partition of the virtual hard disk to export: Issue the    following command to print the partition table of the virtual hard disk:<br> <tt>       &nbsp;&nbsp;    vmware-mount.pl -p ~/vmware/vhd.dsk</tt><br> <p> </p>    ——————————————–<br>  VMware Workstation for Linux - Virtual Hard Disk Mounter<br>      Copyright (C) 1999 VMware, Inc.<br>  ——————————————–<br> <br>  Nr Start    Size      Id Sytem<br>  – ——– ——— – ——————-<br>  1  63       4092417   C  Win95 FAT32 (LBA)    <p>Now, find the partition number (first column) you want to export. Let’s    say it is 1.</p> <p> </p> </li> <li>Mount the disk partition on a directory. Let’s say you want to mount    your partition on the directory <tt>/mnt/vhd</tt>. Issue the following    command:<br> <tt>       &nbsp;&nbsp;    vmware-mount.pl ~/vmware/vhd.dsk 1 /mnt/vhd</tt><br> <p> </p>    ——————————————–<br>  VMware Workstation for Linux - Virtual Hard Disk Mounter<br>     Copyright (C) 1999 VMware, Inc.<br>  ——————————————–<br> <br>  Network Block Device driver detected.<br> <br>  Trying to map the partition to the /dev/nb0 Network<br>  Block Device..  Success.<br> <br>  You can now browse your Virtual Hard Disk partition<br>  in /mnt/vhd  Hit Control-C in this terminal when done.    <p>You can now browse <tt>/mnt/vhd</tt> as usual. It works as if a physical    device were mounted on the directory  When you are finished, simply kill    <tt>vmware-mount.pl</tt> by typing Ctrl-C in its terminal.</p> </li></ol><p><a name="note"></a> <strong>Notes for Advanced Users</strong></p><p>By using the <tt>vmware-loop</tt> binary directly, you can map the partition    of a virtual hard disk to any network block device (which you can then    mount). This mapping can be done in read-only mode if you use the <tt>-r</tt>    command line option of <tt>vmware-loop</tt>.</p><p>Currently, a virtual hard disk can not be accessed in read/write mode by more    than one application (VMware Workstation or vmware-mount for example) at a time.</p><p><a name="trouble"></a> <strong>Troubleshooting</strong></p><p><strong><tt>vmware-mount</tt> claims that my Linux kernel is too old</strong></p><p>See the Requirements section.  You need to upgrade to a newer kernel.  To    do so, the easiest way is to upgrade your Linux distribution (installing    the package corresponding to the most recent kernel). If you are    able, you can also grab the latest kernel sources and compile your own    kernel.  Take a kernel version 2.1.101 or higher and set the    CONFIG_BLK_DEV_NBD option (which you can find under Block devices &gt;    Network block device support) to &quot;y&quot; or &quot;m&quot;  If you    don’t want to mess with kmod (the kernel module loader formerly known as    kerneld), we recommend to use &quot;y&quot;.</p><p>Once you have rebooted your new kernel, rerun <tt>vmware-mount.pl</tt>.</p><p><strong><tt>vmware-mount</tt> keeps saying that it cannot open my virtual hard    disk because it is locked by other VMs. What does that mean?</strong></p><p>See the Notes for Advanced Users section. <tt>vmware-mount.pl</tt> has    detected that several applications (VMware Workstation or <tt>vmware-mount.pl</tt>)    are trying to access your virtual disk at the same time.  First, be sure    that this is not true  If you are certain that two processes (including    processes running on some remote machine) are not trying to simultaneously    access your virtual hard disk, then it is probably a stale lock that    hasn’t been cleaned up as it should have been. You can remove it safely.</p><p>If you experience further problems, please <a href="http://www.vmware.com/fileincident" target="_blank" rel="external">file a report</a>.   Be sure to select the &quot;vmware-mount&quot; category, and to include the    output of your session with your report.</p><p><br><a name="problems"></a> <strong>Known Problems</strong></p><p>Under severe load, your host operating system may hang (lock solid) if   you are <strong>writing</strong> to a virtual disk using <tt>vmware-mount.pl</tt>.    VMware is aware of the problem and is working on a solution.</p><p>To avoid this problem, either use the read-only mode (see    <a href="http://www.vmware.com/support/reference/linux/loopback_linux.html#note" target="_blank" rel="external">Notes for Advanced Users</a>) or try to limit the    throughput of data you write to your virtual disk.</p><br><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/27/Mount-VMware-Disk-Images-under-Linux-using-vmware-mount-vmware-loop/" class="archive-article-date">
  	<time datetime="2008-10-27T11:29:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-27</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-App/">Linux App</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】2-4-18和2-6-25-4-rt在任务调度上的不同" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/27/【zz】2-4-18和2-6-25-4-rt在任务调度上的不同/">【zz】2.4.18和2.6.25.4-rt在任务调度上的不同</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a target="_blank" href="http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK&amp;Number=693202&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1"><br>http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK&amp;Number=693202&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1</a><br><br><br>2.4.18和2.6.25.4-rt在任务调度上的不同<br><br>检查点:<br>A) 返回用户空间/返回内核空间:<br>—-2.4 :只在返回user space的时候才会检查任务是否需要被调度.<br>—-2.6:除了保留这个检查点,新增了返回内核空间的检查点, 这个检查点调用preempt_schedule_irq,这就是抢占式调度. 2.6中调用<strong>schedule前有个关键的操作, add_preempt_count(PREEMPT_ACTIVE),这标志这此schedule是抢占式调度,</strong>schedule 通过PREEMPT_ACTIVE这个标志知道这是一次抢占. <br>返回内核空间的时候只有peeempt_count==0才能够抢占当前进程. 2.6在返回用户空间的时候检查两个标志:TIF_NEED_RESCHED和新增的TIF_NEED_RESCHED_DELAYED, 而返回内核空间只检查TIF_NEED_RESCHED.<br><br>B)内核中的其他检查点<br>这些剩余的检查点分散在diver/mm和fs的一些地方, 这些检查点,能够提高内核的响应速度,这种加查点加速了对当前需要调度的进程的调度速度,而不是只有在返回user space/kernel space的时候才检查.<br>—-2.4: 比较单纯,就是检查current-&gt;need_resched (TASK_NEED_RESCHED),然后调用schedule.<br>—-2.6: 有两种检查点,TIF_NEED_RESCHED和新增的TIF_NEED_RESCHED_DELAYED.主要区别在A)中已有叙述.另一而主要区别是2.6中扩展了很多抢占式的检查点.<br>TIF_NEED_RESCHED:返回user space和返回kernel space都要检查.need_resched()也只检查这个标志. 而这个标记实现的检查点又有两种途径:<br>a)通过preempt_check_resched 实现的检查点,进行的是抢占式调度. 然后直接调用,和通过unlock spin,bh,rwlock这些函数（调用preempt_enable时）广泛分布到内核各个地方，会调用preempt_schedule.<br>b)通过need_resched()实现的检查点: 这个途径实现的检查点一部分是非抢占式调度,另一部分是抢占式调度,抢占式的检查点都是调用的cond_resched实现的(下面再详细分析这个函数).直接通过need_resched()来调用schedule和cond_resched的地方不是特别多.<br>c)直接在一些路径调用cond_resched实现的抢占式检查点.<br>TIF_NEED_RESCHED_DELAYED: 这个是RT linux patches set进行的扩展, 对应一个need_resched_delayed,然而几乎没有通过这个检查函数实现的检查点. 而preempt_check_resched_delayed()通过被wait queue的<strong>wake_up和complete间接的被广泛应用.<br><br><br>trigger :对应检查点,必须有地方trigger上述的检查点.<br>—- 2.4.18<br>2.4中trigger比较有限. 最重要的是时钟中断的update_process_times, 监视p-&gt;counter,等进程消耗完时间片就触发对这个进程的一次调度,其次就是 </strong>schedule_tail-&gt;reschedule_idle 在每次调度完成之后试图给prev找到一个合适的CPU去运行, 通过IPI触发另外一个cpu重新调度. 还有就是较少运行的sys_sched_yield,setscheduler.<br><br>—-2.6.25.4-rt3<br>TIF_NEED_RESCHED :<br>设置这个标志的函数主要有两个: resched_task(),set_tsk_need_resched().主要是resched_task,而resched_task的调用者 check_preempt_curr更是通过:try_to_wake_up/wake_up_new_task/pull_task /__migrate_task 这些被广泛使用的函数, 从而分布在内核中大量的检查点有机会抢占进程.<br>对应2.4, 最典型的trigger点是hrtick()-&gt;curr-&gt;sched_class-&gt;task_tick-&gt;..-&gt;set_tsk_need_resched.<br>TIF_NEED_RESCHED_DELAYED:<br>对应这个检查点的trigger几乎没有. 看来要fade out了.<br><br><br>直接调用schedule:<br>区别不大.<br>cond_resched:这个函数在内核实现很多检查点:<br>当前进程需要被抢占,且不是处PREEMPT_ACTIVE的环境下,即防止schedule() -&gt; reacquire_kernel_lock() -&gt; down() -&gt; might_sleep()-&gt;cond_resched这个循环. 参考<br><a href="http://mail.nl.linux.org/kernelnewbies/2007-02/msg00311.html" target="_blank" rel="external">http://mail.nl.linux.org/kernelnewbies/2007-02/msg00311.html</a><br><br><br><br><br><br><br><del>end</del> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/27/【zz】2-4-18和2-6-25-4-rt在任务调度上的不同/" class="archive-article-date">
  	<time datetime="2008-10-26T17:07:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-27</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】linux-2-6-25-4-PREEMPT-RT简介" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/27/【zz】linux-2-6-25-4-PREEMPT-RT简介/">【zz】linux-2.6.25.4 PREEMPT_RT简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><a href="http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK&amp;Number=700000&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1" target="_blank">http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK&amp;Number=700000&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1</a><br></p><p>link: hylpro.cublog.cn <br><br>1. 2.6.25.4-rt <br><br>下载内核和rt-linux 补丁 <br><a href="http://www.kernel.org/pub/linux/kernel/projects/rt/patch-2.6.25.4-rt6.bz2" target="_blank">http://www.kernel.org/pub/linux/kernel/projects/rt/patch-2.6.25.4-rt6.bz2</a> <br><a href="http://www.cn.kernel.org/pub/linux/kernel/v2.6/linux-2.6.25.4.tar.bz2" target="_blank">http://www.cn.kernel.org/pub/linux/kernel/v2.6/linux-2.6.25.4.tar.bz2</a> <br><br>在解压缩后的内核目录,用下面命令把补丁打上: <br>patch -p1 -i patch-2.6.25.4-rt6  <br>其主要修改的文件是: rcu/rtmutex/sched/lockdep/trace/arch/driver… <br><br><br>2. preempt_rt 实现简介 <br><br>Ingo Molnar 带领一干人等,维护rt linux patch. 打完补丁后除了raw_spinlock 不容许抢占外,几乎所有内核代码都容许被抢占.主要途径 <br>就是吧内核的大部分spinlock替换成支持PI的rt-mutexes,并把中断和软中断改造成内核线程.PI: priority inheritance, <br><br><br>a)Preemptible critical sections <br>普通的spinlocks,rwlock_t, 以及RCU read 操作容许抢占.以spin lock为例,打过补丁后spinlock分成两种:spinlock_t和 <br>raw_spinlock_t. raw_spinlock_t就是原来的spinlock, spinlock_t则被替换成rt_mutex. <br>以下面的spin_lock为例 <br>#define spin_lock(lock) PICK_SPIN_OP(<strong>spin_lock, _spin_lock, lock) <br>#define spin_lock_irq(lock) PICK_SPIN_OP(</strong>spin_lock_irq, _spin_lock_irq, lock) <br>#define spin_lock_bh(lock) PICK_SPIN_OP(<strong>spin_lock_bh, _spin_lock_bh, lock) <br><br>PICK_SPIN_OP 根据lock的类型选择对应的函数, 如果是raw_spinlock_t就选用前一个函数, 否则用后一个.  <br><br>下面是spinlock_t选用的函数: <br><br>#ifdef CONFIG_PREEMPT_RT <br># define _spin_lock(l)            rt_spin_lock(l) <br># define _spin_lock_nested(l, s)    rt_spin_lock_nested(l, s) <br># define _spin_lock_bh(l)        rt_spin_lock(l) <br># define _spin_lock_irq(l)        rt_spin_lock(l) <br><br>通过上面的代码片断,可以看到, spin_lock_irq/bh 都使用了同一个函数:rt_spin_lock, 深入进去, _spin_lock_irq就根本没有关中断. <br><br>void </strong>lockfunc rt_spin_lock(spinlock_t <em>lock) <br>{ <br>spin_acquire(&amp;lock-&gt;dep_map, 0, 0, _RET<em>IP</em>); <br>LOCK_CONTENDED_RT(lock, rt_mutex_trylock, __rt_spin_lock); <br>} <br>而raw_spinlock_t则对应于原来的实现. <br><br><br>spin_lock成为可抢占代码后, 某些关键路径如果不能容许使用这种spinlock: 如preemption已经被禁止,或者irq是disable的时候(这些情况下再使用可以被抢占的代码显然不合适: 进程已经明确要求经禁抢占了,还(有可能)强行调度当前进程显然比较操蛋.) <br><br><br>万一这种情况无可避免,就使用raw_spinlock_t来代替spinlock_t即可.(上面分析了,使用raw格式的spin, 保持其原有含义). 不过这种情况实属例外,一般除了底层的scheduler,RCU,体系相关代码用不着如此. <br><br><br><br>另一个问题是,spinlock_t所保护的代码现在可以抢占了,有可能迁徙到其他cpu去执行,这样per cpu的变量就要注意了:在spinlock_t保护下的per-cpu变量需要明确的禁止抢占,或者使用 DEFINE_PER_CPU_LOCKED()来定义per cpu var,通过get_cpu_var_locked来操作per cpu变量(呵呵,per cpu现在也锁上了). <br><br><br>Ingo Molnar 指出, 如下情况, blah函数会发现当前任务状态变成了running, 这是因为sched函数会唤醒进程的时候把进程状态重新置为running. <br><br>spin_lock(&amp;mylock1); <br>current-&gt;state = TASK_UNINTERRUPTIBLE; <br>spin_lock(&amp;mylock2); //</em></p><br>blah(); <br>spin_unlock(&amp;mylock2); <br>spin_unlock(&amp;mylock1); <br><br>解决的办法是, 在sping lock 加锁睡眠的时候保存任务状态(rt_spin_lock_slowlock),然后由于rtmutex而被唤醒的进程任务状态被置为mutex running(wakeup_next_waiter-&gt;wake_up_process_mutex),而slowlock过程根据被唤醒后的 任务的状态决定是恢复保存的状态还是设置成TASK_RUNNING(见rt_spin_lock_slowlock). <br><br><br><br>b)Preemptible interrupt handlers <br><br>在PREEMPT_RT环境下,大部分中断运行在 process context环境, 是进程化了的中断. 可以指定中断处理函数的 SA_NODELAY属性从而使得中断处理函数依然处于interrupt context, 但是实际上只有fpu_irq(浮点), irq0(per cpu的timer中断), irq2, lpptest(中断延迟测定)指定这个属性. 只有per cpu timer属于经常性使用的. software timer (add_timer() and friends) 不运行在hardware interrupt context上而是运行于process context,是可抢占的. <br><br>指定SA_NODELAY 会增加很多延迟,要小心对待,不然很容易oops, deadlock. <br><br>per-CPU timer interrupt (e.g., scheduler_tick()) 运行于hardware-interrupt context,和process-context code 互斥需要用raw spinlocks (raw_spinlock_t or raw_rwlock_t), 进程端必须用_irq 类型的spin lock.和NO_DELAY硬件中断共享的per-CPU 变量在进程端也要关中断进行保护. <br><br><br>C) Preemptible &quot;interrupt disable&quot; code sequences <br><br>这个奇怪的提法是因为PREEMPT_RT的逻辑:针对spinlcok_t的spin_lock_irq并不关中断,在RT环境下,大部分中断作为一个进程来运行.和中断处理打交道的进程需要考虑到中断处理函数可能运行在另外一个cpu上. <br><br>spin_lock_irqsave() 和其他相关原语也不必要disable preemption:如果中断处理抢占了一个持有spinlock_t进的程,当这个中断处理函数试图获取这个锁的时候也会马上block,临界区依然得到保护. <br><br>local_irq_save也有禁止抢占的作用, 所以用spinlcok_t代替local_irq_save() 可以减少调度的延迟但是会降低SMP的效率. <br><br>在RT环境下和SA_NODELAY类型的中断处理函数打交道需要使用raw_spin_lock/raw_xxxx ,但是需要注意raw类型的应该仅仅用在scheduler, architecture-dependent code,  RCU 就可以了. <br><br><br>(似乎早期RT patches local_irq_save也不关中断(??),仅仅关闭抢占而已, 新内核lock_irq_save == raw_lock_irq_save,就是多了hard irq trace的功能, 另外加了local_irq_save_rt/nort这些宏) <br><br>D) Priority inheritance for in-kernel spinlocks and semaphores <br>优先级继承适合于Rt kenrel下消除优先级翻转.对于spin_lock锁, 优先级翻转较为容易处理. <br><br><br>但是对于 writer-2-readers 的优先级继承就很有问题: 比如一个rw lock被多个readers read_lock, 然后每个reader都block 到一个rw lock,并且他们试图write_lock这个锁, 然而这个锁被许多reader read_lock住…. 这是个级数增长的过程, 几乎无解. RT kernel 简化这个问题,同一时间只容许一个任务read_hold一个reader-writer lock, 或者semaphore. <br><br><br><br>另外一个特殊情况是,semaphores 有时做PI反而坏事,比如sem被用于event,而不是锁, 因为你补知道谁将give 锁(sem用做事件时和lock相反:先block上, 这样没办法去PI, 我们只能在block on时才boost. 所以,这种情况下使用compat_semaphore,compat_rw_semaphore 这些变种. <br><br><br>E) Deferred operations <br><br>由于spin_lock() 可以sleep, 所以抢占禁止的时候不能调用这些函数,一些情况下这个由延迟处理来解决: <br><br> put_task_struct_delayed() 把put_task_struct()个函数放到一个队列中,直到可以调用spin_lock时才执行. <br><br><em> mmdrop_delayed() : 就是mmdrop() 的queue… <br><br></em> TIF_NEED_RESCHED_DELAYED : <br>这里顺带解释下TIF_NEED_RESCHED: 这个要从调度谈起. <br><br><br><br>Latency-reduction measures <br><br>There are a few changes in PREEMPT_RT whose primary purpose is to reduce scheduling or interrupt latency. <br><br>The first such change involves the x86 MMX/SSE hardware. This hardware is handled in the kernel with preemption disabled, and this sometimes means waiting until preceding MMX/SSE instructions complete. Some MMX/SSE instructions are no problem, but others take overly long amounts of time, so PREEMPT_RT refuses to use the slow ones. <br><br>The second change applies per-CPU variables to the slab allocator, as an alternative to the previous wanton disabling of interrupts. <br><br><br><br><br><br>参考资料: <br><br><a href="http://rt.wiki.kernel.org/index.php/CONFIG_PREEMPT_RT_Patch" target="_blank">http://rt.wiki.kernel.org/index.php/CONFIG_PREEMPT_RT_Patch</a>  简介 <br><a href="http://lwn.net/Articles/146861/" target="_blank">http://lwn.net/Articles/146861/</a>  A realtime preemption overview by Paul McKenney <br><a href="http://www.ibm.com/developerworks/cn/linux/l-real-time-linux/" target="_blank">http://www.ibm.com/developerworks/cn/linux/l-real-time-linux/</a>  实时linux的几种类型      <br><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/27/【zz】linux-2-6-25-4-PREEMPT-RT简介/" class="archive-article-date">
  	<time datetime="2008-10-26T16:33:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-27</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Linux-RCU-Read-Copy-Update" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/25/Linux-RCU-Read-Copy-Update/">Linux RCU (Read-Copy Update)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><del>my</del><br><br>读者在访问被RCU保护的共享数据期间不能被阻塞,这是RCU机制得以实现的一个基本前提,也就说<br>当读者在引用被RCU保护的共享数据期间,读者所在的CPU不能发生上下文切换(不能主动阻塞(block)，<br>如等待某个资源；也不能被抢占(preempt)),  spinlock和rw lock都<br>需要这样的前提。写者在访问被RCU保护的共享数据时不需要和读者竞争任何锁,只有在有多于一个<br>写者的情况下需要获得某种锁以与其他写者同步。写者修改数据前首先拷贝一个被修改元素的副本,<br>然后在副本上进行修改,修改完毕后它向垃圾回收器注册一个回调函数以便在适当的时机执行真正的<br>修改操作。等待适当时机的这一时期称为grace period,而CPU发生了上下文切换称为经历一个<br>quiescent state,grace period就是所有CPU都经历一次quiescent state所需要的等待的时间。垃圾收<br>集器就是在grace period之后调用写者注册的回调函数来完成真正的数据修改或数据释放操作的。<br><br>但如果打过 PREEMPT_RT 补丁，或是配置了 CONFIG_PREEMPT_RCU，read-side的critical sections<br>可以被抢占，因此quiescent state的确认还需要其他辅助机制，例如reference counts。<br><br>参考<br>Linux 2.6内核中新的锁机制–RCU  <a href="http://www.ibm.com/developerworks/cn/linux/l-rcu/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/l-rcu/</a><br>call_rcu()函数解析  <a href="http://blog.chinaunix.net/u1/55599/showart_1101879.html" target="_blank" rel="external">http://blog.chinaunix.net/u1/55599/showart_1101879.html</a><br><br><del>my</del><br><br><br>For more information, see <a href="http://www.rdrop.com/users/paulmck/RCU" target="_blank" rel="external">http://www.rdrop.com/users/paulmck/RCU</a><br><br>linux-2.6.24/Documentation/RCU/whatisRCU.txt<br><br>1.&nbsp;&nbsp;&nbsp;      RCU OVERVIEW<br>2.&nbsp;&nbsp;&nbsp;      WHAT IS RCU’S CORE API?<br>3.&nbsp;&nbsp;&nbsp;      WHAT ARE SOME EXAMPLE USES OF CORE RCU API?<br>4.&nbsp;&nbsp;&nbsp;      WHAT IF MY UPDATING THREAD CANNOT BLOCK?<br>5.&nbsp;&nbsp;&nbsp;      WHAT ARE SOME SIMPLE IMPLEMENTATIONS OF RCU?<br>6.&nbsp;&nbsp;&nbsp;      ANALOGY WITH READER-WRITER LOCKING<br>7.&nbsp;&nbsp;&nbsp;      FULL LIST OF RCU APIs<br>8.&nbsp;&nbsp;&nbsp;      ANSWERS TO QUICK QUIZZES<br><br><br>1.  RCU OVERVIEW<br><br>The basic idea behind RCU is to split updates into &quot;removal&quot; and<br>&quot;reclamation&quot; phases.  The removal phase removes references to data items<br>within a data structure (possibly by replacing them with references to<br>new versions of these data items), and can run concurrently with readers.<br>The reason that it is safe to run the removal phase concurrently with<br>readers is the semantics of modern CPUs guarantee that readers will see<br>either the old or the new version of the data structure rather than a<br>partially updated reference.  The reclamation phase does the work of reclaiming<br>(e.g., freeing) the data items removed from the data structure during the<br>removal phase.  Because reclaiming data items can disrupt any readers<br>concurrently referencing those data items, the reclamation phase must<br>not start until readers no longer hold references to those data items.<br><br>Splitting the update into removal and reclamation phases permits the<br>updater to perform the removal phase immediately, and to defer the<br>reclamation phase until all readers active during the removal phase have<br>completed, either by blocking until they finish or by registering a<br>callback that is invoked after they finish.  Only readers that are active<br>during the removal phase need be considered, because any reader starting<br>after the removal phase will be unable to gain a reference to the removed<br>data items, and therefore cannot be disrupted by the reclamation phase.<br><br>So the typical RCU update sequence goes something like the following:<br><br>a.&nbsp;&nbsp;&nbsp;      Remove pointers to a data structure, so that subsequent<br>&nbsp;&nbsp;&nbsp;      readers cannot gain a reference to it.<br><br>b.&nbsp;&nbsp;&nbsp;      Wait for all previous readers to complete their RCU read-side<br>&nbsp;&nbsp;&nbsp;      critical sections.<br><br>c.&nbsp;&nbsp;&nbsp;      At this point, there cannot be any readers who hold references<br>&nbsp;&nbsp;&nbsp;      to the data structure, so it now may safely be reclaimed<br>&nbsp;&nbsp;&nbsp;      (e.g., kfree()d).<br><br>Step (b) above is the key idea underlying RCU’s deferred destruction.<br>The ability to wait until all readers are done allows RCU readers to<br>use much lighter-weight synchronization, in some cases, absolutely no<br>synchronization at all.  In contrast, in more conventional lock-based<br>schemes, readers must use heavy-weight synchronization in order to<br>prevent an updater from deleting the data structure out from under them.<br>This is because lock-based updaters typically update data items in place,<br>and must therefore exclude readers.  In contrast, RCU-based updaters<br>typically take advantage of the fact that writes to single aligned<br>pointers are atomic on modern CPUs, allowing atomic insertion, removal,<br>and replacement of data items in a linked structure without disrupting<br>readers.  Concurrent RCU readers can then continue accessing the old<br>versions, and can dispense with the atomic operations, memory barriers,<br>and communications cache misses that are so expensive on present-day<br>SMP computer systems, even in absence of lock contention.<br><br>In the three-step procedure shown above, the updater is performing both<br>the removal and the reclamation step, but it is often helpful for an<br>entirely different thread to do the reclamation, as is in fact the case<br>in the Linux kernel’s directory-entry cache (dcache).  Even if the same<br>thread performs both the update step (step (a) above) and the reclamation<br>step (step (c) above), it is often helpful to think of them separately.<br>For example, RCU readers and updaters need not communicate at all,<br>but RCU provides implicit low-overhead communication between readers<br>and reclaimers, namely, in step (b) above.<br><br><br>2.  WHAT IS RCU’S CORE API?<br><br>The core RCU API is quite small:<br><br>a.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    rcu_read_lock()<br>b.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    rcu_read_unlock()<br>c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    synchronize_rcu() / call_rcu()<br>d.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    rcu_assign_pointer()<br>e.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    rcu_dereference()<br><br>There are many other members of the RCU API, but the rest can be<br>expressed in terms of these five, though most implementations instead<br>express synchronize_rcu() in terms of the call_rcu() callback API.<br><br>The five core RCU APIs are described below, the other 18 will be enumerated<br>later.  See the kernel docbook documentation for more info, or look directly<br>at the function header comments.<br><br>rcu_read_lock()<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    void rcu_read_lock(void);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Used by a reader to inform the reclaimer that the reader is<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    entering an RCU read-side critical section.  It is illegal<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    to block while in an RCU read-side critical section, though<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    kernels built with CONFIG_PREEMPT_RCU can preempt RCU read-side<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    critical sections.  Any RCU-protected data structure accessed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    during an RCU read-side critical section is guaranteed to remain<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    unreclaimed for the full duration of that critical section.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Reference counts may be used in conjunction with RCU to maintain<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    longer-term references to data structures.<br><br><br><br>==============================================================<br><br>linux-2.6.24/Documentation/RCU/UP.txt<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     What locking restriction must RCU callbacks respect?<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     Any lock that is acquired within an RCU callback must be<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     acquired elsewhere using an _irq variant of the spinlock<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     primitive.  For example, if &quot;mylock&quot; is acquired by an<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     RCU callback, then a process-context acquisition of this<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     lock must use something like spin_lock_irqsave() to<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     acquire the lock. (&lt;by jfo&gt; i.e. to disable interrupt)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     If the process-context code were to simply use spin_lock(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     then, since RCU callbacks can be invoked from softirq context,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     the callback might be called from a softirq that interrupted<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     the process-context critical section.  This would result in<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     self-deadlock.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     This restriction might seem gratuitous, since very few RCU<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     callbacks acquire locks directly.  However, a great many RCU<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     callbacks do acquire locks -indirectly-, for example, via<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     the kfree() primitive. (&lt;by jfo&gt; in kmalloc() and kfree(), local CPU’s interrupt are all disabled!)<br><br><br><br><br><del>end</del> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/25/Linux-RCU-Read-Copy-Update/" class="archive-article-date">
  	<time datetime="2008-10-25T07:22:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-25</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【C-C-】error-jump-to-case-label" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/23/【C-C-】error-jump-to-case-label/">【C/C++】error: jump to case label</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>problem<br><br>The following is not allowed:<br>switch (a)<br>{<br>&nbsp;&nbsp;&nbsp;    case 1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    int a = 6;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    //stuff<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    break;<br><br>&nbsp;&nbsp;&nbsp;    case 2:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    //stuff<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    break;<br>}<br><br>The following is allowed:<br>switch (a)<br>{<br>&nbsp;&nbsp;&nbsp;    case 1:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    int a = 6;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    //stuff<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    break;<br><br>&nbsp;&nbsp;&nbsp;    case 2:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    //stuff<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    break;<br>}<br><br><br><br>   Reason<br><br>The ‘jump’ in the error message is the computed goto effected by the switch statement. <br>When x = 1, the switch acts like this:<br>goto case_label_1;<br>// …<br>unsigned int y = ++ x;<br>// …<br>case_label_1:<br>// here y is uninitialized<br><br>The problem is that the initialization of y is skipped when x == 1.<br>When the &quot;case 1:&quot; label is reached, stack space has been allocated for<br>y but its value has not been initialized. This is not allowed.<br><br>The general way round this situation is to make the scope of y smaller<br>by adding braces:<br>switch (x)<br>{<br>default:<br>unsigned z; // this is OK since z is uninitialized<br>{<br>unsigned y = x + 1;<br>// …<br>}<br>case 1:<br>z = 2;<br>// …<br>// cannot refer to y here so no problem with y’s initialization<br>}<br><br><br> An error example from L4<br><br>user/serv/sigma0/sigma0.cc<br>static void init_mempool_from_kip (void)<br>{<br>&nbsp;&nbsp;&nbsp;    …<br><br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    switch (L4_MemoryDescType (md))<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    {<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_UndefinedMemoryType:<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_ConventionalMemoryType:<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    conv_memory_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_ReservedMemoryType:<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    alloc_pool.insert (low, high, kernel_id);<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_DedicatedMemoryType:<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    memory_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_SharedMemoryType:<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    alloc_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    default:<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    dprintf (0, &quot;s0: Unknown memory type (0x%x)n&quot;,<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;&nbsp;    (int) L4_MemoryDescType (md));<br>&nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    break;<br><br>&nbsp;&nbsp;&nbsp;    …<br>}<br><br># make<br>sigma0.cc: In function ‘void init_mempool_from_kip()’:<br>sigma0.cc:1060: error: jump to case label<br>sigma0.cc:1058: error:&nbsp;&nbsp;  crosses initialization of ‘L4_ThreadId_t &lt;anonymous&gt;’<br>sigma0.cc:1063: error: jump to case label<br>sigma0.cc:1058: error:&nbsp;&nbsp;  crosses initialization of ‘L4_ThreadId_t &lt;anonymous&gt;’<br>sigma0.cc:1068: error: jump to case label<br>sigma0.cc:1058: error:&nbsp;&nbsp;  crosses initialization of ‘L4_ThreadId_t &lt;anonymous&gt;’<br>sigma0.cc:1073: error: jump to case label<br>sigma0.cc:1058: error:&nbsp;&nbsp;  crosses initialization of ‘L4_ThreadId_t &lt;anonymous&gt;’<br>make: <em>*</em> [sigma0.o] Error 1<br><br><br>L4_anythread is defined as:<br>typedef union {<br>&nbsp;&nbsp;&nbsp;   L4_Word_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   raw;<br>&nbsp;&nbsp;&nbsp;   L4_GthreadId_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   global;<br>&nbsp;&nbsp;&nbsp;   L4_LthreadId_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   local;<br>} L4_ThreadId_t; <br><br>#define L4_nilthread&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ((L4_ThreadId_t) { raw : 0UL})<br>#define L4_anythread&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ((L4_ThreadId_t) { raw : ~0UL})<br><br><br>  The following will be right<br>static void init_mempool_from_kip (void)<br>{<br>&nbsp;&nbsp;&nbsp;    …<br><br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    switch (L4_MemoryDescType (md))<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    {<br>&nbsp;&nbsp;         &nbsp;&nbsp;    case L4_UndefinedMemoryType:<br>&nbsp;&nbsp;        &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_ConventionalMemoryType:<br>&nbsp;&nbsp;&nbsp;&nbsp;        &nbsp;&nbsp;        {<br>&nbsp;&nbsp;      &nbsp;&nbsp;   &nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;    conv_memory_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;           &nbsp;&nbsp;   &nbsp;&nbsp;            break;<br>&nbsp;&nbsp;&nbsp;&nbsp;     &nbsp;&nbsp;      }<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_ReservedMemoryType:<br> &nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;  alloc_pool.insert (low, high, kernel_id);<br> &nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;                break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_DedicatedMemoryType:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    {<br> &nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;             memory_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;      &nbsp;&nbsp;                break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    }<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    case L4_SharedMemoryType:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    {<br> &nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;      &nbsp;&nbsp;           alloc_pool.insert (low, high, L4_anythread);<br>&nbsp;&nbsp;      &nbsp;&nbsp;               break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;    }<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    default:<br>&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    dprintf (0, &quot;s0: Unknown memory type (0x%x)n&quot;,<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;&nbsp;    (int) L4_MemoryDescType (md));<br>&nbsp;&nbsp;&nbsp;      &nbsp;&nbsp;    &nbsp;&nbsp;    break;<br>&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp;    }<br><br>&nbsp;&nbsp;&nbsp;    …<br><br>}<br><br> <br><br><br><br><br><br><br><del>end</del><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2008/10/23/【C-C-】error-jump-to-case-label/" class="archive-article-date">
  	<time datetime="2008-10-23T11:27:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2008-10-23</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/31/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><a class="page-number" href="/page/34/">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/33/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>