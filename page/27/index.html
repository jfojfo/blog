<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="jfo planet">
<meta property="og:url" content="http://blog.pickbox.me/page/27/index.html">
<meta property="og:site_name" content="jfo planet">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jfo planet">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-虚拟化及地址空间转换（page-translation-table）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/08/05/虚拟化及地址空间转换（page-translation-table）/">虚拟化及地址空间转换（page translation table）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> （全）虚拟化技术解决的问题：<br>如何让在虚拟硬件环境中运行的guest系统的代码在真实CPU上运行？<br>a. 无硬件虚拟化支持（软触发）<br>将guest系统中需要触发硬件的指令保存并替换成异常指令，以便陷入进而转入VMM进行处理<br>b. 有硬件虚拟化支持（硬触发）<br>将所有影响系统级配置（host系统有可能因为它们的改动而down掉）的操作作上虚拟化标记<br><br><br> VT-x地址空间转换（page translation table）<br>对于没有ept硬件支持的，需要维护如下几个表：<br>1. 真实页表：寄存器GDTR所指向的真实GDT表，完成guest读写内存时从线性地址到真实物理地址的转换，转换过程和普通情况一样，由硬件自动完成；<br>2. 虚拟页表：VMCS（virtual-machine control structure）中存储的GDTR的一份读拷贝（read shadow）所指向的GDT表，它是给guest系统“看”的（欺骗guest系统），每当guest需要读写page translation table（一级、二级映射表）时，首先会读取GDTR这个索引，再依次读取pdt、pt表项，读取GDTR时，CPU将返回VMCS中存储的read shadow，它与GDTR所指向的真实GDT表并非同一个，它存储的是从guest线性地址到VMM为guest分配的线性地址（guest用作物理内存）的转换，guest系统只看得到虚拟页表（每次读GDTR，返回的都是VMCS中的read shadow）；<br><br>如果guest没有对页表的写操作（如修改页表项的读写权限、存在标志位、设置该entry为空等等），以上两个页表已经完全满足需求：当guest的某线程读/写某个内存地址，产生page fault时，触发VMX产生VM exit，切换到VMM，VMM将分配一块host的物理内存，将该物理内存地址填入guest的真实页表中，然后VMM向VM注入一个page fault异常，VM enter进入VM后，guest接收到该page fault，执行guest系统的page fault处理程序，这一过程将涉及到虚拟页表。<br>对于以Linux作为guest的系统，该page fault处理流程大致如下：首先从全局分配一块空闲的page物理内存（对VMM而言，该物理内存仅仅是guest所在VM线程线性地址空间中还未分配出去的空闲地址），对应guest内核的一个struct page结构体，然后guest将得到的地址填入虚拟页表（实际上这里还是有写操作！），下一次guest读取页表中的内容（如获取某个page entry的权限），就可以得到在这里分配出去的值。虚拟页表的作用仅仅是给guest“看”，而不会起到读写内存时从线性地址到真实物理地址转换的作用。<br><br>至此还有一个问题未解决，由于guest自认为虚拟页表就是自己真实页表，guest修改虚拟页表中的内容后，如修改页表项的读写权限、存在标志位、设置该entry为空等等，将预期产生相应的结果，例如设置页表项为只读后，对该页表项所指向的内存的写操作应当引发write page fault，然而由于真实页表中的内容仍然保持原状，guest依旧可以对该内存进行写操作，这样，guest系统的执行语义不能得到保证。<br><br>为解决这一问题，可以通过设置让guest系统写PDT和PT内容时产生异常，例如将虚拟页表（PDT和PT）地址在真实页表中对应的页表项的可写标记全部关闭。<br>要修改某个页（page）的属性，首先会在虚拟页表中找到对应的页表项（page table entry），该页表项所在的地址最终还需真实页表来转换到host物理地址，将该页表项的地址在真实页表中对应的页表项设置成只读，这样每次guest修改虚拟页表项都会被VMX捕捉，通过产生异常后的VM exit进入VMM后，VMM通过适当的方法判断出本次异常是更新虚拟页表的操作，于是完成虚拟页表和真实页表内容的更新，保持两个页表的同步，并在真实页表项中继续保留只读属性，以便下一次捕获。<br><br>真实页表由VMM来管理，虚拟页表由guest系统维护。<br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/55f4014f1b656a1faec3ab34.jpg" small="0" class="blogimg"><br><br><br><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/ca0b013b981354c314cecb05.jpg"><br><br><br><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/c3fd57fb1171de3f6c22eb21.jpg"><br><br><br>新的VMX中已经包含ept，硬件page translation table机制虚拟化变得更加完美。<br><br><br><br><br><br><br><br>～～end～～ </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/08/05/虚拟化及地址空间转换（page-translation-table）/" class="archive-article-date">
  	<time datetime="2009-08-05T03:44:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-08-05</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-JavaScript语法参考" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/31/JavaScript语法参考/">JavaScript语法参考</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p>
<p>=================================================================</p>
<p>Javascript 动画框架</p>
<p><a href="http://madrobby.github.com/scriptaculous/" target="_blank">http://madrobby.github.com/scriptaculous/</a></p>
<p><a href="http://blog.pickbox.me/2012/04/30/css3%20%E5%92%8C%20javascript%20%E7%89%B9%E6%95%88/" target="_blank">CSS3 和 JavaScript 特效</a></p>
<p>&nbsp;</p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2011/07/17/%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A%E7%9A%84xss%E6%94%BB%E5%87%BB%E7%9A%84js%E4%BB%A3%E7%A0%81/" target="_blank">新浪微博的XSS攻击的JS代码</a></p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2011/06/13/The%2011%20JavaScript%20Mistakes%20youre%20Making/" target="_blank">The 11 JavaScript Mistakes you’re Making</a></p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2011/06/10/%E5%85%B3%E4%BA%8Ejavascript%E7%9A%84%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/" target="_blank">关于JavaScript的单线程模型</a></p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2011/06/03/js%E5%AE%9E%E7%8E%B0%20file%20download/" target="_blank">JS实现 File Download</a></p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2011/06/11/javascript%20equality%20%28%3d%3d%29%20and%20identity%20%28%3d%3d%3d%29/" target="_blank">JavaScript Equality (==) and Identity (===)</a></p>
<p>=================================================================</p>
<p><strong><a href="http://blog.pickbox.me/2012/05/21/javascript%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF/" target="_blank">JavaScript原型和继承</a>，<a href="http://blog.pickbox.me/2012/11/28/javascript%E5%8E%9F%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF-a-special-example-by-jfo/" target="_blank">a special example by jfo</a>，<a href="http://blog.pickbox.me/2012/11/30/javascript%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8Cconstructor%E5%B1%9E%E6%80%A7/" target="_blank">Javascript的构造函数和constructor属性</a></strong></p>
<p>=================================================================</p>
<p><a href="http://blog.pickbox.me/2012/11/30/jquery%E4%B8%ADdeferred%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" target="_blank">jQuery中Deferred的实现原理</a></p>
<p><span>=================================================================</span></p>
<p><span> </span></p>
<p>关于new function(…)初始化</p>
<p><strong>function f()<br>{<br>this.v = 0;<br>}<br>var a = new f();<br>alert(a.v);<br>alert(a.length);<br></strong>输出：<br>0<br>undefined</p>
<p><strong>function f()<br>{<br>this.v = 0;<br>return new Array(“j”, “f”, “o”);<br>}<br>var a = new f();<br>alert(a.v);<br>alert(a.length);<br>alert(a[0]);<br></strong>输出：<br>undefined<br>3<br>j</p>
<p>说明创建一个object时，该function的return语句将覆盖new新创建的对象。</p>
<p>function很特殊，它可以作为函数直接被调用；也可以用作创建新的object（通过new function(…)），此时<br>function的函数体则扮演了构造函数的角色。</p>
<p>看看jquery（v1.3.2）<br><strong>(function(){<br>var   jQuery = window.jQuery = window.$ = function( selector, context ) {<br>// The jQuery object is actually just the init constructor ‘enhanced’<br>return new jQuery.fn.init( selector, context );<br>},<br>jQuery.fn = jQuery.prototype = {<br>init: function( selector, context ) {<br>…<br>}<br>}；<br>jQuery.fn.init.prototype = jQuery.fn;<br>…<br>})();<br></strong>$(“body”)：以函数调用的形式创建新对象（<strong>return new jQuery.fn.init( selector, context );</strong>）<br>var J = new jQuery(“body”)：以new function(…)的形式创建新对象，return返回的对象覆盖new的对象<br>两者最终返回的完全一样。</p>
<p>=================================================================<br>function的类静态变量（Instance Property、Class Property、Prototype Property）</p>
<p>实例对象访问不到function（类似于C++中的class）中的所谓静态变量</p>
<p><strong>function f()<br>{<br>f.v_class = 1;<br>this.v_object = 0;<br>}<br>var a = new f();<br>alert(a.v_class);<br>alert(a.v_object);<br></strong>输出：<br>undefined<br>0</p>
<p>typeof(f)将输出function，可以将f看做一个特殊的object，那么f.v_class = 1就是给 f 这个object添加<br>一个属性，a自然不可以访问到 f 的属性，这样解释了为什么a.v_class是undefined，从这一点看，<br>静态变量没什么特殊之处，仅仅为function object的普通属性而已。<br>另外由于每次调用f()这个函数，涉及到都是同一个对象f，f属性的变化是可积累的，于是表现形式<br>和C++中的静态变量一样。</p>
<p>new的过程可以看做先分配一块内存空间赋给this，然后调用f()完成初始化（f()相当于构造函数），<br>在f()函数体内执行正常的JavaScript语句流程，碰到this替换为当前对象的地址，再对相应字段赋值；<br>碰到f.property对 f 这个”对象”的property属性进行操作；并无特殊之处。</p>
<p>另外，如果直接调用f()函数，则this将变成全局的那个this，在浏览器中为window对象。</p>
<p>ps：通过prototype访问<br><strong>function f()<br>{<br>this.v_object = 0;<br>}<br></strong><strong>f.v_prototype = 1;</strong><br><strong>var a = new f();<br>alert(a.v_prototype);<br>alert(a.v_object);<br></strong>输出：<br>1<br>0</p>
<p>=================================================================<br>Array类型——function object</p>
<p>Array、Number、String、Date、Function等类型，可以进行如下操作</p>
<p><strong>var T = Array;<br>var a = new T(“1111”, “222”, “33”);<br>alert(a);<br>alert(a.length);<br></strong><strong><br>T = String;<br></strong><strong>a = new T(“1111”, “222”, “33”);</strong><br><strong>alert(a);<br>alert(a.length);</strong>输出：<br>1111,222,33<br>3<br>1111<br>4</p>
<p>Array等可以用function Array() {…}的形式定义，看作function object，可被赋值，正如可以进行一下操作一样：<br>var func = function() { alert(“Hello”); }<br>func();</p>
<p>=================================================================<br>Enumerating Properties</p>
<p><strong>for (var prop in document)<br>document.write(‘document[“‘ + prop + ‘“] = ‘ + document[prop] + ‘&lt;br /&gt; ‘);<br></strong>输出：<br>document[“addEventListener”] = function addEventListener() {     [native code] }<br>document[“evaluate”] = function evaluate() {     [native code] }<br>document[“createExpression”] = function createExpression() {     [native code] }<br>document[“createNSResolver”] = function createNSResolver() {     [native code] }<br>document[“baseURI”] = file:///E:/work/Cygwin/home/Administrator/sh_script/js/js_template.html<br>document[“textContent”] = null<br>document[“nodeType”] = 9<br>document[“localName”] = null<br><strong>…</strong></p>
<p>=================================================================<br>Objects Are Reference Types</p>
<p>var str1 = “abc”;<br>var str2 = “abc”;<br>alert(str1 == str2);<br>===&gt;true</p>
<p>var str1 = new String(“abc”);<br>var str2 = new String(“abc”);<br>alert(str1 == str2);<br>===&gt; false  [the <strong>== </strong>operator checks whether the two variables refer to the exact same object]</p>
<p>var n1 = Number(314);<br>var n2 = Number(314);<br>alert(n2.valueOf() == n1.valueOf());<br>===&gt;true</p>
<p><em>The relational comparison operators  (</em>&gt;&gt;<em>,</em>&lt;&lt;<em>,</em>&gt;&gt;<strong><em>=</em></strong><em>,  and</em>&lt;&lt;<strong><em>=</em></strong><em>) work as you would expect for objects  for which these operators make sense (e.g., </em><em>, </em><em>, </em><em>, and so on). The reason is  that these operators automatically convert their operands to a primitive type.</em><em>The equality relational operator doesn’t do this because you might actually want  to compare references.</em></p>
<p>=================================================================<br>Prototype-Based Objects</p>
<p>Java and C++ are <em>class-based</em>object-oriented languages. An object’s properties are defined by its <strong>class</strong>—a description of the code and data that each object of that  class contains. In these languages, a class is defined at compile-time, that is,  by the source code the programmer writes. You can’t add new properties and  methods to a class at runtime, and a program can’t create new data types while  it’s running.</p>
<p>Because JavaScript is interpreted (and therefore has no visible  distinction between compile-time and runtime), a more dynamic approach is called  for. JavaScript doesn’t have a formal notion of a class; instead, you create new  types of objects on the fly, and you can modify the properties of existing  objects whenever you please.</p>
<p>JavaScript is a <em>prototype-based</em>object-oriented language, meaning that every object has a prototype, an object  from which it inherits properties and methods. When a property of an object is  accessed or a method invoked, the interpreter first checks to see if the object  has an instance property of the same name. If so, the instance property is used.  If not, the interpreter checks the object’s prototype for the appropriate  property. In this way the properties and methods common to all objects of that  type can be encapsulated in the prototype, and each object can have instance  properties representing the specific data for that object.</p>
<p>An object’s prototype is also an object, and can therefore itself have a  prototype.</p>
<p>&nbsp;</p>
<p>Property</p>
<p>Description</p>
<p><strong>prototype</strong></p>
<p>Reference to the object from which it inherits non-instance  properties</p>
<p><strong>constructor</strong></p>
<p>Reference to the function object that served as this  object’s constructor</p>
<p><strong>toString()</strong></p>
<p>Converts the object into a string (object-dependent  behavior)</p>
<p><strong>toLocaleString()</strong></p>
<p>Converts the object into a localized string  (object-dependent behavior)</p>
<p><strong>valueOf()</strong></p>
<p>Converts the object into an appropriate primitive type,  usually a number</p>
<p><strong>hasOwnProperty(</strong><strong><em>prop</em></strong><strong>)</strong></p>
<p>Returns <strong>true </strong>if the object has an instance  property named <em>prop</em>, <strong>false  </strong>otherwise</p>
<p><strong>isPrototypeOf(</strong><strong><em>obj</em></strong><strong>)</strong></p>
<p>Returns <strong>true </strong>if the object serves as the  prototype of the object <em>obj</em></p>
<p><strong>propertyIsEnumerable(</strong><strong><em>prop</em></strong><strong>)</strong></p>
<p>Returns <strong>true </strong>if the property given in the  string <em>prop</em>will be enumerated in a <strong>for</strong>/<strong>in</strong>loop</p>
<p>Inheritance in JavaScript is achieved through prototypes. It is clear that  instances of a particular object “inherit” the code and data present in the  constructor’s prototype.</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/31/JavaScript语法参考/" class="archive-article-date">
  	<time datetime="2009-07-31T06:45:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-31</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/js-html-python/">js/html/python</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-kvm-init-debug-debugfs-fops" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/26/kvm-init-debug-debugfs-fops/">kvm_init_debug debugfs fops</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/85199c515efa900c43a75b66.jpg" small="0" class="blogimg"><br><br><br><br><br><br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/0993938f30daa1d2513d9294.jpg" small="0" class="blogimg"> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/26/kvm-init-debug-debugfs-fops/" class="archive-article-date">
  	<time datetime="2009-07-26T14:09:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-sys-open-flow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/26/sys-open-flow/">sys_open() flow</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><img src="http://img.pickbox.me/wp-content/uploads/pic/6ec29a22d99b92dbd6cae22b.jpg" small="0" class="blogimg"><br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/26/sys-open-flow/" class="archive-article-date">
  	<time datetime="2009-07-26T13:36:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-debugfs-create-dir-flow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/26/debugfs-create-dir-flow/">debugfs_create_dir() flow</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><img src="http://img.pickbox.me/wp-content/uploads/pic/8d1dab774eb32833b151b93f.jpg" small="0" class="blogimg"><br><br> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/26/debugfs-create-dir-flow/" class="archive-article-date">
  	<time datetime="2009-07-26T11:15:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-26</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-mount-flow-debugfs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/25/mount-flow-debugfs/">mount flow (debugfs)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/f1b440a7b45a4ebdd0435846.jpg" small="0" class="blogimg"> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/25/mount-flow-debugfs/" class="archive-article-date">
  	<time datetime="2009-07-25T07:40:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-25</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Linux-kernel-memory-distribution" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/07/15/Linux-kernel-memory-distribution/">Linux kernel memory distribution</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br>/<em> Just any arbitrary offset to the start of the vmalloc VM area: the<br></em> current 8MB value just means that there will be a 8MB &quot;hole&quot; after the<br><em> physical memory until the kernel virtual memory starts.  That means that<br></em> any out-of-bounds memory accesses will hopefully be caught.<br><em> The vmalloc() routines leaves a hole of 4kB between each vmalloced<br></em> area for the same reason. ;)<br><em>/<br>#define VMALLOC_OFFSET&#160;&#160;&#160;    (8 </em> 1024 <em> 1024)<br>#define VMALLOC_START&#160;&#160;&#160;    (((unsigned long)high_memory + 2 </em> VMALLOC_OFFSET - 1) <br>&amp; ~(VMALLOC_OFFSET - 1))<br># define VMALLOC_END&#160;&#160;&#160;    (PKMAP_BASE - 2 <em> PAGE_SIZE)<br><br><br><br>#define LAST_PKMAP 1024<br><br>#define PKMAP_BASE ((FIXADDR_BOOT_START - PAGE_SIZE </em> (LAST_PKMAP + 1))&#160;&#160;&#160;    <br>&amp; PMD_MASK)<br>// PGDIR_SIZE == PMD_SIZE == 22<br>// PGDIR_SHIFT == PMD_SHIFT<br>// PGDIR_MASK == PMD_MASK<br><br>#define FIXADDR_BOOT_START&#160;&#160;&#160;    (FIXADDR_TOP - <strong>FIXADDR_BOOT_SIZE)<br>#define FIXADDR_TOP&#160;&#160;&#160;    ((unsigned long)</strong>FIXADDR_TOP)<br>unsigned long <strong>FIXADDR_TOP = 0xfffff000;<br>#define </strong>FIXADDR_BOOT_SIZE&#160;&#160;&#160;    (__end_of_fixed_addresses &lt;&lt; PAGE_SHIFT)<br><br><br><br><img class="blogimg" small="0" src="http://img.pickbox.me/wp-content/uploads/pic/e4dc530f065fae026159f304.jpg"><br><br><img src="http://img.pickbox.me/wp-content/uploads/pic/f2a3854421f39167510ffeac.jpg" small="0" class="blogimg"> </p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/07/15/Linux-kernel-memory-distribution/" class="archive-article-date">
  	<time datetime="2009-07-15T13:50:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-07-15</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】DirectFB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/03/【zz】DirectFB/">【zz】DirectFB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a href="http://blog.chinaunix.net/u/30686/showart.php?id=1946188" target="_blank">http://blog.chinaunix.net/u/30686/showart.php?id=1946188</a><br></p><p><strong>DirectFB在Davinci平台上的应用分析报告</strong></p><p></p>1.概述<p>根据目前ＳＴＢ的媒体表现形式不足和将来的功能扩展需求，需要有一套稳定、灵活的显示设备、输入设备适配层。 DirectFB（以下简称DFB）是针对嵌入式系统资源和性能特点而设计的一套图形库。我们在这里对DFB在Davinci平台上的可用性做一次分析。</p><p>分析的主要内容有：</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   代码的编译选项</p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   图形库主要特性</p><p>3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   典型应用程序启动、画图显示过程分析</p><p>4)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   分析DFB在Davinci平台上应用的可行性</p>2.编译选项<p>./configure  CC=arm_v5t_le-gcc CXX=arm_v5t_le-g++  AR=arm_v5t_le-ar   RANLIB=arm_v5t_le-ranlib LD=arm_v5t_le-ld CFLAGS=&quot;-O2 -ffast-math -pipe&quot;  CPPFLAGS=-I/home/cnc/devkit/arm/v5t_le/target/usr/include&nbsp;&nbsp;   LDFLAGS=&quot;-L/home/cnc/devkit/arm/v5t_le/target/lib  -L/home/cnc/devkit/arm/v5t_le/target/usr/lib&quot;   –host=arm-linux –build=i386   –prefix=/home/cnc/root-nfs/usr/local   –exec-prefix=/usr/local –enable-debug   –enable-trace&nbsp;&nbsp;&nbsp;  –enable-static  –enable-multi –enable-fbdev –without-tools&nbsp;&nbsp;   –with-gfxdrivers=davinci</p><p>上面的编译选项中：&nbsp;&nbsp;&nbsp;</p><p>–enable-multi   允许多进程间共享显示设备（下面的分析都是基于此编译条件）<br>  &nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; –enable-debug   允许调试信息与断言<br>  &nbsp;&nbsp;   &nbsp;&nbsp;&nbsp; –enable-trace   允许运行时堆栈跟踪</p><p> </p><p>当DFB图形库编译安装成功后，我们需要编写DFB在目标系统上的运行配置。</p><p>directfbrc是DFB图形库启动的配置文件，配置方式分为：</p><p>系统级配置：a system-wide one stored in  /etc/directfbrc </p><p>用户级配置：a per-user $HOME/.directfbrc which may  override system settings. </p><p>也可以通过应用程序（basename of argv[0])）传入：/etc/directfbrc.$0 或$HOME/.directfbrc.$0</p><p>下面是配置文件的具体示例，更详细的配置方式请参阅文档Man page of  DIRECTFBRC.mht：</p><p>system=fbdev</p><p>fbdev=/dev/fb0</p><p>mode=720x576</p><p>depth=16</p><p>pixelformat=RGB16</p><p> </p><p>systems指定显示系统接口，目前可选接口有：</p><p>dvevm:直接操作硬件地址空间适配层代码</p><p>fbdev: 输出到frame buffer。</p><p>osx:&nbsp;&nbsp;  输出到mac os上。</p><p>vnc： 输出到Virtual Network  Computing（类似于微软远程桌面的一个协议）。</p><p>x11： 输出到X Window上</p><p>sdl：   输出到Simple DirectMedia  Layer。</p><p>这里我们使用framebuffer接口。</p><p>mode指定显示设备的分辨率；</p><p>depth为像素位数；</p><p>pixelformat指定显示设备像素格式。</p><p> </p><p> </p>3.DFB图形库关键模块－fusion<p>在介绍DFB之前先介绍一下DFB多进程共享同一显示资源的核心模块fusion。在传统的DFB应用中，所有的应用程序都在一个进程中，在性能上，有一些优势，然而一个应用程序不稳定会造成整个系统的不稳定。若采用C/S模型，无疑是重蹈X Widnow的覆辙，会丧失性能上的优势。所以DirectFB采用了另外一种方式，与C/S相区别，称之为主从模型（Master/Slave）。它加了一个称之为fusion的内核模块。Fusion是熔化的意思，多个应用程序在不同的进程空间里，通过这个内核模块通信，在这里，一切都溶为一体。Master应用程序负责初始化一个称为竟技场(Arena)的东西，其它Slave应用程序可以加入(join)或者退出(leave)竟技场。当Master退出时，则其它所有Slave都必须退出。Fusion里采用了Reactor模式，每个应用程序可以通过ioctl向reactor注册事件处理器，当有事件发生时，reactor会把事件写入到所注册了的应用程序的fusion文件描述符时，之后应用程序可以从fusion文件描述符里读取到事件数据。当然，应用程序也可以通过ioctl发送事件给其它应用程序，reactor也会把事件分发给其它应用程序。</p><p> </p><p> </p><p>/<em>关于fusion的调用函数定义都是通过FUSION_OBJECT_METHODS这个宏定义实现的</em>/</p><p><strong>消息分发线程的创建</strong><strong></strong></p><p>DirectFBCreate</p><p>fusion_enter&gt;&gt;&gt;Master应用程序初始化或join Arena，挂在/dev/fusionN</p><p>direct_thread_create( DTT_MESSAGING, fusion_dispatch_loop, world, &quot;Fusion  Dispatch&quot; );</p><p>fusion_dispatch_loop&gt;&gt;&gt;启动消息分发线程</p><p> </p><p><strong>以注册Surface</strong><strong>对象的Flip</strong><strong>事件为例说明fusion</strong><strong>注册事件流程</strong></p><p>IDirectFB_CreateSurface&gt;&gt;&gt;创建一个surface对象</p><p>IDirectFBSurface_Construct&gt;&gt;&gt;</p><p>dfb_surface_attach( surface,IDirectFBSurface_listener, thiz,  &amp;data-&gt;reaction ); &gt;&gt;注册surface </p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   listener</p><p>fusion_reactor_attach&gt;&gt;注册surface 相关的回调函数</p><p>ioctl( _fusion_fd( reactor-&gt;shared ), FUSION_REACTOR_ATTACH,  &amp;attach )</p><p><strong>发送Surface Flip</strong><strong>事件</strong></p><p>dfb_surface_flip( data-&gt;surface, false  );&gt;&gt;&gt; 改变surface buffer  index</p><p>dfb_surface_notify( surface,  CSNF_FLIP );&gt;&gt;&gt;</p><p>dfb_surface_dispatch(  surface, &amp;notification, dfb_surface_globals );&gt;&gt;&gt; 通过fusion通知进行surface_listener flip操作</p><p> </p><p> </p><p> </p><p>下面以触摸屏为例介绍笔点事件的过程：</p><p>1）初始化时，driver_open_device创建一个进程，挂在/dev/input/event0上，等待笔点事件。</p><p>2）初始化时，应用程序创建另外一个线程，挂在/dev/fusionN(不同的应用程序N值不同)上。</p><p>3) 当有笔点事件时，通过函数调用dfb_input_dispatch–&gt;fusion_reactor_dispatch-&gt;ioctl  (FUSION_REACTOR_DISPATCH)把消息丢给内核模块。</p><p>4) 内核模块中的Reactor把事件数据写入到各个所注册的事件处理器的/dev/fusionN里。</p><p>5) 应用程序从/dev/fusionN文件中取得事件数据，并调用应用程序内部的reactor处理函数，一般是IDirectFBEventBuffer_InputReact/IDirectFBEventBuffer_WindowReact两个函数。</p><p>6) 然后，在IDirectFBEventBuffer_InputReact/IDirectFBEventBuffer_WindowReact两个函数中，调用IDirectFBEventBuffer_AddItem把事件加入到窗口的事件队列中。</p><p>7) 在应用程序的主线程中，就可以通过调用窗口的GetEvent函数从事件队列中获取事件了，最后，把获取的事件分发到各个窗口事件处理函数中。</p><p> </p><p> </p><br><br>更多内容，请参见原文链接<br><br><br><br><br><br><br><del>end</del><br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/06/03/【zz】DirectFB/" class="archive-article-date">
  	<time datetime="2009-06-03T07:56:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-06-03</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/linux-图形/">linux 图形</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】Linux的X窗口系统结构说明" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/03/【zz】Linux的X窗口系统结构说明/">【zz】Linux的Ｘ窗口系统结构说明</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a target="_blank" href="http://blog.chinaunix.net/u/30686/showart.php?id=1946051">http://blog.chinaunix.net/u/30686/showart.php?id=1946051</a><br><br></p><p>一、说明<br>以X Server为中心，简要地分为四层，如图所示</p><p><a href="https://qgd1mg.blu.livefilestore.com/y1mTR9pG-kkPLXNPYq1ikSPZpmmrA9IFOYtzVPDEx4Gw27QuQNpKFmn-DGpOyHL_aI5b9mw3wpbXfJ9cqM4o_RJVLehToLCgIl1rBSvN0OeH7sOiM8H3-vXXQ8Q5MJoYEZjh1Lg_PXs2mw/x_protocol.jpg" target="_blank" rel="WLPP;url=https://qgd1mg.blu.livefilestore.com/y1mTR9pG-kkPLXNPYq1ikSPZpmmrA9IFOYtzVPDEx4Gw27QuQNpKFmn-DGpOyHL_aI5b9mw3wpbXfJ9cqM4o_RJVLehToLCgIl1rBSvN0OeH7sOiM8H3-vXXQ8Q5MJoYEZjh1Lg_PXs2mw/x_protocol.jpg"><img src="http://img.pickbox.me/wp-content/uploads/pic/4eeec8804a7d4ff29123d99f.jpg" small="0" class="blogimg"><br></a></p><p>二、Ｘ方式与Framebuffer方式的差异</p><p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X方式</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    什么是Ｘ<br>我们常说的X Window，X，X11(指X协议的11版本)一般指X协议，或指是基于X协议的X服务端程序(X Server) </p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X  Server与X  Client</p><p>a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Ｘ协议指X Server及X  Client组成的c/s架构，及其通讯协议的实现</p><p>b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X  Server有主事件循环，由它来处理用户输入、显示及与X Client通讯</p><p>c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X  Client即Ｘ桌面上运行的普通应用程序<br>应用程序如果想显示数据，需要利用X Lib库建立X窗口(X Client)，它通过Ｘ协议与X Server通讯，让X Server完成显示；X Server会把接到键盘鼠标事件，传给焦点所在的X Client处理</p><p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Framebuffer方式<br>Framebuffer方式相对简单，它由内核直接支持，通常用于嵌入式系统。应用程序可以得到屏幕显示区域的指针，然后对其写数据来进行显示，其中窗口的概念不强，它自身不带窗口管理，需要应用软件自己管理窗口。比如qtopia基本于framebuffer显示时，qtopia自身实现了窗口管理功能</p><p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    应用程序的显示方式<br>很多应用程序同时支持X和Framebuffer两种模式显示，如gtk，qt等，以下我们只讨论它基本于Ｘ实现的部分</p><p>三、分层</p><p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    应用层(Application)<br>指Ｘ  Window上运行所有带图形界面的应用程序，每个窗口都是一个X Client</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X Lib app<br>直接使用X函数的应用程序，这种程序一般界面简单，比较底层，比如很多窗口管理器直接写在这层</p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Gtk app<br>gtk又分为gtk和gdk两层，<br>gtk为控件及主循环的实现<br>gdk相对底层，控制底层绘图部分，它支持framebuffer、X11、DirectFb等<br>应用程序可调用gtk函数，也可直接调用gdk函数<br>gtk常和cairo一起实现二维特效</p><p>3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Qt app<br>Qt也通过调用X Lib实现图形界面<br>Qt的优势在于它是C++实现的，使用起来程序结构更好，也有较成熟的嵌入式版本</p><p>4)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    SDL app<br>SDL也通过调用X Lib实现图形界面<br>SDL更底层，代码少，没有控件，但做特殊效果很好用</p><p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    窗口管理器层(Window manager简称wm)<br>Window  manager是特殊的X Client，也通过X Lib库与X  Server交互，与一般应用不同的是：它负责控制各个窗口的动作，及操作主窗口<br>WM的功能分为管理(manager)和工具(tools)，</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Manager<br>负责各个窗口的建立销毁／显示隐藏／最大最小化／移动缩放，管理窗口队列，设置焦点窗口，窗口切换效果等</p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Tools<br>实现桌面工具条，桌面菜单等基本界面及小工具</p><p>3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    具体实现<br>实现通常有两种方式：一种是manager和tools在一个程序中实现，一种是分开两个程序实现，使用时可以随意组合</p><p>a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    qvwm,  blackbox等较早期的wm，都是manager和tools在一个程序中实现的</p><p>b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    xfce、metacity等是分开的，例如：xfce包含tools和manager，但不在一个程序中实现，它的manager是xfwm，我们可在使用xfce时把xfwm替成metacity(metacity是一个manager，不带tools)</p><p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    X服务器层(X Server)<br>主循环控制显示，读取设备数据，与X Client通讯，事件循环，并把事件送给焦点窗口</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    普通X Server<br>功能完整的X Server，代码量大，支持全，常见的如XFree86，Ｘorg等</p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Tiny X Server<br>一般用于嵌入式系统，资源占用小，代码少，功能及逻辑相对简单，如KDrive（Xvesa/Xchips/Xfbdev/Xi810……）</p><p>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    系统底层(System)</p><p>1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Kernel<br>与硬件交互，获得输入设备的数据，向显示设备输出</p><p>2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    Dev<br>文件系统中的设备文件，程序通过对它的读写和操作与kernel交互，控制硬件</p><p>3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    中间层<br>在程序和Dev层之间，有时还需要库或程序处理设备数据，比如触摸屏就使用libts去除噪点，过滤出更有效的数据</p><p> </p><p> </p><p><br></p> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/06/03/【zz】Linux的X窗口系统结构说明/" class="archive-article-date">
  	<time datetime="2009-06-03T07:24:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-06-03</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/linux-图形/">linux 图形</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-【zz】Linux-图形现状" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/03/【zz】Linux-图形现状/">【zz】Linux 图形现状</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <a target="_blank" href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965">http://blog.chinaunix.net/u/30686/showart.php?id=1945965</a><br></p><p>在淡出 <a href="http://www.freedesktop.org/wiki/Xegl" target="_blank" rel="external">Xgl</a>  方面的工作之后，我仍收到大量 email 并阅读许多帖子。我的结论是大多数人并没有真正理解 linux  图形方面正在发生的事情。人们无法看清整体的图景，这是可以理解的。图形是一个庞杂的领域，包含着众多软件组件和相互竞争的开发小组。作为一种尝试，  我写了这篇文章，来解释所有这些部分是如何组织到一起的。</p>俱往矣<p>今年是 X server 的二十一岁生日。脱胎于 Athena 项目,自 1984 年发端以来，过去的那些年中，它很好地满足了  Unix 社团的需要。 X 已经被广泛应用，推动着今天的大多数 Linux 桌面。这篇 <a href="http://en.wikipedia.org/wiki/X_Window_System" target="_blank" rel="external">Wikipedia 文章</a><sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote2" name="mxtctpcontent2" target="_blank" rel="external">2</a></sup>提供了更多详细资料，除了两项开源的主要 X 创新，它们允许提供跨平台支持和网络通透性。</p><p>然而，自 X 着手设计，20 年时光匆匆流逝，视频硬件今非昔比了。如果瞥一下一块现代视频芯片的<a href="http://graphics.tomshardware.com/graphic/20040504/images/architecture.gif" target="_blank" rel="external">架构图</a>，你会注意到一个小小的标记着  2D 的区块。那是由于芯片的 90% 专注于 <a href="http://www.opengl.org/documentation/specs/version1.1/state.pdf" target="_blank" rel="external">3D</a>  管线。你正好为那些 3D 硬件付了费，因此如果桌面能利用它那不是很棒吗。很多人并未意识到 3D 硬件也可用于绘制 2D 桌面。看看你的屏幕，它是一块平平的 2D  平面，对不对？任何由 3D 硬件生成的图画最终都要显示在平的 2D 屏幕上。此一事实应能让你认识到，通过适当地编程，3D 硬件可以绘制 2D 桌面。</p>图形供应商<p>多年以前图形芯片供应商乐于为他们的硬件公开数据表和编程信息。但是随着专利库的增大，对专利侵权的恐惧也增大了。现在图 形芯片供应商将关于芯片的全部信息秘而不宣，作为使专利持有人更难搜寻侵权行为的一种手段。至少这是供应商给出的隐藏编程规范的理由。并且他们也宣称隐藏 编程规范可使竞争对手更难对他们的芯片做反相工程，但我对此同样持怀疑态度。所有这些隐藏规范使为这些芯片编写开源设备驱动异常困难。作为替代方案，我们 被迫依赖供应商来为最新的硬件提供驱动程序。如果你尚未留意，请注意图形供应商的确仅仅关心 MS Windows 因此他们只为 Linux 提供最低程度的驱动支持。也有例外。Intel 为他们的部分芯片提供开源驱动。Nvidia/ATI 提供专有驱动，但是落后于 Windows 版本。总的后果是一批非常参差不齐的驱动，品质从良好到完全空白。</p>桌面选择<p>其它的桌面选择， <a href="http://msdn.microsoft.com/windowsvista/experience/" target="_blank" rel="external">Windows</a> 与 <a href="http://www.apple.com/macosx/features/quartzextreme/" target="_blank" rel="external">Mac</a>，都拥有 GPU  加速的桌面。它们明显地、眼见地比他们的前辈要好。某些情况下这些新的带加速的桌面的绘制速度能够比旧的模型快过一百倍。在未来的某个时候，图形芯片供应商会移除标记为  2D 的那个小点，仅给我们留下 3D 硬件。Microsoft 和 Apple 看起来已经得到信儿说 3D 是未来的方向并开始进行转换。另一方面。几个 X  开发者曾告诉我停止谈论竞争的图景。他们说他们想做的是让 X 更好。尽管 X 开发者可能无动于衷，我确信当由于缺乏竞争力的 GUI  而开始丧失份额的时候，Redhat 和 Novell 的经理们不会赞同此一观点。</p><p>在桌面上使用 3D 并不只是为了制造更华丽的视觉效果<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote3" name="mxtctpcontent3" target="_blank" rel="external">3</a></sup>。有大量利用 3D 能力生成的效果只是虚饰，但仍有些真正的理由运用 3D。简单来说 3D 快过  2D，没有人动手使他们的 2D 功能更快，所有的硅工程师都转向了 3D 。你能够完成快速、任意的图像处理，例如色彩空间转换，拉伸/卷曲，等等。我曾见过某些消耗主  CPU 几秒钟才完成一帧的超级复杂的过滤操作在 shader 硬件上以实时达成。支持任意色彩映射的不同的 Windows 色深(同时支持 8、16、24  位窗口)。为项目管理者提供极快的屏幕翻转/旋转，为视力不良者提供全屏缩放，等等。分辨率无关性允许对象以任意分辨率/尺寸渲染，当显示到屏幕上的时候再降低/提高取样精度。更多有意思的应用在后面讨论窗口化的小节里阐述。</p>当前的 X.org 服务器<p><a href="http://x.org/" target="_blank" rel="external">X.org</a> <a href="http://lists.freedesktop.org/pipermail/xorg/2005-June/008325.html" target="_blank" rel="external">即将</a>发布  X11R7<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote4" name="mxtctpcontent4" target="_blank" rel="external">4</a></sup>。这个发布的主要特性是 X 源代码库的<a href="http://wiki.x.org/wiki/ModularizationProposal" target="_blank" rel="external">模块化</a>。尽管对大多数用户并无意义，模块化将使在  X 源代码上工作容易得多。模块化之前 X 源代码树包含约 16M  行代码，全部作为一个单独的项目构建。模块化之后，代码树将分解为一打左右的独立部分，使项目的构建和理解容易得多。</p>X，作为操作系统<p>X 究竟是一个应用程序还是一个操作系统？在<a href="http://h30097.www3.hp.com/docs/dev_doc/DOCUMENTATION/HTML/AR5NHATE/TOC.HTM" target="_blank" rel="external">这里</a>有一份优秀的参考文献帮助我们理解一个  X server 是如何组织到一起的。尽管写成已有 8 年之久，大多数内容仍然切题。如果你不知道何谓 DIX、mi、DDX、CFB 什么的，最好先读读它。大概在  X11R6.3 那会儿 Xfree86 分裂了，X 服务器的<a href="http://www.x.org/X11R6.8.2/doc/DESIGN.html" target="_blank" rel="external">设计</a>变得极度跨平台。X  面向的众多操作系统对硬件侦测这类事情提供不同程度的支持。为了解决此类问题，X 添加了代码侦测 PCI 总线来搜寻硬件，代码搜寻视频 ROM  并运行它们来重置硬件，搜寻鼠标和键盘并提供驱动，管理多个 VGA 设备的问题，最后甚至提供它自己的模块加载器。这一步让 X  开始模糊了它是应用程序还是操作系统的界线。虽然某些操作环境的确需要这种类 OS 支持，实现这些特性来提供同样服务的操作系统，比如 Linux， 终于落到 X 和  OS 之间互相冲突的境地。当然操作系统是一个移动的标靶，十年前恰当的决策今天看来可能已经不合时宜了。</p><p>Linux 内核提供在 BSD 和某些其它平台上并不存在的子系统，比如 PCI 和 framebuffer。出于对跨平台支持的兴趣，X  服务器内建了和这些子系统平行的实现。在过去对此确有需求但在当前 Linux 系统上这导致两块不同的软件都试图控制同一个硬件。Linux 具有多个非 X  的视频硬件使用者，它们与 X 交互的唯一位置就是内核。内核提供了很多机制来协调这些使用者；反正就是 PCI  子系统，输入驱动，热拔插检测，设备驱动这档子事。为了和 Linux 一致，最佳方案是使用内核提供的特性，仅仅在其它平台上运行这些重复的库。Fbdev 和 XAA  驱动是冗余驱动的主要例子。</p><p>Linux 有一个优秀的热拔插系统，图形系统真的有必要开始利用它。显示屏可以从多个来源上热拔插。有一个传统的热拔插来源；有些人将新的显示卡插入热拔插背板。然 而存在其它非传统的途径来获得一次热拔插。另一位用户可能正在使用你要加到你的屏幕组的显示屏，当他注销的时候你就会获得一次热拔插。你可以将一台外部监 视器连接到笔记本电脑上，从而生成一次热拔插。你可以以无线方式通过 <a href="http://www.x.org/X11R6.8.2/doc/dmx.html" target="_blank" rel="external">DMX</a> 或 <a href="http://chromium.sourceforge.net/doc/index.html" target="_blank" rel="external">Chromium</a>  这类东西连接到显示墙。USB 也是很多热拔插的来源。用户能够热拔插鼠标、手写板、键盘、音频设备、甚至图形适配器。既然不和内核的热拔插系统通信，当前 X  服务器不能处理这些情形中的任何一种。</p><p>标准的 Linux 桌面使用 rooted X。Rooted X 指的是 X 控制最上级桌面的绘制，窗口则处于它之上。 <a href="http://xfree86.cygwin.com/" target="_blank" rel="external">Cygwin/X</a>，Directfb 和 <a href="http://developer.apple.com/darwin/projects/X11/index.html" target="_blank" rel="external">Apple  Darwin</a> 都是用 rootless X。这些环境拥有另一套窗口系统负责显示。这些宿主窗口系统绘制主桌面并实现它们自己的窗口 API。通过运行在  rootless 模式，X 能够象这样被整合到一个宿主窗口系统中。在 rootless 模式下应用程序窗口绘制到系统内存中的缓冲区。在适当的时候 X  窗口和宿主窗口系统同步，于是它们的内容被显示出来了。Rootless X 也提供协议在两个环境当中传递鼠标和键盘事件。</p>X Render<p>现在讲到 <a href="http://keithp.com/%7Ekeithp/talks/usenix2001/xrender/" target="_blank" rel="external">X Render 扩展</a>。Keith  P 于公元 2000 年宣称现存的 X 服务器无法有效地绘制清晰的、<a href="http://en.wikipedia.org/wiki/Font_rasterization" target="_blank" rel="external">反锯齿的文本</a>，起而提出 X Render  <a href="http://cvs.freedesktop.org/xorg/xc/doc/specs/Render/library?rev=1.1.1.1&amp;view=markup" target="_blank" rel="external">扩展</a>来解决此问题。X  Render 是核心 X 特性，允许漂亮的字体和 Cairo 这类事情在 X 服务器上实现。X Render 给 X 服务器添加了 Porter-Duff  操作<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote5" name="mxtctpcontent5" target="_blank" rel="external">5</a></sup>。这些操作允许图面以不同的方式合并。它们与 OpenGL  纹理和纹理操作的概念非常相似，但仅仅是相似而非完全一致。</p>XAA<p><a href="http://cvs.freedesktop.org/xorg/xc/programs/Xserver/hw/xfree86/xaa/XAA.HOWTO?rev=1.2&amp;view=markup" target="_blank" rel="external">XAA</a>，既  X 加速体系结构，是在 XFree86 4.0 中引入的。为达成跨平台可迁移性，XAA 没有利用内核设备驱动，而在用户空间实现了 2D  视频驱动。用户空间驱动的确可行，然而既然不存在基于内核的驱动，Linux 内核就无法追踪 X 对硬件作了些什么。直到你的系统引导完毕，X  都未开始运行。你应该希望启动过程中在启动 X 出麻烦的情况下仍有显示，不是吗？Linux 下的启动显示通过文本模式(控制台)驱动实现，最常见的是  VGAcon。由此 Linux 下你困于两套设备驱动， X 和控制台的，都在试图控制同一块硬件。XAA、控制台和<a href="http://www.tldp.org/HOWTO/Text-Terminal-HOWTO.html" target="_blank" rel="external">虚拟终端</a>(Virtual  Terminal)这类 Linux 内核功能的组合会导致大量的冲突，不过容后细谈。</p>EXA<p><a href="http://www.virtuousgeek.org/exa-driver.txt" target="_blank" rel="external">EXA</a> 对现存 2D  XAA 驱动的替代允许当前的服务器模型能工作更长一点。它通过提供远为高级的驱动和内存管理 API 来加速 X Redner 扩展。起初 EXA  定位为针对包括旧硬件在内的所有硬件的方案。但这并未成为现实。如果老旧的硬件缺少加速渲染核心所需的 alpha 混合硬件,你基本上就无能为力了，虽然EXA  有可能通过较好地管理显存帮助增强这些芯片的性能。所以归根结底硬件 EXA 相当程度上工作于现存OpenGL 驱动同样的硬件。Nv 和 i128  这样的例外也是有的，这些硬件具有 3D 能力却不存在 OpenGL 驱动。可以确定的是 EXA 会不断扩张来探求更多芯片中的 3D 能力。EXA  牌创可贴能顶一阵子,但非长远之计。必须牢记的是 EXA/render 仍然仅是庞大的 Mesa OpenGL API  的子集，而随着时间的推移我们总会寻求越来越多的特性。</p>Cairo<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote6" name="mxtctpcontent6" target="_blank" rel="external">6</a></sup><p><a href="http://www.cairographics.org/" target="_blank" rel="external">Cairo</a>  的目标是成为一套高品质的、同时适用于打印输出和屏幕显示的 2D 绘制 API。它被特别着意设计得同 X Render 扩展协同工作，实现了 <a href="http://partners.adobe.com/public/developer/en/pdf/PDFReference.pdf" target="_blank" rel="external">PDF  1.4</a> 图像模型。有趣的操作包括笔划和三次 Bézier 样条曲线，转换与合成半透明图像，<a href="http://en.wikipedia.org/wiki/Anti-aliasing.odt" target="_blank" rel="external">反锯齿</a>文本渲染。Cairo  的设计是可移植的，且允许可挂接的绘制后端例如图像、glitz、png、ps、PDF、svg、quartz、GDI 和 xlib。目前 Cairo  已经过大约两年的开发，在 GDK 和 Mozilla 即将到来的版本中应该能看到部署。Cairo 的主要目标是使处理屏幕上的高端 2D  图形更容易，然后轻松打印它们。可挂接后端允许应用程序使用相同的代码绘制和打印。</p><p>Cairo 后端之一，名为 <a href="http://www.freedesktop.org/wiki/Software_2fglitz" target="_blank" rel="external">glitz</a>，基于 OpenGL 实现了  Cairo。这里有一篇上佳的<a href="http://www.cs.umu.se/%7Ec99drn/opengl_freenix04.pdf" target="_blank" rel="external">论文</a>说明了glitz 的细节。既然  Cairo 同时实现了 xlib 和 OpenGL 后端，我们可以在两者间做一直接性能比较。在已发表的基准测试中，OpenGL 的速度在所有地方都以 10 到  100 比 1 的比率击溃了 XAA。这样巨大的性能差异正是由于 glitz/OpenGL 对图形芯片上3D硬件的运用。比较 glitz 和 xlib 上的  Cairo 是一个展现3D硬件具有在 2D 屏幕上绘制之完美能力的好方法。</p>DRI 与 OpenGL<p><a href="http://dri.sourceforge.net/doc/DRIintro.html" target="_blank" rel="external">DRI</a>，直接渲染机构<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote7" name="mxtctpcontent7" target="_blank" rel="external">7</a></sup>，实现了与 X 服务器协作的 <a href="http://www.opengl.org/" target="_blank" rel="external">OpenGL</a>。DRI 有四个主要<a href="http://www.freedesktop.org/%7Ejonsmirl/mesa.png" target="_blank" rel="external">组件</a>。首先，libGL 提供 OpenGL  API，并作为在多个驱动间的切换器。其次，存在一套用于编程图形芯片的硬件相关的 DRI 库。对于DRI 驱动未能提供的 OpenGL  特性你需要一套软件后备实现。这个后备实现由 <a href="http://mesa3d.sourceforge.net/" target="_blank" rel="external">Mesa</a> 提供。注意  Mesa 是一套完全的 OpenGL 软件实现。一块没有提供任何加速的卡仍然能够通过将每一个函数都交给 Mesa 来实现 OpenGL<sup><a href="http://blog.chinaunix.net/u/30686/showart.php?id=1945965#mxtctpnote8" name="mxtctpcontent8" target="_blank" rel="external">8</a></sup>。最后，就是 <a href="http://dri.freedesktop.org/wiki/DRM" target="_blank" rel="external">DRM</a>，直接渲染管理器。DRM  驱动运行于内核，管理着硬件并提供必要的安全保护。</p><p>DRI 有意思的方面在于名字当中的 direct 代表的那部分。每个使用 DRI  的应用程序直接(directly)对视频硬件编程。这和 X 大异其趣，在那里你发送绘制命令给服务器，由服务器代表你对硬件编程。 DRM  内核驱动协调多个用户防止冲突。此模型的优点在于 OpenGL  绘制能够在无须进程切换及传输数据至主控服务器开销的情况下发生。一个缺点是图形卡必须处理大量图形上下文切换。工作站级卡一般能应对裕如，但部分消费级卡不行。Microsoft  已经撞上这个问题，并要求 DirectX 10 硬件提供高级硬件上下文切换支持。</p><p>DRM 还实现了比普通用户拥有更多能力的主控用户的概念。这些额外能力允许图形设备被初始化以及GPU 资源的消耗受到控制。当前的 X  服务器，以根权限运行着，作为 DRM 主控用户工作。实际上并无 DRM 主控用户运行在根权限下的真实要求，而且存在一个初步的<a href="http://dri.freedesktop.org/%7Ejonsmirl/drm_no_root.patch" target="_blank" rel="external">补丁</a>移除此要求。</p><p>一旦硬件缺少某种特性，Mesa 就以软件实现它。这称为软件后备。人们有时被这个绕住了。他们说他们的 OpenGL  没有被完全加速而X服务器一切正常。再想想看。两款驱动都运行在相同的硬件上。 OpenGL 未能完全加速，因为它提供了很多需要加速能力的特性，而 X  仅提供少量此类特性。如果你利用了同时存在于两款驱动 API 中的特性，他们可能都会被加速。如果没有，那就开始动手编程来修复对应的驱动。</p>安全性与根权限<p>Linux 内核包含了约 1000 万行以根权限运行的代码。X 服务器包含了 1600  万行代码，其中大多数运行在根权限下。如果搜寻安全漏洞，你认为最好下注在哪一处呢？其实并无技术理由要求 X 服务器以根权限运行。打着跨平台兼容性的旗号，当前的 X  服务器以根权限运行，以便从用户空间直接对视频硬件编程。 Linux  有个方案针对这种情况。你可以把特权代码放到设备驱动里，无须特权即可运行用户空间应用。一款一般的显示卡的特权设备驱动在 100KB 左右。那可是比 1600  万行少得多的代码需要审核。</p>怀旧版硬件<p>任何视频硬件，低档至 <a href="http://en.wikipedia.org/wiki/VGA" target="_blank" rel="external">VGA</a>  适配器，都可以运行 X 服务器，而且 Mesa 会非常乐意以软件实现整个 OpenGL API。问题是有多快。并没有很多编程活动投注于将一块 VGA 卡变成  ATI X850。这些旧硬件能被当前的 X  服务器很好地支持。但是新系统的设计正围绕新的硬件展开，并且它们很可能在旧硬件上表现差劲。你也许应该考虑一下升级你的视频硬件；具有适当 OpenGL 性能的<a href="http://www.pricegrabber.com/search_getprod.php/masterid=3584847/search=radeon+9200" target="_blank" rel="external">全新图形卡能在  40$ 的价位买到</a>，二手价格甚至更低。作为替代，你也可选择不要升级，继续运行那些旧的对你已经够用的软件。</p>内核级图形支持<p>当内核开始引导，你面对的就是引导控制台。在 x86 平台上，最常见的引导控制台为 VGAcon。 VGAcon  使用你图形卡上的遗留硬件 VGA 支持。既然几乎所有 x86 图形卡都支持 VGA， VGAcon 为此平台提供了一个通用控制台。在非 x86  平台上你也许无法获得 VGA 硬件支持。在这类平台上你通常加载针对特定芯片的帧缓冲驱动。内核提供为数众多的 fbdev 驱动，由此范围相当广泛的硬件都被支持了。</p>VGA之余孽犹存<p>IBM PC 的原始设计定义了少数位于固定的、预知的地址的外部设备，例如 COM1 在 0x3F8。很不幸，大多数图形卡的 VGA  支持是这些位于固定地址的遗留设备之一。只要你的系统中仅存在一块图形卡，VGA 并不成问题。插入第二块，现在你有了两片都试图独占相同总线地址的硬件。</p><p>目前的 X 服务器包含处理多块 VGA 适配卡的代码。但是这些 X  服务器代码并不会感知到这些设备上的其他用户，而是会让他们乱作一团。搞乱这些程序并不好玩，所以我们需要某种方法来协调 VGA 设备的多个用户。Linux  上最佳方案就是向内核添加一套 VGA 仲裁机制。BenH 已经<a href="http://lists.freedesktop.org/pipermail/xorg/2005-March/006745.html" target="_blank" rel="external">动手在搞</a>一种  OLS 上讨论过的。</p><p>另一症结在于多块显卡的初始化。显卡具有 ROM，又称 VBIOS，在引导时执行以初始化硬件。出于历史原因，很多这类初始化用到了 VGA  支持。既然我们仅能有一块遗留 VGA 设备，系统 BIOS 转移了问题，仅初始化第一块显卡。在引导期间某个较迟的点初始化第二块卡也是可能的。这是通过以 vm86  模式运行第二个 VBIOS 并同等使用单个遗留 VGA 设备来达成。为了使问题更复杂，存在两种常见 ROM 格式即 x86 代码和 Open  Firmware。既然供应商对他们的 Open Firmware 型号收取高额费用，在非 x86 机器上使用 x86  视频硬件是很常见的。为了让这种做法可行，VBIOS 不得不使用 x86 仿真器来运行。BenH 也在为这个问题的一种方案工作。</p><p>Fbdev，又名帧缓冲。Linux  下，帧缓冲主要用途包括：初始化硬件，检测连接的显示设备，确定它们的有效模式，设定输出模式及配置，硬件光标，黑屏处理，色彩映射，取景和休眠/恢复。内核中存在大量帧缓冲驱动，它们实现了对这些特性程度不同的支持。请注意，尽管  fbdev 接口是基于内核的，并无障碍阻止存在实现于用户空间的辅助应用 fbdev 支持。辅助应用可用在缺少源代码的时候让 VBIOS 可用。</p><p>当你运行 VBIOS 时它建立一套非常低级的、用于控制显示的入口点。这事太细节化，我不准备解释 <a href="http://www.osdever.net/FreeVGA/vga/vga.htm" target="_blank" rel="external">VGA</a>、 <a href="http://www.delorie.com/djgpp/doc/rbinter/ix/10/" target="_blank" rel="external">Int10</a> 和 <a href="http://www.vesa.org/Public/VBE/vbecore3.pdf" target="_blank" rel="external">VESA</a> 之间的所有差异。作为概括， VGA 是  IBM 创立的基本硬件寄存器标准。 Int10 专注于用软件中断的方式处理显示输出。软件中断仅工作在 x86 实模式下，且除了 GRUB 之类很少被使用。支持  Int10 功能的代码来自 VBIOS，当 ROM 运行时被安装。仅允许存在一个被安装的 Int10 驱动。VESA 取代了 Int10  模式并扩展它到保护模式。配置内核时，有三个驱动： VGA 和 VESA fbdev， fbconsole 也需要加载运行，VGAcon 则总是必要的。在非  x86 系统你通常需要 fbdev 和 fbconsole。</p><br>……<br><br>篇幅限制，更多请参考原文~<br><br><hr><p> </p><strong>原文地址</strong> <a href="http://mxtctp.googlepages.com/GraphicsCN.html" target="_blank">http://mxtctp.googlepages.com/GraphicsCN.html</a><br><br><br><br><br><del>end</del> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2009/06/03/【zz】Linux-图形现状/" class="archive-article-date">
  	<time datetime="2009-06-03T07:21:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2009-06-03</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/linux-图形/">linux 图形</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/26/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><a class="page-number" href="/page/29/">29</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/28/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>