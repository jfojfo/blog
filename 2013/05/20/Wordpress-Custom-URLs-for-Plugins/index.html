<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Wordpress supports custom URL rewrites for search engine friendly URLs, but the fact is they can be a real pain in the ass for WP plugin authors. As is evidenced by the plethora of confused posts out">
<meta property="og:type" content="article">
<meta property="og:title" content="Wordpress Custom URLs for Plugins">
<meta property="og:url" content="http://blog.pickbox.me/2013/05/20/Wordpress-Custom-URLs-for-Plugins/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="Wordpress supports custom URL rewrites for search engine friendly URLs, but the fact is they can be a real pain in the ass for WP plugin authors. As is evidenced by the plethora of confused posts out">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wordpress Custom URLs for Plugins">
<meta name="twitter:description" content="Wordpress supports custom URL rewrites for search engine friendly URLs, but the fact is they can be a real pain in the ass for WP plugin authors. As is evidenced by the plethora of confused posts out">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2013/05/20/Wordpress-Custom-URLs-for-Plugins/"/>


  <title> Wordpress Custom URLs for Plugins | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Wordpress Custom URLs for Plugins
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2013-05-20T14:48:58+08:00" content="2013-05-20">
              2013-05-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index">
                    <span itemprop="name">wordpress</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Wordpress supports custom URL rewrites for search engine friendly URLs, but the fact is they can be a real pain in the ass for WP plugin authors. As is evidenced by the plethora of confused posts out there desperately seeking help with <a href="http://codex.wordpress.org/Rewrite_API/add_rewrite_rule" target="_blank" rel="external">add_rewrite_rule()</a> and <a href="http://codex.wordpress.org/Rewrite_API/add_rewrite_tag" target="_blank" rel="external">add_rewrite_tag()</a>, slapping a few new rules and custom querystring variables in your plugin’s functions.php just doesn’t always cut it.</p>
<p></p><h2>Custom URLs for Wordpress Plugins</h2><br>Take the following scenario: you have a custom plugin for displaying products on a Wordpress site, but there are thousands of products. Obviously you don’t want to use WP posts or pages to add every single product, so you probably have a unique interface for product management somewhere. Heck, maybe you’re even fetching the product info from a 3rd party source.<p></p>
<p>WP purists will whine that if it <strong>can</strong> work with built-in Wordpress posts and pages, then it<strong>should</strong> work with posts and pages. I disagree. Many websites get started with WP and want to expand beyond the limitations of the WP platform - that shouldn’t require an intensive migration of design, categories, posts, and everything else they have created, assuming they are happy with the WP platform for their blogging and basic CMS needs. But anyway, that’s a conversation for a different time.</p>
<p>That said - if your plugin doesn’t just piggyback the built-in posts and pages format, and you don’t want to create custom taxonomies that tie you in to the WP mechanisms, the solution might be to roll your own basic rules.</p>
<p></p><h2>Setting up Custom URLs</h2><br>Since many plugins are developed that work outside the scope of Wordpress pages, plugin authors can use custom templates with <a href="http://codex.wordpress.org/Plugin_API/Action_Reference#Template_Actions" target="_blank" rel="external">template_redirect()</a>. This is an easy way to create a unique interface for your plugin that you can do pretty much anything with.<p></p>
<p>But, let’s say you want to use a custom URL for your interface, and also need to access the URL variables from your custom template. For example, imagine you need an URL format like this:</p>
<p><code><a href="http://mysite.com/items/big-yellow-raincoat/" target="_blank" rel="external">http://mysite.com/items/big-yellow-raincoat/</a></code></p>
<p>Wouldn’t it be nice to call that URL, have the query string variables “items” and “big-yellow-raincoat” parsed out and automatically redirect to your custom template?</p>
<p>Wordpress has a whole slew of functions for <a href="http://codex.wordpress.org/Rewrite_API" target="_blank" rel="external">custom URL rewriting</a>, but they all tend to work around the existing structure of Wordpress page and post types.</p>
<p>After endless experimentation with <code>add_rewrite_rule()</code> and <code>add_rewrite_tag()</code>, as well as custom handling of <code>$wp-&gt;query_vars</code> and everything else in between, I have settled on a very simple implementation to essentially take control of the custom URLs and pass it along to a plugin interface.</p>
<p></p><h2>Coding a Custom URL Handler</h2><br>First, the basic approach is to set up a custom function for parsing the current URL.<p></p>
<p><div></div></p>
<p><div id="highlighter_906601"></div></p>
<p><pre>function my_url_handler()<br>{<br>    // Manually parse the URL request<br>    if(!empty($_SERVER[‘REQUEST_URI’]))<br>    {<br>        $urlvars = explode(‘/‘, $_SERVER[‘REQUEST_URI’]);<br>    }<br>}</pre><br><br><br>The above function <code>my_url_handler()</code> basically takes the current request URL from<code>$_SERVER[‘REQUEST_URI’]</code> and splits it up on the forward slashes. Then we can do WHATEVER WE WANT with it.</p>
<p>So, after running this, the <code>$urlvars</code> array will contain the elements from our URL in the example above:</p>
<p><div></div></p>
<p><div id="highlighter_798184"></div></p>
<p><pre>[0] =&gt; ‘items’,<br>[1] =&gt; ‘big-yellow-raincoat’</pre><br><br><br>Typically, the first element in the URL contains important information about our “view” (or the interface that will process the request). Then the second element will contain the data - in this case, a unique ID string.</p>
<p>So, we can expand our function to check for these elements and then set our $_REQUEST variables explicitly, where they can then be accessed from the rest of our plugin just like they were passed by a browser.</p>
<p><div></div></p>
<p><div id="highlighter_499672"></div></p>
<p><pre>function my_url_handler()<br>{<br>    // Manually parse the URL request<br>    if(!empty($_SERVER[‘REQUEST_URI’]))<br>    {<br>        $urlvars = explode(‘/‘, $_SERVER[‘REQUEST_URI’]);<br>    }</pre></p>
<pre><code>// Check for querystring variables
if((!empty($urlvars[1])) &amp;amp;&amp;amp; (!empty($urlvars[2])))
{
    $_REQUEST[&apos;myview&apos;] = $urlvars[1];

    if($urlvars[1] == &apos;item&apos;)
    {
        // Set the $_REQUEST vars
        $_REQUEST[&apos;myid&apos;] = $urlvars[2];

        // Redirect to custom plugin template for &quot;item&quot; view
        add_action(&apos;template_redirect&apos;, &apos;my_custom_item_template&apos;);
    }

    // ... handle multiple types of URL by checking $urlvars[1] here
}
</code></pre><p>}<br><br><br>There! Now our little function parses the URL, checks the first element to determine our view, then sets the view and URL data in the <a href="http://us3.php.net/manual/en/reserved.variables.request.php" target="_blank" rel="external">$_REQUEST array</a> ($_REQUEST is an associative array that contains all the HTTP request variables GET, POST and COOKIE). It then registers the template_redirect for our custom template for that view.</p>
<p>The final step is just to add a hook to <code>parse_request</code> for the new function, generally add the end of your plugin’s functions.php file:</p>
<p><div></div></p>
<p><div id="highlighter_268778"></div></p>
<p><pre>add_action(‘parse_request’, ‘my_url_handler’);</pre><br><br><br>Now, when your custom plugin template runs, you can just access the variables in $_REQUEST to get the unique ID, view, etc.</p>
<p>The next steps are filtering the page titles to ensure that you don’t see “Page Not Found” in the browser title, and further testing to make sure that WP doesn’t spit any 404’s out because it couldn’t find your content. However, that’s a subject for another post.</p>
<p>This method is simple, clean, and requires virtually no built-in WP methods. Wordpress purists may be seething in a fit of rage right now, and if that’s the case I invite them all to seriously improve Wordpress custom URL handling for plugin authors.</p>
<p>refer:</p>
<ul><br>    <li><a href="http://gabrielharper.com/blog/2012/09/wordpress-custom-urls-for-plugins/" target="_blank">wordpress-custom-urls-for-plugins</a></li><br>    <li><a href="http://www.rlmseo.com/blog/passing-get-query-string-parameters-in-wordpress-url/" target="_blank" rel="external">passing-get-query-string-parameters-in-wordpress-url</a></li><br>    <li><a href="http://www.mihaivalentin.com/wordpress-tutorial-load-the-template-you-want-with-template_redirect/" target="_blank" rel="external">wordpress-tutorial-load-the-template-you-want-with-template_redirect</a></li><br></ul>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2013/05/06/Loading-JavaScript-without-blocking/" rel="next" title="Loading JavaScript without blocking">
                <i class="fa fa-chevron-left"></i> Loading JavaScript without blocking
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2013/05/21/记录一下从百度hi迁移博客过程/" rel="prev" title="记录一下从百度hi迁移博客过程">
                记录一下从百度hi迁移博客过程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">595</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">Custom URLs for Wordpress Plugins</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">Setting up Custom URLs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">Coding a Custom URL Handler</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  
<script type="text/javascript" src="http://p.pickbox.me/js/pv.js"></script>



</body>
</html>
