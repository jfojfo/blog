<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>OBJECT AND LIBRARY ORDERING | jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">
<meta property="og:type" content="article">
<meta property="og:title" content="OBJECT AND LIBRARY ORDERING">
<meta property="og:url" content="http://blog.pickbox.me/2007/10/01/OBJECT-AND-LIBRARY-ORDERING/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">
<meta property="og:updated_time" content="2016-10-15T04:38:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OBJECT AND LIBRARY ORDERING">
<meta name="twitter:description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-OBJECT-AND-LIBRARY-ORDERING" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      OBJECT AND LIBRARY ORDERING
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> OBJECT AND LIBRARY ORDERING<br><br>  The ordering of object files, archive libraries, and shared libraries on<br>  the command line affects how symbols are resolved. For example, if an<br>  archive library appears before an object file or shared library that refer-<br>  ences one of its symbols, the linker may report that symbol as unresolved.<br><br>  Unresolved symbol errors can be avoided by adhering to the following<br>  suggestions:<br><br>    +  Object files should be ordered before all archive libraries and shared<br>       libraries.<br><br>    +  If archives and shared libraries cannot be specified in dependency<br>       order, shared libraries should be ordered before archive libraries.<br><br>    +  If necessary, archives can be specified more than once on the ld com-<br>       mand line to handle unresolved symbols that were encountered after<br>       previous symbol-resolution passes through the archives.<br><br>  Symbols defined in object files are always included in the output object.<br>  Ordering object files first might prevent the inclusion of conflicting sym-<br>  bols that are also defined in archive libraries or shared libraries speci-<br>  fied on the ld command line.<br>  Both of the following two link OK:</p><p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt<em>.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </em></p><p>                                    ld -static -o hello foo.o hello.o /usr/lib/crt.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </p><br><br>As each object, archive library, and shared library is processed by the<br>  linker, new symbol definitions and references are added to the output<br>  object. If a symbol reference is added for a symbol that does not yet have<br>  an associated symbol definition, it is an &quot;undefined&quot; symbol.  The linker<br>  must find a definition of every undefined symbol. The definition must exist<br>  in either an object, archive, or shared library specified on the command<br>  line. Archives and shared libraries are processed in the following ways:<br><br>    +  When the linker processes an archive library, it extracts objects from<br>       the archive that define any symbols that are currently undefined.  As<br>       each object is extracted from an archive library, the linker processes<br>       the object, identifies any additional undefined symbols, and extracts<br>       the objects that define those symbols.<br>  The following links OK:<br><p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt<em>.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </em></p> But the following produces error, since libc.a depends on some functions on <br> libgcc.a:<p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt.o  -L<code>gcc -print-file-name=</code> -lgcc -lc<br><br>/usr/lib/libc.a(strtoll.o)(.text+0x104): In function <code>__strtoll_internal&#39;:&lt;br /&gt;: undefined reference to</code><strong>udivdi3’<br>/usr/lib/libc.a(strtoll.o)(.text+0x118): In function `</strong>strtoll_internal’:<br>: undefined reference to <code>__umoddi3&#39;&lt;br /&gt;/usr/lib/libc.a(strtoull.o)(.text+0x104): In function</code><strong>strtoull_internal’:<br>: undefined reference to `</strong>udivdi3’<br>/usr/lib/libc.a(strtoull.o)(.text+0x118): In function <code>__strtoull_internal&#39;:&lt;br /&gt;: undefined reference to</code>__umoddi3’                        </p>  The following is another demenstration:<p>                                    ar -q libfoo.a foo.o<br>ld -static -o hello hello.o /usr/lib/crt<em>.o  -L. -lfoo -L<code>gcc -print-file-name=</code> -lc -lgcc<br><br>ld -static -o hello -lfoo hello.o /usr/lib/crt</em>.o  -L. -L<code>gcc -print-file-name=</code> -lc -lgcc<br>hello.o(.text+0x21): In function <code>main&#39;:&lt;br /&gt;: undefined reference to</code>foo’                        </p><br><br>+  When the linker processes a shared library, it extracts symbol defini-<br>       tions from the shared library for symbols that are currently unde-<br>       fined.  These symbol definitions are added to the output object. The<br>       shared library might also define many symbols that are not added to<br>       the output object. These symbols will not be considered as additional<br>       objects (archive libraries and shared libraries) are processed; how-<br>       ever, the linker does not report these symbols as unresolved if they<br>       are referenced in objects ordered after the shared library on the com-<br>       mand line. /<em> by jfo: ie they are remembered by the linker, if referenced<br> later by object files(not archive libraries or shared libraries), add them; <br> if not, discard them when generating the final object. If it is the .a or .so<br> libraries referenced them, it will be undefined. </em>/<p>                                    gcc -shared -fpic foo.c -o libfoo.so<br>gcc -shared -fpic foo2.c -o libfoo2.so<br>ld –dynamic-linker /lib/ld-linux.so.2  -L. -L<code>gcc -print-file-name=</code> -lfoo -lfoo2 -lc -lgcc_s  -o hello hello.o /usr/lib/crt<em>.o -lc<br>ld –dynamic-linker /lib/ld-linux.so.2  -L. -L<code>gcc -print-file-name=</code> -lfoo2 -lfoo -lc -lgcc_s  -o hello hello.o /usr/lib/crt</em>.o -lc<br>why are they the same???<br>The later is expected to fail! But it passed.                        </p><br>       The linker also identifies new undefined symbols while processing a<br>       shared library. These undefined symbols are not added to the output<br>       object and are not reported as unresolved, but the linker does con-<br>       sider these undefined symbols as it processes additional objects on<br>       the command line. /<em> by jfo: ie when defined later, the linker will probably<br> resolved it. </em>/<br><br>  The following will link OK, /<em> libc.so depends on libgcc_s.so ? </em>/<p>                                    ld –dynamic-linker /lib/ld-linux.so.2 -o hello hello.o foo.o  /usr/lib/crt<em>.o -L<code>gcc -print-file-name=</code> -lc<br>/</em>ld –dynamic-linker /lib/ld-linux.so.2 -o hello hello.o foo.o  /usr/lib/crt<em>.o -L<code>gcc -print-file-name=</code> -lgcc_s -lc</em>/                        </p><br><br><br><br><strong>sample codes (Redhat9 gcc version 3.2.2 20030222 (Red Hat Linux 3.2.2-5))</strong><p> </p><p> </p><p> </p><br><br><br><br><br><br><br><br><br> <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2007/10/01/OBJECT-AND-LIBRARY-ORDERING/" class="archive-article-date">
  	<time datetime="2007-10-01T10:45:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2007-10-01</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2007/10/24/Makefile/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          Makefile
        
      </div>
    </a>
  
  
    <a href="/2007/09/30/【zz】Win-2003单网卡实现VPN-NAT完整攻略/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">【zz】Win 2003单网卡实现VPN+NAT完整攻略</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>









      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>