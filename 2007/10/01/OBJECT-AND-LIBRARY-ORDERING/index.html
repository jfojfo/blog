<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">
<meta property="og:type" content="article">
<meta property="og:title" content="OBJECT AND LIBRARY ORDERING">
<meta property="og:url" content="http://blog.pickbox.cc/2007/10/01/OBJECT-AND-LIBRARY-ORDERING/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">
<meta property="og:updated_time" content="2017-06-07T05:03:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OBJECT AND LIBRARY ORDERING">
<meta name="twitter:description" content="OBJECT AND LIBRARY ORDERING  The ordering of object files, archive libraries, and shared libraries on  the command line affects how symbols are resolved. For example, if an  archive library appears b">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.cc/2007/10/01/OBJECT-AND-LIBRARY-ORDERING/"/>


  <title> OBJECT AND LIBRARY ORDERING | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OBJECT AND LIBRARY ORDERING
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2007-10-01T18:45:00+08:00" content="2007-10-01">
              2007-10-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/gcc-binutils-make-共享库/" itemprop="url" rel="index">
                    <span itemprop="name">gcc/binutils/make/共享库</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> OBJECT AND LIBRARY ORDERING<br><br>  The ordering of object files, archive libraries, and shared libraries on<br>  the command line affects how symbols are resolved. For example, if an<br>  archive library appears before an object file or shared library that refer-<br>  ences one of its symbols, the linker may report that symbol as unresolved.<br><br>  Unresolved symbol errors can be avoided by adhering to the following<br>  suggestions:<br><br>    +  Object files should be ordered before all archive libraries and shared<br>       libraries.<br><br>    +  If archives and shared libraries cannot be specified in dependency<br>       order, shared libraries should be ordered before archive libraries.<br><br>    +  If necessary, archives can be specified more than once on the ld com-<br>       mand line to handle unresolved symbols that were encountered after<br>       previous symbol-resolution passes through the archives.<br><br>  Symbols defined in object files are always included in the output object.<br>  Ordering object files first might prevent the inclusion of conflicting sym-<br>  bols that are also defined in archive libraries or shared libraries speci-<br>  fied on the ld command line.<br>  Both of the following two link OK:</p><p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt<em>.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </em></p><p>                                    ld -static -o hello foo.o hello.o /usr/lib/crt.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </p><br><br>As each object, archive library, and shared library is processed by the<br>  linker, new symbol definitions and references are added to the output<br>  object. If a symbol reference is added for a symbol that does not yet have<br>  an associated symbol definition, it is an &quot;undefined&quot; symbol.  The linker<br>  must find a definition of every undefined symbol. The definition must exist<br>  in either an object, archive, or shared library specified on the command<br>  line. Archives and shared libraries are processed in the following ways:<br><br>    +  When the linker processes an archive library, it extracts objects from<br>       the archive that define any symbols that are currently undefined.  As<br>       each object is extracted from an archive library, the linker processes<br>       the object, identifies any additional undefined symbols, and extracts<br>       the objects that define those symbols.<br>  The following links OK:<br><p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt<em>.o  -L<code>gcc -print-file-name=</code> -lc -lgcc                        </em></p> But the following produces error, since libc.a depends on some functions on <br> libgcc.a:<p>                                    ld -static -o hello hello.o foo.o /usr/lib/crt.o  -L<code>gcc -print-file-name=</code> -lgcc -lc<br><br>/usr/lib/libc.a(strtoll.o)(.text+0x104): In function <code>__strtoll_internal&#39;:&lt;br /&gt;: undefined reference to</code><strong>udivdi3’<br>/usr/lib/libc.a(strtoll.o)(.text+0x118): In function `</strong>strtoll_internal’:<br>: undefined reference to <code>__umoddi3&#39;&lt;br /&gt;/usr/lib/libc.a(strtoull.o)(.text+0x104): In function</code><strong>strtoull_internal’:<br>: undefined reference to `</strong>udivdi3’<br>/usr/lib/libc.a(strtoull.o)(.text+0x118): In function <code>__strtoull_internal&#39;:&lt;br /&gt;: undefined reference to</code>__umoddi3’                        </p>  The following is another demenstration:<p>                                    ar -q libfoo.a foo.o<br>ld -static -o hello hello.o /usr/lib/crt<em>.o  -L. -lfoo -L<code>gcc -print-file-name=</code> -lc -lgcc<br><br>ld -static -o hello -lfoo hello.o /usr/lib/crt</em>.o  -L. -L<code>gcc -print-file-name=</code> -lc -lgcc<br>hello.o(.text+0x21): In function <code>main&#39;:&lt;br /&gt;: undefined reference to</code>foo’                        </p><br><br>+  When the linker processes a shared library, it extracts symbol defini-<br>       tions from the shared library for symbols that are currently unde-<br>       fined.  These symbol definitions are added to the output object. The<br>       shared library might also define many symbols that are not added to<br>       the output object. These symbols will not be considered as additional<br>       objects (archive libraries and shared libraries) are processed; how-<br>       ever, the linker does not report these symbols as unresolved if they<br>       are referenced in objects ordered after the shared library on the com-<br>       mand line. /<em> by jfo: ie they are remembered by the linker, if referenced<br> later by object files(not archive libraries or shared libraries), add them; <br> if not, discard them when generating the final object. If it is the .a or .so<br> libraries referenced them, it will be undefined. </em>/<p>                                    gcc -shared -fpic foo.c -o libfoo.so<br>gcc -shared -fpic foo2.c -o libfoo2.so<br>ld –dynamic-linker /lib/ld-linux.so.2  -L. -L<code>gcc -print-file-name=</code> -lfoo -lfoo2 -lc -lgcc_s  -o hello hello.o /usr/lib/crt<em>.o -lc<br>ld –dynamic-linker /lib/ld-linux.so.2  -L. -L<code>gcc -print-file-name=</code> -lfoo2 -lfoo -lc -lgcc_s  -o hello hello.o /usr/lib/crt</em>.o -lc<br>why are they the same???<br>The later is expected to fail! But it passed.                        </p><br>       The linker also identifies new undefined symbols while processing a<br>       shared library. These undefined symbols are not added to the output<br>       object and are not reported as unresolved, but the linker does con-<br>       sider these undefined symbols as it processes additional objects on<br>       the command line. /<em> by jfo: ie when defined later, the linker will probably<br> resolved it. </em>/<br><br>  The following will link OK, /<em> libc.so depends on libgcc_s.so ? </em>/<p>                                    ld –dynamic-linker /lib/ld-linux.so.2 -o hello hello.o foo.o  /usr/lib/crt<em>.o -L<code>gcc -print-file-name=</code> -lc<br>/</em>ld –dynamic-linker /lib/ld-linux.so.2 -o hello hello.o foo.o  /usr/lib/crt<em>.o -L<code>gcc -print-file-name=</code> -lgcc_s -lc</em>/                        </p><br><br><br><br><strong>sample codes (Redhat9 gcc version 3.2.2 20030222 (Red Hat Linux 3.2.2-5))</strong><p> </p><p> </p><p> </p><br><br><br><br><br><br><br><br><br> <p></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2007/09/30/【zz】Win-2003单网卡实现VPN-NAT完整攻略/" rel="next" title="【zz】Win 2003单网卡实现VPN+NAT完整攻略">
                <i class="fa fa-chevron-left"></i> 【zz】Win 2003单网卡实现VPN+NAT完整攻略
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2007/10/24/Makefile/" rel="prev" title="Makefile">
                Makefile <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">604</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  
<script type="text/javascript" src="http://p.pickbox.me/js/pv.js"></script>



</body>
</html>
