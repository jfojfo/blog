<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="jfo, blog" />





  <link rel="alternate" href="/atom.xml" title="jfo planet" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="另参考：Android的智能指针——http://ytydyd.blog.sohu.com/139278565.html理解 Java 的 GC 与 幽灵引用Java 中一共有 4 种类型的引用 : StrongReference、 SoftReference、 WeakReference 以及 PhantomReference (传说中的幽灵引用 呵呵), 这 4 种类型的引用与 GC 有着密">
<meta property="og:type" content="article">
<meta property="og:title" content="【zz】理解 Java 的 GC 与 幽灵引用">
<meta property="og:url" content="http://blog.pickbox.me/2010/07/04/【zz】理解-Java-的-GC-与-幽灵引用/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="另参考：Android的智能指针——http://ytydyd.blog.sohu.com/139278565.html理解 Java 的 GC 与 幽灵引用Java 中一共有 4 种类型的引用 : StrongReference、 SoftReference、 WeakReference 以及 PhantomReference (传说中的幽灵引用 呵呵), 这 4 种类型的引用与 GC 有着密">
<meta property="og:updated_time" content="2016-10-15T05:24:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【zz】理解 Java 的 GC 与 幽灵引用">
<meta name="twitter:description" content="另参考：Android的智能指针——http://ytydyd.blog.sohu.com/139278565.html理解 Java 的 GC 与 幽灵引用Java 中一共有 4 种类型的引用 : StrongReference、 SoftReference、 WeakReference 以及 PhantomReference (传说中的幽灵引用 呵呵), 这 4 种类型的引用与 GC 有着密">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://blog.pickbox.me/2010/07/04/【zz】理解-Java-的-GC-与-幽灵引用/"/>


  <title> 【zz】理解 Java 的 GC 与 幽灵引用 | jfo planet </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jfo planet</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hope is the best gift that tomorrow gives.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                【zz】理解 Java 的 GC 与 幽灵引用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2010-07-04T15:01:00+08:00" content="2010-07-04">
              2010-07-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p> 另参考：Android的智能指针——<a href="http://ytydyd.blog.sohu.com/139278565.html" target="_blank" rel="external">http://ytydyd.blog.sohu.com/139278565.html</a><br></p><p><a href="http://www.javaeye.com/topic/401478?page=4" target="_blank">理解 Java 的 GC 与 幽灵引用</a><br><br>Java 中一共有 4 种类型的引用 : StrongReference、 SoftReference、 WeakReference 以及 PhantomReference (传说中的幽灵引用 呵呵), <br>这 4 种类型的引用与 GC 有着密切的关系,&#160; 让我们逐一来看它们的定义和使用场景 :<br><br>1. Strong Reference<br><br>StrongReference 是 Java 的默认引用实现,&#160; 它会尽可能长时间的存活于 JVM 内， 当没有任何对象指向它时 GC 执行后将会被回收</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;strongReference()&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;referent&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/<strong>&#160;</strong></li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;通过赋值创建&#160;StrongReference&#160;&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;strongReference&#160;=&#160;referent;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertSame(referent,&#160;strongReference);&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;referent&#160;=&#160;null;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;System.gc();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;StrongReference&#160;在&#160;GC&#160;后不会被回收&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNotNull(strongReference);&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void strongReference() {   Object referent = new Object();      /<strong>    <em> 通过赋值创建 StrongReference     </em>/   Object strongReference = referent;      assertSame(referent, strongReference);      referent = null;   System.gc();      /</strong>    <em> StrongReference 在 GC 后不会被回收    </em>/   assertNotNull(strongReference);  }<p><br><br><br><br>2. WeakReference &amp; WeakHashMap<br><br>WeakReference， 顾名思义,&#160; 是一个弱引用,&#160; 当所引用的对象在 JVM 内不再有强引用时, GC 后 weak reference 将会被自动回收</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;weakReference()&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;referent&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;WeakReference&lt;Object&gt;&#160;weakRerference&#160;=&#160;new&#160;WeakReference&lt;Object&gt;(referent);&#160;&#160;</li> <li>&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertSame(referent,&#160;weakRerference.get());&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;referent&#160;=&#160;null;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;System.gc();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/<strong>&#160;</strong></li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;一旦没有指向&#160;referent&#160;的强引用,&#160;weak&#160;reference&#160;在&#160;GC&#160;后会被自动回收&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNull(weakRerference.get());&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void weakReference() {   Object referent = new Object();   WeakReference&lt;Object&gt; weakRerference = new WeakReference&lt;Object&gt;(referent);     assertSame(referent, weakRerference.get());      referent = null;   System.gc();      /    <em> 一旦没有指向 referent 的强引用, weak reference 在 GC 后会被自动回收    </em>/   assertNull(weakRerference.get());  }<p><br><br><br>WeakHashMap 使用 WeakReference 作为 key， 一旦没有指向 key 的强引用, WeakHashMap 在 GC 后将自动删除相关的 entry</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;weakHashMap()&#160;throws&#160;InterruptedException&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Map&lt;Object,&#160;Object&gt;&#160;weakHashMap&#160;=&#160;new&#160;WeakHashMap&lt;Object,&#160;Object&gt;();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;key&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;value&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;weakHashMap.put(key,&#160;value);&#160;&#160;</li> <li>&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertTrue(weakHashMap.containsValue(value));&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;key&#160;=&#160;null;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;System.gc();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/<strong>&#160;</strong></li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;等待无效&#160;entries&#160;进入&#160;ReferenceQueue&#160;以便下一次调用&#160;getTable&#160;时被清理&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Thread.sleep(1000);&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;一旦没有指向&#160;key&#160;的强引用,&#160;WeakHashMap&#160;在&#160;GC&#160;后将自动删除相关的&#160;entry&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertFalse(weakHashMap.containsValue(value));&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void weakHashMap() throws InterruptedException {   Map&lt;Object, Object&gt; weakHashMap = new WeakHashMap&lt;Object, Object&gt;();   Object key = new Object();   Object value = new Object();   weakHashMap.put(key, value);     assertTrue(weakHashMap.containsValue(value));      key = null;   System.gc();      /<strong>    <em> 等待无效 entries 进入 ReferenceQueue 以便下一次调用 getTable 时被清理    </em>/   Thread.sleep(1000);      /</strong>    <em> 一旦没有指向 key 的强引用, WeakHashMap 在 GC 后将自动删除相关的 entry    </em>/   assertFalse(weakHashMap.containsValue(value));  }<p><br><br><br>3. SoftReference<br><br>SoftReference 于 WeakReference 的特性基本一致， 最大的区别在于 SoftReference 会尽可能长的保留引用直到 JVM 内存不足时才会被回收(虚拟机保证), 这一特性使得 SoftReference 非常适合缓存应用</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;softReference()&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;referent&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;SoftReference&lt;Object&gt;&#160;softRerference&#160;=&#160;new&#160;SoftReference&lt;Object&gt;(referent);&#160;&#160;</li> <li>&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNotNull(softRerference.get());&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;referent&#160;=&#160;null;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;System.gc();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/<strong>&#160;</strong></li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;&#160;soft&#160;references&#160;只有在&#160;jvm&#160;OutOfMemory&#160;之前才会被回收,&#160;所以它非常适合缓存应用&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNotNull(softRerference.get());&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void softReference() {   Object referent = new Object();   SoftReference&lt;Object&gt; softRerference = new SoftReference&lt;Object&gt;(referent);     assertNotNull(softRerference.get());      referent = null;   System.gc();      /    <em>  soft references 只有在 jvm OutOfMemory 之前才会被回收, 所以它非常适合缓存应用    </em>/   assertNotNull(softRerference.get());  }<p><br><br><br>4. PhantomReference<br><br>作为本文主角， Phantom Reference(幽灵引用) 与 WeakReference 和 SoftReference 有很大的不同,&#160; 因为它的 get() 方法永远返回 null, 这也正是它名字的由来</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;phantomReferenceAlwaysNull()&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;referent&#160;=&#160;new&#160;Object();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;PhantomReference&lt;Object&gt;&#160;phantomReference&#160;=&#160;new&#160;PhantomReference&lt;Object&gt;(referent,&#160;new&#160;ReferenceQueue&lt;Object&gt;());&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;/<strong>&#160;</strong></li> <li>&#160;&#160;&#160;&#160;&#160;<em>&#160;phantom&#160;reference&#160;的&#160;get&#160;方法永远返回&#160;null&#160;&#160;</em></li> <li>&#160;&#160;&#160;&#160;&#160;/&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNull(phantomReference.get());&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void phantomReferenceAlwaysNull() {   Object referent = new Object();   PhantomReference&lt;Object&gt; phantomReference = new PhantomReference&lt;Object&gt;(referent, new ReferenceQueue&lt;Object&gt;());      /    <em> phantom reference 的 get 方法永远返回 null     </em>/   assertNull(phantomReference.get());  }<p><br><br>诸位可能要问, 一个永远返回 null 的 reference 要来何用,&#160; 请注意构造 PhantomReference 时的第二个参数 ReferenceQueue(事实上 WeakReference &amp; SoftReference 也可以有这个参数)，<br>PhantomReference 唯一的用处就是跟踪 referent&#160; 何时被 enqueue 到 ReferenceQueue 中.<br><br>5. RererenceQueue<br><br>当一个 WeakReference 开始返回 null 时， 它所指向的对象已经准备被回收， 这时可以做一些合适的清理工作.&#160;&#160; 将一个 ReferenceQueue 传给一个 Reference 的构造函数， 当对象被回收时， 虚拟机会自动将这个对象插入到 ReferenceQueue 中， WeakHashMap 就是利用 ReferenceQueue 来清除 key 已经没有强引用的 entries.</p>Java代码<ol> <li>@Test&#160;&#160;</li> <li>public&#160;void&#160;referenceQueue()&#160;throws&#160;InterruptedException&#160;{&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Object&#160;referent&#160;=&#160;new&#160;Object();&#160;&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;ReferenceQueue&lt;Object&gt;&#160;referenceQueue&#160;=&#160;new&#160;ReferenceQueue&lt;Object&gt;();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;WeakReference&lt;Object&gt;&#160;weakReference&#160;=&#160;new&#160;WeakReference&lt;Object&gt;(referent,&#160;referenceQueue);&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertFalse(weakReference.isEnqueued());&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Reference&lt;?&#160;extends&#160;Object&gt;&#160;polled&#160;=&#160;referenceQueue.poll();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNull(polled);&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;referent&#160;=&#160;null;&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;System.gc();&#160;&#160;</li> <li>&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertTrue(weakReference.isEnqueued());&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;Reference&lt;?&#160;extends&#160;Object&gt;&#160;removed&#160;=&#160;referenceQueue.remove();&#160;&#160;</li> <li>&#160;&#160;&#160;&#160;assertNotNull(removed);&#160;&#160;</li> <li>}&#160;&#160;</li></ol>@Test  public void referenceQueue() throws InterruptedException {   Object referent = new Object();     ReferenceQueue&lt;Object&gt; referenceQueue = new ReferenceQueue&lt;Object&gt;();   WeakReference&lt;Object&gt; weakReference = new WeakReference&lt;Object&gt;(referent, referenceQueue);      assertFalse(weakReference.isEnqueued());   Reference&lt;? extends Object&gt; polled = referenceQueue.poll();   assertNull(polled);      referent = null;   System.gc();    assertTrue(weakReference.isEnqueued());   Reference&lt;? extends Object&gt; removed = referenceQueue.remove();   assertNotNull(removed);  }<p><br><br>6.&#160; PhantomReference&#160; vs WeakReference<br><br>PhantomReference&#160; 有两个好处， 其一， 它可以让我们准确地知道对象何时被从内存中删除， 这个特性可以被用于一些特殊的需求中(例如 Distributed GC，&#160; XWork 和 google-guice 中也使用 PhantomReference 做了一些清理性工作). <br><br>其二， 它可以避免 finalization 带来的一些根本性问题, 上文提到 PhantomReference 的唯一作用就是跟踪 referent 何时被 enqueue 到 ReferenceQueue 中,&#160; 但是 WeakReference 也有对应的功能, 两者的区别到底在哪呢 ?<br>这就要说到 Object 的 finalize 方法, 此方法将在 gc 执行前被调用, 如果某个对象重载了 finalize 方法并故意在方法内创建本身的强引用,&#160; 这将导致这一轮的 GC 无法回收这个对象并有可能<br>引 起任意次 GC， 最后的结果就是明明 JVM 内有很多 Garbage 却 OutOfMemory， 使用 PhantomReference 就可以避免这个问题， 因为 PhantomReference 是在 finalize 方法执行后回收的，也就意味着此时已经不可能拿到原来的引用,&#160; 也就不会出现上述问题,&#160; 当然这是一个很极端的例子, 一般不会出现. <br><br>7. 对比<br><br>taken from&#160;<a href="http://mindprod.com/jgloss/phantom.html" target="_blank" rel="external">http://mindprod.com/jgloss/phantom.html</a></p>                        Soft vs Weak vs Phantom References                            Type            Purpose            Use            When GCed            Implementing Class                                    Strong Reference            An ordinary reference. Keeps objects alive as long as they are referenced.            normal reference.            Any object not pointed to can be reclaimed.            default                            Soft Reference            Keeps objects alive provided there’s enough memory.            to keep objects alive even after clients have removed their references (memory-sensitive caches), in case clients start asking for them again by key.            After a first gc pass, the JVM decides it still needs to reclaim more space.            java.lang.ref.SoftReference                            Weak Reference            Keeps objects alive only while they’re in use (reachable) by clients.            Containers that automatically delete objects no longer in use.            After gc determines the object is only weakly reachable            java.lang.ref.WeakReference&#160;<br>            java.util.WeakHashMap                            Phantom Reference            Lets you clean up after finalization but before the space is reclaimed (replaces or augments the use offinalize())            Special clean up processing <p></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2010/06/29/解决android2-1中Youku每次都要选择默认播放器的问题/" rel="next" title="解决android2.1中Youku每次都要选择默认播放器的问题">
                <i class="fa fa-chevron-left"></i> 解决android2.1中Youku每次都要选择默认播放器的问题
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2010/07/04/【zz】How-to-Handle-Java-Finalization-s-Memory-Retention-Issues/" rel="prev" title="【zz】How to Handle Java Finalization's Memory-Retention Issues">
                【zz】How to Handle Java Finalization's Memory-Retention Issues <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/wp-content/uploads/penguin.gif"
               alt="jfo" />
          <p class="site-author-name" itemprop="name">jfo</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">601</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jfojfo" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jfojfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pickbox.me" title="收藏夹" target="_blank">收藏夹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://note.pickbox.me" title="网络剪贴板" target="_blank">网络剪贴板</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://iguangba.pickbox.me" title="爱逛吧" target="_blank">爱逛吧</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2007 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jfo</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  

  
<script type="text/javascript" src="http://p.pickbox.me/js/pv.js"></script>



</body>
</html>
