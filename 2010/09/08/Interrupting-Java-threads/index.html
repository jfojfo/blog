<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Interrupting Java threads | jfo planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="mySamplevoid run() {    try {        while (!sFlagExit) {            [I/O operation];            [wait/sleep operation];        }    } catch (InterruptedException e) {        …    } catch (ClosedByIn">
<meta property="og:type" content="article">
<meta property="og:title" content="Interrupting Java threads">
<meta property="og:url" content="http://blog.pickbox.me/2010/09/08/Interrupting-Java-threads/index.html">
<meta property="og:site_name" content="jfo planet">
<meta property="og:description" content="mySamplevoid run() {    try {        while (!sFlagExit) {            [I/O operation];            [wait/sleep operation];        }    } catch (InterruptedException e) {        …    } catch (ClosedByIn">
<meta property="og:updated_time" content="2016-10-15T04:38:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Interrupting Java threads">
<meta name="twitter:description" content="mySamplevoid run() {    try {        while (!sFlagExit) {            [I/O operation];            [wait/sleep operation];        }    } catch (InterruptedException e) {        …    } catch (ClosedByIn">
  
    <link rel="alternative" href="/atom.xml" title="jfo planet" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.ico">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">jfo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">分类</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">jfo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://img.pickbox.me/wp-content/uploads/penguin.gif" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">jfo</h1>
			</hgroup>
			
			<p class="header-subtitle">Hope is the best gift that tomorrow gives.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/jfojfo" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/jfojfo" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-Interrupting-Java-threads" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Interrupting Java threads
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> <br><br><del>my</del><br><br><strong>Sample</strong><br>void run() {<br>    try {<br>        while (!sFlagExit) {<br>            [I/O operation];<br>            [wait/sleep operation];<br>        }<br>    } catch (InterruptedException e) {<br>        …<br>    } catch (ClosedByInterruptException e) {<br>        …<br>    } catch (IOException e) {<br>        …<br>    }<br>}<br><del>my</del><br><br><br><br><br><a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html" target="_blank">Interrupting Java threads</a><br></p><p><strong>Takeaway:</strong> Multithreading presents a whole set  of new challenges to the programmer that, if not correctly addressed,  can lead to unexpected behavior and hard-to-find errors. In this article  we address one of those challenges: how to interrupt a running thread.</p><br>Writing multithreaded programs in Java, with its built-in  support for threads, is fairly straightforward. However, multithreading  presents a whole set of new challenges to the programmer that, if not  correctly addressed, can lead to unexpected behavior and subtle,  hard-to-find errors. In this article, we address one of those  challenges: how to interrupt a running thread.<br><br><strong>Background</strong><br>Interrupting  a thread means stopping what it is doing before it has completed its  task, effectively aborting its current operation. Whether the thread  dies, waits for new tasks, or goes on to the next step depends on the  application.<br><br>Although it may seem simple at first, you must take  some precautions in order to achieve the desired result. There are some  caveats you must be aware of as well.<br><br>First of all, forget the <em>Thread.stop</em> method. Although it indeed stops a running thread, the method is unsafe and was <a href="http://java.sun.com/j2se/1.3/docs/guide/misc/threadPrimitiveDeprecation.html" target="_target">deprecated</a>, which means it may not be available in future versions of the Java.<br><br>Another method that can be confusing for the unadvised is <em>Thread.interrupt</em>. Despite what its name may imply, the method does not interrupt a running thread (more on this later), as <a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html#" target="_blank" rel="external">Listing A</a> demonstrates. It creates a thread and tries to stop it using <em>Thread.interrupt</em>. The calls to <em>Thread.sleep</em><em>(</em><em>)</em> give plenty of time for the thread initialization and termination. The thread itself does not do anything useful.<br><br>If you run the code in Listing A, you should see something like this on your console:<br>Starting thread…<br>Thread is running…<br>Thread is running…<br>Thread is running…<br>Interrupting thread…<br>Thread is running…<br>Thread is running…<br>Thread is running…<br>Stopping application…<br><br>Even after <em>Thread.interrupt</em><em>()</em> is called, the thread continues to run for a while.<br><br><strong>Really interrupting a thread</strong><br>The  best, recommended way to interrupt a thread is to use a shared variable  to signal that it must stop what it is doing. The thread must check the  variable periodically, especially during lengthy operations, and  terminate its task in an orderly manner. <a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html#" target="_blank" rel="external">Listing B</a> demonstrates this technique.<br><br>Running the code in Listing B will generate output like this (notice how the thread exits in an orderly fashion):<br>Starting thread…<br>Thread is running…<br>Thread is running…<br>Thread is running…<br>Asking thread to stop…<br>Thread exiting under request…<br>Stopping application…<br><br>Although  this method requires some coding, it is not difficult to implement and  give the thread the opportunity to do any cleanup needed, which is an  absolute requirement for any multithreaded application. Just be sure to  declare the shared variable as <em>volatile</em> or enclose any access to it into <em>synchronized</em> blocks/methods.<br><br>So  far, so good! But what happens if the thread is blocked waiting for  some event? Of course, if the thread is blocked, it can’t check the  shared variable and can’t stop. There are plenty of situations when that  may occur, such as calling <em>Object.wait</em><em>()</em>, <em>ServerSocket.accept</em><em>()</em>, and <em>DatagramSocket.receive</em><em>()</em>, to name a few.<br><br>They  all can block the thread forever. Even if a timeout is employed, it may  not be feasible or desirable to wait until the timeout expires, so a  mechanism to prematurely exit the blocked state must be used.<br><br>Unfortunately  there is no such mechanism that works for all cases, but the particular  technique to use depends on each situation. In the following sections,  I’ll give solutions for the most common cases.<br><br><strong>Interrupting a thread with Thread.interrupt()</strong><br>As demonstrated in Listing A, the method <em>Thread.interrupt</em><em>()</em>  does not interrupt a running thread. What the method actually does is  to throw an interrupt if the thread is blocked, so that it exits the  blocked state. More precisely, if the thread is blocked at one of the  methods <em>Object.wait</em>, <em>Thread.join</em>, or <em>Thread.sleep</em>, it receives an <em>InterruptedException</em>, thus terminating the blocking method prematurely.<br><br>So,  if a thread blocks in one of the aforementioned methods, the correct  way to stop it is to set the shared variable and then call the <em>interrupt()</em> method on it (notice that it is important to set the variable first). If the thread is not blocked, calling <em>interrupt(</em><em>)</em>  will not hurt; otherwise, the thread will get an exception (the thread  must be prepared to handle this condition) and escape the blocked state.  In either case, eventually the thread will test the shared variable and  stop. <a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html#" target="_blank" rel="external">Listing C</a> is a simple example that demonstrates this technique.<br><br>As soon as <em>Thread.interrupt</em><em>()</em> is called in Listing C,  the thread gets an exception so that it escapes the blocked state and  determines that it should stop. Running this code produces output like  this:<br>Starting thread…<br>Thread running…<br>Thread running…<br>Thread running…<br>Asking thread to stop…<br>Thread interrupted…<br>Thread exiting under request…<br>Stopping application…<br><br><strong>Interrupting an I/O operation</strong><br>But  what happens if the thread is blocked on an I/O operation? I/O can  block a thread for a considerable amount of time, particularly if  network communication is involved. For example, a server may be waiting  for a request, or a network application may be waiting for an answer  from a remote host.<br><br>If you’re using channels, available with the new I/O API introduced in Java 1.4, the blocked thread will get a <em>ClosedByInterruptException</em> exception. If that is the case, the logic is the same as that used in the third example—only the exception is different.<br><br>But  you might be using the traditional I/O available since Java 1.0, since  the new I/O is so recent and requires more work. In this case, <em>Thread.interrupt</em><em>()</em> doesn’t help, since the thread will not exit the blocked state. <a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html#" target="_blank" rel="external">Listing D</a> demonstrates that behavior. Although the <em>interrupt()</em> method is called, the thread does not exit the blocked state.<br><br>Fortunately, the Java Platform provides a solution for that case by calling the <em>close()</em>  method of the socket the thread is blocked in. In this case, if the  thread is blocked in an I/O operation, the thread will get a <em>SocketException</em> exception, much like the <em>interrupt()</em> method causes an <em>InterruptedException</em> to be thrown.<br><br>The only caveat is that a reference to the socket must be available so that its <em>close()</em> method can be called. That means the socket object must also be shared. <a href="http://articles.techrepublic.com.com/5100-10878_11-5144546.html#" target="_blank" rel="external">Listing E</a> demonstrates this case. The logic is the same as in the examples presented so far.<br><br>And here’s the sample output you can expect from running Listing E:<br>Starting thread…<br>Waiting for connection…<br>Asking thread to stop…<br>accept() failed or interrupted…<br>Thread exiting under request…<br>Stopping application…<br><br>Multithreading  is a powerful tool, but it presents its own set of challenges. One of  these is how to interrupt a running thread. If properly implemented,  these techniques make interrupting a thread no more difficult than using  the built-in operations already provided by the Java Platform. <p></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2010/09/08/Interrupting-Java-threads/" class="archive-article-date">
  	<time datetime="2010-09-08T07:41:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2010-09-08</time>
</a>
      
      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Java/">Java</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2010/09/12/反编译apk/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          反编译apk
        
      </div>
    </a>
  
  
    <a href="/2010/09/06/Android-HttpClient网络通信/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Android HttpClient网络通信</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>









      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 jfo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino-OpenWrt/">Arduino/OpenWrt</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DefaultCategory/">DefaultCategory</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Computing/">Distributed Computing</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/">Google</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">67</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-App/">Linux App</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Debug/">Linux Debug</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Virtualization/">Linux Virtualization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac-OS-X/">Mac OS X</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mobile/">Mobile</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Saying/">Saying</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDev/">WebDev</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows/">Windows</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-template-gp-boost/">c++/c++ template/gp/boost</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-algorithm/">c/c++/algorithm</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cocos2d-x-模拟器/">cocos2d-x/模拟器</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/com组件/">com组件</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gcc-binutils-make-共享库/">gcc/binutils/make/共享库</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js-html-python/">js/html/python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/l4ka-pistachio-iguana/">l4ka::pistachio/iguana</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux-图形/">linux 图形</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python-js-php-html-mysql-http/">python/js/php/html/mysql/http</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/self-collect/">self_collect</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unifiedkernel-wine-reactos/">unifiedkernel/wine/reactos</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/wordpress/">wordpress</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/产品/">产品</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学-物理/">数学/物理</a><span class="category-list-count">3</span></li></ul>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://iguangba.pickbox.me/">爱逛吧</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.pickbox.me/">收藏夹</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://note.pickbox.me/">网络剪贴板</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">jfojfo#gmail.com</div>
  	  	
    	</section>
    
  </div>
  
</div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>